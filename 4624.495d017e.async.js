(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4624],{64335:function(sr,L,x){"use strict";var Q=x(67294),w=(0,Q.createContext)({});L.Z=w},21349:function(sr,L,x){"use strict";var Q=x(84305),w=x(69224),d=x(17781),b=x.n(d),Y=x(67294),W=x(94184),$=x.n(W),I=x(64335),k=function(Be){var We=(0,Y.useContext)(I.Z),$e=Be.children,Ut=Be.contentWidth,Yt=Be.className,kt=Be.style,Lt=(0,Y.useContext)(w.ZP.ConfigContext),bt=Lt.getPrefixCls,pt=Be.prefixCls||bt("pro"),Ir=Ut||We.contentWidth,er="".concat(pt,"-grid-content");return Y.createElement("div",{className:$()(er,Yt,{wide:Ir==="Fixed"}),style:kt},Y.createElement("div",{className:"".concat(pt,"-grid-content-children")},$e))};L.Z=k},46343:function(sr,L,x){"use strict";x.d(L,{zj:function(){return gt},oI:function(){return un},ni:function(){return oe},gg:function(){return Br}});var Q=x(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function w(tr,se,be,ke){function Ce(Pt){return Pt instanceof be?Pt:new be(function(Dt){Dt(Pt)})}return new(be||(be=Promise))(function(Pt,Dt){function E(Ze){try{he(ke.next(Ze))}catch(qe){Dt(qe)}}function N(Ze){try{he(ke.throw(Ze))}catch(qe){Dt(qe)}}function he(Ze){Ze.done?Pt(Ze.value):Ce(Ze.value).then(E,N)}he((ke=ke.apply(tr,se||[])).next())})}function d(tr,se){var be={label:0,sent:function(){if(Pt[0]&1)throw Pt[1];return Pt[1]},trys:[],ops:[]},ke,Ce,Pt,Dt;return Dt={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(Dt[Symbol.iterator]=function(){return this}),Dt;function E(he){return function(Ze){return N([he,Ze])}}function N(he){if(ke)throw new TypeError("Generator is already executing.");for(;be;)try{if(ke=1,Ce&&(Pt=he[0]&2?Ce.return:he[0]?Ce.throw||((Pt=Ce.return)&&Pt.call(Ce),0):Ce.next)&&!(Pt=Pt.call(Ce,he[1])).done)return Pt;switch(Ce=0,Pt&&(he=[he[0]&2,Pt.value]),he[0]){case 0:case 1:Pt=he;break;case 4:return be.label++,{value:he[1],done:!1};case 5:be.label++,Ce=he[1],he=[0];continue;case 7:he=be.ops.pop(),be.trys.pop();continue;default:if(Pt=be.trys,!(Pt=Pt.length>0&&Pt[Pt.length-1])&&(he[0]===6||he[0]===2)){be=0;continue}if(he[0]===3&&(!Pt||he[1]>Pt[0]&&he[1]<Pt[3])){be.label=he[1];break}if(he[0]===6&&be.label<Pt[1]){be.label=Pt[1],Pt=he;break}if(Pt&&be.label<Pt[2]){be.label=Pt[2],be.ops.push(he);break}Pt[2]&&be.ops.pop(),be.trys.pop();continue}he=se.call(tr,be)}catch(Ze){he=[6,Ze],Ce=0}finally{ke=Pt=0}if(he[0]&5)throw he[1];return{value:he[0]?he[1]:void 0,done:!0}}}function b(tr,se){var be=typeof Symbol=="function"&&tr[Symbol.iterator];if(!be)return tr;var ke=be.call(tr),Ce,Pt=[],Dt;try{for(;(se===void 0||se-- >0)&&!(Ce=ke.next()).done;)Pt.push(Ce.value)}catch(E){Dt={error:E}}finally{try{Ce&&!Ce.done&&(be=ke.return)&&be.call(ke)}finally{if(Dt)throw Dt.error}}return Pt}function Y(){for(var tr=[],se=0;se<arguments.length;se++)tr=tr.concat(b(arguments[se]));return tr}function W(tr){return tr&&tr.__esModule&&Object.prototype.hasOwnProperty.call(tr,"default")?tr.default:tr}function $(tr,se){return se={exports:{}},tr(se,se.exports),se.exports}var I=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(ke){return ke&&typeof ke.length=="number"&&ke.length>=0&&ke.length%1==0}tr.exports=se.default});W(I);var k=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(be){return function(){for(var ke=[],Ce=arguments.length;Ce--;)ke[Ce]=arguments[Ce];var Pt=ke.pop();return be.call(this,ke,Pt)}},tr.exports=se.default});W(k);var we=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.fallback=Ce,se.wrap=Pt;var be=se.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,ke=se.hasNextTick=typeof Q=="object"&&typeof Q.nextTick=="function";function Ce(E){setTimeout(E,0)}function Pt(E){return function(N){for(var he=[],Ze=arguments.length-1;Ze-- >0;)he[Ze]=arguments[Ze+1];return E(function(){return N.apply(void 0,he)})}}var Dt;be?Dt=setImmediate:ke?Dt=Q.nextTick:Dt=Ce,se.default=Pt(Dt)});W(we);var Be=we.fallback,We=we.wrap,$e=we.hasSetImmediate,Ut=we.hasNextTick,Yt=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Pt;var be=Ce(k),ke=Ce(we);function Ce(N){return N&&N.__esModule?N:{default:N}}function Pt(N){return(0,kt.isAsync)(N)?function(){for(var he=[],Ze=arguments.length;Ze--;)he[Ze]=arguments[Ze];var qe=he.pop(),mt=N.apply(this,he);return Dt(mt,qe)}:(0,be.default)(function(he,Ze){var qe;try{qe=N.apply(this,he)}catch(mt){return Ze(mt)}if(qe&&typeof qe.then=="function")return Dt(qe,Ze);Ze(null,qe)})}function Dt(N,he){return N.then(function(Ze){E(he,null,Ze)},function(Ze){E(he,Ze&&Ze.message?Ze:new Error(Ze))})}function E(N,he,Ze){try{N(he,Ze)}catch(qe){(0,ke.default)(function(mt){throw mt},qe)}}tr.exports=se.default});W(Yt);var kt=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.isAsyncIterable=se.isAsyncGenerator=se.isAsync=void 0;var be=ke(Yt);function ke(N){return N&&N.__esModule?N:{default:N}}function Ce(N){return N[Symbol.toStringTag]==="AsyncFunction"}function Pt(N){return N[Symbol.toStringTag]==="AsyncGenerator"}function Dt(N){return typeof N[Symbol.asyncIterator]=="function"}function E(N){if(typeof N!="function")throw new Error("expected a function");return Ce(N)?(0,be.default)(N):N}se.default=E,se.isAsync=Ce,se.isAsyncGenerator=Pt,se.isAsyncIterable=Dt});W(kt);var Lt=kt.isAsyncIterable,bt=kt.isAsyncGenerator,pt=kt.isAsync,Ir=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(ke,Ce){if(Ce===void 0&&(Ce=ke.length),!Ce)throw new Error("arity is undefined");function Pt(){for(var Dt=this,E=[],N=arguments.length;N--;)E[N]=arguments[N];return typeof E[Ce-1]=="function"?ke.apply(this,E):new Promise(function(he,Ze){E[Ce-1]=function(qe){for(var mt=[],Ct=arguments.length-1;Ct-- >0;)mt[Ct]=arguments[Ct+1];if(qe)return Ze(qe);he(mt.length>1?mt:mt[0])},ke.apply(Dt,E)})}return Object.defineProperty(Pt,"name",{configurable:!0,value:"awaitable("+ke.name+")"}),Pt}tr.exports=se.default});W(Ir);var er=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Pt(I),ke=Pt(kt),Ce=Pt(Ir);function Pt(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}se.default=(0,Ce.default)(function(Dt,E,N){var he=(0,be.default)(E)?[]:{};Dt(E,function(Ze,qe,mt){(0,ke.default)(Ze)(function(Ct){for(var H,Kt=[],jt=arguments.length-1;jt-- >0;)Kt[jt]=arguments[jt+1];Kt.length<2&&(H=Kt,Kt=H[0]),he[qe]=Kt,mt(Ct)})},function(Ze){return N(Ze,he)})},3),tr.exports=se.default});W(er);var nr=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(ke){function Ce(){for(var Pt=[],Dt=arguments.length;Dt--;)Pt[Dt]=arguments[Dt];if(ke!==null){var E=ke;ke=null,E.apply(this,Pt)}}return Object.assign(Ce,ke),Ce}tr.exports=se.default});W(nr);var xt=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(be){return be[Symbol.iterator]&&be[Symbol.iterator]()},tr.exports=se.default});W(xt);var Ke=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=N;var be=Ce(I),ke=Ce(xt);function Ce(he){return he&&he.__esModule?he:{default:he}}function Pt(he){var Ze=-1,qe=he.length;return function(){return++Ze<qe?{value:he[Ze],key:Ze}:null}}function Dt(he){var Ze=-1;return function(){var mt=he.next();return mt.done?null:(Ze++,{value:mt.value,key:Ze})}}function E(he){var Ze=he?Object.keys(he):[],qe=-1,mt=Ze.length;return function(){var H=Ze[++qe];return qe<mt?{value:he[H],key:H}:null}}function N(he){if((0,be.default)(he))return Pt(he);var Ze=(0,ke.default)(he);return Ze?Dt(Ze):E(he)}tr.exports=se.default});W(Ke);var _t=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(ke){return function(){for(var Ce=[],Pt=arguments.length;Pt--;)Ce[Pt]=arguments[Pt];if(ke===null)throw new Error("Callback was already called.");var Dt=ke;ke=null,Dt.apply(this,Ce)}}tr.exports=se.default});W(_t);var Fe=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be={};se.default=be,tr.exports=se.default});W(Fe);var Pe=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Ce;var be=ke(Fe);function ke(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}function Ce(Pt,Dt,E,N){var he=!1,Ze=!1,qe=!1,mt=0,Ct=0;function H(){mt>=Dt||qe||he||(qe=!0,Pt.next().then(function(hr){var Cr=hr.value,Tr=hr.done;if(!(Ze||he)){if(qe=!1,Tr){he=!0,mt<=0&&N(null);return}mt++,E(Cr,Ct,Kt),Ct++,H()}}).catch(jt))}function Kt(hr,Cr){if(mt-=1,!Ze){if(hr)return jt(hr);if(hr===!1){he=!0,Ze=!0;return}if(Cr===be.default||he&&mt<=0)return he=!0,N(null);H()}}function jt(hr){Ze||(qe=!1,he=!0,N(hr))}H()}tr.exports=se.default});W(Pe);var Ve=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=E(nr),ke=E(Ke),Ce=E(_t),Pt=E(Pe),Dt=E(Fe);function E(N){return N&&N.__esModule?N:{default:N}}se.default=function(N){return function(he,Ze,qe){if(qe=(0,be.default)(qe),N<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!he)return qe(null);if((0,kt.isAsyncGenerator)(he))return(0,Pt.default)(he,N,Ze,qe);if((0,kt.isAsyncIterable)(he))return(0,Pt.default)(he[Symbol.asyncIterator](),N,Ze,qe);var mt=(0,ke.default)(he),Ct=!1,H=!1,Kt=0,jt=!1;function hr(Tr,Pr){if(!H)if(Kt-=1,Tr)Ct=!0,qe(Tr);else if(Tr===!1)Ct=!0,H=!0;else{if(Pr===Dt.default||Ct&&Kt<=0)return Ct=!0,qe(null);jt||Cr()}}function Cr(){for(jt=!0;Kt<N&&!Ct;){var Tr=mt();if(Tr===null){Ct=!0,Kt<=0&&qe(null);return}Kt+=1,Ze(Tr.value,Tr.key,(0,Ce.default)(hr))}jt=!1}Cr()}},tr.exports=se.default});W(Ve);var Et=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Pt(Ve),ke=Pt(kt),Ce=Pt(Ir);function Pt(E){return E&&E.__esModule?E:{default:E}}function Dt(E,N,he,Ze){return(0,be.default)(N)(E,(0,ke.default)(he),Ze)}se.default=(0,Ce.default)(Dt,4),tr.exports=se.default});W(Et);var gr=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Ce(Et),ke=Ce(Ir);function Ce(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Pt(Dt,E,N){return(0,be.default)(Dt,1,E,N)}se.default=(0,ke.default)(Pt,3),tr.exports=se.default});W(gr);var ae=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Pt;var be=Ce(er),ke=Ce(gr);function Ce(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Pt(Dt,E){return(0,be.default)(ke.default,Dt,E)}tr.exports=se.default}),Ae=W(ae),oe=function(){function tr(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];this.args=[],this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];return this.args=be,Ae(this.tasks)},tr.prototype.tap=function(se,be){var ke=this;this.tasks.push(function(Ce){be.apply(void 0,Y(ke.args)),Ce(null,se)})},tr}(),ge=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=he(I),ke=he(Fe),Ce=he(Et),Pt=he(nr),Dt=he(_t),E=he(kt),N=he(Ir);function he(Ct){return Ct&&Ct.__esModule?Ct:{default:Ct}}function Ze(Ct,H,Kt){Kt=(0,Pt.default)(Kt);var jt=0,hr=0,Cr=Ct.length,Tr=!1;Cr===0&&Kt(null);function Pr(Je,yt){Je===!1&&(Tr=!0),Tr!==!0&&(Je?Kt(Je):(++hr===Cr||yt===ke.default)&&Kt(null))}for(;jt<Cr;jt++)H(Ct[jt],jt,(0,Dt.default)(Pr))}function qe(Ct,H,Kt){return(0,Ce.default)(Ct,Infinity,H,Kt)}function mt(Ct,H,Kt){var jt=(0,be.default)(Ct)?Ze:qe;return jt(Ct,(0,E.default)(H),Kt)}se.default=(0,N.default)(mt,3),tr.exports=se.default});W(ge);var Me=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Pt;var be=Ce(ge),ke=Ce(er);function Ce(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Pt(Dt,E){return(0,ke.default)(be.default,Dt,E)}tr.exports=se.default}),Qe=W(Me),gt=function(){function tr(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];this.tasks=[]}return tr.prototype.promise=function(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];return Qe(this.tasks)},tr.prototype.tapPromise=function(se,be){var ke=this;this.tasks.push(function(Ce){return w(ke,void 0,void 0,function(){return d(this,function(Pt){switch(Pt.label){case 0:return[4,be()];case 1:return Pt.sent(),Ce(null,se),[2]}})})})},tr}(),Jt=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Dt(nr),ke=Dt(_t),Ce=Dt(kt),Pt=Dt(Ir);function Dt(N){return N&&N.__esModule?N:{default:N}}function E(N,he){if(he=(0,be.default)(he),!Array.isArray(N))return he(new Error("First argument to waterfall must be an array of functions"));if(!N.length)return he();var Ze=0;function qe(Ct){var H=(0,Ce.default)(N[Ze++]);H.apply(void 0,Ct.concat([(0,ke.default)(mt)]))}function mt(Ct){for(var H=[],Kt=arguments.length-1;Kt-- >0;)H[Kt]=arguments[Kt+1];if(Ct!==!1){if(Ct||Ze===N.length)return he.apply(void 0,[Ct].concat(H));qe(H)}}qe([])}se.default=(0,Pt.default)(E),tr.exports=se.default}),Dr=W(Jt),Br=function(){function tr(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];return Dr(this.tasks)},tr.prototype.tap=function(se,be){this.tasks.length===0?this.tasks.push(function(ke){var Ce=be();ke(Ce?null:!1,Ce)}):this.tasks.push(function(ke,Ce){var Pt=be();Ce(Pt?null:!1,se)})},tr}(),un=function(){function tr(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,be=[],ke=0;ke<arguments.length;ke++)be[ke]=se[ke];return Ae(this.tasks)},tr.prototype.tap=function(se,be){this.tasks.push(function(ke){var Ce=be();ke(Ce,se)})},tr}()},58881:function(sr,L,x){"use strict";x.d(L,{nC:function(){return Q.ZP},Hp:function(){return Q.Hp},e7:function(){return Q.e7},yT:function(){return Q.yT},vK:function(){return d.v},BlendType:function(){return Y.h},AttributeType:function(){return W.GC},ScaleTypes:function(){return W.vY},StyleScaleType:function(){return W.ee},MapServiceEvent:function(){return k.I},CoordinateSystem:function(){return we.l},CoordinateUniform:function(){return we.k},CameraUniform:function(){return $e.l},SceneEventList:function(){return kt.P},PositionType:function(){return xt.d},gl:function(){return N.gl}});var Q=x(85951),w=x(69530),d=x(72302),b=x(76915),Y=x(77252),W=x(31251),$=x(8628),I=x.n($);x.o($,"CameraUniform")&&x.d(L,{CameraUniform:function(){return $.CameraUniform}}),x.o($,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return $.CityBuildingLayer}}),x.o($,"CoordinateSystem")&&x.d(L,{CoordinateSystem:function(){return $.CoordinateSystem}}),x.o($,"CoordinateUniform")&&x.d(L,{CoordinateUniform:function(){return $.CoordinateUniform}}),x.o($,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return $.HeatmapLayer}}),x.o($,"ImageLayer")&&x.d(L,{ImageLayer:function(){return $.ImageLayer}}),x.o($,"LineLayer")&&x.d(L,{LineLayer:function(){return $.LineLayer}}),x.o($,"MapServiceEvent")&&x.d(L,{MapServiceEvent:function(){return $.MapServiceEvent}}),x.o($,"Marker")&&x.d(L,{Marker:function(){return $.Marker}}),x.o($,"PointLayer")&&x.d(L,{PointLayer:function(){return $.PointLayer}}),x.o($,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return $.PolygonLayer}}),x.o($,"Popup")&&x.d(L,{Popup:function(){return $.Popup}}),x.o($,"PositionType")&&x.d(L,{PositionType:function(){return $.PositionType}}),x.o($,"RasterLayer")&&x.d(L,{RasterLayer:function(){return $.RasterLayer}}),x.o($,"Scene")&&x.d(L,{Scene:function(){return $.Scene}}),x.o($,"SceneEventList")&&x.d(L,{SceneEventList:function(){return $.SceneEventList}}),x.o($,"gl")&&x.d(L,{gl:function(){return $.gl}});var k=x(16606),we=x(47282),Be=x(41906),We=x.n(Be);x.o(Be,"CameraUniform")&&x.d(L,{CameraUniform:function(){return Be.CameraUniform}}),x.o(Be,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Be.CityBuildingLayer}}),x.o(Be,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Be.HeatmapLayer}}),x.o(Be,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Be.ImageLayer}}),x.o(Be,"LineLayer")&&x.d(L,{LineLayer:function(){return Be.LineLayer}}),x.o(Be,"Marker")&&x.d(L,{Marker:function(){return Be.Marker}}),x.o(Be,"PointLayer")&&x.d(L,{PointLayer:function(){return Be.PointLayer}}),x.o(Be,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Be.PolygonLayer}}),x.o(Be,"Popup")&&x.d(L,{Popup:function(){return Be.Popup}}),x.o(Be,"PositionType")&&x.d(L,{PositionType:function(){return Be.PositionType}}),x.o(Be,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Be.RasterLayer}}),x.o(Be,"Scene")&&x.d(L,{Scene:function(){return Be.Scene}}),x.o(Be,"SceneEventList")&&x.d(L,{SceneEventList:function(){return Be.SceneEventList}}),x.o(Be,"gl")&&x.d(L,{gl:function(){return Be.gl}});var $e=x(4594),Ut=x(1910),Yt=x.n(Ut);x.o(Ut,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ut.CityBuildingLayer}}),x.o(Ut,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ut.HeatmapLayer}}),x.o(Ut,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ut.ImageLayer}}),x.o(Ut,"LineLayer")&&x.d(L,{LineLayer:function(){return Ut.LineLayer}}),x.o(Ut,"Marker")&&x.d(L,{Marker:function(){return Ut.Marker}}),x.o(Ut,"PointLayer")&&x.d(L,{PointLayer:function(){return Ut.PointLayer}}),x.o(Ut,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ut.PolygonLayer}}),x.o(Ut,"Popup")&&x.d(L,{Popup:function(){return Ut.Popup}}),x.o(Ut,"PositionType")&&x.d(L,{PositionType:function(){return Ut.PositionType}}),x.o(Ut,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ut.RasterLayer}}),x.o(Ut,"Scene")&&x.d(L,{Scene:function(){return Ut.Scene}}),x.o(Ut,"SceneEventList")&&x.d(L,{SceneEventList:function(){return Ut.SceneEventList}}),x.o(Ut,"gl")&&x.d(L,{gl:function(){return Ut.gl}});var kt=x(19793),Lt=x(93102),bt=x.n(Lt);x.o(Lt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Lt.CityBuildingLayer}}),x.o(Lt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Lt.HeatmapLayer}}),x.o(Lt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Lt.ImageLayer}}),x.o(Lt,"LineLayer")&&x.d(L,{LineLayer:function(){return Lt.LineLayer}}),x.o(Lt,"Marker")&&x.d(L,{Marker:function(){return Lt.Marker}}),x.o(Lt,"PointLayer")&&x.d(L,{PointLayer:function(){return Lt.PointLayer}}),x.o(Lt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Lt.PolygonLayer}}),x.o(Lt,"Popup")&&x.d(L,{Popup:function(){return Lt.Popup}}),x.o(Lt,"PositionType")&&x.d(L,{PositionType:function(){return Lt.PositionType}}),x.o(Lt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Lt.RasterLayer}}),x.o(Lt,"Scene")&&x.d(L,{Scene:function(){return Lt.Scene}}),x.o(Lt,"gl")&&x.d(L,{gl:function(){return Lt.gl}});var pt=x(64532),Ir=x.n(pt);x.o(pt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return pt.CityBuildingLayer}}),x.o(pt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return pt.HeatmapLayer}}),x.o(pt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return pt.ImageLayer}}),x.o(pt,"LineLayer")&&x.d(L,{LineLayer:function(){return pt.LineLayer}}),x.o(pt,"Marker")&&x.d(L,{Marker:function(){return pt.Marker}}),x.o(pt,"PointLayer")&&x.d(L,{PointLayer:function(){return pt.PointLayer}}),x.o(pt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return pt.PolygonLayer}}),x.o(pt,"Popup")&&x.d(L,{Popup:function(){return pt.Popup}}),x.o(pt,"PositionType")&&x.d(L,{PositionType:function(){return pt.PositionType}}),x.o(pt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return pt.RasterLayer}}),x.o(pt,"Scene")&&x.d(L,{Scene:function(){return pt.Scene}}),x.o(pt,"gl")&&x.d(L,{gl:function(){return pt.gl}});var er=x(2811),nr=x.n(er);x.o(er,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return er.CityBuildingLayer}}),x.o(er,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return er.HeatmapLayer}}),x.o(er,"ImageLayer")&&x.d(L,{ImageLayer:function(){return er.ImageLayer}}),x.o(er,"LineLayer")&&x.d(L,{LineLayer:function(){return er.LineLayer}}),x.o(er,"Marker")&&x.d(L,{Marker:function(){return er.Marker}}),x.o(er,"PointLayer")&&x.d(L,{PointLayer:function(){return er.PointLayer}}),x.o(er,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return er.PolygonLayer}}),x.o(er,"Popup")&&x.d(L,{Popup:function(){return er.Popup}}),x.o(er,"PositionType")&&x.d(L,{PositionType:function(){return er.PositionType}}),x.o(er,"RasterLayer")&&x.d(L,{RasterLayer:function(){return er.RasterLayer}}),x.o(er,"Scene")&&x.d(L,{Scene:function(){return er.Scene}}),x.o(er,"gl")&&x.d(L,{gl:function(){return er.gl}});var xt=x(66690),Ke=x(81732),_t=x.n(Ke);x.o(Ke,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ke.CityBuildingLayer}}),x.o(Ke,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ke.HeatmapLayer}}),x.o(Ke,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ke.ImageLayer}}),x.o(Ke,"LineLayer")&&x.d(L,{LineLayer:function(){return Ke.LineLayer}}),x.o(Ke,"Marker")&&x.d(L,{Marker:function(){return Ke.Marker}}),x.o(Ke,"PointLayer")&&x.d(L,{PointLayer:function(){return Ke.PointLayer}}),x.o(Ke,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ke.PolygonLayer}}),x.o(Ke,"Popup")&&x.d(L,{Popup:function(){return Ke.Popup}}),x.o(Ke,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ke.RasterLayer}}),x.o(Ke,"Scene")&&x.d(L,{Scene:function(){return Ke.Scene}}),x.o(Ke,"gl")&&x.d(L,{gl:function(){return Ke.gl}});var Fe=x(84007),Pe=x.n(Fe);x.o(Fe,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Fe.CityBuildingLayer}}),x.o(Fe,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Fe.HeatmapLayer}}),x.o(Fe,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Fe.ImageLayer}}),x.o(Fe,"LineLayer")&&x.d(L,{LineLayer:function(){return Fe.LineLayer}}),x.o(Fe,"Marker")&&x.d(L,{Marker:function(){return Fe.Marker}}),x.o(Fe,"PointLayer")&&x.d(L,{PointLayer:function(){return Fe.PointLayer}}),x.o(Fe,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Fe.PolygonLayer}}),x.o(Fe,"Popup")&&x.d(L,{Popup:function(){return Fe.Popup}}),x.o(Fe,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Fe.RasterLayer}}),x.o(Fe,"Scene")&&x.d(L,{Scene:function(){return Fe.Scene}}),x.o(Fe,"gl")&&x.d(L,{gl:function(){return Fe.gl}});var Ve=x(79042),Et=x.n(Ve);x.o(Ve,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ve.CityBuildingLayer}}),x.o(Ve,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ve.HeatmapLayer}}),x.o(Ve,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ve.ImageLayer}}),x.o(Ve,"LineLayer")&&x.d(L,{LineLayer:function(){return Ve.LineLayer}}),x.o(Ve,"Marker")&&x.d(L,{Marker:function(){return Ve.Marker}}),x.o(Ve,"PointLayer")&&x.d(L,{PointLayer:function(){return Ve.PointLayer}}),x.o(Ve,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ve.PolygonLayer}}),x.o(Ve,"Popup")&&x.d(L,{Popup:function(){return Ve.Popup}}),x.o(Ve,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ve.RasterLayer}}),x.o(Ve,"Scene")&&x.d(L,{Scene:function(){return Ve.Scene}}),x.o(Ve,"gl")&&x.d(L,{gl:function(){return Ve.gl}});var gr=x(89648),ae=x(90919),Ae=x.n(ae);x.o(ae,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),x.o(ae,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return ae.HeatmapLayer}}),x.o(ae,"ImageLayer")&&x.d(L,{ImageLayer:function(){return ae.ImageLayer}}),x.o(ae,"LineLayer")&&x.d(L,{LineLayer:function(){return ae.LineLayer}}),x.o(ae,"Marker")&&x.d(L,{Marker:function(){return ae.Marker}}),x.o(ae,"PointLayer")&&x.d(L,{PointLayer:function(){return ae.PointLayer}}),x.o(ae,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return ae.PolygonLayer}}),x.o(ae,"Popup")&&x.d(L,{Popup:function(){return ae.Popup}}),x.o(ae,"RasterLayer")&&x.d(L,{RasterLayer:function(){return ae.RasterLayer}}),x.o(ae,"Scene")&&x.d(L,{Scene:function(){return ae.Scene}}),x.o(ae,"gl")&&x.d(L,{gl:function(){return ae.gl}});var oe=x(75925),ge=x.n(oe);x.o(oe,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return oe.CityBuildingLayer}}),x.o(oe,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return oe.HeatmapLayer}}),x.o(oe,"ImageLayer")&&x.d(L,{ImageLayer:function(){return oe.ImageLayer}}),x.o(oe,"LineLayer")&&x.d(L,{LineLayer:function(){return oe.LineLayer}}),x.o(oe,"Marker")&&x.d(L,{Marker:function(){return oe.Marker}}),x.o(oe,"PointLayer")&&x.d(L,{PointLayer:function(){return oe.PointLayer}}),x.o(oe,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return oe.PolygonLayer}}),x.o(oe,"Popup")&&x.d(L,{Popup:function(){return oe.Popup}}),x.o(oe,"RasterLayer")&&x.d(L,{RasterLayer:function(){return oe.RasterLayer}}),x.o(oe,"Scene")&&x.d(L,{Scene:function(){return oe.Scene}}),x.o(oe,"gl")&&x.d(L,{gl:function(){return oe.gl}});var Me=x(85040),Qe=x.n(Me);x.o(Me,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Me.CityBuildingLayer}}),x.o(Me,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Me.HeatmapLayer}}),x.o(Me,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Me.ImageLayer}}),x.o(Me,"LineLayer")&&x.d(L,{LineLayer:function(){return Me.LineLayer}}),x.o(Me,"Marker")&&x.d(L,{Marker:function(){return Me.Marker}}),x.o(Me,"PointLayer")&&x.d(L,{PointLayer:function(){return Me.PointLayer}}),x.o(Me,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Me.PolygonLayer}}),x.o(Me,"Popup")&&x.d(L,{Popup:function(){return Me.Popup}}),x.o(Me,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Me.RasterLayer}}),x.o(Me,"Scene")&&x.d(L,{Scene:function(){return Me.Scene}}),x.o(Me,"gl")&&x.d(L,{gl:function(){return Me.gl}});var gt=x(8594),Jt=x.n(gt);x.o(gt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return gt.CityBuildingLayer}}),x.o(gt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return gt.HeatmapLayer}}),x.o(gt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return gt.ImageLayer}}),x.o(gt,"LineLayer")&&x.d(L,{LineLayer:function(){return gt.LineLayer}}),x.o(gt,"Marker")&&x.d(L,{Marker:function(){return gt.Marker}}),x.o(gt,"PointLayer")&&x.d(L,{PointLayer:function(){return gt.PointLayer}}),x.o(gt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return gt.PolygonLayer}}),x.o(gt,"Popup")&&x.d(L,{Popup:function(){return gt.Popup}}),x.o(gt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return gt.RasterLayer}}),x.o(gt,"Scene")&&x.d(L,{Scene:function(){return gt.Scene}}),x.o(gt,"gl")&&x.d(L,{gl:function(){return gt.gl}});var Dr=x(67571),Br=x.n(Dr);x.o(Dr,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Dr.CityBuildingLayer}}),x.o(Dr,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Dr.HeatmapLayer}}),x.o(Dr,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Dr.ImageLayer}}),x.o(Dr,"LineLayer")&&x.d(L,{LineLayer:function(){return Dr.LineLayer}}),x.o(Dr,"Marker")&&x.d(L,{Marker:function(){return Dr.Marker}}),x.o(Dr,"PointLayer")&&x.d(L,{PointLayer:function(){return Dr.PointLayer}}),x.o(Dr,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Dr.PolygonLayer}}),x.o(Dr,"Popup")&&x.d(L,{Popup:function(){return Dr.Popup}}),x.o(Dr,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Dr.RasterLayer}}),x.o(Dr,"Scene")&&x.d(L,{Scene:function(){return Dr.Scene}}),x.o(Dr,"gl")&&x.d(L,{gl:function(){return Dr.gl}});var un=x(66718),tr=x.n(un);x.o(un,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return un.CityBuildingLayer}}),x.o(un,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return un.HeatmapLayer}}),x.o(un,"ImageLayer")&&x.d(L,{ImageLayer:function(){return un.ImageLayer}}),x.o(un,"LineLayer")&&x.d(L,{LineLayer:function(){return un.LineLayer}}),x.o(un,"Marker")&&x.d(L,{Marker:function(){return un.Marker}}),x.o(un,"PointLayer")&&x.d(L,{PointLayer:function(){return un.PointLayer}}),x.o(un,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return un.PolygonLayer}}),x.o(un,"Popup")&&x.d(L,{Popup:function(){return un.Popup}}),x.o(un,"RasterLayer")&&x.d(L,{RasterLayer:function(){return un.RasterLayer}}),x.o(un,"Scene")&&x.d(L,{Scene:function(){return un.Scene}}),x.o(un,"gl")&&x.d(L,{gl:function(){return un.gl}});var se=x(92364),be=x(78010),ke=x.n(be);x.o(be,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return be.CityBuildingLayer}}),x.o(be,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return be.HeatmapLayer}}),x.o(be,"ImageLayer")&&x.d(L,{ImageLayer:function(){return be.ImageLayer}}),x.o(be,"LineLayer")&&x.d(L,{LineLayer:function(){return be.LineLayer}}),x.o(be,"Marker")&&x.d(L,{Marker:function(){return be.Marker}}),x.o(be,"PointLayer")&&x.d(L,{PointLayer:function(){return be.PointLayer}}),x.o(be,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return be.PolygonLayer}}),x.o(be,"Popup")&&x.d(L,{Popup:function(){return be.Popup}}),x.o(be,"RasterLayer")&&x.d(L,{RasterLayer:function(){return be.RasterLayer}}),x.o(be,"Scene")&&x.d(L,{Scene:function(){return be.Scene}}),x.o(be,"gl")&&x.d(L,{gl:function(){return be.gl}});var Ce=x(68116),Pt=x.n(Ce);x.o(Ce,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ce.CityBuildingLayer}}),x.o(Ce,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ce.HeatmapLayer}}),x.o(Ce,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ce.ImageLayer}}),x.o(Ce,"LineLayer")&&x.d(L,{LineLayer:function(){return Ce.LineLayer}}),x.o(Ce,"Marker")&&x.d(L,{Marker:function(){return Ce.Marker}}),x.o(Ce,"PointLayer")&&x.d(L,{PointLayer:function(){return Ce.PointLayer}}),x.o(Ce,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ce.PolygonLayer}}),x.o(Ce,"Popup")&&x.d(L,{Popup:function(){return Ce.Popup}}),x.o(Ce,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ce.RasterLayer}}),x.o(Ce,"Scene")&&x.d(L,{Scene:function(){return Ce.Scene}}),x.o(Ce,"gl")&&x.d(L,{gl:function(){return Ce.gl}});var Dt=x(23067),E=x.n(Dt);x.o(Dt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Dt.CityBuildingLayer}}),x.o(Dt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Dt.HeatmapLayer}}),x.o(Dt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Dt.ImageLayer}}),x.o(Dt,"LineLayer")&&x.d(L,{LineLayer:function(){return Dt.LineLayer}}),x.o(Dt,"Marker")&&x.d(L,{Marker:function(){return Dt.Marker}}),x.o(Dt,"PointLayer")&&x.d(L,{PointLayer:function(){return Dt.PointLayer}}),x.o(Dt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Dt.PolygonLayer}}),x.o(Dt,"Popup")&&x.d(L,{Popup:function(){return Dt.Popup}}),x.o(Dt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Dt.RasterLayer}}),x.o(Dt,"Scene")&&x.d(L,{Scene:function(){return Dt.Scene}}),x.o(Dt,"gl")&&x.d(L,{gl:function(){return Dt.gl}});var N=x(7648)},85951:function(sr,L,x){"use strict";x.d(L,{e7:function(){return ru},Hp:function(){return lf},ZP:function(){return Hl},yT:function(){return Wc}});var Q=x(28660),w=x(26729),d=x.n(w),b=x(86700),Y=x(84879),W=x(72302),$=x(6610),I=x(5991),k=x(96156),we=x(6901),Be=x(49296),We=x.n(Be);function $e(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Ut(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?$e(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):$e(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Yt(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=kt(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function kt(j,z){if(!!j){if(typeof j=="string")return Lt(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Lt(j,z)}}function Lt(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var bt=30;function pt(j){var z=j.characterSet,M=j.getFontWidth,D=j.fontHeight,ne=j.buffer,_e=j.maxCanvasWidth,vt=j.mapping,Vt=vt===void 0?{}:vt,Bt=j.xOffset,Sr=Bt===void 0?0:Bt,qr=j.yOffset,Rn=qr===void 0?0:qr,Gn=0,Mn=Sr;Array.from(z).forEach(function(yi,aa){if(!Vt[yi]){var Mi=M(yi,aa);Mn+bt>_e&&(Mn=0,Gn++),Vt[yi]={x:Mn,y:Rn+Gn*bt,width:bt,height:bt,advance:Mi},Mn+=bt}});var di=D+ne*2;return{mapping:Vt,xOffset:Mn,yOffset:Rn+Gn*di,canvasHeight:nr(Rn+(Gn+1)*di)}}function Ir(j,z,M){var D=0,ne=0,_e=0,vt=[],Vt={},Bt=Yt(j),Sr;try{for(Bt.s();!(Sr=Bt.n()).done;){var qr=Sr.value;if(!Vt[qr.id]){var Rn=qr.size;D+Rn+z>M&&(er(Vt,vt,ne),D=0,ne=_e+ne+z,_e=0,vt=[]),vt.push({icon:qr,xOffset:D}),D=D+Rn+z,_e=Math.max(_e,Rn)}}}catch(Mn){Bt.e(Mn)}finally{Bt.f()}vt.length>0&&er(Vt,vt,ne);var Gn=nr(_e+ne+z);return{mapping:Vt,canvasHeight:Gn}}function er(j,z,M){var D=Yt(z),ne;try{for(D.s();!(ne=D.n()).done;){var _e=ne.value,vt=_e.icon,Vt=_e.xOffset;j[vt.id]=Ut(Ut({},vt),{},{x:Vt,y:M,image:vt.image,width:vt.width,height:vt.height})}}catch(Bt){D.e(Bt)}finally{D.f()}}function nr(j){return Math.pow(2,Math.ceil(Math.log2(j)))}var xt,Ke;function _t(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=Fe(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function Fe(j,z){if(!!j){if(typeof j=="string")return Pe(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Pe(j,z)}}function Pe(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}function Ve(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Et(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ve(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ve(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var gr=tr(),ae="sans-serif",Ae="normal",oe=24,ge=3,Me=.25,Qe=8,gt=1024,Jt=1,Dr=1,Br=3,un=null;function tr(){for(var j=[],z=32;z<128;z++)j.push(String.fromCharCode(z));return j}function se(j,z,M,D){j.font="".concat(D," ").concat(M,"px ").concat(z),j.fillStyle="black",j.textBaseline="middle"}function be(j,z){for(var M=0;M<j.length;M++)z.data[4*M+3]=j[M]}var ke=(xt=(0,b.b2)(),xt(Ke=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"fontAtlas",void 0),(0,k.Z)(this,"iconFontMap",void 0),(0,k.Z)(this,"iconFontGlyphs",{}),(0,k.Z)(this,"fontOptions",void 0),(0,k.Z)(this,"key",void 0),(0,k.Z)(this,"cache",new we.z6(Br))}return(0,I.Z)(j,[{key:"scale",get:function(){return Dr}},{key:"canvas",get:function(){var M=this.cache.get(this.key);return M&&M.data}},{key:"mapping",get:function(){var M=this.cache.get(this.key);return M&&M.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ae,fontWeight:Ae,characterSet:gr,fontSize:oe,buffer:ge,sdf:!0,cutoff:Me,radius:Qe,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(M){var D=this;M.forEach(function(ne){D.iconFontGlyphs[ne.name]=ne.unicode})}},{key:"addIconFont",value:function(M,D){this.iconFontMap.set(M,D)}},{key:"getIconFontKey",value:function(M){return this.iconFontMap.get(M)||M}},{key:"getGlyph",value:function(M){return this.iconFontGlyphs[M]?String.fromCharCode(parseInt(this.iconFontGlyphs[M],16)):""}},{key:"setFontOptions",value:function(M){this.fontOptions=Et(Et({},this.fontOptions),M),this.key=this.getKey();var D=this.getNewChars(this.key,this.fontOptions.characterSet),ne=this.cache.get(this.key);if(!(ne&&D.length===0)){var _e=this.generateFontAtlas(this.key,D,ne);this.fontAtlas=_e,this.cache.set(this.key,_e)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(M,D,ne){var _e=this.fontOptions,vt=_e.fontFamily,Vt=_e.fontWeight,Bt=_e.fontSize,Sr=_e.buffer,qr=_e.sdf,Rn=_e.radius,Gn=_e.cutoff,Mn=_e.iconfont,di=ne&&ne.data;di||(di=document.createElement("canvas"),di.width=gt);var yi=di.getContext("2d");se(yi,vt,Bt,Vt);var aa=pt(Et({getFontWidth:function(cf){return yi.measureText(cf).width},fontHeight:Bt*Dr,buffer:Sr,characterSet:D,maxCanvasWidth:gt},ne&&{mapping:ne.mapping,xOffset:ne.xOffset,yOffset:ne.yOffset})),Mi=aa.mapping,Ha=aa.canvasHeight,Mo=aa.xOffset,bo=aa.yOffset,So=yi.getImageData(0,0,di.width,di.height);if(di.height=Ha,yi.putImageData(So,0,0),se(yi,vt,Bt,Vt),qr){var Qa=new(We())(Bt,Sr,Rn,Gn,vt,Vt),ca=yi.getImageData(0,0,Qa.size,Qa.size),Wa=_t(D),Eo;try{for(Wa.s();!(Eo=Wa.n()).done;){var oo=Eo.value;if(Mn){var wo=String.fromCharCode(parseInt(oo.replace("&#x","").replace(";",""),16)),Ds=Qa.draw(wo);be(Ds,ca)}else be(Qa.draw(oo),ca);yi.putImageData(ca,Mi[oo].x,Mi[oo].y)}}catch(Xc){Wa.e(Xc)}finally{Wa.f()}}else{var mu=_t(D),Zu;try{for(mu.s();!(Zu=mu.n()).done;){var Ss=Zu.value;yi.fillText(Ss,Mi[Ss].x,Mi[Ss].y+Bt*Jt)}}catch(Xc){mu.e(Xc)}finally{mu.f()}}return{xOffset:Mo,yOffset:bo,mapping:Mi,data:di,width:di.width,height:di.height}}},{key:"getKey",value:function(){return"key";var M,D,ne,_e,vt,Vt,Bt,Sr}},{key:"getNewChars",value:function(M,D){var ne=this.cache.get(M);if(!ne)return D;var _e=[],vt=ne.mapping,Vt=new Set(Object.keys(vt)),Bt=new Set(D);return Bt.forEach(function(Sr){Vt.has(Sr)||_e.push(Sr)}),_e}}]),j}())||Ke),Ce=x(63349),Pt=x(10379),Dt=x(46070),E=x(77608),N,he;function Ze(j){var z=qe();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var mt=3,Ct=1024,H=64,Kt=(N=(0,b.b2)(),N(he=function(j){(0,Pt.Z)(M,j);var z=Ze(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),vt=0;vt<ne;vt++)_e[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(_e)),(0,k.Z)((0,Ce.Z)(D),"canvasHeight",128),(0,k.Z)((0,Ce.Z)(D),"texture",void 0),(0,k.Z)((0,Ce.Z)(D),"canvas",void 0),(0,k.Z)((0,Ce.Z)(D),"iconData",void 0),(0,k.Z)((0,Ce.Z)(D),"iconMap",void 0),(0,k.Z)((0,Ce.Z)(D),"ctx",void 0),(0,k.Z)((0,Ce.Z)(D),"loadingImageCount",0),D}return(0,I.Z)(M,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ne,_e){var vt=this,Vt=new Image;if(this.loadingImageCount++,this.hasImage(ne))throw new Error("Image Id already exists");this.iconData.push({id:ne,size:H}),this.updateIconMap(),this.loadImage(_e).then(function(Bt){Vt=Bt;var Sr=vt.iconData.find(function(qr){return qr.id===ne});Sr&&(Sr.image=Vt,Sr.width=Vt.width,Sr.height=Vt.height),vt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ne){return this.iconMap.hasOwnProperty(ne)}},{key:"removeImage",value:function(ne){this.hasImage(ne)&&(this.iconData=this.iconData.filter(function(_e){return _e.id!==ne}),delete this.iconMap[ne],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ne=this;this.canvas.width=Ct,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(_e){var vt=ne.iconMap[_e],Vt=vt.x,Bt=vt.y,Sr=vt.image,qr=vt.width,Rn=qr===void 0?64:qr,Gn=vt.height,Mn=Gn===void 0?64:Gn,di=Math.max(Rn,Mn),yi=di/H,aa=Mn/yi,Mi=Rn/yi;Sr&&ne.ctx.drawImage(Sr,Vt+(H-Mi)/2,Bt+(H-aa)/2,Mi,aa)})}},{key:"updateIconMap",value:function(){var ne=Ir(this.iconData,mt,Ct),_e=ne.mapping,vt=ne.canvasHeight;this.iconMap=_e,this.canvasHeight=vt}},{key:"loadImage",value:function(ne){return new Promise(function(_e,vt){if(ne instanceof HTMLImageElement){_e(ne);return}var Vt=new Image;Vt.crossOrigin="anonymous",Vt.onload=function(){_e(Vt)},Vt.onerror=function(){vt(new Error("Could not load image at "+ne))},Vt.src=ne instanceof File?URL.createObjectURL(ne):ne})}}]),M}(w.EventEmitter))||he),jt=x(28481),hr=x(85975),Cr,Tr,Pr=(Cr=(0,b.b2)(),Cr(Tr=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"viewport",void 0),(0,k.Z)(this,"overridedViewProjectionMatrix",void 0),(0,k.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,k.Z)(this,"jitteredProjectionMatrix",void 0),(0,k.Z)(this,"viewMatrixInverse",void 0),(0,k.Z)(this,"cameraPosition",void 0)}return(0,I.Z)(j,[{key:"init",value:function(){}},{key:"update",value:function(M){this.viewport=M,this.viewMatrixInverse=hr.create(),hr.invert(this.viewMatrixInverse,M.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var M=this.viewport.getCenter(),D=(0,jt.Z)(M,2),ne=D[0],_e=D[1];return[ne,_e]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(M,D){return this.viewport.projectFlat(M,D)}},{key:"setViewProjectionMatrix",value:function(M){this.overridedViewProjectionMatrix=M}},{key:"jitterProjectionMatrix",value:function(M,D){var ne=hr.fromTranslation(hr.create(),[M,D,0]);this.jitteredProjectionMatrix=hr.multiply(hr.create(),ne,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=hr.multiply(hr.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),j}())||Tr),Je,yt;function ht(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=fr(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function fr(j,z){if(!!j){if(typeof j=="string")return $r(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return $r(j,z)}}function $r(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var lt=(Je=(0,b.b2)(),Je(yt=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"container",void 0),(0,k.Z)(this,"controlCorners",void 0),(0,k.Z)(this,"controlContainer",void 0),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"controls",[]),(0,k.Z)(this,"unAddControls",[])}return(0,I.Z)(j,[{key:"init",value:function(M,D){this.container=M.container,this.scene=D,this.mapsService=D.get(W.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(M,D){var ne=D.get(W.v.IMapService);ne.map?(M.addTo(this.scene),this.controls.push(M)):this.unAddControls.push(M)}},{key:"getControlByName",value:function(M){return this.controls.find(function(D){return D.controlOption.name===M})}},{key:"removeControl",value:function(M){var D=this.controls.indexOf(M);return D>-1&&this.controls.splice(D,1),M.remove(),this}},{key:"addControls",value:function(){var M=this;this.unAddControls.forEach(function(D){D.addTo(M.scene),M.controls.push(D)}),this.unAddControls=[]}},{key:"destroy",value:function(){var M=ht(this.controls),D;try{for(M.s();!(D=M.n()).done;){var ne=D.value;ne.remove()}}catch(_e){M.e(_e)}finally{M.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var M=this.controlCorners={},D="l7-",ne=this.controlContainer=we.SO.create("div",D+"control-container",this.container);function _e(vt,Vt){var Bt=D+vt+" "+D+Vt;M[vt+Vt]=we.SO.create("div",Bt,ne)}_e("top","left"),_e("top","right"),_e("bottom","left"),_e("bottom","right")}},{key:"clearControlPos",value:function(){for(var M in this.controlCorners)this.controlCorners[M]&&we.SO.remove(this.controlCorners[M]);this.controlContainer&&we.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),j}())||yt),Rt,Qt,pr=(Rt=(0,b.b2)(),Rt(Qt=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"container",void 0),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"markers",[]),(0,k.Z)(this,"markerLayers",[]),(0,k.Z)(this,"unAddMarkers",[]),(0,k.Z)(this,"unAddMarkerLayers",[])}return(0,I.Z)(j,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var D=this.markerLayers.indexOf(M);D>-1&&this.markerLayers.splice(D,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(D){D.addTo(M.scene),M.markers.push(D)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(D){M.markerLayers.push(D),D.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var D=this.markers.indexOf(M);D>-1&&this.markers.splice(D,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(W.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),j}())||Qt),vn,Pn,bi=(vn=(0,b.b2)(),vn(Pn=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"popup",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"unAddPopup",void 0)}return(0,I.Z)(j,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(W.v.IMapService)}}]),j}())||Pn),Si=x(82492),Ri=x.n(Si),ia={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},pi=ia,G,ie;function ce(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function B(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ce(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ce(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var re={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},fe={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Se=(G=(0,b.b2)(),G(ie=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"sceneConfigCache",{}),(0,k.Z)(this,"layerConfigCache",{})}return(0,I.Z)(j,[{key:"getSceneConfig",value:function(M){return this.sceneConfigCache[M]}},{key:"getSceneWarninfo",value:function(M){return pi[M]}},{key:"setSceneConfig",value:function(M,D){this.sceneConfigCache[M]=B(B({},re),D)}},{key:"getLayerConfig",value:function(M){return this.layerConfigCache[M]}},{key:"setLayerConfig",value:function(M,D,ne){this.layerConfigCache[D]=B({},Ri()({},this.sceneConfigCache[M],fe,ne))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),j}())||ie),te=x(55770),me=x(3473),ct=x(98333),yr=Math.PI/180,Or=512,Ft=4003e4;function kr(j){var z=j.latitude,M=z===void 0?0:z,D=j.zoom,ne=D===void 0?0:D,_e=j.scale,vt=j.highPrecision,Vt=vt===void 0?!1:vt,Bt=j.flipY,Sr=Bt===void 0?!1:Bt;_e=_e!==void 0?_e:Math.pow(2,ne);var qr={},Rn=Or*_e,Gn=Math.cos(M*yr),Mn=Rn/360,di=Mn/Gn,yi=Rn/Ft/Gn;if(qr.pixelsPerMeter=[yi,-yi,yi],qr.metersPerPixel=[1/yi,-1/yi,1/yi],qr.pixelsPerDegree=[Mn,-di,yi],qr.degreesPerPixel=[1/Mn,-1/di,1/yi],Vt){var aa=yr*Math.tan(M*yr)/Gn,Mi=Mn*aa/2,Ha=Rn/Ft*aa,Mo=Ha/di*yi;qr.pixelsPerDegree2=[0,-Mi,Ha],qr.pixelsPerMeter2=[Mo,0,Mo],Sr&&(qr.pixelsPerDegree2[1]=-qr.pixelsPerDegree2[1],qr.pixelsPerMeter2[1]=-qr.pixelsPerMeter2[1])}return Sr&&(qr.pixelsPerMeter[1]=-qr.pixelsPerMeter[1],qr.metersPerPixel[1]=-qr.metersPerPixel[1],qr.pixelsPerDegree[1]=-qr.pixelsPerDegree[1],qr.degreesPerPixel[1]=-qr.degreesPerPixel[1]),qr}var bn=x(47282),gn,mr,dn,Wr,ln,Ei=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],hn=(gn=(0,b.b2)(),mr=(0,b.f3)(W.v.ICameraService),gn(dn=(Wr=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"needRefresh",!0),(0,te.Z)(this,"cameraService",ln,this),(0,k.Z)(this,"coordinateSystem",void 0),(0,k.Z)(this,"viewportCenter",void 0),(0,k.Z)(this,"viewportCenterProjection",void 0),(0,k.Z)(this,"pixelsPerDegree",void 0),(0,k.Z)(this,"pixelsPerDegree2",void 0),(0,k.Z)(this,"pixelsPerMeter",void 0)}return(0,I.Z)(j,[{key:"refresh",value:function(){var M=this.cameraService.getZoom(),D=this.cameraService.getZoomScale(),ne=this.cameraService.getCenter(),_e=kr({latitude:ne[1],zoom:M}),vt=_e.pixelsPerMeter,Vt=_e.pixelsPerDegree;this.viewportCenter=ne,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=vt,this.pixelsPerDegree=Vt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===bn.l.LNGLAT||this.coordinateSystem===bn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===bn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ne,M):this.coordinateSystem===bn.l.P20_OFFSET&&this.calculateLnglatOffset(ne,M,D,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(M){this.coordinateSystem=M}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(M,D,ne,_e){var vt=kr({latitude:M[1],zoom:D,scale:ne,flipY:_e,highPrecision:!0}),Vt=vt.pixelsPerMeter,Bt=vt.pixelsPerDegree,Sr=vt.pixelsPerDegree2,qr=this.cameraService.getViewMatrix(),Rn=this.cameraService.getProjectionMatrix(),Gn=hr.multiply([],Rn,qr),Mn=this.cameraService.projectFlat([Math.fround(M[0]),Math.fround(M[1])],Math.pow(2,D));this.viewportCenterProjection=ct.fF([],[Mn[0],Mn[1],0,1],Gn),qr=this.cameraService.getViewMatrixUncentered()||qr,Gn=hr.multiply([],Rn,qr),Gn=hr.multiply([],Gn,Ei),this.cameraService.setViewProjectionMatrix(Gn),this.pixelsPerMeter=Vt,this.pixelsPerDegree=Bt,this.pixelsPerDegree2=Sr}}]),j}(),ln=(0,me.Z)(Wr.prototype,"cameraService",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wr))||dn),wi=x(50840),Yi=x.n(wi),Yn=x(89648),Di,ki,za,Wn,ai,Ai,Qn;function Fi(j){var z=ya();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Xa={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},_a=(Di=(0,b.b2)(),ki=(0,b.f3)(W.v.IMapService),za=(0,b.f3)(W.v.ILogService),Di(Wn=(ai=function(j){(0,Pt.Z)(M,j);var z=Fi(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),vt=0;vt<ne;vt++)_e[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(_e)),(0,te.Z)((0,Ce.Z)(D),"mapService",Ai,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"logger",Qn,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"hammertime",void 0),(0,k.Z)((0,Ce.Z)(D),"lastClickTime",0),(0,k.Z)((0,Ce.Z)(D),"lastClickXY",[-1,-1]),(0,k.Z)((0,Ce.Z)(D),"clickTimer",void 0),(0,k.Z)((0,Ce.Z)(D),"$containter",void 0),(0,k.Z)((0,Ce.Z)(D),"onDrag",function(Vt){var Bt=D.interactionEvent(Vt);Bt.type=Xa[Bt.type],D.emit(Yn.s.Drag,Bt)}),(0,k.Z)((0,Ce.Z)(D),"onHammer",function(Vt){Vt.srcEvent.stopPropagation();var Bt=D.interactionEvent(Vt);D.emit(Yn.s.Hover,Bt)}),(0,k.Z)((0,Ce.Z)(D),"onTouch",function(Vt){var Bt=Vt.touches[0];D.onHover({x:Bt.pageX,y:Bt.pageY,type:"touch"})}),(0,k.Z)((0,Ce.Z)(D),"onHover",function(Vt){var Bt=Vt.clientX,Sr=Vt.clientY,qr=Bt,Rn=Sr,Gn=Vt.type,Mn=D.mapService.getMapContainer();if(Mn){var di=Mn.getBoundingClientRect(),yi=di.top,aa=di.left;qr=qr-aa-Mn.clientLeft,Rn=Rn-yi-Mn.clientTop}var Mi=D.mapService.containerToLngLat([qr,Rn]);if(Gn==="click"){if("ontouchstart"in document.documentElement)return;D.isDoubleTap(qr,Rn,Mi);return}if(Gn==="touch"){D.isDoubleTap(qr,Rn,Mi);return}Gn!=="click"&&Gn!=="dblclick"&&D.emit(Yn.s.Hover,{x:qr,y:Rn,lngLat:Mi,type:Gn,target:Vt})}),D}return(0,I.Z)(M,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Yn.s.Hover)}},{key:"triggerHover",value:function(ne){var _e=ne.x,vt=ne.y;this.emit(Yn.s.Hover,{x:_e,y:vt})}},{key:"triggerSelect",value:function(ne){this.emit(Yn.s.Select,{featureId:ne})}},{key:"triggerActive",value:function(ne){this.emit(Yn.s.Active,{featureId:ne})}},{key:"addEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();if(ne){var _e=new(Yi()).Manager(ne);_e.add(new(Yi()).Tap({event:"dblclick",taps:2})),_e.add(new(Yi()).Tap({event:"click"})),_e.add(new(Yi()).Pan({threshold:0,pointers:0})),_e.add(new(Yi()).Press({})),_e.on("dblclick click",this.onHammer),_e.on("panstart panmove panend pancancel",this.onDrag),ne.addEventListener("mousemove",this.onHover),ne.addEventListener("mousedown",this.onHover,!0),ne.addEventListener("mouseup",this.onHover),ne.addEventListener("contextmenu",this.onHover),this.hammertime=_e,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();ne&&(ne.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ne.removeEventListener("mousedown",this.onHover),ne.removeEventListener("mouseup",this.onHover),ne.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ne){var _e=ne.type,vt=ne.pointerType,Vt,Bt;vt==="touch"?(Bt=Math.floor(ne.pointers[0].clientY),Vt=Math.floor(ne.pointers[0].clientX)):(Bt=Math.floor(ne.srcEvent.y),Vt=Math.floor(ne.srcEvent.x));var Sr=this.mapService.getMapContainer();if(Sr){var qr=Sr.getBoundingClientRect(),Rn=qr.top,Gn=qr.left;Vt-=Gn,Bt-=Rn}var Mn=this.mapService.containerToLngLat([Vt,Bt]);return{x:Vt,y:Bt,lngLat:Mn,type:_e,target:ne.srcEvent}}},{key:"isDoubleTap",value:function(ne,_e,vt){var Vt=this,Bt=new Date().getTime(),Sr="click";Bt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ne)<10&&Math.abs(this.lastClickXY[1]-_e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Sr="dblclick",this.emit(Yn.s.Hover,{x:ne,y:_e,lngLat:vt,type:Sr})):(this.lastClickTime=Bt,this.lastClickXY=[ne,_e],this.clickTimer=setTimeout(function(){Sr="click",Vt.emit(Yn.s.Hover,{x:ne,y:_e,lngLat:vt,type:Sr})},400))}}]),M}(d()),Ai=(0,me.Z)(ai.prototype,"mapService",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn=(0,me.Z)(ai.prototype,"logger",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai))||Wn),da=x(92137),Vu=x(87757),Ya=x.n(Vu),gi=x(7648),qa,Ka,$a,Yo,Gi,Oo,Oa,Za,cs,va,fs;function Ca(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function fo(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ca(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ca(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var Zi=(qa=(0,b.b2)(),Ka=(0,b.f3)(W.v.IRendererService),$a=(0,b.f3)(W.v.IGlobalConfigService),Yo=(0,b.f3)(W.v.IInteractionService),Gi=(0,b.f3)(W.v.ILayerService),qa(Oo=(Oa=function(){function j(){var z=this;(0,$.Z)(this,j),(0,te.Z)(this,"rendererService",Za,this),(0,te.Z)(this,"configService",cs,this),(0,te.Z)(this,"interactionService",va,this),(0,te.Z)(this,"layerService",fs,this),(0,k.Z)(this,"pickingFBO",void 0),(0,k.Z)(this,"width",0),(0,k.Z)(this,"height",0),(0,k.Z)(this,"alreadyInPicking",!1),(0,k.Z)(this,"pickBufferScale",1),(0,k.Z)(this,"pickFromPickingFBO",function(M,D){var ne,_e=D.x,vt=D.y,Vt=D.lngLat,Bt=D.type,Sr=D.target,qr=!1,Rn=z.rendererService,Gn=Rn.getViewportSize,Mn=Rn.readPixels,di=Rn.getContainer,yi=di().getBoundingClientRect(),aa=yi.width,Mi=yi.height;aa*=we.SO.DPR,Mi*=we.SO.DPR;var Ha=M.getLayerConfig(),Mo=Ha.enableHighlight,bo=Ha.enableSelect,So=_e*we.SO.DPR,Qa=vt*we.SO.DPR;if(So>aa-1*we.SO.DPR||So<0||Qa>Mi-1*we.SO.DPR||Qa<0)return!1;var ca;if(ca=Mn({x:Math.floor(So/z.pickBufferScale),y:Math.floor((Mi-(vt+1)*we.SO.DPR)/z.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:z.pickingFBO}),ca[0]!==0||ca[1]!==0||ca[2]!==0){var Wa=(0,we.W0)(ca),Eo=M.getSource().getFeatureById(Wa);Wa!==M.getCurrentPickId()&&Bt==="mousemove"&&(Bt="mouseenter");var oo={x:_e,y:vt,type:Bt,lngLat:Vt,featureId:Wa,feature:Eo,target:Sr};Eo&&(qr=!0,M.setCurrentPickId(Wa),z.triggerHoverOnLayer(M,oo))}else{var wo={x:_e,y:vt,lngLat:Vt,type:M.getCurrentPickId()!==null&&Bt==="mousemove"?"mouseout":"un"+Bt,featureId:null,target:Sr,feature:null};z.triggerHoverOnLayer(M,fo(fo({},wo),{},{type:"unpick"})),z.triggerHoverOnLayer(M,wo),M.setCurrentPickId(null)}if(Mo&&z.highlightPickedFeature(M,ca),bo&&Bt==="click"&&((ne=ca)===null||ne===void 0?void 0:ne.toString())!==[0,0,0,0].toString()){var Ds=(0,we.W0)(ca);M.getCurrentSelectedId()===null||Ds!==M.getCurrentSelectedId()?(z.selectFeature(M,ca),M.setCurrentSelectedId(Ds)):(z.selectFeature(M,new Uint8Array([0,0,0,0])),M.setCurrentSelectedId(null))}return qr})}return(0,I.Z)(j,[{key:"init",value:function(M){var D=this.rendererService,ne=D.createTexture2D,_e=D.createFramebuffer,vt=D.getViewportSize,Vt=D.getContainer,Bt=Vt().getBoundingClientRect(),Sr=Bt.width,qr=Bt.height;Sr*=we.SO.DPR,qr*=we.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(M).pickBufferScale||1,this.pickingFBO=_e({color:ne({width:Math.round(Sr/this.pickBufferScale),height:Math.round(qr/this.pickBufferScale),wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Yn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne,_e,vt){var Vt=this,Bt,Sr,qr,Rn;return Ya().wrap(function(Mn){for(;;)switch(Mn.prev=Mn.next){case 0:Bt=this.rendererService,Sr=Bt.useFramebuffer,qr=Bt.clear,Rn=Bt.getContainer,this.resizePickingFBO(),Sr(this.pickingFBO,function(){qr({framebuffer:Vt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ne.hooks.beforePickingEncode.call(),ne.renderModels(),ne.hooks.afterPickingEncode.call();var di=Vt.pickBox(ne,_e);vt(di)});case 3:case"end":return Mn.stop()}},D,this)}));function M(D,ne,_e){return z.apply(this,arguments)}return M}()},{key:"pickBox",value:function(M,D){var ne=this,_e=D.map(function(wo){var Ds=wo<0?0:wo;return Math.floor(Ds*we.SO.DPR/ne.pickBufferScale)}),vt=(0,jt.Z)(_e,4),Vt=vt[0],Bt=vt[1],Sr=vt[2],qr=vt[3],Rn=this.rendererService,Gn=Rn.getViewportSize,Mn=Rn.readPixels,di=Rn.getContainer,yi=di().getBoundingClientRect(),aa=yi.width,Mi=yi.height;if(aa*=we.SO.DPR,Mi*=we.SO.DPR,Vt>(aa-1)*we.SO.DPR/this.pickBufferScale||Sr<0||Bt>(Mi-1)*we.SO.DPR/this.pickBufferScale||qr<0)return[];var Ha,Mo=Math.min(aa/this.pickBufferScale,Sr)-Vt,bo=Math.min(Mi/this.pickBufferScale,qr)-Bt;Ha=Mn({x:Vt,y:Math.floor(Mi/this.pickBufferScale-(qr+1)),width:Mo,height:bo,data:new Uint8Array(Mo*bo*4),framebuffer:this.pickingFBO});for(var So=[],Qa={},ca=0;ca<Ha.length/4;ca=ca+1){var Wa=Ha.slice(ca*4,ca*4+4),Eo=(0,we.W0)(Wa);if(Eo!==-1&&!Qa[Eo]){var oo=M.getSource().getFeatureById(Eo);So.push(oo),Qa[Eo]=!0}}return So}},{key:"pickingAllLayer",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne){return Ya().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){vt.next=2;break}return vt.abrupt("return");case 2:return this.alreadyInPicking=!0,vt.next=5,this.pickingLayers(ne);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return vt.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"resizePickingFBO",value:function(){var M=this.rendererService.getContainer,D=M().getBoundingClientRect(),ne=D.width,_e=D.height;ne*=we.SO.DPR,_e*=we.SO.DPR,(this.width!==ne||this.height!==_e)&&(this.pickingFBO.resize({width:Math.round(ne/this.pickBufferScale),height:Math.round(_e/this.pickBufferScale)}),this.width=ne,this.height=_e)}},{key:"pickingLayers",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne){var _e=this,vt,Vt,Bt,Sr,qr;return Ya().wrap(function(Gn){for(;;)switch(Gn.prev=Gn.next){case 0:vt=this.rendererService,Vt=vt.getViewportSize,Bt=vt.useFramebuffer,Sr=vt.clear,qr=vt.getContainer,this.resizePickingFBO(),Bt(this.pickingFBO,function(){var Mn=_e.layerService.getLayers();Mn.filter(function(di){return di.needPick(ne.type)}).reverse().some(function(di){Sr({framebuffer:_e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),di.hooks.beforePickingEncode.call(),di.renderModels(),di.hooks.afterPickingEncode.call();var yi=_e.pickFromPickingFBO(di,ne);return yi&&!di.getLayerConfig().enablePropagation})});case 3:case"end":return Gn.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"triggerHoverOnLayer",value:function(M,D){M.emit(D.type,D)}},{key:"isEventCrash",value:function(M){var D=!0;return M.target.path.map(function(ne){ne.classList&&ne.classList.forEach(function(_e){(_e==="l7-marker"||_e==="l7-popup")&&(D=!1)})}),D}},{key:"highlightPickedFeature",value:function(M,D){var ne=(0,jt.Z)(D,3),_e=ne[0],vt=ne[1],Vt=ne[2];M.hooks.beforeHighlight.call([_e,vt,Vt])}},{key:"selectFeature",value:function(M,D){var ne=(0,jt.Z)(D,3),_e=ne[0],vt=ne[1],Vt=ne[2];M.hooks.beforeSelect.call([_e,vt,Vt])}}]),j}(),Za=(0,me.Z)(Oa.prototype,"rendererService",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs=(0,me.Z)(Oa.prototype,"configService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=(0,me.Z)(Oa.prototype,"interactionService",[Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs=(0,me.Z)(Oa.prototype,"layerService",[Gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa))||Oo),pe=function(){function j(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,$.Z)(this,j),(0,k.Z)(this,"autoStart",void 0),(0,k.Z)(this,"startTime",0),(0,k.Z)(this,"oldTime",0),(0,k.Z)(this,"running",!1),(0,k.Z)(this,"elapsedTime",0),this.autoStart=z}return(0,I.Z)(j,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var M=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var D=(typeof performance=="undefined"?Date:performance).now();M=(D-this.oldTime)/1e3,this.oldTime=D,this.elapsedTime+=M}return M}}]),j}(),Oe,ft,ur,Qr,Dn,Ki,Ua,La=(Oe=(0,b.b2)(),ft=(0,b.f3)(W.v.IRendererService),ur=(0,b.f3)(W.v.IGlobalConfigService),Oe(Qr=(Dn=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"clock",new pe),(0,k.Z)(this,"alreadyInRendering",!1),(0,k.Z)(this,"layers",[]),(0,k.Z)(this,"layerRenderID",void 0),(0,k.Z)(this,"sceneInited",!1),(0,k.Z)(this,"animateInstanceCount",0),(0,te.Z)(this,"renderService",Ki,this),(0,te.Z)(this,"configService",Ua,this)}return(0,I.Z)(j,[{key:"add",value:function(M){this.sceneInited&&M.init(),this.layers.push(M)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(M){M.inited||M.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(M){return this.layers.find(function(D){return D.id===M})}},{key:"getLayerByName",value:function(M){return this.layers.find(function(D){return D.name===M})}},{key:"remove",value:function(M){var D=this.layers.indexOf(M);D>-1&&this.layers.splice(D,1),M.emit("remove",null),M.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(M){return M.inited}).filter(function(M){return M.isVisible()}).forEach(function(M){M.hooks.beforeRenderData.call(),M.hooks.beforeRender.call(),M.render(),M.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(M,D){return M.zIndex-D.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(M){return M.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),j}(),Ki=(0,me.Z)(Dn.prototype,"renderService",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=(0,me.Z)(Dn.prototype,"configService",[ur],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn))||Qr),ja=x(81253),To=x(85061),Mu=x(14293),$l=x.n(Mu),Il=function(){function j(z){var M=this;(0,$.Z)(this,j),(0,k.Z)(this,"name",void 0),(0,k.Z)(this,"type",void 0),(0,k.Z)(this,"scale",void 0),(0,k.Z)(this,"descriptor",void 0),(0,k.Z)(this,"featureBufferLayout",[]),(0,k.Z)(this,"needRescale",!1),(0,k.Z)(this,"needRemapping",!1),(0,k.Z)(this,"needRegenerateVertices",!1),(0,k.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,k.Z)(this,"vertexAttribute",void 0),(0,k.Z)(this,"defaultCallback",function(D){if(D.length===0){var ne;return((ne=M.scale)===null||ne===void 0?void 0:ne.defaultValues)||[]}return D.map(function(_e,vt){var Vt,Bt=(Vt=M.scale)===null||Vt===void 0?void 0:Vt.scalers[vt].func,Sr=Bt(_e);return Sr})}),this.setProps(z)}return(0,I.Z)(j,[{key:"setProps",value:function(M){Object.assign(this,M)}},{key:"mapping",value:function(M){var D;if((D=this.scale)!==null&&D!==void 0&&D.callback){var ne,_e=(ne=this.scale)===null||ne===void 0?void 0:ne.callback.apply(ne,(0,To.Z)(M));if(!$l()(_e))return[_e]}return this.defaultCallback(M)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),j}(),Lo,Xs,ua,Ns,ou,bs;function Ps(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function ti(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ps(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ps(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function ho(j){return new Promise(function(z){return setTimeout(z,j)})}var su=(Lo={},(0,k.Z)(Lo,gi.gl.FLOAT,4),(0,k.Z)(Lo,gi.gl.UNSIGNED_BYTE,1),(0,k.Z)(Lo,gi.gl.UNSIGNED_SHORT,2),Lo),Ol=(Xs=(0,b.b2)(),ua=(0,b.f3)(W.v.IRendererService),Xs(Ns=(ou=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"attributesAndIndices",void 0),(0,te.Z)(this,"rendererService",bs,this),(0,k.Z)(this,"attributes",[]),(0,k.Z)(this,"triangulation",void 0),(0,k.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,I.Z)(j,[{key:"registerStyleAttribute",value:function(M){var D=this.getLayerStyleAttribute(M.name||"");return D?D.setProps(M):(D=new Il(M),this.attributes.push(D)),D}},{key:"updateStyleAttribute",value:function(M,D,ne){var _e=this.getLayerStyleAttribute(M);_e||(_e=this.registerStyleAttribute(ti(ti({},D),{},{name:M})));var vt=D.scale;vt&&_e&&(_e.scale=vt,_e.needRescale=!0,_e.needRemapping=!0,_e.needRegenerateVertices=!0,ne&&ne.featureRange&&(_e.featureRange=ne.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(M){return this.attributes.find(function(D){return D.name===M})}},{key:"getLayerAttributeScale",value:function(M){var D,ne=this.getLayerStyleAttribute(M),_e=ne==null||(D=ne.scale)===null||D===void 0?void 0:D.scalers;return _e&&_e[0]?_e[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(M,D){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,_e=arguments.length>3?arguments[3]:void 0,vt=this.attributes.find(function(bo){return bo.name===M});if(vt&&vt.descriptor){var Vt=vt.descriptor,Bt=Vt.update,Sr=Vt.buffer,qr=Vt.size,Rn=qr===void 0?0:qr,Gn=su[Sr.type||gi.gl.FLOAT];if(Bt){var Mn=this.featureLayout,di=Mn.elements,yi=Mn.sizePerElement,aa=di.slice(ne,_e);if(!aa.length)return;var Mi=aa[0].offset,Ha=Mi*Rn*Gn,Mo=aa.map(function(bo,So){for(var Qa=bo.featureIdx,ca=bo.vertices,Wa=bo.normals,Eo=ca.length/yi,oo=[],wo=0;wo<Eo;wo++){var Ds=Wa?Wa.slice(wo*3,wo*3+3):[];oo.push.apply(oo,(0,To.Z)(Bt(D[Qa],Qa,ca.slice(wo*yi,wo*yi+yi),So,Ds)))}return oo}).reduce(function(bo,So){return bo.push.apply(bo,(0,To.Z)(So)),bo},[]);vt.vertexAttribute.updateBuffer({data:Mo,offset:Ha})}}}},{key:"createAttributesAndIndices",value:function(M,D){var ne=this;this.featureLayout={sizePerElement:0,elements:[]},D&&(this.triangulation=D);var _e=this.attributes.map(function(Mi){return Mi.resetDescriptor(),Mi.descriptor}),vt=0,Vt=[],Bt=[],Sr=[],qr=3;M.forEach(function(Mi,Ha){var Mo=ne.triangulation(Mi),bo=Mo.indices,So=Mo.vertices,Qa=Mo.normals,ca=Mo.size;bo.forEach(function(wo){Bt.push(wo+vt)}),qr=ca;var Wa=So.length/ca;ne.featureLayout.sizePerElement=qr,ne.featureLayout.elements.push({featureIdx:Ha,vertices:So,normals:Qa,offset:vt}),vt+=Wa;for(var Eo=function(Ds){var mu=(Qa==null?void 0:Qa.slice(Ds*3,Ds*3+3))||[],Zu=So.slice(Ds*ca,Ds*ca+ca);_e.forEach(function(Ss,Xc){if(Ss&&Ss.update){var cf;(cf=Ss.buffer.data).push.apply(cf,(0,To.Z)(Ss.update(Mi,Ha,Zu,Ds,mu)))}})},oo=0;oo<Wa;oo++)Eo(oo)});var Rn=this.rendererService,Gn=Rn.createAttribute,Mn=Rn.createBuffer,di=Rn.createElements,yi={};_e.forEach(function(Mi,Ha){if(Mi){var Mo=Mi.buffer,bo=Mi.update,So=Mi.name,Qa=(0,ja.Z)(Mi,["buffer","update","name"]),ca=Gn(ti({buffer:Mn(Mo)},Qa));yi[Mi.name||""]=ca,ne.attributes[Ha].vertexAttribute=ca}});var aa=di({data:Bt,type:gi.gl.UNSIGNED_INT,count:Bt.length});return this.attributesAndIndices={attributes:yi,elements:aa},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var M;this.attributes.forEach(function(D){D.vertexAttribute&&D.vertexAttribute.destroy()}),(M=this.attributesAndIndices)===null||M===void 0||M.elements.destroy(),this.attributes=[]}}]),j}(),bs=(0,me.Z)(ou.prototype,"rendererService",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ou))||Ns),sl=x(34155);function He(j){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof sl!="undefined"&&typeof sl.versions=="object"&&Boolean(sl.versions.electron))return!0;const z=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,M=j||z;return!!(M&&M.indexOf("Electron")>=0)}var Tt=x(34155);function _r(){return!(typeof Tt=="object"&&String(Tt)==="[object process]"&&!Tt.browser)||He()}function Zn(){return _r()&&typeof document!="undefined"}const sa=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",xa=_r();function ka(j){try{const z=window[j],M="__storage_test__";return z.setItem(M,M),z.removeItem(M),z}catch(z){return null}}class vi{constructor(z,M,D="sessionStorage"){this.storage=ka(D),this.id=z,this.config={},Object.assign(this.config,M),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(z){return this.config={},this.updateConfiguration(z)}updateConfiguration(z){if(Object.assign(this.config,z),this.storage){const M=JSON.stringify(this.config);this.storage.setItem(this.id,M)}return this}_loadConfiguration(){let z={};if(this.storage){const M=this.storage.getItem(this.id);z=M?JSON.parse(M):{}}return Object.assign(this.config,z),this}}function Ta(j){let z;return j<10?z="".concat(j.toFixed(2),"ms"):j<100?z="".concat(j.toFixed(1),"ms"):j<1e3?z="".concat(j.toFixed(0),"ms"):z="".concat((j/1e3).toFixed(2),"s"),z}function eo(j,z=8){const M=Math.max(z-j.length,0);return"".concat(" ".repeat(M)).concat(j)}function qn(j,z=8){const M=Math.max(z-j.length,0);return"".concat(j).concat(" ".repeat(M))}function ba(j,z={}){const M=1e-16,{isInteger:D=!1}=z;if(Array.isArray(j)||ArrayBuffer.isView(j))return Jl(j,z);if(!Number.isFinite(j))return String(j);if(Math.abs(j)<M)return D?"0":"0.";if(D||Math.abs(j)>100&&Math.abs(j)<1e4)return j.toFixed(0);const ne=j.toPrecision(2);return ne.indexOf(".0")===ne.length-2?ne.slice(0,-1):ne}function Jl(j,z){const{maxElts:M=16,size:D=1}=z;let ne="[";for(let vt=0;vt<j.length&&vt<M;++vt)vt>0&&(ne+=",".concat(vt%D==0?" ":"")),ne+=ba(j[vt],z);const _e=j.length>M?"...":"]";return"".concat(ne).concat(_e)}function Ra(j,z,M,D=600){const ne=j.src.replace(/\(/g,"%28").replace(/\)/g,"%29");j.width>D&&(M=Math.min(M,D/j.width));const _e=j.width*M,vt=j.height*M,Vt=["font-size:1px;","padding:".concat(Math.floor(vt/2),"px ").concat(Math.floor(_e/2),"px;"),"line-height:".concat(vt,"px;"),"background:url(".concat(ne,");"),"background-size:".concat(_e,"px ").concat(vt,"px;"),"color:transparent;"].join("");return["".concat(z," %c+"),Vt]}const Ro={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function xu(j){return typeof j=="string"?Ro[j.toUpperCase()]||Ro.WHITE:j}function Ys(j,z,M){return!xa&&typeof j=="string"&&(z&&(z=xu(z),j="[".concat(z,"m").concat(j,"[39m")),M&&(z=xu(M),j="[".concat(M+10,"m").concat(j,"[49m"))),j}function zs(j,z=["constructor"]){const M=Object.getPrototypeOf(j),D=Object.getOwnPropertyNames(M);for(const ne of D)typeof j[ne]=="function"&&(z.find(_e=>ne===_e)||(j[ne]=j[ne].bind(j)))}function rs(j,z){if(!j)throw new Error(z||"Assertion failed")}var Iu=x(34155);const xo={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof x.g!="undefined"&&x.g,document:typeof document!="undefined"&&document,process:typeof Iu=="object"&&Iu},rf=xo.self||xo.window||xo.global,ul=xo.window||xo.self||xo.global,Ui=xo.global||xo.self||xo.window,Hf=xo.document||{},Ql=xo.process||{},Sf=console;function Ll(){let j;if(xa&&ul.performance)j=ul.performance.now();else if(Ql.hrtime){const z=Ql.hrtime();j=z[0]*1e3+z[1]/1e6}else j=Date.now();return j}const Ko={debug:xa&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Aa={enabled:!0,level:0};function to(){}const Ks={},ns={once:!0};function fc(j){for(const z in j)for(const M in j[z])return M||"untitled";return"empty"}class Rl{constructor({id:z}={id:""}){this.id=z,this.VERSION=sa,this._startTs=Ll(),this._deltaTs=Ll(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new vi("__probe-".concat(this.id,"__"),Aa),this.userData={},this.timeStamp("".concat(this.id," started")),zs(this),Object.seal(this)}set level(z){this.setLevel(z)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ll()-this._startTs).toPrecision(10))}getDelta(){return Number((Ll()-this._deltaTs).toPrecision(10))}set priority(z){this.level=z}get priority(){return this.level}getPriority(){return this.level}enable(z=!0){return this._storage.updateConfiguration({enabled:z}),this}setLevel(z){return this._storage.updateConfiguration({level:z}),this}assert(z,M){rs(z,M)}warn(z){return this._getLogFunction(0,z,Ko.warn,arguments,ns)}error(z){return this._getLogFunction(0,z,Ko.error,arguments)}deprecated(z,M){return this.warn("`".concat(z,"` is deprecated and will be removed in a later version. Use `").concat(M,"` instead"))}removed(z,M){return this.error("`".concat(z,"` has been removed. Use `").concat(M,"` instead"))}probe(z,M){return this._getLogFunction(z,M,Ko.log,arguments,{time:!0,once:!0})}log(z,M){return this._getLogFunction(z,M,Ko.debug,arguments)}info(z,M){return this._getLogFunction(z,M,console.info,arguments)}once(z,M){return this._getLogFunction(z,M,Ko.debug||Ko.info,arguments,ns)}table(z,M,D){return M?this._getLogFunction(z,M,console.table||to,D&&[D],{tag:fc(M)}):to}image({logLevel:z,priority:M,image:D,message:ne="",scale:_e=1}){return this._shouldLog(z||M)?xa?Eu({image:D,message:ne,scale:_e}):Zs({image:D,message:ne,scale:_e}):to}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(z){return this._storage.config[z]}set(z,M){this._storage.updateConfiguration({[z]:M})}time(z,M){return this._getLogFunction(z,M,console.time?console.time:console.info)}timeEnd(z,M){return this._getLogFunction(z,M,console.timeEnd?console.timeEnd:console.info)}timeStamp(z,M){return this._getLogFunction(z,M,console.timeStamp||to)}group(z,M,D={collapsed:!1}){D=Su({logLevel:z,message:M,opts:D});const{collapsed:ne}=D;return D.method=(ne?console.groupCollapsed:console.group)||console.info,this._getLogFunction(D)}groupCollapsed(z,M,D={}){return this.group(z,M,Object.assign({},D,{collapsed:!0}))}groupEnd(z){return this._getLogFunction(z,"",console.groupEnd||to)}withGroup(z,M,D){this.group(z,M)();try{D()}finally{this.groupEnd(z)()}}trace(){console.trace&&console.trace()}_shouldLog(z){return this.isEnabled()&&this.getLevel()>=bu(z)}_getLogFunction(z,M,D,ne=[],_e){if(this._shouldLog(z)){_e=Su({logLevel:z,message:M,args:ne,opts:_e}),D=D||_e.method,rs(D),_e.total=this.getTotal(),_e.delta=this.getDelta(),this._deltaTs=Ll();const vt=_e.tag||_e.message;if(_e.once)if(!Ks[vt])Ks[vt]=Ll();else return to;return M=Ou(this.id,_e.message,_e),D.bind(console,M,..._e.args)}return to}}Rl.VERSION=sa;function bu(j){if(!j)return 0;let z;switch(typeof j){case"number":z=j;break;case"object":z=j.logLevel||j.priority||0;break;default:return 0}return rs(Number.isFinite(z)&&z>=0),z}function Su(j){const{logLevel:z,message:M}=j;j.logLevel=bu(z);const D=j.args?Array.from(j.args):[];for(;D.length&&D.shift()!==M;);switch(j.args=D,typeof z){case"string":case"function":M!==void 0&&D.unshift(M),j.message=z;break;case"object":Object.assign(j,z);break;default:}typeof j.message=="function"&&(j.message=j.message());const ne=typeof j.message;return rs(ne==="string"||ne==="object"),Object.assign(j,j.opts)}function Ou(j,z,M){if(typeof z=="string"){const D=M.time?eo(Ta(M.total)):"";z=M.time?"".concat(j,": ").concat(D,"  ").concat(z):"".concat(j,": ").concat(z),z=Ys(z,M.color,M.background)}return z}function Zs({image:j,message:z="",scale:M=1}){let D=null;try{D=x(75307)}catch(ne){}return D?()=>D(j,{fit:"box",width:"".concat(Math.round(80*M),"%")}).then(ne=>console.log(ne)):to}function Eu({image:j,message:z="",scale:M=1}){if(typeof j=="string"){const ne=new Image;return ne.onload=()=>{const _e=Ra(ne,z,M);console.log(..._e)},ne.src=j,to}const D=j.nodeName||"";if(D.toLowerCase()==="img")return console.log(...Ra(j,z,M)),to;if(D.toLowerCase()==="canvas"){const ne=new Image;return ne.onload=()=>console.log(...Ra(ne,z,M)),ne.src=j.toDataURL(),to}return to}var hc,Gu,ma=new Rl({id:"L7"}).enable(!1);ma.priority=5;var Pc=(hc=(0,b.b2)(),hc(Gu=function(){function j(){(0,$.Z)(this,j)}return(0,I.Z)(j,[{key:"error",value:function(M){ma.error(M)()}},{key:"warn",value:function(M){ma.probe(1,M)()}},{key:"info",value:function(M){ma.info(3,M)()}},{key:"debug",value:function(M){ma.probe(4,M)()}}]),j}())||Gu),Ef=x(46343),ll=x(67709),nf=x.n(ll),Mc=window.document.documentElement.style,pc=0;function ql(j){var z=j;if(typeof j=="string"&&(z=document.getElementById(j)),z){var M=document.createElement("div");return M.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,M.id="l7-scene-".concat(pc++),M.classList.add("l7-scene"),z.appendChild(M),M}return null}var cl,wu,ec,fl,uu,dc,hl,$s,Ic,Oc,Lc,Hu,Dl,tc,Wu,kl,Rc,Xu,No,af,of,Fl,Dc,Fa,kc,Yu,Fc,Cu,Pa,rc,Lu,Ku,Hi,Ma,Us;function vc(j){var z=nc();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var ic=(cl=(0,b.b2)(),wu=(0,b.f3)(W.v.SceneID),ec=(0,b.f3)(W.v.IIconService),fl=(0,b.f3)(W.v.IFontService),uu=(0,b.f3)(W.v.IControlService),dc=(0,b.f3)(W.v.ILogService),hl=(0,b.f3)(W.v.IGlobalConfigService),$s=(0,b.f3)(W.v.IMapService),Ic=(0,b.f3)(W.v.ICoordinateSystemService),Oc=(0,b.f3)(W.v.IRendererService),Lc=(0,b.f3)(W.v.ILayerService),Hu=(0,b.f3)(W.v.ICameraService),Dl=(0,b.f3)(W.v.IInteractionService),tc=(0,b.f3)(W.v.IPickingService),Wu=(0,b.f3)(W.v.IShaderModuleService),kl=(0,b.f3)(W.v.IMarkerService),Rc=(0,b.f3)(W.v.IPopupService),cl(Xu=(No=function(j){(0,Pt.Z)(M,j);var z=vc(M);function M(){var D;return(0,$.Z)(this,M),D=z.call(this),(0,k.Z)((0,Ce.Z)(D),"destroyed",!1),(0,k.Z)((0,Ce.Z)(D),"loaded",!1),(0,k.Z)((0,Ce.Z)(D),"loadFont",!1),(0,k.Z)((0,Ce.Z)(D),"fontFamily",""),(0,te.Z)((0,Ce.Z)(D),"id",af,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"iconService",of,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"fontService",Fl,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"controlService",Dc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"logger",Fa,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"configService",kc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"map",Yu,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"coordinateSystemService",Fc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"rendererService",Cu,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"layerService",Pa,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"cameraService",rc,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"interactionService",Lu,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"pickingService",Ku,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"shaderModuleService",Hi,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"markerService",Ma,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"popupService",Us,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"inited",!1),(0,k.Z)((0,Ce.Z)(D),"initPromise",void 0),(0,k.Z)((0,Ce.Z)(D),"rendering",!1),(0,k.Z)((0,Ce.Z)(D),"$container",void 0),(0,k.Z)((0,Ce.Z)(D),"canvas",void 0),(0,k.Z)((0,Ce.Z)(D),"markerContainer",void 0),(0,k.Z)((0,Ce.Z)(D),"hooks",void 0),(0,k.Z)((0,Ce.Z)(D),"handleWindowResized",function(){D.emit("resize"),D.$container&&(D.initContainer(),we.SO.triggerResize(),D.coordinateSystemService.needRefresh=!0,D.render())}),(0,k.Z)((0,Ce.Z)(D),"handleMapCameraChanged",function(ne){D.cameraService.update(ne),D.render()}),D.hooks={init:new Ef.zj},D}return(0,I.Z)(M,[{key:"init",value:function(ne){var _e=this;this.configService.setSceneConfig(this.id,ne),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,da.Z)(Ya().mark(function vt(){return Ya().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return Bt.next=2,new Promise(function(Sr){_e.map.onCameraChanged(function(qr){_e.cameraService.init(),_e.cameraService.update(qr),_e.map.version!=="GAODE2.x"&&Sr()}),_e.map.version!=="GAODE2.x"?_e.map.init():Sr()});case 2:if(!(_e.map.version==="GAODE2.x"&&_e.map.initViewPort)){Bt.next=6;break}return Bt.next=5,_e.map.init();case 5:_e.map.initViewPort();case 6:_e.map.onCameraChanged(_e.handleMapCameraChanged),_e.map.addMarkerContainer(),_e.markerService.addMarkers(),_e.markerService.addMarkerLayers(),_e.popupService.initPopup(),_e.interactionService.init(),_e.interactionService.on(Yn.s.Drag,_e.addSceneEvent.bind(_e)),_e.logger.debug("map ".concat(_e.id," loaded"));case 14:case"end":return Bt.stop()}},vt)}))),this.hooks.init.tapPromise("initRenderer",(0,da.Z)(Ya().mark(function vt(){var Vt;return Ya().wrap(function(Sr){for(;;)switch(Sr.prev=Sr.next){case 0:if(Vt=ql(_e.configService.getSceneConfig(_e.id).id||""),_e.$container=Vt,!Vt){Sr.next=11;break}return _e.canvas=we.SO.create("canvas","",Vt),_e.setCanvas(),Sr.next=7,_e.rendererService.init(_e.canvas,_e.configService.getSceneConfig(_e.id));case 7:nf()(_e.$container,_e.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(_e.handleWindowResized),Sr.next=12;break;case 11:_e.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:_e.pickingService.init(_e.id),_e.logger.debug("scene ".concat(_e.id," renderer loaded"));case 14:case"end":return Sr.stop()}},vt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ne){this.logger.debug("add layer ".concat(ne.name," to scene ").concat(this.id)),this.layerService.add(ne),this.render()}},{key:"render",value:function(){var D=(0,da.Z)(Ya().mark(function _e(){return Ya().wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(!(this.rendering||this.destroyed)){Vt.next=2;break}return Vt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Vt.next=16;break}return Vt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Vt.next=10;break}return Vt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return Vt.stop()}},_e,this)}));function ne(){return D.apply(this,arguments)}return ne}()},{key:"addFontFace",value:function(ne,_e){this.fontFamily=ne;var vt=document.createElement("style");vt.type="text/css",vt.innerText=`
        @font-face{
            font-family: '`.concat(ne,`';
            src: url('`).concat(_e,`') format('woff2'),
            url('`).concat(_e,`') format('woff'),
            url('`).concat(_e,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(vt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ne){var _e,vt=(_e=this.$container)===null||_e===void 0?void 0:_e.getElementsByTagName("canvas")[0];this.render();var Vt=ne==="jpg"?vt==null?void 0:vt.toDataURL("image/jpeg"):vt==null?void 0:vt.toDataURL("image/png");return Vt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ne=this.$container.parentElement;ne!==null&&(this.markerContainer=we.SO.create("div","l7-marker-container",ne))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,ll.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ne,_e,vt=we.SO.DPR,Vt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,Bt=((_e=this.$container)===null||_e===void 0?void 0:_e.clientHeight)||300,Sr=this.canvas;Sr&&(Sr.width=Vt*vt,Sr.height=Bt*vt,Sr.style.width="".concat(Vt,"px"),Sr.style.height="".concat(Bt,"px")),this.rendererService.viewport({x:0,y:0,width:vt*Vt,height:vt*Bt})}},{key:"setCanvas",value:function(){var ne,_e,vt=we.SO.DPR,Vt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,Bt=((_e=this.$container)===null||_e===void 0?void 0:_e.clientHeight)||300,Sr=this.canvas;Sr.width=Vt*vt,Sr.height=Bt*vt,Sr.style.width="".concat(Vt,"px"),Sr.style.height="".concat(Bt,"px")}},{key:"addSceneEvent",value:function(ne){this.emit(ne.type,ne)}}]),M}(w.EventEmitter),af=(0,me.Z)(No.prototype,"id",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),of=(0,me.Z)(No.prototype,"iconService",[ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fl=(0,me.Z)(No.prototype,"fontService",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=(0,me.Z)(No.prototype,"controlService",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=(0,me.Z)(No.prototype,"logger",[dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=(0,me.Z)(No.prototype,"configService",[hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=(0,me.Z)(No.prototype,"map",[$s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc=(0,me.Z)(No.prototype,"coordinateSystemService",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=(0,me.Z)(No.prototype,"rendererService",[Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=(0,me.Z)(No.prototype,"layerService",[Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc=(0,me.Z)(No.prototype,"cameraService",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lu=(0,me.Z)(No.prototype,"interactionService",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=(0,me.Z)(No.prototype,"pickingService",[tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=(0,me.Z)(No.prototype,"shaderModuleService",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=(0,me.Z)(No.prototype,"markerService",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Us=(0,me.Z)(No.prototype,"popupService",[Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),No))||Xu),Of=x(44908),Lf=x.n(Of);function ac(j){var z=0;switch(j){case"vec2":case"ivec2":z=2;break;case"vec3":case"ivec3":z=3;break;case"vec4":case"ivec4":case"mat2":z=4;break;case"mat3":z=9;break;case"mat4":z=16;break;default:}return z}var $u=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ru(j){var z={};return j=j.replace($u,function(M,D,ne){var _e=ne.split(":"),vt=_e[0].trim(),Vt="";switch(_e.length>1&&(Vt=_e[1].trim()),D){case"bool":Vt=Vt==="true";break;case"float":case"int":Vt=Number(Vt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Vt?Vt=Vt.replace("[","").replace("]","").split(",").reduce(function(Bt,Sr){return Bt.push(Number(Sr.trim())),Bt},[]):Vt=new Array(ac(D)).fill(0);break;default:}return z[vt]=Vt,"uniform ".concat(D," ").concat(vt,`;
`)}),{content:j,uniforms:z}}var ro,hs;function pl(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Va(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?pl(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):pl(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var wn="#define PI 3.14159265359",js=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,mc=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Bl=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,lu=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Vs=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,dl=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Kr=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Bc=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,Ju=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Js=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Ms=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Nc=/precision\s+(high|low|medium)p\s+float/,zc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Gs=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Qu=(ro=(0,b.b2)(),ro(hs=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"moduleCache",{}),(0,k.Z)(this,"rawContentCache",{})}return(0,I.Z)(j,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:wn,fs:wn}),this.registerModule("decode",{vs:js,fs:""}),this.registerModule("projection",{vs:Kr,fs:""}),this.registerModule("project",{vs:dl,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Bc}),this.registerModule("lighting",{vs:Bl,fs:""}),this.registerModule("light",{vs:mc,fs:""}),this.registerModule("picking",{vs:Vs,fs:lu}),this.registerModule("styleMapping",{vs:gc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Ju,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Js,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Ms,fs:""})}},{key:"registerModule",value:function(M,D){if(!this.rawContentCache[M]){var ne=D.vs,_e=D.fs,vt=D.uniforms,Vt=Ru(ne),Bt=Vt.content,Sr=Vt.uniforms,qr=Ru(_e),Rn=qr.content,Gn=qr.uniforms;this.rawContentCache[M]={fs:Rn,uniforms:Va(Va(Va({},Sr),Gn),vt),vs:Bt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(M){var D=this;if(this.moduleCache[M])return this.moduleCache[M];var ne=this.rawContentCache[M].vs,_e=this.rawContentCache[M].fs,vt=this.processModule(ne,[],"vs"),Vt=vt.content,Bt=vt.includeList,Sr=this.processModule(_e,[],"fs"),qr=Sr.content,Rn=Sr.includeList,Gn=qr,Mn=Lf()(Bt.concat(Rn).concat(M)).reduce(function(di,yi){return Va(Va({},di),D.rawContentCache[yi].uniforms)},{});return Nc.test(qr)||(Gn=zc+qr),this.moduleCache[M]={fs:Gn.trim(),uniforms:Mn,vs:Vt.trim()},this.moduleCache[M]}},{key:"processModule",value:function(M,D,ne){var _e=this,vt=M.replace(Gs,function(Vt,Bt){var Sr=Bt.split(" "),qr=Sr[0].replace(/"/g,"");if(D.indexOf(qr)>-1)return"";var Rn=_e.rawContentCache[qr][ne];D.push(qr);var Gn=_e.processModule(Rn,D,ne),Mn=Gn.content;return Mn});return{content:vt,includeList:D}}}]),j}())||hs),Nl=x(66213),Du=x(92364),Zc,yc,cu,Is,Bi,Qs=(Zc=(0,b.b2)(),yc=(0,b.f3)(W.v.IShaderModuleService),Zc(cu=(Is=function(){function j(){(0,$.Z)(this,j),(0,te.Z)(this,"shaderModuleService",Bi,this),(0,k.Z)(this,"rendererService",void 0),(0,k.Z)(this,"cameraService",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"interactionService",void 0),(0,k.Z)(this,"layerService",void 0),(0,k.Z)(this,"config",void 0)}return(0,I.Z)(j,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Du.G.Normal}},{key:"init",value:function(M,D){this.config=D,this.rendererService=M.getContainer().get(W.v.IRendererService),this.cameraService=M.getContainer().get(W.v.ICameraService),this.mapService=M.getContainer().get(W.v.IMapService),this.interactionService=M.getContainer().get(W.v.IInteractionService),this.layerService=M.getContainer().get(W.v.ILayerService)}},{key:"render",value:function(M){}}]),j}(),Bi=(0,me.Z)(Is.prototype,"shaderModuleService",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is))||cu),$o,Ao;function vl(j){var z=qu();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function qu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var fu=($o=(0,b.b2)(),$o(Ao=function(j){(0,Pt.Z)(M,j);var z=vl(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,_e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),M}(Qs))||Ao),is,zl,Un,On,Zl;function ps(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=Do(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,vt=!1,Vt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){vt=!0,Vt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(vt)throw Vt}}}}function Do(j,z){if(!!j){if(typeof j=="string")return zo(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return zo(j,z)}}function zo(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var ku=(is=(0,b.b2)(),zl=(0,b.f3)(W.v.IPostProcessor),is(Un=(On=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"passes",[]),(0,te.Z)(this,"postProcessor",Zl,this),(0,k.Z)(this,"layer",void 0),(0,k.Z)(this,"renderFlag",void 0),(0,k.Z)(this,"width",0),(0,k.Z)(this,"height",0)}return(0,I.Z)(j,[{key:"setLayer",value:function(M){this.layer=M}},{key:"setRenderFlag",value:function(M){this.renderFlag=M}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var z=(0,da.Z)(Ya().mark(function D(){var ne,_e,vt;return Ya().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:ne=ps(this.passes),Bt.prev=1,ne.s();case 3:if((_e=ne.n()).done){Bt.next=9;break}return vt=_e.value,Bt.next=7,vt.render(this.layer);case 7:Bt.next=3;break;case 9:Bt.next=14;break;case 11:Bt.prev=11,Bt.t0=Bt.catch(1),ne.e(Bt.t0);case 14:return Bt.prev=14,ne.f(),Bt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Bt.stop()}},D,this,[[1,11,14,17]])}));function M(){return z.apply(this,arguments)}return M}()},{key:"resize",value:function(M,D){(this.width!==M||this.height!==D)&&(this.width=M,this.height=D)}},{key:"add",value:function(M,D){M.getType()===Du.G.PostProcessing?this.postProcessor.add(M,this.layer,D):(M.init(this.layer,D),this.passes.push(M))}},{key:"insert",value:function(M,D,ne){M.init(this.layer,D),this.passes.splice(ne,0,M)}},{key:"destroy",value:function(){this.passes.length=0}}]),j}(),Zl=(0,me.Z)(On.prototype,"postProcessor",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On))||Un),hu,Ul,ra,po,Uc;function Fu(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function _c(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Fu(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Fu(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Bu(j){var z=Os();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function Os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var oc=(hu=(0,b.b2)(),Ul=(0,b.f3)(W.v.ILogService),hu(ra=(po=function(j){(0,Pt.Z)(M,j);var z=Bu(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),vt=0;vt<ne;vt++)_e[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(_e)),(0,te.Z)((0,Ce.Z)(D),"logger",Uc,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"pickingFBO",void 0),(0,k.Z)((0,Ce.Z)(D),"layer",void 0),(0,k.Z)((0,Ce.Z)(D),"width",0),(0,k.Z)((0,Ce.Z)(D),"height",0),(0,k.Z)((0,Ce.Z)(D),"alreadyInRendering",!1),(0,k.Z)((0,Ce.Z)(D),"pickFromPickingFBO",function(Vt){var Bt=Vt.x,Sr=Vt.y,qr=Vt.lngLat,Rn=Vt.type;if(!(!D.layer.isVisible()||!D.layer.needPick(Rn))){var Gn=D.rendererService,Mn=Gn.getViewportSize,di=Gn.readPixels,yi=Gn.useFramebuffer,aa=Mn(),Mi=aa.width,Ha=aa.height,Mo=D.layer.getLayerConfig(),bo=Mo.enableHighlight,So=Mo.enableSelect,Qa=Bt*we.SO.DPR,ca=Sr*we.SO.DPR;if(!(Qa>Mi||Qa<0||ca>Ha||ca<0)){var Wa;yi(D.pickingFBO,function(){var Eo;if(Wa=di({x:Math.round(Qa),y:Math.round(Ha-(Sr+1)*we.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:D.pickingFBO}),Wa[0]!==0||Wa[1]!==0||Wa[2]!==0){D.logger.debug("picked");var oo=(0,we.W0)(Wa),wo=D.layer.getSource().getFeatureById(oo),Ds={x:Bt,y:Sr,type:Rn,lngLat:qr,featureId:oo,feature:wo};wo&&(D.layer.setCurrentPickId(oo),D.triggerHoverOnLayer(Ds))}else{var mu={x:Bt,y:Sr,lngLat:qr,type:D.layer.getCurrentPickId()===null?"un"+Rn:"mouseout",featureId:null,feature:null};D.triggerHoverOnLayer(_c(_c({},mu),{},{type:"unpick"})),D.triggerHoverOnLayer(mu),D.layer.setCurrentPickId(null)}bo&&D.highlightPickedFeature(Wa),So&&Rn==="click"&&((Eo=Wa)===null||Eo===void 0?void 0:Eo.toString())!==[0,0,0,0].toString()&&D.selectFeature(Wa)})}}}),D}return(0,I.Z)(M,[{key:"getType",value:function(){return Du.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,_e),this.layer=ne;var vt=this.rendererService,Vt=vt.createTexture2D,Bt=vt.createFramebuffer,Sr=vt.getViewportSize,qr=Sr(),Rn=qr.width,Gn=qr.height;this.pickingFBO=Bt({color:Vt({width:Rn,height:Gn,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Yn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(Yn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Yn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ne){var _e=this;if(!this.alreadyInRendering){var vt=this.rendererService,Vt=vt.getViewportSize,Bt=vt.useFramebuffer,Sr=vt.clear,qr=Vt(),Rn=qr.width,Gn=qr.height;this.alreadyInRendering=!0,(this.width!==Rn||this.height!==Gn)&&(this.pickingFBO.resize({width:Rn,height:Gn}),this.width=Rn,this.height=Gn),Bt(this.pickingFBO,function(){Sr({framebuffer:_e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Mn=_e.layer.multiPassRenderer.getRenderFlag();_e.layer.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforePickingEncode.call(),ne.render(),ne.hooks.afterPickingEncode.call(),_e.layer.multiPassRenderer.setRenderFlag(Mn),_e.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ne){this.layer.emit(ne.type,ne)}},{key:"highlightPickedFeature",value:function(ne){var _e=(0,jt.Z)(ne,3),vt=_e[0],Vt=_e[1],Bt=_e[2];this.layer.hooks.beforeHighlight.call([vt,Vt,Bt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ne){var _e=(0,jt.Z)(ne,3),vt=_e[0],Vt=_e[1],Bt=_e[2];this.layer.hooks.beforeSelect.call([vt,Vt,Bt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ne){var _e=ne.featureId,vt=(0,we.Z6)(_e);this.selectFeature(new Uint8Array(vt))}},{key:"highlightFeatureHandle",value:function(ne){var _e=ne.featureId,vt=(0,we.Z6)(_e);this.highlightPickedFeature(new Uint8Array(vt))}}]),M}(Qs),Uc=(0,me.Z)(po.prototype,"logger",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),po))||ra),as=x(69530),xc,jl;function sc(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function jc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?sc(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):sc(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function uc(j){var z=ml();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Vc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,gl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yl=(xc=(0,b.b2)(),xc(jl=function(j){(0,Pt.Z)(M,j);var z=uc(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:gl,fs:Vc});var ne=this.shaderModuleService.getModule("blur-pass"),_e=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:_e,fs:vt,uniforms:jc(jc({},Vt),{},{u_ViewportSize:[Sr,qr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var _e={};return $l()(ne.blurRadius)||(_e.u_BlurDir=[ne.blurRadius,0]),_e}}]),M}(as.Z))||jl),_l,pu;function qs(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Gc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?qs(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):qs(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function bc(j){var z=sf();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Sc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,i=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,u=(_l=(0,b.b2)(),_l(pu=function(j){(0,Pt.Z)(M,j);var z=bc(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:i,fs:Sc});var ne=this.shaderModuleService.getModule("blur-pass"),_e=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:_e,fs:vt,uniforms:Gc(Gc({},Vt),{},{u_ViewportSize:[Sr,qr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var _e={};return $l()(ne.blurRadius)||(_e.u_BlurDir=[0,ne.blurRadius]),_e}}]),M}(as.Z))||pu),a,h;function g(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function S(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?g(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):g(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function T(j){var z=R();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var V=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ee=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ve=(a=(0,b.b2)(),a(h=function(j){(0,Pt.Z)(M,j);var z=T(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ee,fs:V});var ne=this.shaderModuleService.getModule("colorhalftone-pass"),_e=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:_e,fs:vt,uniforms:S(S({},Vt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(as.Z))||h),ye,Ee;function Ye(j){var z=Ge();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function Ge(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var nt=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ne=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,rt=(ye=(0,b.b2)(),ye(Ee=function(j){(0,Pt.Z)(M,j);var z=Ye(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Ne,fs:nt}),this.shaderModuleService.getModule("copy-pass")}}]),M}(as.Z))||Ee),dt,zt;function ar(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function rr(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ar(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ar(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function or(j){var z=Lr();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function Lr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var tn=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Xr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yn=(dt=(0,b.b2)(),dt(zt=function(j){(0,Pt.Z)(M,j);var z=or(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Xr,fs:tn});var ne=this.shaderModuleService.getModule("hexagonalpixelate-pass"),_e=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:_e,fs:vt,uniforms:rr(rr({},Vt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(as.Z))||zt),Fn,Vn;function jn(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Qi(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?jn(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):jn(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function _n(j){var z=ci();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function ci(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Ci=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,fi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,oi=(Fn=(0,b.b2)(),Fn(Vn=function(j){(0,Pt.Z)(M,j);var z=_n(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:fi,fs:Ci});var ne=this.shaderModuleService.getModule("ink-pass"),_e=ne.vs,vt=ne.fs,Vt=ne.uniforms,Bt=this.rendererService.getViewportSize(),Sr=Bt.width,qr=Bt.height;return{vs:_e,fs:vt,uniforms:Qi(Qi({},Vt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(as.Z))||Vn),Ti,ii;function ri(j){var z=Po();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function Po(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Ja=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,os=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zo=(Ti=(0,b.b2)(),Ti(ii=function(j){(0,Pt.Z)(M,j);var z=ri(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:os,fs:Ja}),this.shaderModuleService.getModule("noise-pass")}}]),M}(as.Z))||ii),Ga,no;function ds(j){var z=vs();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var el=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ms=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,eu=(Ga=(0,b.b2)(),Ga(no=function(j){(0,Pt.Z)(M,j);var z=ds(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:el,fs:ms}),this.shaderModuleService.getModule("sepia-pass")}}]),M}(as.Z))||no),Ls,xl,bl,Nu,tu,Vl,Tu=(Ls=(0,b.b2)(),xl=(0,b.f3)(W.v.IRendererService),bl=(0,b.zY)(),Ls(Nu=(tu=function(){function j(){(0,$.Z)(this,j),(0,te.Z)(this,"rendererService",Vl,this),(0,k.Z)(this,"passes",[]),(0,k.Z)(this,"readFBO",void 0),(0,k.Z)(this,"writeFBO",void 0)}return(0,I.Z)(j,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne){var _e,vt;return Ya().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:_e=0;case 1:if(!(_e<this.passes.length)){Bt.next=10;break}return vt=this.passes[_e],vt.setRenderToScreen(this.isLastEnabledPass(_e)),Bt.next=6,vt.render(ne);case 6:_e!==this.passes.length-1&&this.swap();case 7:_e++,Bt.next=1;break;case 10:case"end":return Bt.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"resize",value:function(M,D){this.readFBO.resize({width:M,height:D}),this.writeFBO.resize({width:M,height:D})}},{key:"add",value:function(M,D,ne){M.init(D,ne),this.passes.push(M)}},{key:"insert",value:function(M,D,ne,_e){M.init(ne,_e),this.passes.splice(D,0,M)}},{key:"getPostProcessingPassByName",value:function(M){return this.passes.find(function(D){return D.getName()===M})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(M){for(var D=M+1;D<this.passes.length;D++)if(this.passes[D].isEnabled())return!1;return!0}},{key:"swap",value:function(){var M=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=M}}]),j}(),Vl=(0,me.Z)(tu.prototype,"rendererService",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,me.Z)(tu.prototype,"init",[bl],Object.getOwnPropertyDescriptor(tu.prototype,"init"),tu.prototype),tu))||Nu),zu,Hs;function io(j){var z=Au();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function Au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var du=(zu=(0,b.b2)(),zu(Hs=function(j){(0,Pt.Z)(M,j);var z=io(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"getType",value:function(){return Du.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,_e)}},{key:"render",value:function(ne){var _e=this.rendererService,vt=_e.useFramebuffer,Vt=_e.clear;vt(null,function(){Vt({color:[0,0,0,0],depth:1,stencil:0}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)})}}]),M}(Qs))||Hs),gs,qi,ao,ko,Rs,tl,vu;function rl(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function nl(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?rl(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):rl(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Ec(j){var z=Pu();return function(){var D=(0,E.Z)(j),ne;if(z){var _e=(0,E.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Dt.Z)(this,ne)}}function Pu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Gl=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,wc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ws=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Uo(j,z){for(var M=0,D=1/z,ne=j;ne>0;)M=M+D*(ne%z),ne=Math.floor(ne/z),D=D/z;return M}var Hc=1,Rf=(gs=(0,b.b2)(),qi=(0,b.f3)(W.v.IShaderModuleService),ao=(0,b.f3)(W.v.ILogService),gs(ko=(Rs=function(j){(0,Pt.Z)(M,j);var z=Ec(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),vt=0;vt<ne;vt++)_e[vt]=arguments[vt];return D=z.call.apply(z,[this].concat(_e)),(0,te.Z)((0,Ce.Z)(D),"shaderModuleService",tl,(0,Ce.Z)(D)),(0,te.Z)((0,Ce.Z)(D),"logger",vu,(0,Ce.Z)(D)),(0,k.Z)((0,Ce.Z)(D),"haltonSequence",[]),(0,k.Z)((0,Ce.Z)(D),"accumulatingId",0),(0,k.Z)((0,Ce.Z)(D),"frame",0),(0,k.Z)((0,Ce.Z)(D),"timer",void 0),(0,k.Z)((0,Ce.Z)(D),"sampleRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"prevRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"outputRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"copyRenderTarget",void 0),(0,k.Z)((0,Ce.Z)(D),"blendModel",void 0),(0,k.Z)((0,Ce.Z)(D),"outputModel",void 0),(0,k.Z)((0,Ce.Z)(D),"copyModel",void 0),D}return(0,I.Z)(M,[{key:"getType",value:function(){return Du.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,E.Z)(M.prototype),"init",this).call(this,ne,_e);var vt=this.rendererService,Vt=vt.createFramebuffer,Bt=vt.createTexture2D;this.sampleRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Vt({color:Bt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})});for(var Sr=0;Sr<30;Sr++)this.haltonSequence.push([Uo(Sr,2),Uo(Sr,3)]);this.blendModel=this.createTriangleModel("blend-pass",Gl),this.outputModel=this.createTriangleModel("copy-pass",wc,{blend:{enable:!0,func:{srcRGB:gi.gl.ONE,dstRGB:gi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:gi.gl.ONE,dstAlpha:gi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:gi.gl.FUNC_ADD,alpha:gi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",wc)}},{key:"render",value:function(ne){var _e=this,vt=this.rendererService,Vt=vt.clear,Bt=vt.getViewportSize,Sr=vt.useFramebuffer,qr=Bt(),Rn=qr.width,Gn=qr.height;this.sampleRenderTarget.resize({width:Rn,height:Gn}),this.prevRenderTarget.resize({width:Rn,height:Gn}),this.outputRenderTarget.resize({width:Rn,height:Gn}),this.copyRenderTarget.resize({width:Rn,height:Gn}),this.resetFrame(),this.stopAccumulating();var Mn=ne.multiPassRenderer.getPostProcessor().getReadFBO();Sr(Mn,function(){Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Mn}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)});var di=function yi(aa){!_e.accumulatingId||aa!==_e.accumulatingId||_e.isFinished()||(_e.doRender(ne),requestAnimationFrame(function(){yi(aa)}))};this.accumulatingId=Hc++,this.timer=window.setTimeout(function(){di(_e.accumulatingId)},50)}},{key:"doRender",value:function(ne){var _e=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var vt=this.rendererService,Vt=vt.clear,Bt=vt.getViewportSize,Sr=vt.useFramebuffer,qr=Bt(),Rn=qr.width,Gn=qr.height,Mn=ne.getLayerConfig(),di=Mn.jitterScale,yi=di===void 0?1:di,aa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((aa[0]*2-1)/Rn*yi,(aa[1]*2-1)/Gn*yi),ne.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforeRender.call(),Sr(this.sampleRenderTarget,function(){Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:_e.sampleRenderTarget}),ne.render()}),ne.hooks.afterRender.call(),ne.multiPassRenderer.setRenderFlag(!0);var Mi=ne.getLayerConfig();Sr(this.outputRenderTarget,function(){_e.blendModel.draw({uniforms:{u_opacity:Mi.opacity||1,u_MixRatio:_e.frame===0?1:.9,u_Diffuse1:_e.sampleRenderTarget,u_Diffuse2:_e.frame===0?ne.multiPassRenderer.getPostProcessor().getReadFBO():_e.prevRenderTarget}})}),this.frame===0&&Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Sr(this.copyRenderTarget,function(){_e.outputModel.draw({uniforms:{u_Texture:_e.outputRenderTarget}})}),Sr(ne.multiPassRenderer.getPostProcessor().getReadFBO(),function(){_e.copyModel.draw({uniforms:{u_Texture:_e.copyRenderTarget}})}),ne.multiPassRenderer.getPostProcessor().render(ne));var Ha=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ha,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ne,_e,vt){this.shaderModuleService.registerModule(ne,{vs:Ws,fs:_e});var Vt=this.shaderModuleService.getModule(ne),Bt=Vt.vs,Sr=Vt.fs,qr=Vt.uniforms,Rn=this.rendererService,Gn=Rn.createAttribute,Mn=Rn.createBuffer,di=Rn.createModel;return di(nl({vs:Bt,fs:Sr,attributes:{a_Position:Gn({buffer:Mn({data:[-4,-4,4,-4,0,4],type:gi.gl.FLOAT}),size:2})},uniforms:nl({},qr),depth:{enable:!1},count:3},vt))}}]),M}(Qs),tl=(0,me.Z)(Rs.prototype,"shaderModuleService",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=(0,me.Z)(Rs.prototype,"logger",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs))||ko),Sl=new b.W2;Sl.bind(W.v.IGlobalConfigService).to(Se).inSingletonScope(),Sl.bind(W.v.IShaderModuleService).to(Qu).inSingletonScope(),Sl.bind(W.v.ILogService).to(Pc).inSingletonScope(),(0,b.GW)((0,b.b2)(),w.EventEmitter),Sl.bind(W.v.IEventEmitter).to(w.EventEmitter);var uf=(0,Y.Z)(Sl,!1),Wc=function(z){var M=uf.lazyInject(z);return function(D,ne,_e){M.call(this,D,ne),_e&&(_e.initializer=function(){return D[ne]})}},Wf=function(z){var M=uf.lazyMultiInject(z);return function(D,ne,_e){M.call(this,D,ne),_e&&(_e.initializer=function(){return D[ne]})}},Hl=Sl,ih=0;function lf(){var j=new b.W2;return j.parent=Sl,j.bind(W.v.SceneID).toConstantValue("".concat(ih++)),j.bind(W.v.ILayerService).to(La).inSingletonScope(),j.bind(W.v.ISceneService).to(ic).inSingletonScope(),j.bind(W.v.ICameraService).to(Pr).inSingletonScope(),j.bind(W.v.ICoordinateSystemService).to(hn).inSingletonScope(),j.bind(W.v.IInteractionService).to(_a).inSingletonScope(),j.bind(W.v.IPickingService).to(Zi).inSingletonScope(),j.bind(W.v.IControlService).to(lt).inSingletonScope(),j.bind(W.v.IMarkerService).to(pr).inSingletonScope(),j.bind(W.v.IIconService).to(Kt).inSingletonScope(),j.bind(W.v.IFontService).to(ke).inSingletonScope(),j.bind(W.v.IPopupService).to(bi).inSingletonScope(),j.bind(W.v.INormalPass).to(fu).whenTargetNamed("clear"),j.bind(W.v.INormalPass).to(oc).whenTargetNamed("pixelPicking"),j.bind(W.v.INormalPass).to(du).whenTargetNamed("render"),j.bind(W.v.INormalPass).to(Rf).whenTargetNamed("taa"),j.bind(W.v.IFactoryNormalPass).toFactory(function(z){return function(M){return z.container.getNamed(W.v.INormalPass,M)}}),j.bind(W.v.IPostProcessingPass).to(rt).whenTargetNamed("copy"),j.bind(W.v.IPostProcessingPass).to(yl).whenTargetNamed("blurH"),j.bind(W.v.IPostProcessingPass).to(u).whenTargetNamed("blurV"),j.bind(W.v.IPostProcessingPass).to(Zo).whenTargetNamed("noise"),j.bind(W.v.IPostProcessingPass).to(eu).whenTargetNamed("sepia"),j.bind(W.v.IPostProcessingPass).to(ve).whenTargetNamed("colorHalftone"),j.bind(W.v.IPostProcessingPass).to(yn).whenTargetNamed("hexagonalPixelate"),j.bind(W.v.IPostProcessingPass).to(oi).whenTargetNamed("ink"),j.bind(W.v.IFactoryPostProcessingPass).toFactory(function(z){return function(M){var D=z.container.getNamed(W.v.IPostProcessingPass,M);return D.setName(M),D}}),j}function ru(j){var z=new b.W2;return z.parent=j,z.bind(W.v.IStyleAttributeService).to(Ol).inSingletonScope(),z.bind(W.v.IMultiPassRenderer).to(ku).inSingletonScope(),z.bind(W.v.IPostProcessor).to(Tu).inSingletonScope(),z}},2811:function(){},64532:function(){},4594:function(sr,L,x){"use strict";x.d(L,{l:function(){return Q}});var Q={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(sr,L,x){"use strict";x.d(L,{d:function(){return Q}});var Q;(function(w){w.TOPRIGHT="topright",w.TOPLEFT="topleft",w.BOTTOMRIGHT="bottomright",w.BOTTOMLEFT="bottomleft"})(Q||(Q={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(sr,L,x){"use strict";x.d(L,{l:function(){return Q},k:function(){return w}});var Q;(function(d){d[d.LNGLAT=1]="LNGLAT",d[d.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",d[d.VECTOR_TILE=3]="VECTOR_TILE",d[d.IDENTITY=4]="IDENTITY",d[d.P20=5]="P20",d[d.P20_OFFSET=6]="P20_OFFSET",d[d.METER_OFFSET=7]="METER_OFFSET",d[d.P20_2=8]="P20_2"})(Q||(Q={}));var w={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(sr,L,x){"use strict";x.d(L,{s:function(){return Q}});var Q;(function(w){w.Hover="hover",w.Click="click",w.Select="select",w.Active="active",w.Drag="drag"})(Q||(Q={}))},90919:function(){},77252:function(sr,L,x){"use strict";x.d(L,{h:function(){return Q}});var Q;(function(w){w.normal="normal",w.additive="additive",w.subtractive="subtractive",w.min="min",w.max="max",w.none="none"})(Q||(Q={}))},31251:function(sr,L,x){"use strict";x.d(L,{vY:function(){return Q},ee:function(){return w},GC:function(){return d}});var Q;(function(b){b.LINEAR="linear",b.POWER="power",b.LOG="log",b.IDENTITY="identity",b.TIME="time",b.QUANTILE="quantile",b.QUANTIZE="quantize",b.THRESHOLD="threshold",b.CAT="cat"})(Q||(Q={}));var w;(function(b){b.CONSTANT="constant",b.VARIABLE="variable"})(w||(w={}));var d;(function(b){b[b.Attribute=0]="Attribute",b[b.InstancedAttribute=1]="InstancedAttribute",b[b.Uniform=2]="Uniform"})(d||(d={}))},79042:function(){},16606:function(sr,L,x){"use strict";x.d(L,{I:function(){return Q}});var Q=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(sr,L,x){"use strict";x.d(L,{G:function(){return Q}});var Q;(function(w){w.Normal="normal",w.PostProcessing="post-processing"})(Q||(Q={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(sr,L,x){"use strict";x.d(L,{gl:function(){return Q}});var Q;(function(w){w[w.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",w[w.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",w[w.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",w[w.POINTS=0]="POINTS",w[w.LINES=1]="LINES",w[w.LINE_LOOP=2]="LINE_LOOP",w[w.LINE_STRIP=3]="LINE_STRIP",w[w.TRIANGLES=4]="TRIANGLES",w[w.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",w[w.TRIANGLE_FAN=6]="TRIANGLE_FAN",w[w.ZERO=0]="ZERO",w[w.ONE=1]="ONE",w[w.SRC_COLOR=768]="SRC_COLOR",w[w.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",w[w.SRC_ALPHA=770]="SRC_ALPHA",w[w.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",w[w.DST_ALPHA=772]="DST_ALPHA",w[w.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",w[w.DST_COLOR=774]="DST_COLOR",w[w.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",w[w.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",w[w.FUNC_ADD=32774]="FUNC_ADD",w[w.BLEND_EQUATION=32777]="BLEND_EQUATION",w[w.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",w[w.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",w[w.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",w[w.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",w[w.MAX_EXT=32776]="MAX_EXT",w[w.MIN_EXT=32775]="MIN_EXT",w[w.BLEND_DST_RGB=32968]="BLEND_DST_RGB",w[w.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",w[w.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",w[w.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",w[w.CONSTANT_COLOR=32769]="CONSTANT_COLOR",w[w.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",w[w.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",w[w.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",w[w.BLEND_COLOR=32773]="BLEND_COLOR",w[w.ARRAY_BUFFER=34962]="ARRAY_BUFFER",w[w.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",w[w.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",w[w.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",w[w.STREAM_DRAW=35040]="STREAM_DRAW",w[w.STATIC_DRAW=35044]="STATIC_DRAW",w[w.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",w[w.BUFFER_SIZE=34660]="BUFFER_SIZE",w[w.BUFFER_USAGE=34661]="BUFFER_USAGE",w[w.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",w[w.FRONT=1028]="FRONT",w[w.BACK=1029]="BACK",w[w.FRONT_AND_BACK=1032]="FRONT_AND_BACK",w[w.CULL_FACE=2884]="CULL_FACE",w[w.BLEND=3042]="BLEND",w[w.DITHER=3024]="DITHER",w[w.STENCIL_TEST=2960]="STENCIL_TEST",w[w.DEPTH_TEST=2929]="DEPTH_TEST",w[w.SCISSOR_TEST=3089]="SCISSOR_TEST",w[w.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",w[w.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",w[w.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",w[w.NO_ERROR=0]="NO_ERROR",w[w.INVALID_ENUM=1280]="INVALID_ENUM",w[w.INVALID_VALUE=1281]="INVALID_VALUE",w[w.INVALID_OPERATION=1282]="INVALID_OPERATION",w[w.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",w[w.CW=2304]="CW",w[w.CCW=2305]="CCW",w[w.LINE_WIDTH=2849]="LINE_WIDTH",w[w.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",w[w.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",w[w.CULL_FACE_MODE=2885]="CULL_FACE_MODE",w[w.FRONT_FACE=2886]="FRONT_FACE",w[w.DEPTH_RANGE=2928]="DEPTH_RANGE",w[w.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",w[w.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",w[w.DEPTH_FUNC=2932]="DEPTH_FUNC",w[w.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",w[w.STENCIL_FUNC=2962]="STENCIL_FUNC",w[w.STENCIL_FAIL=2964]="STENCIL_FAIL",w[w.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",w[w.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",w[w.STENCIL_REF=2967]="STENCIL_REF",w[w.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",w[w.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",w[w.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",w[w.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",w[w.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",w[w.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",w[w.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",w[w.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",w[w.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",w[w.VIEWPORT=2978]="VIEWPORT",w[w.SCISSOR_BOX=3088]="SCISSOR_BOX",w[w.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",w[w.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",w[w.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",w[w.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",w[w.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",w[w.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",w[w.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",w[w.RED_BITS=3410]="RED_BITS",w[w.GREEN_BITS=3411]="GREEN_BITS",w[w.BLUE_BITS=3412]="BLUE_BITS",w[w.ALPHA_BITS=3413]="ALPHA_BITS",w[w.DEPTH_BITS=3414]="DEPTH_BITS",w[w.STENCIL_BITS=3415]="STENCIL_BITS",w[w.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",w[w.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",w[w.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",w[w.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",w[w.SAMPLES=32937]="SAMPLES",w[w.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",w[w.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",w[w.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",w[w.DONT_CARE=4352]="DONT_CARE",w[w.FASTEST=4353]="FASTEST",w[w.NICEST=4354]="NICEST",w[w.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",w[w.BYTE=5120]="BYTE",w[w.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",w[w.SHORT=5122]="SHORT",w[w.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",w[w.INT=5124]="INT",w[w.UNSIGNED_INT=5125]="UNSIGNED_INT",w[w.FLOAT=5126]="FLOAT",w[w.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",w[w.ALPHA=6406]="ALPHA",w[w.RGB=6407]="RGB",w[w.RGBA=6408]="RGBA",w[w.LUMINANCE=6409]="LUMINANCE",w[w.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",w[w.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",w[w.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",w[w.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",w[w.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",w[w.VERTEX_SHADER=35633]="VERTEX_SHADER",w[w.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",w[w.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",w[w.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",w[w.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",w[w.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",w[w.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",w[w.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",w[w.SHADER_TYPE=35663]="SHADER_TYPE",w[w.DELETE_STATUS=35712]="DELETE_STATUS",w[w.LINK_STATUS=35714]="LINK_STATUS",w[w.VALIDATE_STATUS=35715]="VALIDATE_STATUS",w[w.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",w[w.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",w[w.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",w[w.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",w[w.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",w[w.NEVER=512]="NEVER",w[w.LESS=513]="LESS",w[w.EQUAL=514]="EQUAL",w[w.LEQUAL=515]="LEQUAL",w[w.GREATER=516]="GREATER",w[w.NOTEQUAL=517]="NOTEQUAL",w[w.GEQUAL=518]="GEQUAL",w[w.ALWAYS=519]="ALWAYS",w[w.KEEP=7680]="KEEP",w[w.REPLACE=7681]="REPLACE",w[w.INCR=7682]="INCR",w[w.DECR=7683]="DECR",w[w.INVERT=5386]="INVERT",w[w.INCR_WRAP=34055]="INCR_WRAP",w[w.DECR_WRAP=34056]="DECR_WRAP",w[w.VENDOR=7936]="VENDOR",w[w.RENDERER=7937]="RENDERER",w[w.VERSION=7938]="VERSION",w[w.NEAREST=9728]="NEAREST",w[w.LINEAR=9729]="LINEAR",w[w.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",w[w.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",w[w.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",w[w.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",w[w.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",w[w.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",w[w.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",w[w.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",w[w.TEXTURE_2D=3553]="TEXTURE_2D",w[w.TEXTURE=5890]="TEXTURE",w[w.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",w[w.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",w[w.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",w[w.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",w[w.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",w[w.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",w[w.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",w[w.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",w[w.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",w[w.TEXTURE0=33984]="TEXTURE0",w[w.TEXTURE1=33985]="TEXTURE1",w[w.TEXTURE2=33986]="TEXTURE2",w[w.TEXTURE3=33987]="TEXTURE3",w[w.TEXTURE4=33988]="TEXTURE4",w[w.TEXTURE5=33989]="TEXTURE5",w[w.TEXTURE6=33990]="TEXTURE6",w[w.TEXTURE7=33991]="TEXTURE7",w[w.TEXTURE8=33992]="TEXTURE8",w[w.TEXTURE9=33993]="TEXTURE9",w[w.TEXTURE10=33994]="TEXTURE10",w[w.TEXTURE11=33995]="TEXTURE11",w[w.TEXTURE12=33996]="TEXTURE12",w[w.TEXTURE13=33997]="TEXTURE13",w[w.TEXTURE14=33998]="TEXTURE14",w[w.TEXTURE15=33999]="TEXTURE15",w[w.TEXTURE16=34e3]="TEXTURE16",w[w.TEXTURE17=34001]="TEXTURE17",w[w.TEXTURE18=34002]="TEXTURE18",w[w.TEXTURE19=34003]="TEXTURE19",w[w.TEXTURE20=34004]="TEXTURE20",w[w.TEXTURE21=34005]="TEXTURE21",w[w.TEXTURE22=34006]="TEXTURE22",w[w.TEXTURE23=34007]="TEXTURE23",w[w.TEXTURE24=34008]="TEXTURE24",w[w.TEXTURE25=34009]="TEXTURE25",w[w.TEXTURE26=34010]="TEXTURE26",w[w.TEXTURE27=34011]="TEXTURE27",w[w.TEXTURE28=34012]="TEXTURE28",w[w.TEXTURE29=34013]="TEXTURE29",w[w.TEXTURE30=34014]="TEXTURE30",w[w.TEXTURE31=34015]="TEXTURE31",w[w.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",w[w.REPEAT=10497]="REPEAT",w[w.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",w[w.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",w[w.FLOAT_VEC2=35664]="FLOAT_VEC2",w[w.FLOAT_VEC3=35665]="FLOAT_VEC3",w[w.FLOAT_VEC4=35666]="FLOAT_VEC4",w[w.INT_VEC2=35667]="INT_VEC2",w[w.INT_VEC3=35668]="INT_VEC3",w[w.INT_VEC4=35669]="INT_VEC4",w[w.BOOL=35670]="BOOL",w[w.BOOL_VEC2=35671]="BOOL_VEC2",w[w.BOOL_VEC3=35672]="BOOL_VEC3",w[w.BOOL_VEC4=35673]="BOOL_VEC4",w[w.FLOAT_MAT2=35674]="FLOAT_MAT2",w[w.FLOAT_MAT3=35675]="FLOAT_MAT3",w[w.FLOAT_MAT4=35676]="FLOAT_MAT4",w[w.SAMPLER_2D=35678]="SAMPLER_2D",w[w.SAMPLER_CUBE=35680]="SAMPLER_CUBE",w[w.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",w[w.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",w[w.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",w[w.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",w[w.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",w[w.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",w[w.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",w[w.COMPILE_STATUS=35713]="COMPILE_STATUS",w[w.LOW_FLOAT=36336]="LOW_FLOAT",w[w.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",w[w.HIGH_FLOAT=36338]="HIGH_FLOAT",w[w.LOW_INT=36339]="LOW_INT",w[w.MEDIUM_INT=36340]="MEDIUM_INT",w[w.HIGH_INT=36341]="HIGH_INT",w[w.FRAMEBUFFER=36160]="FRAMEBUFFER",w[w.RENDERBUFFER=36161]="RENDERBUFFER",w[w.RGBA4=32854]="RGBA4",w[w.RGB5_A1=32855]="RGB5_A1",w[w.RGB565=36194]="RGB565",w[w.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",w[w.STENCIL_INDEX=6401]="STENCIL_INDEX",w[w.STENCIL_INDEX8=36168]="STENCIL_INDEX8",w[w.DEPTH_STENCIL=34041]="DEPTH_STENCIL",w[w.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",w[w.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",w[w.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",w[w.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",w[w.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",w[w.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",w[w.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",w[w.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",w[w.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",w[w.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",w[w.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",w[w.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",w[w.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",w[w.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",w[w.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",w[w.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",w[w.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",w[w.NONE=0]="NONE",w[w.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",w[w.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",w[w.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",w[w.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",w[w.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",w[w.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",w[w.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",w[w.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",w[w.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",w[w.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",w[w.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",w[w.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",w[w.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",w[w.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Q||(Q={}))},69530:function(sr,L,x){"use strict";x.d(L,{Z:function(){return Ke}});var Q=x(55770),w=x(6610),d=x(5991),b=x(96156),Y=x(3473),W=x(11700),$=x.n(W),I=x(14293),k=x.n(I),we=x(68929),Be=x.n(we),We=x(86700),$e=x(58881),Ut=x(72302),Yt=x(92364),kt,Lt,bt,pt,Ir;function er(_t,Fe){var Pe=Object.keys(_t);if(Object.getOwnPropertySymbols){var Ve=Object.getOwnPropertySymbols(_t);Fe&&(Ve=Ve.filter(function(Et){return Object.getOwnPropertyDescriptor(_t,Et).enumerable})),Pe.push.apply(Pe,Ve)}return Pe}function nr(_t){for(var Fe=1;Fe<arguments.length;Fe++){var Pe=arguments[Fe]!=null?arguments[Fe]:{};Fe%2?er(Object(Pe),!0).forEach(function(Ve){(0,b.Z)(_t,Ve,Pe[Ve])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_t,Object.getOwnPropertyDescriptors(Pe)):er(Object(Pe)).forEach(function(Ve){Object.defineProperty(_t,Ve,Object.getOwnPropertyDescriptor(Pe,Ve))})}return _t}var xt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ke=(kt=(0,We.b2)(),Lt=(0,We.f3)(Ut.v.IShaderModuleService),kt(bt=(pt=function(){function _t(){(0,w.Z)(this,_t),(0,Q.Z)(this,"shaderModuleService",Ir,this),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"config",void 0),(0,b.Z)(this,"quad",xt),(0,b.Z)(this,"enabled",!0),(0,b.Z)(this,"renderToScreen",!1),(0,b.Z)(this,"model",void 0),(0,b.Z)(this,"name",void 0),(0,b.Z)(this,"optionsToUpdate",{})}return(0,d.Z)(_t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Pe){this.name=Pe}},{key:"getType",value:function(){return Yt.G.PostProcessing}},{key:"init",value:function(Pe,Ve){this.config=Ve,this.rendererService=Pe.getContainer().get(Ut.v.IRendererService);var Et=this.rendererService,gr=Et.createAttribute,ae=Et.createBuffer,Ae=Et.createModel,oe=this.setupShaders(),ge=oe.vs,Me=oe.fs,Qe=oe.uniforms;this.model=Ae({vs:ge,fs:Me,attributes:{a_Position:gr({buffer:ae({data:[-4,-4,4,-4,0,4],type:$e.gl.FLOAT}),size:2})},uniforms:nr(nr({u_Texture:null},Qe),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Pe){var Ve=this,Et=Pe.multiPassRenderer.getPostProcessor(),gr=this.rendererService,ae=gr.useFramebuffer,Ae=gr.getViewportSize,oe=gr.clear,ge=Ae(),Me=ge.width,Qe=ge.height;ae(this.renderToScreen?null:Et.getWriteFBO(),function(){oe({framebuffer:Et.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),Ve.model.draw({uniforms:nr({u_Texture:Et.getReadFBO(),u_ViewportSize:[Me,Qe]},Ve.convertOptionsToUniforms(Ve.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Pe){this.enabled=Pe}},{key:"setRenderToScreen",value:function(Pe){this.renderToScreen=Pe}},{key:"updateOptions",value:function(Pe){this.optionsToUpdate=nr(nr({},this.optionsToUpdate),Pe)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Pe){var Ve={};return Object.keys(Pe).forEach(function(Et){k()(Pe[Et])||(Ve["u_".concat($()(Be()(Et)))]=Pe[Et])}),Ve}}]),_t}(),Ir=(0,Y.Z)(pt.prototype,"shaderModuleService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt))||bt)},19793:function(sr,L,x){"use strict";x.d(L,{P:function(){return Q}});var Q=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(sr,L,x){"use strict";x.d(L,{v:function(){return Q}});var Q={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(sr,L,x){"use strict";var Q=x(74691),w=null;function d(Fe){return w.indexOf(Fe)}var b=2,Y=4,W=64,$=128,I=256,k=512,we=8192,Be=16384,We=32768,$e=null,Ut=131072,Yt=262144,kt=524288,Lt=1048576,bt=2097152,pt=4194304,Ir=8388608,er=16777216,nr=null;function xt(Fe,Pe){return Fe=_clamp(Math.floor(Fe),0,255),Pe=_clamp(Math.floor(Pe),0,255),256*Fe+Pe}function Ke(Fe){var Pe=Fe.color,Ve=Fe.radius,Et=Fe.tileX,gr=Fe.tileY,ae=Fe.shape,Ae=Fe.opacity,oe=Fe.stroke,ge=Fe.strokeWidth,Me=Fe.strokeOpacity,Qe=[],gt=[],Jt=[],Dr=[xt(Pe[0],Pe[1]),xt(Pe[2],Pe[3])],Br=[xt(oe[0],oe[1]),xt(oe[2],oe[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(un){var tr=_slicedToArray(un,2),se=tr[0],be=tr[1];Qe.push([].concat(Dr,[(se+1)*Ir+(be+1)*bt+getShapeIndex(ae)*Ut+Ve,(Et+512)*kt+(gr+512)*W])),gt.push([].concat(Br,[ge,Me])),Jt.push([Ae,0,0,0])}),{packedBuffer:Qe,packedBuffer2:gt,packedBuffer3:Jt}}function _t(Fe,Pe){if(Fe===0&&!Pe)return 0;if(Fe===1&&Pe)return 4294967295;var Ve=Pe?1:0,Et=Math.floor(Fe*127);return Et*nr+Ve*er+Et*Ut+Ve*$e+Et*k+Ve*I+Et*b+Ve}},66275:function(sr,L,x){"use strict";x.d(L,{zP:function(){return Qy},JE:function(){return Qg},ns:function(){return Jy}});var Q=x(67294),w=(0,Q.createContext)({});function d(){return(0,Q.useContext)(w)}var b=x(58881),Y=x(28481),W=x(6610),$=x(5991),I=x(96156),k=x(63349),we=x(10379),Be=x(46070),We=x(77608),$e=x(6901),Ut=x(26729);function Yt(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function kt(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Yt(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Yt(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Lt(n){var c=bt();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var pt;(function(n){n.TOPRIGHT="topright",n.TOPLEFT="topleft",n.BOTTOMRIGHT="bottomright",n.BOTTOMLEFT="bottomleft"})(pt||(pt={}));var Ir=0,er=function(n){(0,we.Z)(o,n);var c=Lt(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this),(0,I.Z)((0,k.Z)(l),"controlOption",void 0),(0,I.Z)((0,k.Z)(l),"container",void 0),(0,I.Z)((0,k.Z)(l),"sceneContainer",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"renderService",void 0),(0,I.Z)((0,k.Z)(l),"layerService",void 0),(0,I.Z)((0,k.Z)(l),"controlService",void 0),(0,I.Z)((0,k.Z)(l),"isShow",void 0),l.controlOption=kt(kt({},l.getDefault()),s||{}),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.TOPRIGHT,name:"".concat(Ir++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",p=this.controlService;return p&&p.removeControl(this),this.controlOption.position=l,p&&p.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(b.vK.IMapService),this.renderService=l.get(b.vK.IRendererService),this.layerService=l.get(b.vK.ILayerService),this.controlService=l.get(b.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var p=this.container,y=this.controlOption.position,C=this.controlService.controlCorners[y];return $e.SO.addClass(p,"l7-control"),y.indexOf("bottom")!==-1?C.insertBefore(p,C.firstChild):C.appendChild(p),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;$e.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;$e.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;$e.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var p=this.mapsService.getContainer();p!==null&&p.focus()}}}]),o}(Ut.EventEmitter);function nr(n){var c=xt();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function xt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ke=function(n){(0,we.Z)(o,n);var c=nr(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,k.Z)(l),"layerControlInputs",void 0),(0,I.Z)((0,k.Z)(l),"layers",void 0),(0,I.Z)((0,k.Z)(l),"lastZIndex",void 0),(0,I.Z)((0,k.Z)(l),"handlingClick",void 0),(0,I.Z)((0,k.Z)(l),"layersLink",void 0),(0,I.Z)((0,k.Z)(l),"baseLayersList",void 0),(0,I.Z)((0,k.Z)(l),"separator",void 0),(0,I.Z)((0,k.Z)(l),"overlaysList",void 0),(0,I.Z)((0,k.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,$e.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:b.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(p){p.layer.on("remove",l.onLayerChange),p.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,p){return this.addLayer(l,p,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),p=l.height;$e.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var y=p-(this.container.offsetTop+50);return y<this.form.clientHeight?($e.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=y+"px"):$e.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return $e.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(p){p.layer.off("remove",l.onLayerChange),p.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",p=this.container=$e.SO.create("div",l),y=this.controlOption.collapsed;p.setAttribute("aria-haspopup","true");var C=this.form=$e.SO.create("form",l+"-list");y&&(this.mapsService.on("click",this.collapse),p.addEventListener("mouseenter",this.expand),p.addEventListener("mouseleave",this.collapse)),this.layersLink=$e.SO.create("a",l+"-toggle",p);var P=this.layersLink;P.title="Layers",y||this.expand(),this.baseLayersList=$e.SO.create("div",l+"-base",C),this.separator=$e.SO.create("div",l+"-separator",C),this.overlaysList=$e.SO.create("div",l+"-overlays",C),p.appendChild(C)}},{key:"initLayers",value:function(){var l=this,p=this.controlOption,y=p.baseLayers,C=y===void 0?{}:y,P=p.overlayers,O=P===void 0?{}:P;Object.keys(C).forEach(function(J,X){l.addLayer(C[J],J,!1)}),Object.keys(O).forEach(function(J,X){l.addLayer(O[J],J,!0)})}},{key:"update",value:function(){if(!this.container)return this;$e.SO.empty(this.baseLayersList),$e.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,p,y,C,P=0;for(y=0;y<this.layers.length;y++)C=this.layers[y],this.addItem(C),p=p||C.overlay,l=l||!C.overlay,P+=C.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&P>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=p&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,p,y,C=this.mapsService.getZoom(),P=l.length-1;P>=0;P--)if(p=l[P],y=this.layerService.getLayer(p.layerId),y&&y.inited){var O=y.getMinZoom(),J=y.getMaxZoom();p.disabled=C<O||C>J}}},{key:"addLayer",value:function(l,p,y){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:p,overlay:y});var C=this.controlOption,P=C.sortLayers,O=C.sortFunction,J=C.autoZIndex;P&&this.layers.sort(function(X,le){return O(X.layer,le.layer,X.name,le.name)}),J&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var p=this.layerService.getLayer(l.target.layerId),y=p!=null&&p.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;y&&this.emit(y,p)}},{key:"createRadioElement",value:function(l,p){var y='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(p?' checked="checked"':"")+"/>",C=document.createElement("div");return C.innerHTML=y,C.firstChild}},{key:"addItem",value:function(l){var p=document.createElement("label"),y=this.layerService.getLayer(l.layer.id),C=y&&y.inited&&l.layer.isVisible(),P;l.overlay?(P=document.createElement("input"),P.type="checkbox",P.className="l7-control-layers-selector",P.defaultChecked=C):P=this.createRadioElement("l7-base-layers",C),this.layerControlInputs.push(P),P.layerId=l.layer.id,P.addEventListener("click",this.onInputClick);var O=document.createElement("span");O.innerHTML=" "+l.name;var J=document.createElement("div");p.appendChild(J),J.appendChild(P),J.appendChild(O);var X=l.overlay?this.overlaysList:this.baseLayersList;return X.appendChild(p),this.checkDisabledLayers(),p}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,p,y,C=[],P=[];this.handlingClick=!0;for(var O=l.length-1;O>=0;O--)p=l[O],y=this.layerService.getLayer(p.layerId),p.checked?C.push(y):p.checked||P.push(y);P.forEach(function(J){J.hide()}),C.forEach(function(J){J.show()}),this.handlingClick=!1}}]),o}(er);function _t(n){var c=Fe();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Fe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pe=function(n){(0,we.Z)(o,n);var c=_t(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",p=$e.SO.create("div",l),y=$e.SO.create("a","l7-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://antv.alipay.com/l7",y.setAttribute("aria-label","AntV logo"),y.setAttribute("rel","noopener nofollow"),p.appendChild(y),p}},{key:"onRemove",value:function(){return null}}]),o}(er);function Ve(n){var c=Et();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gr=function(n){(0,we.Z)(o,n);var c=Ve(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,k.Z)(l),"mScale",void 0),(0,I.Z)((0,k.Z)(l),"iScale",void 0),(0,$e.Ev)(["update"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",p=$e.SO.create("div",l);this.addScales(l+"-line",p);var y=this.controlOption.updateWhenIdle;return this.mapsService.on(y?"moveend":"mapmove",this.update),this.mapsService.on(y?"zoomend":"zoomchange",this.update),this.update(),p}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,p=this.controlOption.maxWidth,y=l.getSize()[1]/2,C=l.containerToLngLat([0,y]),P=l.containerToLngLat([p,y]),O=(0,$e.yM)([C.lng,C.lat],[P.lng,P.lat]);this.updateScales(O)}},{key:"updateScales",value:function(l){var p=this.controlOption,y=p.metric,C=p.imperial;y&&l&&this.updateMetric(l),C&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var p=this.getRoundNum(l),y=p<1e3?p+" m":p/1e3+" km";this.updateScale(this.mScale,y,p/l)}},{key:"updateImperial",value:function(l){var p=l*3.2808399,y,C,P;p>5280?(y=p/5280,C=this.getRoundNum(y),this.updateScale(this.iScale,C+" mi",C/y)):(P=this.getRoundNum(p),this.updateScale(this.iScale,P+" ft",P/p))}},{key:"updateScale",value:function(l,p,y){var C=this.controlOption.maxWidth;l.style.width=Math.round(C*y)+"px",l.innerHTML=p}},{key:"getRoundNum",value:function(l){var p=Math.pow(10,(Math.floor(l)+"").length-1),y=l/p;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,p*y}},{key:"addScales",value:function(l,p){var y=this.controlOption,C=y.metric,P=y.imperial;C&&(this.mScale=$e.SO.create("div",l,p)),P&&(this.iScale=$e.SO.create("div",l,p))}}]),o}(er);function ae(n){var c=Ae();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var oe=function(n){(0,we.Z)(o,n);var c=ae(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,k.Z)(l),"disabled",void 0),(0,I.Z)((0,k.Z)(l),"zoomInButton",void 0),(0,I.Z)((0,k.Z)(l),"zoomOutButton",void 0),(0,$e.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:pt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",p=$e.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",p,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",p,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),p}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,p,y,C,P){var O=$e.SO.create("a",y,C);return O.innerHTML=l,O.title=p,O.href="javascript:void(0)",O.addEventListener("click",P),O}},{key:"updateDisabled",value:function(){var l=this.mapsService,p="l7-disabled";$e.SO.removeClass(this.zoomInButton,p),$e.SO.removeClass(this.zoomOutButton,p),(this.disabled||l.getZoom()<=l.getMinZoom())&&$e.SO.addClass(this.zoomOutButton,p),(this.disabled||l.getZoom()>=l.getMaxZoom())&&$e.SO.addClass(this.zoomInButton,p)}}]),o}(er);function ge(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Me(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ge(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):ge(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Qe(n){var c=gt();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Jt=function(n){(0,we.Z)(o,n);var c=Qe(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this),(0,I.Z)((0,k.Z)(l),"markerOption",void 0),(0,I.Z)((0,k.Z)(l),"defaultMarker",void 0),(0,I.Z)((0,k.Z)(l),"popup",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,k.Z)(l),"lngLat",void 0),(0,I.Z)((0,k.Z)(l),"scene",void 0),(0,I.Z)((0,k.Z)(l),"added",!1),(0,I.Z)((0,k.Z)(l),"eventHandle",function(p){l.emit(p.type,{target:p,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=Me(Me({},l.getDefault()),s),(0,$e.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,k.Z)(l)),l.init(),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:$e.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(b.vK.IMapService),this.sceneSerive=l.get(b.vK.ISceneService);var p=this.markerOption,y=p.element,C=p.draggable;return this.mapsService.getMarkerContainer().appendChild(y),this.registerMarkerEvent(y),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&$e.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var p=this;if(!this.added)return this.once("added",function(){p.setElement(l)}),this;var y=this.markerOption.element;return y&&$e.SO.remove(y),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var p=this.popup;return p?(p.isOpen()||p.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var p=this.popup;return p&&p.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,y=l.anchor;this.updatePosition(),$e.SO.setTransform(p,"".concat($e.rQ[y]))}}},{key:"onMapClick",value:function(l){var p=this.markerOption.element;this.popup&&p&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,y=l.offsets,C=this.lngLat,P=C.lng,O=C.lat,J=this.mapsService.getBounds(),X=this.mapsService.lngLatToContainer([P,O]);if(p){p.style.display="block";var le=this.mapsService.getContainer(),Re=0,ot=0;if(le&&(Re=le.scrollWidth,ot=le.scrollHeight),Math.abs(J[0][0])>180||Math.abs(J[1][0])>180){if(X.x>Re){var It=this.mapsService.lngLatToContainer([P-360,O]);X.x=It.x}if(X.x<0){var vr=this.mapsService.lngLatToContainer([P+360,O]);X.x=vr.x}}(X.x>Re||X.x<0||X.y>ot||X.y<0)&&(p.style.display="none"),p.style.left=X.x+y[0]+"px",p.style.top=X.y-y[1]+"px"}}}},{key:"init",value:function(){var l=this,p=this.markerOption.element,y=this.markerOption,C=y.color,P=y.anchor;if(!p){this.defaultMarker=!0,p=$e.SO.create("div"),this.markerOption.element=p;var O=document.createElementNS("http://www.w3.org/2000/svg","svg");O.setAttributeNS(null,"display","block"),O.setAttributeNS(null,"height","48px"),O.setAttributeNS(null,"width","48px"),O.setAttributeNS(null,"viewBox","0 0 1024 1024");var J=document.createElementNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),J.setAttributeNS(null,"fill",C),O.appendChild(J),p.appendChild(O)}$e.SO.addClass(p,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(X){var le,Re,ot=((le=l.markerOption)===null||le===void 0?void 0:le.style)&&((Re=l.markerOption)===null||Re===void 0?void 0:Re.style[X]);p&&(p.style[X]=ot)}),p.addEventListener("click",function(X){l.onMapClick(X)}),p.addEventListener("click",this.eventHandle),(0,$e.zi)(p,P,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}(Ut.EventEmitter),Dr=x(82492),Br=x.n(Dr),un=x(69848),tr=x.n(un);function se(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function be(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?se(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):se(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function ke(n){var c=Ce();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ce(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pt=function(n){(0,we.Z)(o,n);var c=ke(o);function o(s){var l,p;return(0,W.Z)(this,o),p=c.call(this),(0,I.Z)((0,k.Z)(p),"markers",[]),(0,I.Z)((0,k.Z)(p),"markerLayerOption",void 0),(0,I.Z)((0,k.Z)(p),"clusterIndex",void 0),(0,I.Z)((0,k.Z)(p),"points",[]),(0,I.Z)((0,k.Z)(p),"clusterMarkers",[]),(0,I.Z)((0,k.Z)(p),"mapsService",void 0),(0,I.Z)((0,k.Z)(p),"scene",void 0),(0,I.Z)((0,k.Z)(p),"zoom",void 0),(0,I.Z)((0,k.Z)(p),"bbox",void 0),p.markerLayerOption=Br()(p.getDefault(),s),(0,$e.Ev)(["update"],(0,k.Z)(p)),p.zoom=((l=p.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,p}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(b.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var p=this.markerLayerOption.cluster;p&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var p=this.markers.indexOf(l);p>-1&&this.markers.splice(p,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(p){p.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,p){var y=l.getLnglat(),C=y.lng,P=y.lat,O={geometry:{type:"Point",coordinates:[C,P]},properties:be(be({},l.getExtData()),{},{marker_id:p})};this.points.push(O)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,p=l.radius,y=l.minZoom,C=y===void 0?0:y,P=l.maxZoom;this.clusterIndex=new(tr())({radius:p,minZoom:C,maxZoom:P}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,p){var y=this,C=l[0].concat(l[1]),P=this.clusterIndex.getClusters(C,p);this.clusterMarkers.forEach(function(O){O.remove()}),this.clusterMarkers=[],P.forEach(function(O){var J,X=y.markerLayerOption.clusterOption,le=X.field,Re=X.method;if(O.properties&&(J=O.properties)!==null&&J!==void 0&&J.cluster_id){var ot,It=y.getLeaves((ot=O.properties)===null||ot===void 0?void 0:ot.cluster_id);if(O.properties.clusterData=It,le&&Re){var vr=It==null?void 0:It.map(function(Ln){var ni=(0,I.Z)({},le,Ln.properties[le]);return ni}),br=$e.a5.getColumn(vr,le),Zr=$e.a5.getSatByColumn(Re,br),cn="point_"+Re;O.properties[cn]=Zr.toFixed(2)}}var xn=y.clusterMarker(O);y.clusterMarkers.push(xn),xn.addTo(y.scene)})}},{key:"getLeaves",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,p,y):null}},{key:"clusterMarker",value:function(l){var p=this.markerLayerOption.clusterOption,y=p,C=y.element,P=C===void 0?this.generateElement.bind(this):C,O=new Jt({element:P(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return O}},{key:"normalMarker",value:function(l){var p=l.properties.marker_id;return this.markers[p]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),p=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,$e.oO)(this.bbox,p))&&(this.bbox=(0,$e.yA)(p,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var p=$e.SO.create("div","l7-marker-cluster"),y=$e.SO.create("div","",p),C=$e.SO.create("span","",y),P=this.markerLayerOption.clusterOption,O=P.field,J=P.method;l.properties.point_count=l.properties.point_count||1;var X=O&&J?l.properties["point_"+J]||l.properties[O]:l.properties.point_count;return C.textContent=X,p}}]),o}(Ut.EventEmitter);function Dt(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function E(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Dt(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Dt(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function N(n){var c=he();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function he(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ze=function(n){(0,we.Z)(o,n);var c=N(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this),(0,I.Z)((0,k.Z)(l),"popupOption",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,k.Z)(l),"lngLat",void 0),(0,I.Z)((0,k.Z)(l),"content",void 0),(0,I.Z)((0,k.Z)(l),"closeButton",void 0),(0,I.Z)((0,k.Z)(l),"timeoutInstance",void 0),(0,I.Z)((0,k.Z)(l),"container",void 0),(0,I.Z)((0,k.Z)(l),"tip",void 0),(0,I.Z)((0,k.Z)(l),"scene",void 0),l.popupOption=E(E({},l.getdefault()),s),(0,$e.Ev)(["update","onClickClose","remove"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"addTo",value:function(l){var p=this;return this.mapsService=l.get(b.vK.IMapService),this.sceneSerive=l.get(b.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){p.mapsService.on("click",p.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var p=window.document.createDocumentFragment(),y=window.document.createElement("body"),C;for(y.innerHTML=l;C=y.firstChild,!!C;)p.appendChild(C);return this.setDOMContent(p)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&$e.SO.remove(this.content),this.content=$e.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=$e.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,p,y){var C=window.document.createElement(l);return p!==void 0&&(C.className=p),y&&y.appendChild(C),C}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:$e.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,p=this.lngLat,y=this.popupOption,C=y.className,P=y.maxWidth,O=y.anchor;if(!(!this.mapsService||!p||!this.content)){var J=this.mapsService.getMarkerContainer();if(!this.container&&J){this.container=this.creatDom("div","l7-popup",J),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),C&&C.split(" ").forEach(function(le){return l.container.classList.add(le)});var X=this.popupOption.stopPropagation;X&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(le){l.container.addEventListener(le,function(Re){Re.stopPropagation()})})}P&&this.container.style.maxWidth!==P&&(this.container.style.maxWidth=P),this.updatePosition(),$e.SO.setTransform(this.container,"".concat($e.rQ[O])),(0,$e.zi)(this.container,O,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,p=l.lng,y=l.lat,C=this.popupOption.offsets,P=this.mapsService.lngLatToContainer([p,y]);this.container.style.left=P.x+C[0]+"px",this.container.style.top=P.y-C[1]+"px"}}}]),o}(Ut.EventEmitter);x(68982)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var qe=x(92137),mt=x(87757),Ct=x.n(mt),H=x(86700),Kt=x(81550),jt=x.n(Kt),hr=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var s=o.buffer,l=o.offset,p=o.stride,y=o.normalized,C=o.size,P=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:p||0,normalized:y||!1,divisor:P||0},C&&(this.attribute.size=C)}return(0,$.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),Cr,Tr,Pr,Je,yt,ht,fr,$r,lt,Rt,Qt,pr,vn,Pn,bi=(Cr={},(0,I.Z)(Cr,b.gl.POINTS,"points"),(0,I.Z)(Cr,b.gl.LINES,"lines"),(0,I.Z)(Cr,b.gl.LINE_LOOP,"line loop"),(0,I.Z)(Cr,b.gl.LINE_STRIP,"line strip"),(0,I.Z)(Cr,b.gl.TRIANGLES,"triangles"),(0,I.Z)(Cr,b.gl.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(Cr,b.gl.TRIANGLE_STRIP,"triangle strip"),Cr),Si=(Tr={},(0,I.Z)(Tr,b.gl.STATIC_DRAW,"static"),(0,I.Z)(Tr,b.gl.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(Tr,b.gl.STREAM_DRAW,"stream"),Tr),Ri=(Pr={},(0,I.Z)(Pr,b.gl.BYTE,"int8"),(0,I.Z)(Pr,b.gl.UNSIGNED_INT,"int16"),(0,I.Z)(Pr,b.gl.INT,"int32"),(0,I.Z)(Pr,b.gl.UNSIGNED_BYTE,"uint8"),(0,I.Z)(Pr,b.gl.UNSIGNED_SHORT,"uint16"),(0,I.Z)(Pr,b.gl.UNSIGNED_INT,"uint32"),(0,I.Z)(Pr,b.gl.FLOAT,"float"),Pr),ia=(Je={},(0,I.Z)(Je,b.gl.ALPHA,"alpha"),(0,I.Z)(Je,b.gl.LUMINANCE,"luminance"),(0,I.Z)(Je,b.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(Je,b.gl.RGB,"rgb"),(0,I.Z)(Je,b.gl.RGBA,"rgba"),(0,I.Z)(Je,b.gl.RGBA4,"rgba4"),(0,I.Z)(Je,b.gl.RGB5_A1,"rgb5 a1"),(0,I.Z)(Je,b.gl.RGB565,"rgb565"),(0,I.Z)(Je,b.gl.DEPTH_COMPONENT,"depth"),(0,I.Z)(Je,b.gl.DEPTH_STENCIL,"depth stencil"),Je),pi=(yt={},(0,I.Z)(yt,b.gl.DONT_CARE,"dont care"),(0,I.Z)(yt,b.gl.NICEST,"nice"),(0,I.Z)(yt,b.gl.FASTEST,"fast"),yt),G=(ht={},(0,I.Z)(ht,b.gl.NEAREST,"nearest"),(0,I.Z)(ht,b.gl.LINEAR,"linear"),(0,I.Z)(ht,b.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(ht,b.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(ht,b.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(ht,b.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ht),ie=(fr={},(0,I.Z)(fr,b.gl.REPEAT,"repeat"),(0,I.Z)(fr,b.gl.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(fr,b.gl.MIRRORED_REPEAT,"mirror"),fr),ce=($r={},(0,I.Z)($r,b.gl.NONE,"none"),(0,I.Z)($r,b.gl.BROWSER_DEFAULT_WEBGL,"browser"),$r),B=(lt={},(0,I.Z)(lt,b.gl.NEVER,"never"),(0,I.Z)(lt,b.gl.ALWAYS,"always"),(0,I.Z)(lt,b.gl.LESS,"less"),(0,I.Z)(lt,b.gl.LEQUAL,"lequal"),(0,I.Z)(lt,b.gl.GREATER,"greater"),(0,I.Z)(lt,b.gl.GEQUAL,"gequal"),(0,I.Z)(lt,b.gl.EQUAL,"equal"),(0,I.Z)(lt,b.gl.NOTEQUAL,"notequal"),lt),re=(Rt={},(0,I.Z)(Rt,b.gl.FUNC_ADD,"add"),(0,I.Z)(Rt,b.gl.MIN_EXT,"min"),(0,I.Z)(Rt,b.gl.MAX_EXT,"max"),(0,I.Z)(Rt,b.gl.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Rt,b.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Rt),fe=(Qt={},(0,I.Z)(Qt,b.gl.ZERO,"zero"),(0,I.Z)(Qt,b.gl.ONE,"one"),(0,I.Z)(Qt,b.gl.SRC_COLOR,"src color"),(0,I.Z)(Qt,b.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Qt,b.gl.SRC_ALPHA,"src alpha"),(0,I.Z)(Qt,b.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Qt,b.gl.DST_COLOR,"dst color"),(0,I.Z)(Qt,b.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Qt,b.gl.DST_ALPHA,"dst alpha"),(0,I.Z)(Qt,b.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Qt,b.gl.CONSTANT_COLOR,"constant color"),(0,I.Z)(Qt,b.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Qt,b.gl.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Qt,b.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Qt,b.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Qt),Se=(pr={},(0,I.Z)(pr,b.gl.NEVER,"never"),(0,I.Z)(pr,b.gl.ALWAYS,"always"),(0,I.Z)(pr,b.gl.LESS,"less"),(0,I.Z)(pr,b.gl.LEQUAL,"lequal"),(0,I.Z)(pr,b.gl.GREATER,"greater"),(0,I.Z)(pr,b.gl.GEQUAL,"gequal"),(0,I.Z)(pr,b.gl.EQUAL,"equal"),(0,I.Z)(pr,b.gl.NOTEQUAL,"notequal"),pr),te=(vn={},(0,I.Z)(vn,b.gl.ZERO,"zero"),(0,I.Z)(vn,b.gl.KEEP,"keep"),(0,I.Z)(vn,b.gl.REPLACE,"replace"),(0,I.Z)(vn,b.gl.INVERT,"invert"),(0,I.Z)(vn,b.gl.INCR,"increment"),(0,I.Z)(vn,b.gl.DECR,"decrement"),(0,I.Z)(vn,b.gl.INCR_WRAP,"increment wrap"),(0,I.Z)(vn,b.gl.DECR_WRAP,"decrement wrap"),vn),me=(Pn={},(0,I.Z)(Pn,b.gl.FRONT,"front"),(0,I.Z)(Pn,b.gl.BACK,"back"),Pn),ct=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"buffer",void 0);var s=o.data,l=o.usage,p=o.type;this.buffer=c.buffer({data:s,usage:Si[l||b.gl.STATIC_DRAW],type:Ri[p||b.gl.UNSIGNED_BYTE]})}return(0,$.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,l=o.offset;this.buffer.subdata(s,l)}}]),n}(),yr=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"elements",void 0);var s=o.data,l=o.usage,p=o.type,y=o.count;this.elements=c.elements({data:s,usage:Si[l||b.gl.STATIC_DRAW],type:Ri[p||b.gl.UNSIGNED_BYTE],count:y})}return(0,$.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),Or=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"framebuffer",void 0);var s=o.width,l=o.height,p=o.color,y=o.colors,C=o.depth,P=o.stencil,O={width:s,height:l};Array.isArray(y)&&(O.colors=y.map(function(J){return J.get()})),p&&typeof p!="boolean"&&(O.color=p.get()),this.framebuffer=c.framebuffer(O)}return(0,$.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.framebuffer.resize(s,l)}}]),n}(),Ft=x(90484),kr=x(36719),bn=x.n(kr),gn=x(68630),mr=x.n(gn);function dn(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Wr(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?dn(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):dn(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var ln=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=c;var s=o.vs,l=o.fs,p=o.attributes,y=o.uniforms,C=o.primitive,P=o.count,O=o.elements,J=o.depth,X=o.blend,le=o.stencil,Re=o.cull,ot=o.instances,It={};this.options=o,y&&(this.uniforms=this.extractUniforms(y),Object.keys(y).forEach(function(Zr){It[Zr]=c.prop(Zr)}));var vr={};Object.keys(p).forEach(function(Zr){vr[Zr]=p[Zr].get()});var br={attributes:vr,frag:l,uniforms:It,vert:s,primitive:bi[C===void 0?b.gl.TRIANGLES:C]};ot&&(br.instances=ot),P&&(br.count=P),O&&(br.elements=O.get()),this.initDepthDrawParams({depth:J},br),this.initBlendDrawParams({blend:X},br),this.initStencilDrawParams({stencil:le},br),this.initCullDrawParams({cull:Re},br),this.drawCommand=c(br),this.drawParams=br}return(0,$.Z)(n,[{key:"addUniforms",value:function(o){this.uniforms=Wr(Wr({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Wr(Wr({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(s).forEach(function(p){var y=(0,Ft.Z)(s[p]);y==="boolean"||y==="number"||Array.isArray(s[p])||s[p].BYTES_PER_ELEMENT?l[p]=s[p]:l[p]=s[p].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var l=o.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:B[l.func||b.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var l=o.blend;if(l){var p=l.enable,y=l.func,C=l.equation,P=l.color,O=P===void 0?[0,0,0,0]:P;s.blend={enable:!!p,func:{srcRGB:fe[y&&y.srcRGB||b.gl.SRC_ALPHA],srcAlpha:fe[y&&y.srcAlpha||b.gl.SRC_ALPHA],dstRGB:fe[y&&y.dstRGB||b.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:fe[y&&y.dstAlpha||b.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:re[C&&C.rgb||b.gl.FUNC_ADD],alpha:re[C&&C.alpha||b.gl.FUNC_ADD]},color:O}}}},{key:"initStencilDrawParams",value:function(o,s){var l=o.stencil;if(l){var p=l.enable,y=l.mask,C=y===void 0?-1:y,P=l.func,O=P===void 0?{cmp:b.gl.ALWAYS,ref:0,mask:-1}:P,J=l.opFront,X=J===void 0?{fail:b.gl.KEEP,zfail:b.gl.KEEP,zpass:b.gl.KEEP}:J,le=l.opBack,Re=le===void 0?{fail:b.gl.KEEP,zfail:b.gl.KEEP,zpass:b.gl.KEEP}:le;s.stencil={enable:!!p,mask:C,func:Wr(Wr({},O),{},{cmp:Se[O.cmp]}),opFront:{fail:te[X.fail],zfail:te[X.zfail],zpass:te[X.zpass]},opBack:{fail:te[Re.fail],zfail:te[Re.zfail],zpass:te[Re.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var l=o.cull;if(l){var p=l.enable,y=l.face,C=y===void 0?b.gl.BACK:y;s.cull={enable:!!p,face:me[C]}}}},{key:"extractUniforms",value:function(o){var s=this,l={};return Object.keys(o).forEach(function(p){s.extractUniformsRecursively(p,o[p],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,s,l,p){var y=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||bn()(s)||s===""||"resize"in s){l["".concat(p&&p+".").concat(o)]=s;return}mr()(s)&&Object.keys(s).forEach(function(C){y.extractUniformsRecursively(C,s[C],l,"".concat(p&&p+".").concat(o))}),Array.isArray(s)&&s.forEach(function(C,P){Object.keys(C).forEach(function(O){y.extractUniformsRecursively(O,C[O],l,"".concat(p&&p+".").concat(o,"[").concat(P,"]"))})})}}]),n}(),Ei=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0);var s=o.data,l=o.type,p=l===void 0?b.gl.UNSIGNED_BYTE:l,y=o.width,C=o.height,P=o.flipY,O=P===void 0?!1:P,J=o.format,X=J===void 0?b.gl.RGBA:J,le=o.mipmap,Re=le===void 0?!1:le,ot=o.wrapS,It=ot===void 0?b.gl.CLAMP_TO_EDGE:ot,vr=o.wrapT,br=vr===void 0?b.gl.CLAMP_TO_EDGE:vr,Zr=o.aniso,cn=Zr===void 0?0:Zr,xn=o.alignment,Ln=xn===void 0?1:xn,ni=o.premultiplyAlpha,Nn=ni===void 0?!1:ni,xi=o.mag,Ji=xi===void 0?b.gl.NEAREST:xi,ga=o.min,hi=ga===void 0?b.gl.NEAREST:ga,wa=o.colorSpace,co=wa===void 0?b.gl.BROWSER_DEFAULT_WEBGL:wa;this.width=y,this.height=C;var ju={width:y,height:C,type:Ri[p],format:ia[X],wrapS:ie[It],wrapT:ie[br],mag:G[Ji],min:G[hi],alignment:Ln,flipY:O,colorSpace:ce[co],premultiplyAlpha:Nn,aniso:cn};s&&(ju.data=s),typeof Re=="number"?ju.mipmap=pi[Re]:typeof Re=="boolean"&&(ju.mipmap=Re),this.texture=c.texture(ju)}return(0,$.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),hn,wi,Yi=(hn=(0,H.b2)(),hn(wi=function(){function n(){var c=this;(0,W.Z)(this,n),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(o){return new ln(c.gl,o)}),(0,I.Z)(this,"createAttribute",function(o){return new hr(c.gl,o)}),(0,I.Z)(this,"createBuffer",function(o){return new ct(c.gl,o)}),(0,I.Z)(this,"createElements",function(o){return new yr(c.gl,o)}),(0,I.Z)(this,"createTexture2D",function(o){return new Ei(c.gl,o)}),(0,I.Z)(this,"createFramebuffer",function(o){return new Or(c.gl,o)}),(0,I.Z)(this,"useFramebuffer",function(o,s){c.gl({framebuffer:o?o.get():null})(s)}),(0,I.Z)(this,"clear",function(o){var s=o.color,l=o.depth,p=o.stencil,y=o.framebuffer,C=y===void 0?null:y,P={color:s,depth:l,stencil:p};P.framebuffer=C===null?C:C.get(),c.gl.clear(P)}),(0,I.Z)(this,"viewport",function(o){var s=o.x,l=o.y,p=o.width,y=o.height;c.gl._gl.viewport(s,l,p,y),c.width=p,c.height=y,c.gl._refresh()}),(0,I.Z)(this,"readPixels",function(o){var s=o.framebuffer,l=o.x,p=o.y,y=o.width,C=o.height,P={x:l,y:p,width:y,height:C};return s&&(P.framebuffer=s.get()),c.gl.read(P)}),(0,I.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){var o;return(o=c.canvas)===null||o===void 0?void 0:o.parentElement}),(0,I.Z)(this,"getCanvas",function(){return c.canvas}),(0,I.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,I.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,$.Z)(n,[{key:"init",value:function(){var c=(0,qe.Z)(Ct().mark(function s(l,p){var y=this;return Ct().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.canvas=l,P.next=3,new Promise(function(O,J){jt()({canvas:y.canvas,attributes:{alpha:!0,antialias:p.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:p.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(le,Re){(le||!Re)&&J(le),O(Re)}})});case 3:this.gl=P.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return P.stop()}},s,this)}));function o(s,l){return c.apply(this,arguments)}return o}()},{key:"testExtension",value:function(o){return!!this.getGLContext().getExtension(o)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||wi);function Yn(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Di(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Yn(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Yn(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var ki=function(){function n(c){(0,W.Z)(this,n),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var o=c.id,s=c.map,l=(0,b.Hp)();this.container=l,s.setContainer(l,o),l.bind(b.vK.IRendererService).to(Yi).inSingletonScope(),this.sceneService=l.get(b.vK.ISceneService),this.mapService=l.get(b.vK.IMapService),this.iconService=l.get(b.vK.IIconService),this.fontService=l.get(b.vK.IFontService),this.controlService=l.get(b.vK.IControlService),this.layerService=l.get(b.vK.ILayerService),this.markerService=l.get(b.vK.IMarkerService),this.interactionService=l.get(b.vK.IInteractionService),this.popupService=l.get(b.vK.IPopupService),this.initComponent(o),this.sceneService.init(c),this.initControl()}return(0,$.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var p=new o(s);p.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,b.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(l){var p=(0,Y.Z)(l,2),y=p[0],C=p[1];s.fontService.addIconFont(y,C)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"once",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.once(o,s):this.sceneService.once(o,s)}},{key:"off",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var l=this.sceneService.getSceneConfig(),p=l.fitBoundsOptions,y=l.animate;this.mapService.fitBounds(o,s||Di(Di({},p),{},{animate:y}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(b.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:$e.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,l=o.logoPosition;s&&this.addControl(new Pe({position:l}))}}]),n}(),za=x(81253),Wn=x(55770),ai=x(3473),Ai=x(13218),Qn=x.n(Ai),Fi=x(23560),ya=x.n(Fi),Xa=x(46343),_a=x(86387),da=x.n(_a),Vu,Ya,gi,qa,Ka;function $a(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Yo=(Vu=(0,H.b2)(),Ya=(0,H.f3)(b.vK.IGlobalConfigService),Vu(gi=(qa=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"configService",Ka,this),(0,I.Z)(this,"enabled",void 0)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,p=s.rendererService,y=s.postProcessingPassFactory,C=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var P=o.getLayerConfig(),O=P.enableMultiPassRenderer,J=P.passes,X=J===void 0?[]:J;l.enabled=!!O&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,X,y,C),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,l,p){var y=o.multiPassRenderer,C=o.getLayerConfig(),P=C.enablePicking,O=C.enableTAA;return P&&y.add(p("pixelPicking")),y}}]),n}(),Ka=(0,ai.Z)(qa.prototype,"configService",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa))||gi),Gi,Oo=(Gi={},(0,I.Z)(Gi,b.BlendType.additive,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Gi,b.BlendType.none,{enable:!1}),(0,I.Z)(Gi,b.BlendType.normal,{enable:!0,func:{srcRGB:b.gl.SRC_ALPHA,dstRGB:b.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Gi,b.BlendType.subtractive,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE,srcAlpha:b.gl.ZERO,dstAlpha:b.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:b.gl.FUNC_SUBTRACT,alpha:b.gl.FUNC_SUBTRACT}}),(0,I.Z)(Gi,b.BlendType.max,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE},equation:{rgb:b.gl.MAX_EXT}}),(0,I.Z)(Gi,b.BlendType.min,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE},equation:{rgb:b.gl.MIN_EXT}}),Gi),Oa=x(47037),Za=x.n(Oa),cs=x(81763),va=x.n(cs),fs=x(1469),Ca=x.n(fs),fo=1024;function Zi(n,c,o,s,l){c.updateStyleAttribute(n,o,s,l)}function pe(n,c){n.opacity&&Oe("opacity",c,n.opacity),n.strokeWidth&&Oe("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&Oe("strokeOpacity",c,n.strokeOpacity),n.stroke&&ur("stroke",c,n.stroke),n.offsets&&ft("offsets",c,n.offsets),n.textOffset&&ft("textOffset",c,n.textOffset)}function Oe(n,c,o){Za()(o)?Zi(n,c,o,function(s){return s}):va()(o)?Zi(n,c,[o],void 0):Ca()(o)&&o.length===2?Za()(o[0])&&ya()(o[1])||Za()(o[0])&&Ca()(o[1])&&va()(o[1][0])&&va()(o[1][1])?Zi(n,c,o[0],o[1]):Zi(n,c,[1],void 0):Zi(n,c,[1],void 0)}function ft(n,c,o){Za()(o)?Zi(n,c,o,function(s){return s}):Ca()(o)&&o.length===2&&Za()(o[0])&&ya()(o[1])?Zi(n,c,o[0],o[1]):Ca()(o)&&o.length===2&&va()(o[0])&&va()(o[1])?Zi(n,c,o,void 0):Zi(n,c,[0,0],void 0)}function ur(n,c,o){Za()(o)?Zi(n,c,o,void 0):Ca()(o)&&o.length===2&&(Za()(o[0])&&ya()(o[1])||Za()(o[0])&&Ca()(o[1])&&o[1].length>0)?Zi(n,c,o[0],o[1]):Zi(n,c,"#fff",void 0)}var Qr={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},Dn,Ki,Ua,La,ja,To,Mu;function $l(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=Il(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var O=o.next();return p=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!p&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function Il(n,c){if(!!n){if(typeof n=="string")return Lo(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Lo(n,c)}}function Lo(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function Xs(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function ua(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Xs(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Xs(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Ns(n){var c=ou();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var bs=0,Ps=(Dn=(0,b.yT)(b.vK.ILogService),Ki=(0,b.yT)(b.vK.IGlobalConfigService),Ua=(0,b.yT)(b.vK.IShaderModuleService),La=function(n){(0,we.Z)(o,n);var c=Ns(o);function o(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,W.Z)(this,o),s=c.call(this),(0,I.Z)((0,k.Z)(s),"id","".concat(bs++)),(0,I.Z)((0,k.Z)(s),"name","".concat(bs)),(0,I.Z)((0,k.Z)(s),"type",void 0),(0,I.Z)((0,k.Z)(s),"visible",!0),(0,I.Z)((0,k.Z)(s),"zIndex",0),(0,I.Z)((0,k.Z)(s),"minZoom",void 0),(0,I.Z)((0,k.Z)(s),"maxZoom",void 0),(0,I.Z)((0,k.Z)(s),"inited",!1),(0,I.Z)((0,k.Z)(s),"layerModelNeedUpdate",!1),(0,I.Z)((0,k.Z)(s),"pickedFeatureID",null),(0,I.Z)((0,k.Z)(s),"selectedFeatureID",null),(0,I.Z)((0,k.Z)(s),"styleNeedUpdate",!1),(0,I.Z)((0,k.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,k.Z)(s),"hooks",{init:new Xa.oI,afterInit:new Xa.oI,beforeRender:new Xa.oI,beforeRenderData:new Xa.gg,afterRender:new Xa.ni,beforePickingEncode:new Xa.ni,afterPickingEncode:new Xa.ni,beforeHighlight:new Xa.ni(["pickedColor"]),afterHighlight:new Xa.ni,beforeSelect:new Xa.ni(["pickedColor"]),afterSelect:new Xa.ni,beforeDestroy:new Xa.ni,afterDestroy:new Xa.ni}),(0,I.Z)((0,k.Z)(s),"models",[]),(0,I.Z)((0,k.Z)(s),"multiPassRenderer",void 0),(0,I.Z)((0,k.Z)(s),"plugins",void 0),(0,I.Z)((0,k.Z)(s),"sourceOption",void 0),(0,I.Z)((0,k.Z)(s),"layerModel",void 0),(0,Wn.Z)((0,k.Z)(s),"logger",ja,(0,k.Z)(s)),(0,Wn.Z)((0,k.Z)(s),"configService",To,(0,k.Z)(s)),(0,Wn.Z)((0,k.Z)(s),"shaderModuleService",Mu,(0,k.Z)(s)),(0,I.Z)((0,k.Z)(s),"cameraService",void 0),(0,I.Z)((0,k.Z)(s),"coordinateService",void 0),(0,I.Z)((0,k.Z)(s),"iconService",void 0),(0,I.Z)((0,k.Z)(s),"fontService",void 0),(0,I.Z)((0,k.Z)(s),"pickingService",void 0),(0,I.Z)((0,k.Z)(s),"rendererService",void 0),(0,I.Z)((0,k.Z)(s),"layerService",void 0),(0,I.Z)((0,k.Z)(s),"interactionService",void 0),(0,I.Z)((0,k.Z)(s),"mapService",void 0),(0,I.Z)((0,k.Z)(s),"styleAttributeService",void 0),(0,I.Z)((0,k.Z)(s),"layerSource",void 0),(0,I.Z)((0,k.Z)(s),"postProcessingPassFactory",void 0),(0,I.Z)((0,k.Z)(s),"normalPassFactory",void 0),(0,I.Z)((0,k.Z)(s),"animateOptions",{enable:!1}),(0,I.Z)((0,k.Z)(s),"container",void 0),(0,I.Z)((0,k.Z)(s),"encodedData",void 0),(0,I.Z)((0,k.Z)(s),"configSchema",void 0),(0,I.Z)((0,k.Z)(s),"currentPickId",null),(0,I.Z)((0,k.Z)(s),"rawConfig",void 0),(0,I.Z)((0,k.Z)(s),"needUpdateConfig",void 0),(0,I.Z)((0,k.Z)(s),"pendingStyleAttributes",[]),(0,I.Z)((0,k.Z)(s),"scaleOptions",{}),(0,I.Z)((0,k.Z)(s),"animateStartTime",void 0),(0,I.Z)((0,k.Z)(s),"aniamateStatus",!1),(0,I.Z)((0,k.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var p=s.getLayerConfig(),y=p.autoFit,C=p.fitBoundsOptions;y&&s.fitBounds(C),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,$.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=ua(ua({},this.needUpdateConfig),l);else{var p=this.container.get(b.vK.SceneID);pe(l,this),this.configService.setLayerConfig(p,this.id,ua(ua(ua({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,p=this.container.get(b.vK.SceneID),y=this.rawConfig.enableMultiPassRenderer,C=y===void 0?!1:y;this.configService.setLayerConfig(p,this.id,{enableMultiPassRenderer:C}),this.iconService=this.container.get(b.vK.IIconService),this.fontService=this.container.get(b.vK.IFontService),this.rendererService=this.container.get(b.vK.IRendererService),this.layerService=this.container.get(b.vK.ILayerService),this.interactionService=this.container.get(b.vK.IInteractionService),this.pickingService=this.container.get(b.vK.IPickingService),this.mapService=this.container.get(b.vK.IMapService),this.cameraService=this.container.get(b.vK.ICameraService),this.coordinateService=this.container.get(b.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(b.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(b.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(b.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(b.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(X){var le=X.attributeName,Re=X.attributeField,ot=X.attributeValues,It=X.updateOptions;l.styleAttributeService.updateStyleAttribute(le,{scale:ua({field:Re},l.splitValuesAndCallbackInAttribute(ot,l.getLayerConfig()[le]))},It)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(b.vK.ILayerPlugin);var P=$l(this.plugins),O;try{for(P.s();!(O=P.n()).done;){var J=O.value;J.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(X){P.e(X)}finally{P.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(ua(ua({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),p=l.animateOption;p!=null&&p.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,p,y){return this.updateStyleAttribute("color",l,p,y),this}},{key:"texture",value:function(l,p,y){return this.updateStyleAttribute("texture",l,p,y),this}},{key:"rotate",value:function(l,p,y){return this.updateStyleAttribute("rotate",l,p,y),this}},{key:"size",value:function(l,p,y){return this.updateStyleAttribute("size",l,p,y),this}},{key:"filter",value:function(l,p,y){return this.updateStyleAttribute("filter",l,p,y),this}},{key:"shape",value:function(l,p,y){return this.updateStyleAttribute("shape",l,p,y),this}},{key:"label",value:function(l,p,y){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:p,updateOptions:y}),this}},{key:"animate",value:function(l){var p={};return Qn()(l)?(p.enable=!0,p=ua(ua({},p),l)):p.enable=l,this.updateLayerConfig({animateOption:p}),this}},{key:"source",value:function(l,p){return this.sourceOption={data:l,options:p},this}},{key:"setData",value:function(l,p){var y=this;return this.inited?this.layerSource.setData(l,p):this.on("inited",function(){y.layerSource.setData(l,p)}),this}},{key:"style",value:function(l){var p=this,y=l.passes,C=(0,za.Z)(l,["passes"]);return y&&$a(y).forEach(function(P){var O=p.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(P[0]);O&&O.updateOptions(P[1])}),this.rawConfig=ua(ua({},this.rawConfig),C),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,p){return Qn()(l)?this.scaleOptions=ua(ua({},this.scaleOptions),l):this.scaleOptions[l]=p,this}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var p={};return p.enableHighlight=Qn()(l)?!0:l,Qn()(l)?(p.enableHighlight=!0,l.color&&(p.highlightColor=l.color)):p.enableHighlight=!!l,this.updateLayerConfig(p),this}},{key:"setActive",value:function(l,p){var y=this;if(Qn()(l)){var C=l.x,P=C===void 0?0:C,O=l.y,J=O===void 0?0:O;this.updateLayerConfig({highlightColor:Qn()(p)?p.color:this.getLayerConfig().highlightColor}),this.pick({x:P,y:J})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Qn()(p)?p.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"select",value:function(l){var p={};return p.enableSelect=Qn()(l)?!0:l,Qn()(l)?(p.enableSelect=!0,l.color&&(p.selectColor=l.color)):p.enableSelect=!!l,this.updateLayerConfig(p),this}},{key:"setSelect",value:function(l,p){var y=this;if(Qn()(l)){var C=l.x,P=C===void 0?0:C,O=l.y,J=O===void 0?0:O;this.updateLayerConfig({selectColor:Qn()(p)?p.color:this.getLayerConfig().selectColor}),this.pick({x:P,y:J})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Qn()(p)?p.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),p=this.getLayerConfig(),y=p.visible,C=p.minZoom,P=C===void 0?-Infinity:C,O=p.maxZoom,J=O===void 0?Infinity:O;return!!y&&l>=P&&l<=J}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),p=l.minZoom;return p}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),p=l.maxZoom;return p}},{key:"get",value:function(l){var p=this.getLayerConfig();return p[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var p=this.getSource(),y=p.extent,C=y.some(function(P){return Math.abs(P)===Infinity});return C?this:(this.mapService.fitBounds([[y[0],y[1]],[y[2],y[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var p=this.mapService.getZoom();this.layerSource.updateClusterData(p)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=da()([Qr,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(l){var p=this.styleAttributeService.getLayerAttributeScale(l);if(p){if(p.ticks){var y=p.ticks().map(function(P){return(0,I.Z)({value:P},l,p(P))});return y}else if(p.invertExtent){var C=p.range().map(function(P){return(0,I.Z)({value:p.invertExtent(P)},l,P)});return C}}else return[]}},{key:"pick",value:function(l){var p=l.x,y=l.y;this.interactionService.triggerHover({x:p,y})}},{key:"boxSelect",value:function(l,p){this.pickingService.boxPickLayer(this,l,p)}},{key:"buildLayerModel",value:function(l){var p=l.moduleName,y=l.vertexShader,C=l.fragmentShader,P=l.triangulation,O=(0,za.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(p,{vs:y,fs:C});var J=this.shaderModuleService.getModule(p),X=J.vs,le=J.fs,Re=J.uniforms,ot=this.rendererService.createModel,It=this.styleAttributeService.createAttributesAndIndices(this.encodedData,P),vr=It.attributes,br=It.elements;return ot(ua({attributes:vr,uniforms:Re,fs:le,vs:X,elements:br,blend:Oo[b.BlendType.normal]},O))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var p=this.getLayerConfig(),y=p.enableHighlight,C=y===void 0?!0:y,P=p.enableSelect,O=P===void 0?!0:P,J=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&O&&(J=!0),l==="mousemove"&&(C||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(J=!0),this.isVisible()&&J}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){p.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,p,y,C){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:ua({field:p},this.splitValuesAndCallbackInAttribute(y,this.getLayerConfig()[p]))},C):this.pendingStyleAttributes.push({attributeName:l,attributeField:p,attributeValues:y,updateOptions:C})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,p){return{values:ya()(l)?void 0:l||p,callback:ya()(l)?l:void 0}}}]),o}(Ut.EventEmitter),ja=(0,ai.Z)(La.prototype,"logger",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=(0,ai.Z)(La.prototype,"configService",[Ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu=(0,ai.Z)(La.prototype,"shaderModuleService",[Ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La),ti=x(85061),ho=x(60442),su=x.n(ho),Ol=x(2650),sl,He,Tt,_r,Zn;function sa(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=xa(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var O=o.next();return p=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!p&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function xa(n,c){if(!!n){if(typeof n=="string")return ka(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ka(n,c)}}function ka(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}var vi=(sl=(0,b.yT)(b.vK.IGlobalConfigService),He=(0,b.yT)(b.vK.IShaderModuleService),Tt=function(){function n(c){(0,W.Z)(this,n),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),(0,Wn.Z)(this,"configService",_r,this),(0,Wn.Z)(this,"shaderModuleService",Zn,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(b.vK.IRendererService),this.styleAttributeService=c.getContainer().get(b.vK.IStyleAttributeService),this.mapService=c.getContainer().get(b.vK.IMapService),this.iconService=c.getContainer().get(b.vK.IIconService),this.fontService=c.getContainer().get(b.vK.IFontService),this.cameraService=c.getContainer().get(b.vK.ICameraService),this.layerService=c.getContainer().get(b.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var o=this.rendererService.createTexture2D;this.createTexture2D=o,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:b.gl.NEAREST,min:b.gl.NEAREST,width:1,height:1}))}return(0,$.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(o){var s=!1;return su()(o.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=o.opacity),su()(o.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=o.strokeOpacity),su()(o.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=o.strokeWidth),su()(o.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=o.stroke),su()(o.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=o.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(o){this.clearLastCalRes(),o.opacity!==void 0&&!va()(o.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),o.strokeOpacity!==void 0&&!va()(o.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),o.strokeWidth!==void 0&&!va()(o.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),o.stroke!==void 0&&!this.isStaticColor(o.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),o.offsets!==void 0&&!this.isOffsetStatic(o.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(o){return Za()(o)?!!(0,Ol.ZP)(o):!1}},{key:"getStrokeColor",value:function(o){if(this.isStaticColor(o)){var s=(0,$e.CI)(o);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(o){return!!(Ca()(o)&&o.length===2&&va()(o[0])&&va()(o[1]))}},{key:"patchMod",value:function(o,s){for(var l=0;l<s;l++)o.push(-1)}},{key:"patchData",value:function(o,s,l){var p=sa(l),y;try{for(p.s();!(y=p.n()).done;){var C=y.value,P=C.attr,O=C.count,J=s[P];J?P==="stroke"?o.push.apply(o,(0,ti.Z)((0,$e.CI)(J))):P==="offsets"?this.isOffsetStatic(J)?o.push(-J[0],J[1]):o.push(0,0):o.push(va()(J)?J:1):this.patchMod(o,O)}}catch(X){p.e(X)}finally{p.f()}}},{key:"calDataFrame",value:function(o,s,l){for(var p=s.length,y=Math.ceil(p*o/this.DATA_TEXTURE_WIDTH),C=y*this.DATA_TEXTURE_WIDTH,P=[],O=0;O<p;O++){var J=s[O];this.patchData(P,J,l)}for(var X=P.length;X<C;X++)P.push(-1);return{data:P,width:this.DATA_TEXTURE_WIDTH,height:y}}},{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,l=s===void 0?"normal":s;return Oo[b.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),_r=(0,ai.Z)(Tt.prototype,"configService",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=(0,ai.Z)(Tt.prototype,"shaderModuleService",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt),Ta=x(9187),eo=x.n(Ta),qn=x(31437),ba=qn.create(),Jl=qn.create(),Ra=qn.create(),Ro=qn.create(),xu=qn.create();function Ys(n,c,o,s,l){qn.add(n,o,s),qn.normalize(n,n),c=qn.fromValues(-n[1],n[0]);var p=qn.fromValues(-o[1],o[0]);return[l/qn.dot(c,p),c]}function zs(n,c){return qn.set(n,-c[1],c[0])}function rs(n,c,o){return qn.sub(n,c,o),qn.normalize(n,n),n}function Iu(n,c){return n[0]===c[0]&&n[1]===c[1]}function xo(n){for(var c=new Map,o=0;o<n.length;o++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(o,1),o++):c.set(s,s)}return n}var rf=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,W.Z)(this,n),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",qn.fromValues(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,$.Z)(n,[{key:"extrude_gaode2",value:function(o,s){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var p=o.length,y=l.startIndex,C=1;C<p;C++){var P=o[C-1],O=s[C-1],J=o[C],X=s[C],le=C<o.length-1?o[C+1]:null,Re=C<s.length-1?s[C+1]:null,ot=this.segment_gaode2(l,y,P,J,le,O,X,Re);y+=ot}if(this.dash)for(var It=0;It<l.positions.length/6;It++)l.positions[It*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,p=s.startIndex,y=1;y<l;y++){var C=o[y-1],P=o[y],O=y<o.length-1?o[y+1]:null,J=this.segment(s,p,C,P,O);p+=J}if(this.dash)for(var X=0;X<s.positions.length/6;X++)s.positions[X*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,l,p,y,C,P,O){var J=0,X=o.indices,le=o.positions,Re=o.normals,ot=this.cap==="square",It=this.join==="bevel",vr=(0,$e.Z)([P[0],P[1]]),br=(0,$e.Z)([C[0],C[1]]);rs(Ra,p,l);var Zr=0;if(this.dash&&(Zr=this.lineSegmentDistance(vr,br),this.totalDistance+=Zr),this.normal||(this.normal=qn.create(),zs(this.normal,Ra)),!this.started)if(this.started=!0,ot){var cn=qn.create(),xn=qn.create();qn.add(cn,this.normal,Ra),qn.add(xn,this.normal,Ra),Re.push(xn[0],xn[1],0),Re.push(cn[0],cn[1],0),le.push(l[0],l[1],0,this.totalDistance-Zr,-this.thickness,0),le.push(l[0],l[1],0,this.totalDistance-Zr,this.thickness,0)}else this.extrusions(le,Re,l,this.normal,this.thickness,this.totalDistance-Zr);if(X.push(s+0,s+1,s+2),y){Iu(p,y)&&qn.add(y,p,qn.normalize(y,qn.subtract(y,p,l))),rs(Ro,y,p);var Nn=Ys(xu,qn.create(),Ra,Ro,this.thickness),xi=(0,Y.Z)(Nn,2),Ji=xi[0],ga=xi[1],hi=qn.dot(xu,this.normal)<0?-1:1,wa=It;if(!wa&&this.join==="miter"){var co=Ji;co>this.miterLimit&&(wa=!0)}wa?(Re.push(this.normal[0],this.normal[1],0),Re.push(ga[0],ga[1],0),le.push(p[0],p[1],0,this.totalDistance,-this.thickness*hi,0),le.push(p[0],p[1],0,this.totalDistance,this.thickness*hi,0),X.push.apply(X,(0,ti.Z)(this.lastFlip!==-hi?[s,s+2,s+3]:[s+2,s+1,s+3])),X.push(s+2,s+3,s+4),zs(ba,Ro),qn.copy(this.normal,ba),Re.push(this.normal[0],this.normal[1],0),le.push(p[0],p[1],0,this.totalDistance,-this.thickness*hi,0),J+=3):(this.extrusions(le,Re,p,ga,Ji,this.totalDistance),X.push.apply(X,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),hi=-1,qn.copy(this.normal,ga),J+=2),this.lastFlip=hi}else{if(zs(this.normal,Ra),ot){var Ln=qn.create(),ni=qn.create();qn.sub(ni,Ra,this.normal),qn.add(Ln,Ra,this.normal),Re.push(ni[0],ni[1],0),Re.push(Ln[0],Ln[1],0),le.push(p[0],p[1],0,this.totalDistance,this.thickness,0),le.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(le,Re,p,this.normal,this.thickness,this.totalDistance);X.push.apply(X,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),J+=2}return J}},{key:"segment",value:function(o,s,l,p,y){var C=0,P=o.indices,O=o.positions,J=o.normals,X=this.cap==="square",le=this.join==="bevel",Re=(0,$e.Z)([p[0],p[1]]),ot=(0,$e.Z)([l[0],l[1]]);rs(Ra,Re,ot);var It=0;if(this.dash&&(It=this.lineSegmentDistance(Re,ot),this.totalDistance+=It),this.normal||(this.normal=qn.create(),zs(this.normal,Ra)),!this.started)if(this.started=!0,X){var vr=qn.create(),br=qn.create();qn.add(vr,this.normal,Ra),qn.add(br,this.normal,Ra),J.push(br[0],br[1],0),J.push(vr[0],vr[1],0),O.push(l[0],l[1],0,this.totalDistance-It,-this.thickness,0),O.push(l[0],l[1],0,this.totalDistance-It,this.thickness,0)}else this.extrusions(O,J,l,this.normal,this.thickness,this.totalDistance-It);if(P.push(s+0,s+1,s+2),y){var xn=(0,$e.Z)([y[0],y[1]]);Iu(Re,xn)&&qn.add(xn,Re,qn.normalize(xn,qn.subtract(xn,Re,ot))),rs(Ro,xn,Re);var Ln=Ys(xu,qn.create(),Ra,Ro,this.thickness),ni=(0,Y.Z)(Ln,2),Nn=ni[0],xi=ni[1],Ji=qn.dot(xu,this.normal)<0?-1:1,ga=le;if(!ga&&this.join==="miter"){var hi=Nn;hi>this.miterLimit&&(ga=!0)}ga?(J.push(this.normal[0],this.normal[1],0),J.push(xi[0],xi[1],0),O.push(p[0],p[1],0,this.totalDistance,-this.thickness*Ji,0),O.push(p[0],p[1],0,this.totalDistance,this.thickness*Ji,0),P.push.apply(P,(0,ti.Z)(this.lastFlip!==-Ji?[s,s+2,s+3]:[s+2,s+1,s+3])),P.push(s+2,s+3,s+4),zs(ba,Ro),qn.copy(this.normal,ba),J.push(this.normal[0],this.normal[1],0),O.push(p[0],p[1],0,this.totalDistance,-this.thickness*Ji,0),C+=3):(this.extrusions(O,J,p,xi,Nn,this.totalDistance),P.push.apply(P,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Ji=-1,qn.copy(this.normal,xi),C+=2),this.lastFlip=Ji}else{if(zs(this.normal,Ra),X){var Zr=qn.create(),cn=qn.create();qn.sub(cn,Ra,this.normal),qn.add(Zr,Ra,this.normal),J.push(cn[0],cn[1],0),J.push(Zr[0],Zr[1],0),O.push(p[0],p[1],0,this.totalDistance,this.thickness,0),O.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(O,J,p,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),C+=2}return C}},{key:"extrusions",value:function(o,s,l,p,y,C){s.push(p[0],p[1],0),s.push(p[0],p[1],0),o.push(l[0],l[1],0,C,-y,0),o.push(l[0],l[1],0,C,y,0)}},{key:"lineSegmentDistance",value:function(o,s){var l=s[0]-o[0],p=s[1]-o[1];return Math.sqrt(l*l+p*p)}}]),n}();function ul(n){if(va()(n[0]))return n;if(va()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(va()(n[0][0][0])){var c=n,o=0,s=0,l=0;return c.forEach(function(p){p.forEach(function(y){o+=y[0],s+=y[1],l++})}),[o/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ui=x(77160);function Hf(n){var c=n[0][0],o=n[0][n[0].length-1];c[0]===o[0]&&c[1]===o[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=eo().flatten(n),p=l.vertices,y=l.dimensions,C=[],P=[],O=0;O<p.length/y;O++)y===2?C.push(p[O*2],p[O*2+1],1):C.push(p[O*3],p[O*3+1],1);var J=eo()(l.vertices,l.holes,l.dimensions);P.push.apply(P,(0,ti.Z)(J));for(var X=function(ot){var It=l.vertices.slice(ot*y,(ot+1)*y),vr=l.vertices.slice((ot+1)*y,(ot+2)*y);vr.length===0&&(vr=l.vertices.slice(0,y));var br=C.length/3;C.push(It[0],It[1],1,vr[0],vr[1],1,It[0],It[1],0,vr[0],vr[1],0),P.push.apply(P,(0,ti.Z)([0,2,1,2,3,1].map(function(Zr){return Zr+br})))},le=0;le<s;le++)X(le);return{positions:C,index:P}}function Ql(n){var c=eo().flatten(n),o=eo()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:o}}function Sf(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=n[0][0],s=n[0][n[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,p=eo().flatten(n),y=p.vertices,C=p.dimensions,P=[],O=[],J=[],X=0;X<y.length/C;X++)C===2?P.push(y[X*2],y[X*2+1],1,-1,-1):P.push(y[X*3],y[X*3+1],1,-1,-1),J.push(0,0,1);var le=eo()(p.vertices,p.holes,p.dimensions);O.push.apply(O,(0,ti.Z)(le));for(var Re=function(vr){var br=p.vertices.slice(vr*C,(vr+1)*C),Zr=p.vertices.slice((vr+1)*C,(vr+2)*C);Zr.length===0&&(Zr=p.vertices.slice(0,C));var cn=P.length/5;P.push(br[0],br[1],1,0,0,Zr[0],Zr[1],1,.1,0,br[0],br[1],0,0,.8,Zr[0],Zr[1],0,.1,.8);var xn=Ll([Zr[0],Zr[1],1],[br[0],br[1],0],[br[0],br[1],1],c);J.push.apply(J,(0,ti.Z)(xn).concat((0,ti.Z)(xn),(0,ti.Z)(xn),(0,ti.Z)(xn))),O.push.apply(O,(0,ti.Z)([1,2,0,3,2,1].map(function(Ln){return Ln+cn})))},ot=0;ot<l;ot++)Re(ot);return{positions:P,index:O,normals:J}}function Ll(n,c,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Ui.create(),p=Ui.create(),y=Ui.create();s&&(n=(0,$e.vP)(n),c=(0,$e.vP)(c),o=(0,$e.vP)(o));var C=Ui.fromValues.apply(Ui,(0,ti.Z)(n)),P=Ui.fromValues.apply(Ui,(0,ti.Z)(c)),O=Ui.fromValues.apply(Ui,(0,ti.Z)(o));Ui.sub(l,O,P),Ui.sub(p,C,P),Ui.cross(y,l,p);var J=Ui.create();return Ui.normalize(J,y),J}var Ko,Aa;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(Aa||(Aa={}));var to;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(to||(to={}));function Ks(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(o*l+c*Math.PI/12);var p=s.map(function(y){var C=Math.sin(y+Math.PI/4),P=Math.cos(y+Math.PI/4);return[C,P,0]});return p}function ns(){return Ks(30)}function fc(){return Ks(4)}function Rl(){return Ks(3)}function bu(){return Ks(6,1)}function Su(){return Ks(5)}var Ou=(Ko={},(0,I.Z)(Ko,to.CIRCLE,ns),(0,I.Z)(Ko,to.HEXAGON,bu),(0,I.Z)(Ko,to.TRIANGLE,Rl),(0,I.Z)(Ko,to.SQUARE,fc),(0,I.Z)(Ko,to.PENTAGON,Su),(0,I.Z)(Ko,Aa.CYLINDER,ns),(0,I.Z)(Ko,Aa.HEXAGONCOLUMN,bu),(0,I.Z)(Ko,Aa.TRIANGLECOLUMN,Rl),(0,I.Z)(Ko,Aa.SQUARECOLUMN,fc),(0,I.Z)(Ko,Aa.PENTAGONCOLUMN,Su),Ko),Zs={};function Eu(n){var c=ul(n.coordinates);return{vertices:[].concat((0,ti.Z)(c),(0,ti.Z)(c),(0,ti.Z)(c),(0,ti.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function hc(n){var c=n.shape,o=ql(c,!1),s=o.positions,l=o.index,p=o.normals;return{vertices:s,indices:l,normals:p,size:5}}function Gu(n){var c=ul(n.coordinates);return{vertices:(0,ti.Z)(c),indices:[0],size:c.length}}function ma(n){var c=n.coordinates,o=n.originCoordinates,s=n.version,l=new rf({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var p=c;Array.isArray(p[0][0])||(p=[c]);var y=o;Array.isArray(y[0][0])||(y=[o]);for(var C=0;C<p.length;C++){var P=p[C],O=y[C];l.extrude_gaode2(P,O)}}else{var J=c;Array.isArray(J[0][0])||(J=[c]),J.forEach(function(le){l.extrude(le)})}var X=l.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,size:6}}function Pc(n){var c=n.coordinates,o=eo().flatten(c),s=o.vertices,l=o.dimensions,p=o.holes;return{indices:eo()(s,p,l),vertices:s,size:l}}function Ef(n){var c=n.coordinates,o=Sf(c,!0),s=o.positions,l=o.index,p=o.normals;return{vertices:s,indices:l,normals:p,size:5}}function ll(n){var c=n.shape,o=fl(c),s=o.positions,l=o.index;return{vertices:s,indices:l,size:3}}function nf(n){var c=n.coordinates,o=[].concat((0,ti.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,ti.Z)(c[1]),[0,1,0],(0,ti.Z)(c[0]),[0,0,1],(0,ti.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function Mc(n){for(var c=30,o=n.coordinates,s=[],l=[],p=function(P){s.push(P,1,P,o[0][0],o[0][1],o[1][0],o[1][1],P,-1,P,o[0][0],o[0][1],o[1][0],o[1][1]),P!==c-1&&l.push.apply(l,(0,ti.Z)([0,1,2,1,3,2].map(function(O){return P*2+O})))},y=0;y<c;y++)p(y);return{vertices:s,indices:l,size:7}}function pc(n){var c=n.coordinates;c.length===2&&c.push(0);var o=n.size,s=uu(-1,1),l=uu(1,1),p=uu(-1,-1),y=uu(1,-1),C=[].concat((0,ti.Z)(c),(0,ti.Z)(s),(0,ti.Z)(c),(0,ti.Z)(p),(0,ti.Z)(c),(0,ti.Z)(y),(0,ti.Z)(c),(0,ti.Z)(l)),P=[0,1,2,3,0,2];return{vertices:C,indices:P,size:5}}function ql(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Zs&&Zs[n])return Zs[n];var o=Ou[n]?Ou[n]():Ou.cylinder(),s=Sf([o],c);return Zs[n]=s,s}function cl(n,c){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/o*3),p,y,C,P=vec3.create(),O=vec3.create(),J=vec3.create(),X=0,le=c.length;X<le;X+=3){p=c[X+0]*3,y=c[X+1]*3,C=c[X+2]*3;var Re=[n[p],n[p+1]],ot=[n[y],n[y+1]],It=[n[C],n[C+1]];s&&(Re=lngLatToMeters(Re),ot=lngLatToMeters(ot),It=lngLatToMeters(It));var vr=Re,br=_slicedToArray(vr,2),Zr=br[0],cn=br[1],xn=vec3.fromValues(Zr,cn,n[p+2]),Ln=ot,ni=_slicedToArray(Ln,2),Nn=ni[0],xi=ni[1],Ji=vec3.fromValues(Nn,xi,n[y+2]),ga=It,hi=_slicedToArray(ga,2),wa=hi[0],co=hi[1],ju=vec3.fromValues(wa,co,n[C+2]);vec3.sub(P,ju,Ji),vec3.sub(O,xn,Ji),vec3.cross(J,P,O),l[p]+=P[0],l[p+1]+=P[1],l[p+2]+=P[2],l[y]+=P[0],l[y+1]+=P[1],l[y+2]+=P[2],l[C]+=P[0],l[C+1]+=P[1],l[C+2]+=P[2]}return wu(l),l}function wu(n){for(var c=0,o=n.length;c<o;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function ec(n){var c=n[0][0],o=n[0][n[0].length-1];return c[0]===o[0]&&c[1]===o[1]}function fl(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=Ou[n]?Ou[n]():Ou.circle(),s=c.indexOf(n)===-1?Ql([o]):Hf([o]);return s}function uu(n,c){var o=(n+1)/2,s=(c+1)/2;return[o,s]}function dc(n){var c=hl();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $s=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ic=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Oc=function(n){(0,we.Z)(o,n);var c=dc(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p,C=l.baseColor,P=C===void 0?"rgb(16,16,16)":C,O=l.brightColor,J=O===void 0?"rgb(255,176,38)":O,X=l.windowColor,le=X===void 0?"rgb(30,60,89)":X,Re=l.time,ot=Re===void 0?0:Re;return{u_opacity:y,u_baseColor:(0,$e.CI)(P),u_brightColor:(0,$e.CI)(J),u_windowColor:(0,$e.CI)(le),u_time:this.layer.getLayerAnimateTime()||ot}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Ic,fragmentShader:$s,triangulation:Ef})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.size,J=O===void 0?10:O;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(p,y,C,P){var O=p.size;return[C[3],C[4]]}}})}}]),o}(vi);function Lc(n){var c=Hu();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Hu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Dl=function(n){(0,we.Z)(o,n);var c=Lc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","PolygonLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Oc(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(Ps);function tc(n){var c=Wu();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var kl=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Rc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Xu=function(n){(0,we.Z)(o,n);var c=tc(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:p||1,u_coverage:y||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:kl,fragmentShader:Rc,triangulation:ll,depth:{enable:!1},primitive:b.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y){var C=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[C[0],C[1],0]}}})}}]),o}(vi);function No(n){var c=af();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var of=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Fl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Dc=function(n){(0,we.Z)(o,n);var c=No(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:p||1,u_coverage:y||1,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:of,fragmentShader:Fl,triangulation:hc,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.size;return Array.isArray(O)?[O[0]]:[O]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y){var C=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[C[0],C[1],0]}}})}}]),o}(vi),Fa=x(85975);function kc(n,c){for(var o=[],s=[],l=[],p=n+1,y=c+1,C=n/2,P=c/2,O=0;O<y;O++)for(var J=O-P,X=0;X<p;X++){var le=X-C;s.push(le/C,-J/P,0),l.push(X/n),l.push(1-O/c)}for(var Re=0;Re<c;Re++)for(var ot=0;ot<n;ot++){var It=ot+p*Re,vr=ot+p*(Re+1),br=ot+1+p*(Re+1),Zr=ot+1+p*Re;o.push(It,vr,Zr),o.push(vr,br,Zr)}return{vertices:s,indices:o,uvs:l}}var Yu,Fc;function Cu(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Pa(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Cu(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Cu(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function rc(n){var c=Lu();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ku=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Hi=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,Ma=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Us=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,vc=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,nc=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,ic=(Yu=(0,H.b2)(),Yu(Fc=function(n){(0,we.Z)(o,n);var c=rc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"colorTexture",void 0),(0,I.Z)((0,k.Z)(s),"heatmapFramerBuffer",void 0),(0,I.Z)((0,k.Z)(s),"intensityModel",void 0),(0,I.Z)((0,k.Z)(s),"colorModel",void 0),(0,I.Z)((0,k.Z)(s),"shapeType",void 0),s}return(0,$.Z)(o,[{key:"render",value:function(){var l=this,p=this.rendererService,y=p.clear,C=p.useFramebuffer;C(this.heatmapFramerBuffer,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,p=this.rendererService,y=p.createFramebuffer,C=p.clear,P=p.getViewportSize,O=p.createTexture2D,J=p.useFramebuffer,X=this.styleAttributeService.getLayerStyleAttribute("shape"),le=(X==null||(l=X.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=le,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=le==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Re=this.layer.getLayerConfig(),ot=Re.rampColors,It=(0,$e.Cl)(ot),vr=P(),br=vr.width,Zr=vr.height;return this.heatmapFramerBuffer=y({color:O({width:Math.floor(br/4),height:Math.floor(Zr/4),wrapS:b.gl.CLAMP_TO_EDGE,wrapT:b.gl.CLAMP_TO_EDGE,min:b.gl.LINEAR,mag:b.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:b.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(p,y,C,P){return[C[3],C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.size,J=O===void 0?1:O;return[J]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:vc,fragmentShader:Us,triangulation:pc,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:b.gl.ONE,srcAlpha:1,dstRGB:b.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:nc,fs:Ma});var l=this.shaderModuleService.getModule("heatmapColor"),p=l.vs,y=l.fs,C=l.uniforms,P=this.rendererService,O=P.createAttribute,J=P.createElements,X=P.createBuffer,le=P.createModel;return le({vs:p,fs:y,attributes:{a_Position:O({buffer:X({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:b.gl.FLOAT}),size:3}),a_Uv:O({buffer:X({data:[0,1,1,1,0,0,1,0],type:b.gl.FLOAT}),size:2})},uniforms:Pa({},C),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:b.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.intensity,C=y===void 0?10:y,P=l.radius,O=P===void 0?5:P;this.intensityModel.draw({uniforms:{u_opacity:p||1,u_radius:O,u_intensity:C}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=Fa.create();Fa.invert(y,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ti.Z)(y)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,p=l(),y=p.width,C=p.height,P=kc(y/4,C/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Hi,fs:Ku});var O=this.shaderModuleService.getModule("heatmap3dColor"),J=O.vs,X=O.fs,le=O.uniforms,Re=this.rendererService,ot=Re.createAttribute,It=Re.createElements,vr=Re.createBuffer,br=Re.createModel;return br({vs:J,fs:X,attributes:{a_Position:ot({buffer:vr({data:P.vertices,type:b.gl.FLOAT}),size:3}),a_Uv:ot({buffer:vr({data:P.uvs,type:b.gl.FLOAT}),size:2})},primitive:b.gl.TRIANGLES,uniforms:Pa({},le),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:b.gl.SRC_ALPHA,srcAlpha:1,dstRGB:b.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:It({data:P.indices,type:b.gl.UNSIGNED_INT,count:P.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var p=this.layer.getLayerConfig(),y=p.rampColors,C=(0,$e.Cl)(y);this.colorTexture=l({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:b.gl.CLAMP_TO_EDGE,wrapT:b.gl.CLAMP_TO_EDGE,min:b.gl.NEAREST,mag:b.gl.NEAREST,flipY:!1})}}]),o}(vi))||Fc);function Of(n){var c=Lf();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Lf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ac=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$u=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ru=function(n){(0,we.Z)(o,n);var c=Of(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:p||1,u_coverage:y||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:$u,fragmentShader:ac,triangulation:ll,depth:{enable:!1},primitive:b.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y){var C=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[C[0],C[1],0]}}})}}]),o}(vi),ro={heatmap:ic,heatmap3d:ic,grid:Xu,grid3d:Dc,hexagon:Ru},hs=ro;function pl(n){var c=Va();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Va(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var wn=function(n){(0,we.Z)(o,n);var c=pl(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","HeatMapLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new hs[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,p=this.getModelType();return p==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(y){return y.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),y=this.getLayerConfig(),C=y.shape3d,P=this.getSource(),O=P.data.type,J=(p==null||(l=p.scale)===null||l===void 0?void 0:l.field)||"heatmap";return J==="heatmap"||J==="heatmap3d"?"heatmap":O==="hexagon"?(C==null?void 0:C.indexOf(J))===-1?"hexagon":"grid3d":O==="grid"?(C==null?void 0:C.indexOf(J))===-1?"grid":"grid3d":"heatmap"}}]),o}(Ps);function js(n){var c=mc();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Bl=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,lu=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Vs=function(n){(0,we.Z)(o,n);var c=js(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,p=this.layer.getSource(),y=this.rendererService.createTexture2D;return this.texture=y({height:0,width:0}),p.data.images.then(function(C){l.texture=y({data:C[0],width:C[0].width,height:C[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:lu,fragmentShader:Bl,triangulation:nf,primitive:b.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(p,y,C,P){return[C[3],C[4]]}}})}}]),o}(vi),dl={image:Vs},Kr=dl;function Bc(n){var c=gc();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ju=function(n){(0,we.Z)(o,n);var c=Bc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","ImageLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Kr[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={image:{}};return p[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(Ps);function Js(n){var c=Ms();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Nc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Gs={solid:0,dash:1},Qu=function(n){(0,we.Z)(o,n);var c=Js(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,X=J===void 0?"solid":J,le=l.dashArray,Re=le===void 0?[10,5]:le,ot=l.forward,It=ot===void 0?!0:ot,vr=l.lineTexture,br=vr===void 0?!1:vr,Zr=l.iconStep,cn=Zr===void 0?100:Zr;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var xn=this.layer.getEncodedData(),Ln=this.calDataFrame(this.cellLength,xn,this.cellProperties),ni=Ln.data,Nn=Ln.width,xi=Ln.height;this.rowCount=xi,this.dataTexture=this.cellLength>0&&ni.length>0?this.createTexture2D({flipY:!0,data:ni,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Nn,height:xi}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}Re.length===2&&Re.push(0,0);var Ji=0,ga=[0,0,0,0],hi=[0,0,0,0];return y&&C&&(ga=(0,$e.CI)(y),hi=(0,$e.CI)(C),Ji=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(p)?p:1,u_textureBlend:O==="normal"?0:1,segmentNumber:30,u_line_type:Gs[X||"solid"],u_dash_array:Re,u_blur:.9,u_lineDir:It?1:-1,u_texture:this.texture,u_line_texture:br?1:0,u_icon_step:cn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ji,u_sourceColor:ga,u_targetColor:hi}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:zc,fragmentShader:Nc,triangulation:Mc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,X=J===void 0?1:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,O){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),X=y.texture,le=J[X]||{x:0,y:0},Re=le.x,ot=le.y;return[Re,ot]}}})}}]),o}(vi);function Nl(n){var c=Du();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Du(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,yc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,cu={solid:0,dash:1},Is=function(n){(0,we.Z)(o,n);var c=Nl(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,X=J===void 0?"solid":J,le=l.dashArray,Re=le===void 0?[10,5]:le,ot=l.lineTexture,It=ot===void 0?!1:ot,vr=l.iconStep,br=vr===void 0?100:vr;Re.length===2&&Re.push(0,0);var Zr=0,cn=[0,0,0,0],xn=[0,0,0,0];if(y&&C&&(cn=(0,$e.CI)(y),xn=(0,$e.CI)(C),Zr=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Ln=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,Ln,this.cellProperties),Nn=ni.data,xi=ni.width,Ji=ni.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(p)?p:1,u_textureBlend:O==="normal"?0:1,segmentNumber:30,u_line_type:cu[X]||0,u_dash_array:Re,u_texture:this.texture,u_line_texture:It?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:cn,u_targetColor:xn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:yc,fragmentShader:Zc,triangulation:Mc,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,X=J===void 0?1:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,O){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),X=y.texture,le=J[X]||{x:0,y:0},Re=le.x,ot=le.y;return[Re,ot]}}})}}]),o}(vi);function Bi(n){var c=Qs();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $o=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Ao=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,vl={solid:0,dash:1},qu=function(n){(0,we.Z)(o,n);var c=Bi(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,X=J===void 0?"solid":J,le=l.dashArray,Re=le===void 0?[10,5]:le,ot=l.lineTexture,It=ot===void 0?!1:ot,vr=l.iconStep,br=vr===void 0?100:vr;Re.length===2&&Re.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,cn=[0,0,0,0],xn=[0,0,0,0];if(y&&C&&(cn=(0,$e.CI)(y),xn=(0,$e.CI)(C),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Ln=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,Ln,this.cellProperties),Nn=ni.data,xi=ni.width,Ji=ni.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(p)?p:1,u_textureBlend:O==="normal"?0:1,segmentNumber:30,u_line_type:vl[X]||0,u_dash_array:Re,u_texture:this.texture,u_line_texture:It?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:cn,u_targetColor:xn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Ao,fragmentShader:$o,triangulation:Mc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,X=J===void 0?1:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,O){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),X=y.texture,le=J[X]||{x:0,y:0},Re=le.x,ot=le.y;return[Re,ot]}}})}}]),o}(vi);function fu(n){var c=is();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Un=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,On={solid:0,dash:1},Zl=function(n){(0,we.Z)(o,n);var c=fu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,O=P===void 0?"normal":P,J=l.lineType,X=J===void 0?"solid":J,le=l.dashArray,Re=le===void 0?[10,5,0,0]:le,ot=l.lineTexture,It=ot===void 0?!1:ot,vr=l.iconStep,br=vr===void 0?100:vr;Re.length===2&&Re.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,cn=[0,0,0,0],xn=[0,0,0,0];if(y&&C&&(cn=(0,$e.CI)(y),xn=(0,$e.CI)(C),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Ln=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,Ln,this.cellProperties),Nn=ni.data,xi=ni.width,Ji=ni.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(p)?p:1,u_textureBlend:O==="normal"?0:1,u_line_type:On[X],u_dash_array:Re,u_texture:this.texture,u_line_texture:It?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:cn,u_targetColor:xn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Un,fragmentShader:zl,triangulation:ma,primitive:b.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,p=this.layer.getLayerConfig(),y=p.lineType,C=y===void 0?"solid":y;this.styleAttributeService.registerStyleAttribute({name:"distance",type:b.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(O,J,X,le){return[X[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:b.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(O,J,X,le){return[X[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(O,J,X,le){var Re=O.size,ot=Re===void 0?1:Re;return Array.isArray(ot)?[ot[0],ot[1]]:[ot,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(O,J,X,le,Re){return Re}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:b.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(O,J,X,le){return[X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(O,J,X,le){var Re=l.iconService.getIconMap(),ot=O.texture,It=Re[ot]||{x:0,y:0},vr=It.x,br=It.y;return[vr,br]}}})}},{key:"loadImage",value:function(l){return new Promise(function(p,y){if(l instanceof HTMLImageElement){p(l);return}var C=new Image;C.crossOrigin="anonymous",C.onload=function(){p(C)},C.onerror=function(){y(new Error("Could not load image at "+l))},C.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(vi),ps={arc:Qu,arc3d:Is,greatcircle:qu,line:Zl},Do=ps;function zo(n){var c=ku();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var hu=function(n){(0,we.Z)(o,n);var c=zo(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","LineLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Do[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return p[l]}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),y=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return y||"line"}}]),o}(Ps);function Ul(n){var c=ra();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ra(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var po=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Uc=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Fu=function(n){(0,we.Z)(o,n);var c=Ul(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),O=P.data,J=P.width,X=P.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:X}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Uc,fragmentShader:po,triangulation:hc,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y,C,P){var O=p.size;if(O){var J=[];return Array.isArray(O)&&(J=O.length===2?[O[0],O[0],O[1]]:O),Array.isArray(O)||(J=[O]),J}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y){var C=ul(p.coordinates);return[C[0],C[1],0]}}})}}]),o}(vi);function _c(n){var c=Bu();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Os=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,oc=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,as=function(n){(0,we.Z)(o,n);var c=_c(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p,C=l.strokeOpacity,P=C===void 0?1:C,O=l.strokeWidth,J=O===void 0?0:O,X=l.stroke,le=X===void 0?"rgba(0,0,0,0)":X,Re=l.offsets,ot=Re===void 0?[0,0]:Re;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,strokeOpacity:P,strokeWidth:J,stroke:le,offsets:ot})){this.judgeStyleAttributes({opacity:y,strokeOpacity:P,strokeWidth:J,stroke:le,offsets:ot});var It=this.layer.getEncodedData(),vr=this.calDataFrame(this.cellLength,It,this.cellProperties),br=vr.data,Zr=vr.width,cn=vr.height;this.rowCount=cn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Zr,height:cn}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1,u_stroke_opacity:va()(P)?P:1,u_stroke_width:va()(J)?J:0,u_stroke_color:this.getStrokeColor(le),u_offsets:this.isOffsetStatic(ot)?ot:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Eu)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:oc,fragmentShader:Os,triangulation:Eu,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:b.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=[1,1,-1,1,-1,-1,1,-1],X=O%4*2;return[J[X],J[X+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,X=J===void 0?5:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:b.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.shape,X=J===void 0?2:J,le=l.layer.getLayerConfig().shape2d,Re=le.indexOf(X);return[Re]}}})}}]),o}(vi);function xc(n){var c=jl();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var sc=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,jc=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,uc=function(n){(0,we.Z)(o,n);var c=xc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:jc,fragmentShader:sc,triangulation:Gu,primitive:b.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.fontService.mapping,X=y.shape,le=l.fontService.getGlyph(X),Re=J[le],ot=Re.x,It=Re.y;return[ot,It]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.texture=l({data:p,mag:b.gl.LINEAR,min:b.gl.LINEAR,width:p.width,height:p.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),y=p.fontWeight,C=y===void 0?"normal":y,P=p.fontFamily,O=P===void 0?"sans-serif":P,J=this.layer.getEncodedData(),X=[];J.forEach(function(le){var Re=le.shape,ot=Re===void 0?"":Re;ot=ot.toString();var It=l.fontService.getGlyph(ot);X.indexOf(It)===-1&&X.push(It)}),this.fontService.setFontOptions({characterSet:X,fontWeight:C,fontFamily:O,fontSize:48})}}]),o}(vi);function ml(n){var c=Vc();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Vc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,yl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,_l=function(n){(0,we.Z)(o,n);var c=ml(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=l.offsets,C=y===void 0?[0,0]:y;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:C})){this.judgeStyleAttributes({opacity:p,offsets:C});var P=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,P,this.cellProperties),J=O.data,X=O.width,le=O.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:X,height:le}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:va()(p)?p:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:yl,fragmentShader:gl,triangulation:Gu,primitive:b.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,O){var J=y.size,X=J===void 0?5:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,O){var J=l.iconService.getIconMap(),X=y.shape,le=J[X]||{x:0,y:0},Re=le.x,ot=le.y;return[Re,ot]}}})}}]),o}(vi);function pu(n){var c=qs();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Gc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,bc=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function sf(n){var c=n.coordinates;return{vertices:(0,ti.Z)(c),indices:[0],size:c.length}}var Sc=function(n){(0,we.Z)(o,n);var c=pu(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p,C=l.offsets,P=C===void 0?[0,0]:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,offsets:P})){this.judgeStyleAttributes({opacity:y,offsets:P});var O=this.layer.getEncodedData(),J=this.calDataFrame(this.cellLength,O,this.cellProperties),X=J.data,le=J.width,Re=J.height;this.rowCount=Re,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:le,height:Re}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1,u_offsets:this.isOffsetStatic(P)?P:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:bc,fragmentShader:Gc,triangulation:sf,depth:{enable:!1},primitive:b.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.size,J=O===void 0?1:O;return Array.isArray(J)?[J[0]]:[J]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:b.BlendType.additive}}}]),o}(vi),i=x(98333);function u(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=a(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var O=o.next();return p=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!p&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function a(n,c){if(!!n){if(typeof n=="string")return h(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(n,c)}}function h(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}var g=function(){function n(c,o,s){(0,W.Z)(this,n),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(o/s);for(var p=0;p<this.xCellCount*this.yCellCount;p++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=o,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,$.Z)(n,[{key:"insert",value:function(o,s,l,p,y){this.forEachCell(s,l,p,y,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y)}},{key:"query",value:function(o,s,l,p,y){return this.queryHitTest(o,s,l,p,!1,y)}},{key:"hitTest",value:function(o,s,l,p,y){return this.queryHitTest(o,s,l,p,!0,y)}},{key:"insertBoxCell",value:function(o,s,l,p,y,C){this.boxCells[y].push(C)}},{key:"queryHitTest",value:function(o,s,l,p,y,C){if(l<0||o>this.width||p<0||s>this.height)return y?!1:[];var P=[];if(o<=0&&s<=0&&this.width<=l&&this.height<=p){if(y)return!0;for(var O=0;O<this.boxKeys.length;O++)P.push({key:this.boxKeys[O],x1:this.bboxes[O*4],y1:this.bboxes[O*4+1],x2:this.bboxes[O*4+2],y2:this.bboxes[O*4+3]});return C?P.filter(C):P}var J={hitTest:y,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,l,p,this.queryCell,P,J,C),y?P.length>0:P}},{key:"queryCell",value:function(o,s,l,p,y,C,P,O){var J=P.seenUids,X=this.boxCells[y];if(X!==null){var le=this.bboxes,Re=u(X),ot;try{for(Re.s();!(ot=Re.n()).done;){var It=ot.value;if(!J.box[It]){J.box[It]=!0;var vr=It*4;if(o<=le[vr+2]&&s<=le[vr+3]&&l>=le[vr+0]&&p>=le[vr+1]&&(!O||O(this.boxKeys[It]))){if(P.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[It],x1:le[vr],y1:le[vr+1],x2:le[vr+2],y2:le[vr+3]})}}}}catch(br){Re.e(br)}finally{Re.f()}}return!1}},{key:"forEachCell",value:function(o,s,l,p,y,C,P,O){for(var J=this.convertToXCellCoord(o),X=this.convertToYCellCoord(s),le=this.convertToXCellCoord(l),Re=this.convertToYCellCoord(p),ot=J;ot<=le;ot++)for(var It=X;It<=Re;It++){var vr=this.xCellCount*It+ot;if(y.call(this,o,s,l,p,vr,C,P,O))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),n}(),S=g,T=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=o,this.viewportPadding=Math.max(c,o),this.grid=new S(c+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,$.Z)(n,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,p=o.x2+o.anchorPointX+this.viewportPadding,y=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,p,y)||this.grid.hitTest(s,l,p,y)?{box:[]}:{box:[s,l,p,y]}}},{key:"insertCollisionBox",value:function(o,s){var l={featureIndex:s};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,l){var p=i.al(s,l,0,1),y=i.Ue(),C=Fa.fromValues.apply(Fa,(0,ti.Z)(o));return i.fF(y,p,C),{x:(y[0]/y[3]+1)/2*this.width+this.viewportPadding,y:(-y[1]/y[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,l,p){return l>=0&&o<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}}]),n}();function R(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=V(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var O=o.next();return p=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!p&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function V(n,c){if(!!n){if(typeof n=="string")return ee(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ee(n,c)}}function ee(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function ve(n){var c=.5,o=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:c,verticalAlign:o}}function ye(n,c,o,s,l){if(!!l){var p=n[s],y=p.glyph;if(y)for(var C=c[y].advance*p.scale,P=(n[s].x+C)*l,O=o;O<=s;O++)n[O].x-=P}}function Ee(n,c,o,s,l,p,y){var C=(c-o)*l,P=(-s*y+.5)*p,O=R(n),J;try{for(O.s();!(J=O.n()).done;){var X=J.value;X.x+=C,X.y+=P}}catch(le){O.e(le)}finally{O.f()}}function Ye(n,c,o,s,l,p,y){var C=-8,P=0,O=C,J=0,X=n.positionedGlyphs,le=p==="right"?1:p==="left"?0:.5,Re=X.length;o.forEach(function(Zr){if(Zr.split("").forEach(function(xn){var Ln=c[xn],ni=0;Ln&&(X.push({glyph:xn,x:P,y:O+ni,vertical:!1,scale:1,metrics:Ln}),P+=Ln.advance+y)}),X.length!==Re){var cn=P-y;J=Math.max(cn,J),ye(X,c,Re,X.length-1,le)}P=0,O+=s});var ot=ve(l),It=ot.horizontalAlign,vr=ot.verticalAlign;Ee(X,le,It,vr,J,s,o.length);var br=O-C;n.top+=-vr*br,n.bottom=n.top+br,n.left+=-It*J,n.right=n.left+J}function Ge(n,c,o,s,l,p,y){var C=-8,P=0,O=C,J=0,X=n.positionedGlyphs,le=p==="right"?1:p==="left"?0:.5,Re=X.length;o.forEach(function(Zr){var cn=c[Zr],xn=0;if(cn&&(X.push({glyph:Zr,x:P,y:O+xn,vertical:!1,scale:1,metrics:cn}),P+=cn.advance+y),X.length!==Re){var Ln=P-y;J=Math.max(Ln,J),ye(X,c,Re,X.length-1,le)}P=0,O+=s});var ot=ve(l),It=ot.horizontalAlign,vr=ot.verticalAlign;Ee(X,le,It,vr,J,s,o.length);var br=O-C;n.top+=-vr*br,n.bottom=n.top+br,n.left+=-It*J,n.right=n.left+J}function nt(n,c,o,s,l,p){var y=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],C=arguments.length>7?arguments[7]:void 0,P=n.split(`
`),O=[],J={positionedGlyphs:O,top:y[1],bottom:y[1],left:y[0],right:y[0],lineCount:P.length,text:n};return C?Ge(J,c,P,o,s,l,p):Ye(J,c,P,o,s,l,p),O.length?J:!1}function Ne(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,p=[],y=R(l),C;try{for(y.s();!(C=y.n()).done;){var P=C.value,O=P.metrics,J=4,X=O.advance*P.scale/2,le=o?[P.x+X,P.y]:[0,0],Re=o?[0,0]:[P.x+X+c[0],P.y+c[1]],ot=(0-J)*P.scale-X+Re[0],It=(0-J)*P.scale+Re[1],vr=ot+O.width*P.scale,br=It+O.height*P.scale,Zr={x:ot,y:It},cn={x:vr,y:It},xn={x:ot,y:br},Ln={x:vr,y:br};p.push({tl:Zr,tr:cn,bl:xn,br:Ln,tex:O,glyphOffset:le})}}catch(ni){y.e(ni)}finally{y.f()}return p}function rt(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=dt(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var O=o.next();return p=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!p&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function dt(n,c){if(!!n){if(typeof n=="string")return zt(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return zt(n,c)}}function zt(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function ar(n){var c=rr();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function rr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var or=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Lr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function tn(n){var c=this,o=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var p=c.glyphInfoMap[o].centroid,y=p.length===2?[p[0],p[1],0]:p;return c.glyphInfoMap[o].glyphQuads.forEach(function(C,P){s.push.apply(s,(0,ti.Z)(y).concat([C.tex.x,C.tex.y+C.tex.height,C.tl.x,C.tl.y],(0,ti.Z)(y),[C.tex.x+C.tex.width,C.tex.y+C.tex.height,C.tr.x,C.tr.y],(0,ti.Z)(y),[C.tex.x+C.tex.width,C.tex.y,C.br.x,C.br.y],(0,ti.Z)(y),[C.tex.x,C.tex.y,C.bl.x,C.bl.y])),l.push(0+P*4,1+P*4,2+P*4,2+P*4,3+P*4,0+P*4)}),{vertices:s,indices:l,size:7}}var Xr=function(n){(0,we.Z)(o,n);var c=ar(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"glyphInfo",void 0),(0,I.Z)((0,k.Z)(s),"glyphInfoMap",{}),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"currentZoom",-1),(0,I.Z)((0,k.Z)(s),"extent",void 0),(0,I.Z)((0,k.Z)(s),"textureHeight",0),(0,I.Z)((0,k.Z)(s),"textCount",0),(0,I.Z)((0,k.Z)(s),"preTextStyle",{}),(0,I.Z)((0,k.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Lr,fragmentShader:or,triangulation:tn.bind((0,k.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p,C=l.stroke,P=C===void 0?"#fff":C,O=l.strokeWidth,J=O===void 0?0:O,X=l.textAnchor,le=X===void 0?"center":X,Re=l.textAllowOverlap,ot=Re===void 0?!1:Re,It=l.halo,vr=It===void 0?.5:It,br=l.gamma,Zr=br===void 0?2:br,cn=this.fontService,xn=cn.canvas,Ln=cn.mapping;if(Object.keys(Ln).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ln).length),this.preTextStyle={textAnchor:le,textAllowOverlap:ot},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,strokeWidth:J,stroke:P})){this.judgeStyleAttributes({opacity:y,strokeWidth:J,stroke:P});var ni=this.layer.getEncodedData(),Nn=this.calDataFrame(this.cellLength,ni,this.cellProperties),xi=Nn.data,Ji=Nn.width,ga=Nn.height;this.rowCount=ga,this.dataTexture=this.cellLength>0&&xi.length>0?this.createTexture2D({flipY:!0,data:xi,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Ji,height:ga}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1,u_stroke_width:va()(J)?J:0,u_stroke_color:this.getStrokeColor(P),u_sdf_map:this.texture,u_halo_blur:vr,u_gamma_scale:Zr,u_sdf_map_size:[xn.width,xn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),p=l.textAnchor,y=p===void 0?"center":p,C=l.textAllowOverlap,P=C===void 0?!0:C;return this.preTextStyle={textAnchor:y,textAllowOverlap:P},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),p=l.textAllowOverlap,y=p===void 0?!1:p,C=this.mapService.getZoom(),P=this.mapService.getBounds(),O=(0,$e.oO)(this.extent,P);return!y&&(Math.abs(this.currentZoom-C)>1||!O)||y!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:b.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.rotate,J=O===void 0?0:O;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:b.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(p,y,C,P){return[C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.size,J=O===void 0?12:O;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:b.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(p,y,C,P){return[C[3],C[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,$e.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,y=p===void 0?"400":p,C=l.fontFamily,P=C===void 0?"sans-serif":C,O=this.layer.getEncodedData(),J=[];O.forEach(function(X){var le=X.shape,Re=le===void 0?"":le;Re=Re.toString();var ot=rt(Re),It;try{for(ot.s();!(It=ot.n()).done;){var vr=It.value;J.indexOf(vr)===-1&&J.push(vr)}}catch(br){ot.e(br)}finally{ot.f()}}),this.fontService.setFontOptions({characterSet:J,fontWeight:y,fontFamily:P,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,y=p===void 0?"400":p,C=l.fontFamily,P=C===void 0?"sans-serif":C,O=this.layer.getEncodedData(),J=[];O.forEach(function(X){var le=X.shape,Re=le===void 0?"":le;Re=Re.toString(),J.indexOf(Re)===-1&&J.push(Re)}),this.fontService.setFontOptions({characterSet:J,fontWeight:y,fontFamily:P,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var p=this,y=this.fontService.mapping,C=this.layer.getLayerConfig(),P=C.spacing,O=P===void 0?2:P,J=C.textAnchor,X=J===void 0?"center":J,le=this.layer.getEncodedData();this.glyphInfo=le.map(function(Re){var ot=Re.shape,It=ot===void 0?"":ot,vr=Re.id,br=Re.size,Zr=br===void 0?1:br,cn=Re.textOffset,xn=cn===void 0?[0,0]:cn,Ln=nt(It.toString(),y,Zr,X,"center",O,xn,l),ni=Ne(Ln,xn,!1);return Re.shaping=Ln,Re.glyphQuads=ni,Re.centroid=ul(Re.coordinates),Re.originCentroid=Re.version==="GAODE2.x"?ul(Re.originCoordinates):Re.originCentroid=Re.centroid,p.glyphInfoMap[vr]={shaping:Ln,glyphQuads:ni,centroid:ul(Re.coordinates)},Re})}},{key:"filterGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),y=p.padding,C=y===void 0?[4,4]:y,P=p.textAllowOverlap,O=P===void 0?!1:P;if(!O){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var J=this.rendererService.getViewportSize(),X=J.width,le=J.height,Re=new T(X,le),ot=this.glyphInfo.filter(function(It){var vr=It.shaping,br=It.id,Zr=br===void 0?0:br,cn=It.version==="GAODE2.x"?It.originCentroid:It.centroid,xn=It.size,Ln=xn/24,ni=l.mapService.lngLatToContainer(cn),Nn=Re.placeCollisionBox({x1:vr.left*Ln-C[0],x2:vr.right*Ln+C[0],y1:vr.top*Ln-C[1],y2:vr.bottom*Ln+C[1],anchorPointX:ni.x,anchorPointY:ni.y}),xi=Nn.box;return xi&&xi.length?(Re.insertCollisionBox(xi,Zr),!0):!1});ot.forEach(function(It){l.glyphInfoMap[It.id]=It})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),p=l.iconfont,y=p===void 0?!1:p;y?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(y)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.textureHeight=p.height,this.texture&&this.texture.destroy(),this.texture=l({data:p,mag:b.gl.LINEAR,min:b.gl.LINEAR,width:p.width,height:p.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Lr,fragmentShader:or,triangulation:tn.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(vi),yn={fill:as,image:_l,normal:Sc,extrude:Fu,text:Xr,icon:uc},Fn=yn;function Vn(n){var c=jn();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function jn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Qi=function(n){(0,we.Z)(o,n);var c=Vn(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","PointLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Fn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return p[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),y=p.shape2d,C=p.shape3d,P=this.iconService.getIconMap(),O=l.find(function(X){return X.hasOwnProperty("shape")});if(O){var J=O.shape;return J==="dot"?"normal":(y==null?void 0:y.indexOf(J))!==-1?"fill":(C==null?void 0:C.indexOf(J))!==-1?"extrude":P.hasOwnProperty(J)?"image":this.fontService.getGlyph(J)!==""?"icon":"text"}else return"normal"}}]),o}(Ps);function _n(n){var c=ci();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ci(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ci=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fi=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,oi=function(n){(0,we.Z)(o,n);var c=_n(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),O=P.data,J=P.width,X=P.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:X}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:fi,fragmentShader:Ci,triangulation:Ef})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(p,y,C,P,O){return O}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(p,y,C,P){var O=p.size,J=O===void 0?10:O;return Array.isArray(J)?[J[0]]:[J]}}})}}]),o}(vi);function Ti(n){var c=ii();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ii(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ri=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Po=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Ja=function(n){(0,we.Z)(o,n);var c=Ti(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),O=P.data,J=P.width,X=P.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:X}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Po,fragmentShader:ri,triangulation:Pc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(vi),os={fill:Ja,line:Zl,extrude:oi,text:Xr,point_fill:as,point_image:_l,point_normal:Sc,point_extrude:Fu},Zo=os;function Ga(n){var c=no();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function no(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ds=function(n){(0,we.Z)(o,n);var c=Ga(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","PolygonLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Zo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),y=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return y==="fill"?"fill":y==="extrude"?"extrude":y==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),y=p.shape2d,C=p.shape3d,P=this.iconService.getIconMap(),O=l.find(function(X){return X.hasOwnProperty("shape")});if(O){var J=O.shape;return J==="dot"?"point_normal":(y==null?void 0:y.indexOf(J))!==-1?"point_fill":(C==null?void 0:C.indexOf(J))!==-1?"point_extrude":P.hasOwnProperty(J)?"point_image":"text"}else return"fill"}}]),o}(Ps);function vs(n){var c=el();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function el(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ms=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,eu=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ls=function(n){(0,we.Z)(o,n);var c=vs(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"colorTexture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,y=p===void 0?1:p,C=l.clampLow,P=C===void 0?!0:C,O=l.clampHigh,J=O===void 0?!0:O,X=l.noDataValue,le=X===void 0?-9999999:X,Re=l.domain,ot=Re===void 0?[0,1]:Re;return this.updateColorTexure(),{u_opacity:y||1,u_texture:this.texture,u_domain:ot,u_clampLow:P,u_clampHigh:typeof J!="undefined"?J:P,u_noDataValue:le,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),p=this.rendererService.createTexture2D,y=l.data.dataArray[0];this.texture=p({data:y.data,width:y.width,height:y.height,format:b.gl.LUMINANCE,type:b.gl.FLOAT});var C=this.layer.getLayerConfig(),P=C.rampColors,O=(0,$e.Cl)(P);return this.colorTexture=p({data:O.data,width:O.width,height:O.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:eu,fragmentShader:ms,triangulation:nf,primitive:b.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(p,y,C,P){return[C[3],C[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,p=this.layer.getLayerConfig(),y=p.rampColors,C=(0,$e.Cl)(y);this.colorTexture=l({data:C.data,width:C.width,height:C.height,flipY:!1})}}]),o}(vi),xl={raster:Ls,raster3d:Ls},bl=xl;function Nu(n){var c=tu();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Vl=function(n){(0,we.Z)(o,n);var c=Nu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,p=new Array(l),y=0;y<l;y++)p[y]=arguments[y];return s=c.call.apply(c,[this].concat(p)),(0,I.Z)((0,k.Z)(s),"type","RasterLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new bl[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={raster:{},raster3d:{}};return p[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(Ps),Tu=x(50361),zu=x.n(Tu),Hs,io,Au,du,gs,qi,ao,ko,Rs,tl,vu;function rl(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function nl(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?rl(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):rl(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var Ec=(Hs=(0,H.b2)(),io=(0,H.f3)(b.vK.IGlobalConfigService),Au=(0,H.f3)(b.vK.ILogService),du=(0,H.f3)(b.vK.IMapService),gs=(0,H.f3)(b.vK.IFontService),Hs(qi=(ao=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"configService",ko,this),(0,Wn.Z)(this,"logger",Rs,this),(0,Wn.Z)(this,"mapService",tl,this),(0,Wn.Z)(this,"fontService",vu,this)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,p=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:p})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:p}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var y=p.getLayerStyleAttributes()||[],C=p.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,O=y.filter(function(X){return X.needRemapping}),J=P;C!=null&&C.needRemapping&&C!==null&&C!==void 0&&C.scale&&(J=P.filter(function(X){return l.applyAttributeMapping(C,X)[0]})),O.length&&(C!=null&&C.needRemapping?(o.setEncodedData(l.mapping(y,J)),C.needRemapping=!1):o.setEncodedData(l.mapping(O,J,o.getEncodedData())),l.logger.debug("remapping finished"),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var l=this,p=s.styleAttributeService,y=p.getLayerStyleAttributes()||[],C=p.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,O=P;C!=null&&C.scale&&(O=P.filter(function(J){return l.applyAttributeMapping(C,J)[0]})),o.setEncodedData(this.mapping(y,O))}},{key:"mapping",value:function(o,s,l){var p=this,y=s.map(function(C,P){var O=l?l[P]:{},J=nl({id:C._id,coordinates:C.coordinates},O);return o.filter(function(X){return X.scale!==void 0}).forEach(function(X){var le=p.applyAttributeMapping(X,C);X.needRemapping=!1,X.name==="color"&&(le=le.map(function(Re){return(0,$e.CI)(Re)})),J[X.name]=Array.isArray(le)&&le.length===1?le[0]:le,X.name==="shape"&&(J.shape=p.fontService.getIconFontKey(J[X.name]))}),J});return y.length>0&&this.mapService.version==="GAODE2.x"&&(typeof y[0].coordinates[0]=="number"?y.map(function(C){C.version="GAODE2.x",C.originCoordinates=zu()(C.coordinates),C.coordinates=p.mapService.lngLatToCoord(C.coordinates)}):y.map(function(C){C.version="GAODE2.x",C.originCoordinates=zu()(C.coordinates),C.coordinates=p.mapService.lngLatToCoords(C.coordinates)})),y}},{key:"applyAttributeMapping",value:function(o,s){var l;if(!o.scale)return[];var p=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],y=[];return p.forEach(function(C){var P,O=C.field;(s.hasOwnProperty(O)||((P=o.scale)===null||P===void 0?void 0:P.type)==="variable")&&y.push(s[O])}),o.mapping?o.mapping(y):[]}}]),n}(),ko=(0,ai.Z)(ao.prototype,"configService",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs=(0,ai.Z)(ao.prototype,"logger",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tl=(0,ai.Z)(ao.prototype,"mapService",[du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=(0,ai.Z)(ao.prototype,"fontService",[gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao))||qi),Pu={},Gl={},wc=function(c){return Gl[c]},Ws=function(c,o){Gl[c]=o},Uo=function(c){return Pu[c]},Hc=function(c,o){Pu[c]=o},Rf={},Sl={},uf=34,Wc=10,Wf=13;function Hl(n){return new Function("d","return {"+n.map(function(c,o){return JSON.stringify(c)+": d["+o+'] || ""'}).join(",")+"}")}function ih(n,c){var o=Hl(n);return function(s,l){return c(o(s),l,n)}}function lf(n){var c=Object.create(null),o=[];return n.forEach(function(s){for(var l in s)l in c||o.push(c[l]=l)}),o}function ru(n,c){var o=n+"",s=o.length;return s<c?new Array(c-s+1).join(0)+o:o}function j(n){return n<0?"-"+ru(-n,6):n>9999?"+"+ru(n,6):ru(n,4)}function z(n){var c=n.getUTCHours(),o=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":j(n.getUTCFullYear(),4)+"-"+ru(n.getUTCMonth()+1,2)+"-"+ru(n.getUTCDate(),2)+(l?"T"+ru(c,2)+":"+ru(o,2)+":"+ru(s,2)+"."+ru(l,3)+"Z":s?"T"+ru(c,2)+":"+ru(o,2)+":"+ru(s,2)+"Z":o||c?"T"+ru(c,2)+":"+ru(o,2)+"Z":"")}function M(n){var c=new RegExp('["'+n+`
\r]`),o=n.charCodeAt(0);function s(X,le){var Re,ot,It=l(X,function(vr,br){if(Re)return Re(vr,br-1);ot=vr,Re=le?ih(vr,le):Hl(vr)});return It.columns=ot||[],It}function l(X,le){var Re=[],ot=X.length,It=0,vr=0,br,Zr=ot<=0,cn=!1;X.charCodeAt(ot-1)===Wc&&--ot,X.charCodeAt(ot-1)===Wf&&--ot;function xn(){if(Zr)return Sl;if(cn)return cn=!1,Rf;var ni,Nn=It,xi;if(X.charCodeAt(Nn)===uf){for(;It++<ot&&X.charCodeAt(It)!==uf||X.charCodeAt(++It)===uf;);return(ni=It)>=ot?Zr=!0:(xi=X.charCodeAt(It++))===Wc?cn=!0:xi===Wf&&(cn=!0,X.charCodeAt(It)===Wc&&++It),X.slice(Nn+1,ni-1).replace(/""/g,'"')}for(;It<ot;){if((xi=X.charCodeAt(ni=It++))===Wc)cn=!0;else if(xi===Wf)cn=!0,X.charCodeAt(It)===Wc&&++It;else if(xi!==o)continue;return X.slice(Nn,ni)}return Zr=!0,X.slice(Nn,ot)}for(;(br=xn())!==Sl;){for(var Ln=[];br!==Rf&&br!==Sl;)Ln.push(br),br=xn();le&&(Ln=le(Ln,vr++))==null||Re.push(Ln)}return Re}function p(X,le){return X.map(function(Re){return le.map(function(ot){return J(Re[ot])}).join(n)})}function y(X,le){return le==null&&(le=lf(X)),[le.map(J).join(n)].concat(p(X,le)).join(`
`)}function C(X,le){return le==null&&(le=lf(X)),p(X,le).join(`
`)}function P(X){return X.map(O).join(`
`)}function O(X){return X.map(J).join(n)}function J(X){return X==null?"":X instanceof Date?z(X):c.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:s,parseRows:l,format:y,formatBody:C,formatRows:P,formatRow:O,formatValue:J}}var D=M(","),ne=D.parse,_e=D.parseRows,vt=D.format,Vt=D.formatBody,Bt=D.formatRows,Sr=D.formatRow,qr=D.formatValue,Rn=x(38163),Gn=x.n(Rn);function Mn(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function di(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Mn(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Mn(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function yi(n,c){var o=c.x,s=c.y,l=c.x1,p=c.y1,y=c.coordinates,C=[];return n.forEach(function(P,O){var J=[];if(o&&s&&(J=[parseFloat(P[o]),parseFloat(P[s])]),o&&s&&l&&p){var X=[parseFloat(P[o]),parseFloat(P[s])],le=[parseFloat(P[l]),parseFloat(P[p])];J=[X,le]}if(y){var Re="Polygon";Array.isArray(y[0])||(Re="Point"),Array.isArray(y[0])&&!Array.isArray(y[0][0])&&(Re="LineString");var ot={type:Re,coordinates:(0,ti.Z)(P[y])};Gn()(ot,!0),J=ot.coordinates}var It=di(di({},P),{},{_id:O,coordinates:J});C.push(It)}),{dataArray:C}}function aa(n,c){var o=ne(n);return yi(o,c)}var Mi=x(40271);function Ha(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mo(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function bo(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return bo(n[0]);throw new Error("coordinates must only contain numbers")}function So(n,c,o){if(!c||!o)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+n.type)}function Qa(n,c,o){if(!n)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+n.geometry.type)}function ca(n,c,o){if(!n)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var p=l[s];if(!p||p.type!=="Feature"||!p.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!p.geometry||p.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+p.geometry.type)}}function Wa(n){return n.type==="Feature"?n.geometry:n}function Eo(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function oo(n,c,o){if(n!==null)for(var s,l,p,y,C,P,O,J=0,X=0,le,Re=n.type,ot=Re==="FeatureCollection",It=Re==="Feature",vr=ot?n.features.length:1,br=0;br<vr;br++){O=ot?n.features[br].geometry:It?n.geometry:n,le=O?O.type==="GeometryCollection":!1,C=le?O.geometries.length:1;for(var Zr=0;Zr<C;Zr++){var cn=0,xn=0;if(y=le?O.geometries[Zr]:O,y!==null){P=y.coordinates;var Ln=y.type;switch(J=o&&(Ln==="Polygon"||Ln==="MultiPolygon")?1:0,Ln){case null:break;case"Point":if(c(P,X,br,cn,xn)===!1)return!1;X++,cn++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(c(P[s],X,br,cn,xn)===!1)return!1;X++,Ln==="MultiPoint"&&cn++}Ln==="LineString"&&cn++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(l=0;l<P[s].length-J;l++){if(c(P[s][l],X,br,cn,xn)===!1)return!1;X++}Ln==="MultiLineString"&&cn++,Ln==="Polygon"&&xn++}Ln==="Polygon"&&cn++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(xn=0,l=0;l<P[s].length;l++){for(p=0;p<P[s][l].length-J;p++){if(c(P[s][l][p],X,br,cn,xn)===!1)return!1;X++}xn++}cn++}break;case"GeometryCollection":for(s=0;s<y.geometries.length;s++)if(oo(y.geometries[s],c,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function wo(n,c,o,s){var l=o;return oo(n,function(p,y,C,P,O){y===0&&o===void 0?l=p:l=c(l,p,y,C,P,O)},s),l}function Ds(n,c){var o;switch(n.type){case"FeatureCollection":for(o=0;o<n.features.length&&c(n.features[o].properties,o)!==!1;o++);break;case"Feature":c(n.properties,0);break}}function mu(n,c,o){var s=o;return Ds(n,function(l,p){p===0&&o===void 0?s=l:s=c(s,l,p)}),s}function Zu(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var o=0;o<n.features.length&&c(n.features[o],o)!==!1;o++);}function Ss(n,c,o){var s=o;return Zu(n,function(l,p){p===0&&o===void 0?s=l:s=c(s,l,p)}),s}function Xc(n){var c=[];return oo(n,function(o){c.push(o)}),c}function cf(n,c){var o,s,l,p,y,C,P,O,J,X,le=0,Re=n.type==="FeatureCollection",ot=n.type==="Feature",It=Re?n.features.length:1;for(o=0;o<It;o++){for(C=Re?n.features[o].geometry:ot?n.geometry:n,O=Re?n.features[o].properties:ot?n.properties:{},J=Re?n.features[o].bbox:ot?n.bbox:void 0,X=Re?n.features[o].id:ot?n.id:void 0,P=C?C.type==="GeometryCollection":!1,y=P?C.geometries.length:1,l=0;l<y;l++){if(p=P?C.geometries[l]:C,p===null){if(c(null,le,O,J,X)===!1)return!1;continue}switch(p.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(p,le,O,J,X)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<p.geometries.length;s++)if(c(p.geometries[s],le,O,J,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}le++}}function jp(n,c,o){var s=o;return cf(n,function(l,p,y,C,P){p===0&&o===void 0?s=l:s=c(s,l,p,y,C,P)}),s}function Xf(n,c){cf(n,function(o,s,l,p,y){var C=o===null?null:o.type;switch(C){case null:case"Point":case"LineString":case"Polygon":return c((0,Mi.zL)(o,l,{bbox:p,id:y}),s,0)===!1?!1:void 0}var P;switch(C){case"MultiPoint":P="Point";break;case"MultiLineString":P="LineString";break;case"MultiPolygon":P="Polygon";break}for(var O=0;O<o.coordinates.length;O++){var J=o.coordinates[O],X={type:P,coordinates:J};if(c((0,Mi.zL)(X,l),s,O)===!1)return!1}})}function Yc(n,c,o){var s=o;return Xf(n,function(l,p,y){p===0&&y===0&&o===void 0?s=l:s=c(s,l,p,y)}),s}function ff(n,c){Xf(n,function(o,s,l){var p=0;if(!!o.geometry){var y=o.geometry.type;if(!(y==="Point"||y==="MultiPoint")){var C,P=0,O=0,J=0;if(oo(o,function(X,le,Re,ot,It){if(C===void 0||s>P||ot>O||It>J){C=X,P=s,O=ot,J=It,p=0;return}var vr=lineString([C,X],o.properties);if(c(vr,s,l,It,p)===!1)return!1;p++,C=X})===!1)return!1}}})}function fp(n,c,o){var s=o,l=!1;return ff(n,function(p,y,C,P,O){l===!1&&o===void 0?s=p:s=c(s,p,y,C,P,O),l=!0}),s}function Mh(n,c){if(!n)throw new Error("geojson is required");Xf(n,function(o,s,l){if(o.geometry!==null){var p=o.geometry.type,y=o.geometry.coordinates;switch(p){case"LineString":if(c(o,s,l,0,0)===!1)return!1;break;case"Polygon":for(var C=0;C<y.length;C++)if(c(lineString(y[C],o.properties),s,l,C)===!1)return!1;break}}})}function hp(n,c,o){var s=o;return Mh(n,function(l,p,y,C){p===0&&o===void 0?s=l:s=c(s,l,p,y,C)}),s}function Ih(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.segmentIndex||0,y=c.properties,C;switch(n.type){case"FeatureCollection":o<0&&(o=n.features.length+o),y=y||n.features[o].properties,C=n.features[o].geometry;break;case"Feature":y=y||n.properties,C=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=n;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var P=C.coordinates;switch(C.type){case"Point":case"MultiPoint":return null;case"LineString":return p<0&&(p=P.length+p-1),lineString([P[p],P[p+1]],y,c);case"Polygon":return l<0&&(l=P.length+l),p<0&&(p=P[l].length+p-1),lineString([P[l][p],P[l][p+1]],y,c);case"MultiLineString":return s<0&&(s=P.length+s),p<0&&(p=P[s].length+p-1),lineString([P[s][p],P[s][p+1]],y,c);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),p<0&&(p=P[s][l].length-p-1),lineString([P[s][l][p],P[s][l][p+1]],y,c)}throw new Error("geojson is invalid")}function Vp(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.coordIndex||0,y=c.properties,C;switch(n.type){case"FeatureCollection":o<0&&(o=n.features.length+o),y=y||n.features[o].properties,C=n.features[o].geometry;break;case"Feature":y=y||n.properties,C=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=n;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var P=C.coordinates;switch(C.type){case"Point":return point(P,y,c);case"MultiPoint":return s<0&&(s=P.length+s),point(P[s],y,c);case"LineString":return p<0&&(p=P.length+p),point(P[p],y,c);case"Polygon":return l<0&&(l=P.length+l),p<0&&(p=P[l].length+p),point(P[l][p],y,c);case"MultiLineString":return s<0&&(s=P.length+s),p<0&&(p=P[s].length+p),point(P[s][p],y,c);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),p<0&&(p=P[s][l].length-p),point(P[s][l][p],y,c)}throw new Error("geojson is invalid")}function Wl(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Kc(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Wl(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Wl(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function wf(n,c){var o=[],s={};if(n.features=n.features.filter(function(p){var y=p.geometry;return p!=null&&y&&y.type&&y.coordinates&&y.coordinates.length>0}),Gn()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Xf(n,function(p,y){var C=Mo(p),P=y,O=Kc(Kc({},p.properties),{},{coordinates:C,_id:P});o.push(O)}),{dataArray:o,featureKeys:s}}function Xl(n,c){var o=c.extent,s=new Promise(function(p){Cf(n,function(y){p(y)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function Cf(n,c){var o=n,s=[];if(typeof o=="string")(0,$e.gJ)({url:o},function(y,C){s.push(C),c(s)});else{var l=o.length,p=0;o.forEach(function(y){(0,$e.gJ)({url:y},function(C,P){p++,s.push(P),p===l&&c(s)})})}return Xl}function il(n,c){var o=c.extent,s=c.width,l=c.height,p=c.min,y=c.max,C={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:p,max:y,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return C}var Yf=x(30236),Oh=x.n(Yf);function gu(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function al(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?gu(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):gu(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function jo(n,c){var o=c.radius,s=o===void 0?40:o,l=c.maxZoom,p=l===void 0?18:l,y=c.minZoom,C=y===void 0?0:y,P=c.zoom,O=P===void 0?2:P;if(n.pointIndex){var J=n.pointIndex.getClusters(n.extent,Math.floor(O));return n.dataArray=Uu(J),n}var X=new(tr())({radius:s,minZoom:C,maxZoom:p}),le={type:"FeatureCollection",features:[]};return le.features=n.dataArray.map(function(Re){return{type:"Feature",geometry:{type:"Point",coordinates:Re.coordinates},properties:al({},Re)}}),X.load(le.features),X}function Uu(n){return n.map(function(c,o){return al({coordinates:c.geometry.coordinates,_id:o+1},c.properties)})}function Lh(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],o=1;o<n.length;o++)n[o]>c&&(c=n[o]);return c}function pp(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],o=1;o<n.length;o++)n[o]<c&&(c=n[o]);return c}function Rh(n){if(n.length===0)return 0;for(var c=n[0],o=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?o+=c-s+n[l]:o+=n[l]-s+c,c=s;return c+o*1}function Dh(n){if(n.length===0)throw new Error("mean requires at least one data point");return Rh(n)/n.length}var nu={min:pp,max:Lh,mean:Dh,sum:Rh};function kh(n,c){return n.map(function(o){return o[c]*1})}function ah(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function oh(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ah(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):ah(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function dp(n){var c=Fh();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Fh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function vp(n,c){if(Array.isArray(c))return c}var Bh=function(n){(0,we.Z)(o,n);var c=dp(o);function o(s,l){var p;return(0,W.Z)(this,o),p=c.call(this),(0,I.Z)((0,k.Z)(p),"data",void 0),(0,I.Z)((0,k.Z)(p),"extent",void 0),(0,I.Z)((0,k.Z)(p),"hooks",{init:new Xa.ni}),(0,I.Z)((0,k.Z)(p),"parser",{type:"geojson"}),(0,I.Z)((0,k.Z)(p),"transforms",[]),(0,I.Z)((0,k.Z)(p),"cluster",!1),(0,I.Z)((0,k.Z)(p),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,k.Z)(p),"mapService",void 0),(0,I.Z)((0,k.Z)(p),"invalidExtent",!1),(0,I.Z)((0,k.Z)(p),"originData",void 0),(0,I.Z)((0,k.Z)(p),"rawData",void 0),(0,I.Z)((0,k.Z)(p),"cfg",{}),(0,I.Z)((0,k.Z)(p),"clusterIndex",void 0),p.originData=s,p.initCfg(l),p.hooks.init.tap("parser",function(){p.excuteParser()}),p.hooks.init.tap("cluster",function(){p.initCluster()}),p.hooks.init.tap("transform",function(){p.executeTrans()}),p.init(),p}return(0,$.Z)(o,[{key:"setData",value:function(l,p){this.rawData=l,this.originData=l,this.initCfg(p),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var p=this,y=this.clusterOptions,C=y.method,P=C===void 0?"sum":C,O=y.field,J=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,J.forEach(function(X){X.id||(X.properties.point_count=1)}),(O||ya()(P))&&(J=J.map(function(X){var le=X.id;if(le){var Re=p.clusterIndex.getLeaves(le,Infinity),ot=Re.map(function(br){return br.properties}),It;if(Za()(P)&&O){var vr=kh(ot,O);It=nu[P](vr)}ya()(P)&&(It=P(ot)),X.properties.stat=It}else X.properties.point_count=1;return X})),this.data=wc("geojson")({type:"FeatureCollection",features:J}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var p=this.parser.type,y=p===void 0?"geojson":p;if(y==="geojson"&&!this.cluster){var C=l<this.originData.features.length?this.originData.features[l]:"null",P=zu()(C);if(this.transforms.length!==0){var O=this.data.dataArray.find(function(J){return J._id===l});P.properties=O}return P}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,p){var y=this.data.dataArray.find(function(C){return C[l]===name});return y==null?void 0:y._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var p=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(p=(0,$e.yA)((0,$e.ds)(this.extent),l)),p[0].concat(p[1])}},{key:"initCfg",value:function(l){this.cfg=Oh()(this.cfg,l,vp);var p=this.cfg;p&&(p.parser&&(this.parser=p.parser),p.transforms&&(this.transforms=p.transforms),this.cluster=p.cluster||!1,p.clusterOptions&&(this.cluster=!0,this.clusterOptions=oh(oh({},this.clusterOptions),p.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,p=l.type||"geojson",y=wc(p);this.data=y(this.originData,l),this.extent=(0,$e.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,p=this.transforms;p.forEach(function(y){var C=y.type,P=Uo(C)(l.data,y);Object.assign(l.data,P)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=jo(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Ut.EventEmitter);function Nh(n,c){var o=c.callback;return o&&(n.dataArray=n.dataArray.filter(o)),n}function Kf(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=mp(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(O){throw O},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var O=o.next();return p=O.done,O},e:function(O){y=!0,C=O},f:function(){try{!p&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function mp(n,c){if(!!n){if(typeof n=="string")return zh(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return zh(n,c)}}function zh(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}var $c=6378e3;function Zh(n,c){var o=n.dataArray,s=c.size,l=s===void 0?10:s,p=l/(2*Math.PI*$c)*(256<<20)/2,y=U(o,l),C=y.gridHash,P=y.gridOffset,O=wr(C,P,c);return{yOffset:p,xOffset:p,radius:p,type:"grid",dataArray:O}}function U(n,c){var o=Infinity,s=-Infinity,l,p=Kf(n),y;try{for(p.s();!(y=p.n()).done;){var C=y.value;l=C.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,s=l>s?l:s)}}catch(cn){p.e(cn)}finally{p.f()}var P=(o+s)/2,O=Te(c,P);if(O.xOffset<=0||O.yOffset<=0)return{gridHash:{},gridOffset:O};var J={},X=Kf(n),le;try{for(X.s();!(le=X.n()).done;){var Re=le.value,ot=Re.coordinates[1],It=Re.coordinates[0];if(Number.isFinite(ot)&&Number.isFinite(It)){var vr=Math.floor((ot+90)/O.yOffset),br=Math.floor((It+180)/O.xOffset),Zr="".concat(vr,"-").concat(br);J[Zr]=J[Zr]||{count:0,points:[]},J[Zr].count+=1,J[Zr].points.push(Re)}}}catch(cn){X.e(cn)}finally{X.f()}return{gridHash:J,gridOffset:O}}function Te(n,c){var o=ze(n),s=qt(c,n);return{yOffset:o,xOffset:s}}function ze(n){return n/$c*(180/Math.PI)}function qt(n,c){return c/$c*(180/Math.PI)/Math.cos(n*Math.PI/180)}function wr(n,c,o){return Object.keys(n).reduce(function(s,l,p){var y=l.split("-"),C=parseInt(y[0],10),P=parseInt(y[1],10),O={};if(o.field&&o.method){var J=$e.a5.getColumn(n[l].points,o.field);O[o.method]=$e.a5.statMap[o.method](J)}return Object.assign(O,{_id:p,coordinates:(0,$e.Z)([-180+c.xOffset*(P+.5),-90+c.yOffset*(C+.5)]),rawData:n[l].points,count:n[l].count}),s.push(O),s},[])}var Ht=Math.PI/3,dr=[0,Ht,2*Ht,3*Ht,4*Ht,5*Ht];function Ur(n){return n[0]}function Hr(n){return n[1]}function Jr(){var n=0,c=0,o=1,s=1,l=Ur,p=Hr,y,C,P;function O(X){var le={},Re=[],ot,It=X.length;for(ot=0;ot<It;++ot)if(!(isNaN(br=+l.call(null,vr=X[ot],ot,X))||isNaN(Zr=+p.call(null,vr,ot,X)))){var vr,br,Zr,cn=Math.round(Zr=Zr/P),xn=Math.round(br=br/C-(cn&1)/2),Ln=Zr-cn;if(Math.abs(Ln)*3>1){var ni=br-xn,Nn=xn+(br<xn?-1:1)/2,xi=cn+(Zr<cn?-1:1),Ji=br-Nn,ga=Zr-xi;ni*ni+Ln*Ln>Ji*Ji+ga*ga&&(xn=Nn+(cn&1?1:-1)/2,cn=xi)}var hi=xn+"-"+cn,wa=le[hi];wa?wa.push(vr):(Re.push(wa=le[hi]=[vr]),wa.x=(xn+(cn&1)/2)*C,wa.y=cn*P)}return Re}function J(X){var le=0,Re=0;return dr.map(function(ot){var It=Math.sin(ot)*X,vr=-Math.cos(ot)*X,br=It-le,Zr=vr-Re;return le=It,Re=vr,[br,Zr]})}return O.hexagon=function(X){return"m"+J(X==null?y:+X).join("l")+"z"},O.centers=function(){for(var X=[],le=Math.round(c/P),Re=Math.round(n/C),ot=le*P;ot<s+y;ot+=P,++le)for(var It=Re*C+(le&1)*C/2;It<o+C/2;It+=C)X.push([It,ot]);return X},O.mesh=function(){var X=J(y).slice(0,4).join("l");return O.centers().map(function(le){return"M"+le+"m"+X}).join("")},O.x=function(X){return arguments.length?(l=X,O):l},O.y=function(X){return arguments.length?(p=X,O):p},O.radius=function(X){return arguments.length?(y=+X,C=y*2*Math.sin(Ht),P=y*1.5,O):y},O.size=function(X){return arguments.length?(n=c=0,o=+X[0],s=+X[1],O):[o-n,s-c]},O.extent=function(X){return arguments.length?(n=+X[0][0],c=+X[0][1],o=+X[1][0],s=+X[1][1],O):[[n,c],[o,s]]},O.radius(1)}function Gr(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function rn(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Gr(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Gr(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var fn=6378e3;function jr(n,c){var o=n.dataArray,s=c.size,l=s===void 0?10:s,p=c.method,y=p===void 0?"sum":p,C=l/(2*Math.PI*fn)*(256<<20)/2,P=o.map(function(le){var Re=(0,$e.Z)(le.coordinates),ot=(0,Y.Z)(Re,2),It=ot[0],vr=ot[1];return rn(rn({},le),{},{coordinates:[It,vr]})}),O=Jr().radius(C).x(function(le){return le.coordinates[0]}).y(function(le){return le.coordinates[1]}),J=O(P),X={dataArray:J.map(function(le,Re){var ot;if(c.field&&y){var It=$e.a5.getColumn(le,c.field);le[y]=$e.a5.statMap[y](It)}return ot={},(0,I.Z)(ot,c.method,le[y]),(0,I.Z)(ot,"count",le.length),(0,I.Z)(ot,"rawData",le),(0,I.Z)(ot,"coordinates",[le.x,le.y]),(0,I.Z)(ot,"_id",Re),ot}),radius:C,xOffset:C,yOffset:C,type:"hexagon"};return X}function an(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Nt(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?an(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):an(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function lr(n,c){var o=c.sourceField,s=c.targetField,l=c.data,p={};return l.forEach(function(y){p[y[o]]=y}),n.dataArray=n.dataArray.map(function(y){var C=y[s];return Nt(Nt({},y),p[C])}),n}function Vr(n,c){var o=c.callback;return o&&(n.dataArray=n.dataArray.map(o)),n}var mn=x(4771),Fr=Bh;Ws("geojson",wf),Ws("image",Xl),Ws("csv",aa),Ws("json",yi),Ws("raster",il),Hc("cluster",jo),Hc("filter",Nh),Hc("join",lr),Hc("map",Vr),Hc("grid",Zh),Hc("hexagon",jr);var Sn,zr,sn=(Sn=(0,H.b2)(),Sn(zr=function(){function n(){(0,W.Z)(this,n),(0,I.Z)(this,"mapService",void 0)}return(0,$.Z)(n,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(b.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var p=o.sourceOption,y=p.data,C=p.options;o.setSource(new Fr(y,C))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(o),p=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||p})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),l=s.cluster,p=s.clusterOptions,y=p.zoom,C=y===void 0?0:y,P=p.maxZoom,O=P===void 0?16:P,J=this.mapService.getZoom()-1,X=o.dataState.dataSourceNeedUpdate;return l&&(X||Math.abs(C-J)>1)&&O>C?(s.updateClusterData(Math.floor(J)),!0):!1}}]),n}())||zr),Rr=x(44908),nn=x.n(Rr),Xn=x(14293),Kn=x.n(Xn);function on(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Nr(n){return n.length===1&&(n=Mr(n)),{left:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],o)<0?s=p+1:l=p}return s},right:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],o)>0?l=p:s=p+1}return s}}}function Mr(n){return function(c,o){return on(n(c),o)}}var si=Nr(on),ui=si.right,kn=si.left,ea=null;function Pi(n,c){var o=n.length,s=-1,l,p,y;if(c==null){for(;++s<o;)if((l=n[s])!=null&&l>=l)for(p=y=l;++s<o;)(l=n[s])!=null&&(p>l&&(p=l),y<l&&(y=l))}else for(;++s<o;)if((l=c(n[s],s,n))!=null&&l>=l)for(p=y=l;++s<o;)(l=c(n[s],s,n))!=null&&(p>l&&(p=l),y<l&&(y=l));return[p,y]}var ji=Array.prototype,fa=ji.slice,Jo=ji.map,ss=Math.sqrt(50),$i=Math.sqrt(10),vo=Math.sqrt(2);function so(n,c,o){var s,l=-1,p,y,C;if(c=+c,n=+n,o=+o,n===c&&o>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(C=Qo(n,c,o))===0||!isFinite(C))return[];if(C>0)for(n=Math.ceil(n/C),c=Math.floor(c/C),y=new Array(p=Math.ceil(c-n+1));++l<p;)y[l]=(n+l)*C;else for(n=Math.floor(n*C),c=Math.ceil(c*C),y=new Array(p=Math.ceil(n-c+1));++l<p;)y[l]=(n-l)/C;return s&&y.reverse(),y}function Qo(n,c,o){var s=(c-n)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=ss?10:p>=$i?5:p>=vo?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=ss?10:p>=$i?5:p>=vo?2:1)}function ys(n,c,o){var s=Math.abs(c-n)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=ss?l*=10:p>=$i?l*=5:p>=vo&&(l*=2),c<n?-l:l}function Es(){var n=identity,c=extent,o=sturges;function s(l){var p,y=l.length,C,P=new Array(y);for(p=0;p<y;++p)P[p]=n(l[p],p,l);var O=c(P),J=O[0],X=O[1],le=o(P,J,X);Array.isArray(le)||(le=tickStep(J,X,le),le=range(Math.ceil(J/le)*le,X,le));for(var Re=le.length;le[0]<=J;)le.shift(),--Re;for(;le[Re-1]>X;)le.pop(),--Re;var ot=new Array(Re+1),It;for(p=0;p<=Re;++p)It=ot[p]=[],It.x0=p>0?le[p-1]:J,It.x1=p<Re?le[p]:X;for(p=0;p<y;++p)C=P[p],J<=C&&C<=X&&ot[bisect(le,C,0,Re)].push(l[p]);return ot}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function ks(n,c,o){return n=map.call(n,number).sort(ascending),Math.ceil((o-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function _s(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Fo(n){return n.length===1&&(n=Ni(n)),{left:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],o)<0?s=p+1:l=p}return s},right:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],o)>0?l=p:s=p+1}return s}}}function Ni(n){return function(c,o){return _s(n(c),o)}}var Fs=Fo(_s),Sa=Fs.right,li=Fs.left,Wi=Sa,oa=Array.prototype,qo=oa.slice,El=oa.map,wl=Math.sqrt(50),Ue=Math.sqrt(10),$t=Math.sqrt(2);function Wt(n,c,o){var s,l=-1,p,y,C;if(c=+c,n=+n,o=+o,n===c&&o>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(C=Cn(n,c,o))===0||!isFinite(C))return[];if(C>0)for(n=Math.ceil(n/C),c=Math.floor(c/C),y=new Array(p=Math.ceil(c-n+1));++l<p;)y[l]=(n+l)*C;else for(n=Math.floor(n*C),c=Math.ceil(c*C),y=new Array(p=Math.ceil(n-c+1));++l<p;)y[l]=(n-l)/C;return s&&y.reverse(),y}function Cn(n,c,o){var s=(c-n)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=wl?10:p>=Ue?5:p>=$t?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=wl?10:p>=Ue?5:p>=$t?2:1)}function Xi(n,c,o){var s=Math.abs(c-n)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=wl?l*=10:p>=Ue?l*=5:p>=$t&&(l*=2),c<n?-l:l}function Le(){var n=identity,c=extent,o=sturges;function s(l){var p,y=l.length,C,P=new Array(y);for(p=0;p<y;++p)P[p]=n(l[p],p,l);var O=c(P),J=O[0],X=O[1],le=o(P,J,X);Array.isArray(le)||(le=tickStep(J,X,le),le=range(Math.ceil(J/le)*le,X,le));for(var Re=le.length;le[0]<=J;)le.shift(),--Re;for(;le[Re-1]>X;)le.pop(),--Re;var ot=new Array(Re+1),It;for(p=0;p<=Re;++p)It=ot[p]=[],It.x0=p>0?le[p-1]:J,It.x1=p<Re?le[p]:X;for(p=0;p<y;++p)C=P[p],J<=C&&C<=X&&ot[bisect(le,C,0,Re)].push(l[p]);return ot}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function xe(n,c,o){return n=map.call(n,number).sort(ascending),Math.ceil((o-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function it(n){return n===null?NaN:+n}function Ot(n,c,o){if(o==null&&(o=it),!!(s=n.length)){if((c=+c)<=0||s<2)return+o(n[0],0,n);if(c>=1)return+o(n[s-1],s-1,n);var s,l=(s-1)*c,p=Math.floor(l),y=+o(n[p],p,n),C=+o(n[p+1],p+1,n);return y+(C-y)*(l-p)}}var At="$";function ut(){}ut.prototype=at.prototype={constructor:ut,has:function(n){return At+n in this},get:function(n){return this[At+n]},set:function(n,c){return this[At+n]=c,this},remove:function(n){var c=At+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===At&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===At&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===At&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===At&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===At&&++n;return n},empty:function(){for(var n in this)if(n[0]===At)return!1;return!0},each:function(n){for(var c in this)c[0]===At&&n(this[c],c.slice(1),this)}};function at(n,c){var o=new ut;if(n instanceof ut)n.each(function(C,P){o.set(P,C)});else if(Array.isArray(n)){var s=-1,l=n.length,p;if(c==null)for(;++s<l;)o.set(s,n[s]);else for(;++s<l;)o.set(c(p=n[s],s,n),p)}else if(n)for(var y in n)o.set(y,n[y]);return o}var St=at;function De(){var n=[],c=[],o,s,l;function p(C,P,O,J){if(P>=n.length)return o!=null&&C.sort(o),s!=null?s(C):C;for(var X=-1,le=C.length,Re=n[P++],ot,It,vr=map(),br,Zr=O();++X<le;)(br=vr.get(ot=Re(It=C[X])+""))?br.push(It):vr.set(ot,[It]);return vr.each(function(cn,xn){J(Zr,xn,p(cn,P,O,J))}),Zr}function y(C,P){if(++P>n.length)return C;var O,J=c[P-1];return s!=null&&P>=n.length?O=C.entries():(O=[],C.each(function(X,le){O.push({key:le,values:y(X,P)})})),J!=null?O.sort(function(X,le){return J(X.key,le.key)}):O}return l={object:function(C){return p(C,0,tt,Ie)},map:function(C){return p(C,0,wt,Zt)},entries:function(C){return y(p(C,0,wt,Zt),0)},key:function(C){return n.push(C),l},sortKeys:function(C){return c[n.length-1]=C,l},sortValues:function(C){return o=C,l},rollup:function(C){return s=C,l}}}function tt(){return{}}function Ie(n,c,o){n[c]=o}function wt(){return map()}function Zt(n,c,o){n.set(c,o)}function Er(){}var Xt=St.prototype;Er.prototype=xr.prototype={constructor:Er,has:Xt.has,add:function(n){return n+="",this[At+n]=n,this},remove:Xt.remove,clear:Xt.clear,values:Xt.keys,size:Xt.size,empty:Xt.empty,each:Xt.each};function xr(n,c){var o=new Er;if(n instanceof Er)n.each(function(p){o.add(p)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)o.add(n[s]);else for(;++s<l;)o.add(c(n[s],s,n))}return o}var Yr=null,zn=Array.prototype,Ii=zn.map,In=zn.slice;function $n(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function Oi(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var ha={name:"implicit"};function Co(){var n=St(),c=[],o=[],s=ha;function l(p){var y=p+"",C=n.get(y);if(!C){if(s!==ha)return s;n.set(y,C=c.push(p))}return o[(C-1)%o.length]}return l.domain=function(p){if(!arguments.length)return c.slice();c=[],n=St();for(var y=-1,C=p.length,P,O;++y<C;)n.has(O=(P=p[y])+"")||n.set(O,c.push(P));return l},l.range=function(p){return arguments.length?(o=In.call(p),l):o.slice()},l.unknown=function(p){return arguments.length?(s=p,l):s},l.copy=function(){return Co(c,o).unknown(s)},$n.apply(l,arguments),l}function yu(){var n=ordinal().unknown(void 0),c=n.domain,o=n.range,s=[0,1],l,p,y=!1,C=0,P=0,O=.5;delete n.unknown;function J(){var X=c().length,le=s[1]<s[0],Re=s[le-0],ot=s[1-le];l=(ot-Re)/Math.max(1,X-C+P*2),y&&(l=Math.floor(l)),Re+=(ot-Re-l*(X-C))*O,p=l*(1-C),y&&(Re=Math.round(Re),p=Math.round(p));var It=sequence(X).map(function(vr){return Re+l*vr});return o(le?It.reverse():It)}return n.domain=function(X){return arguments.length?(c(X),J()):c()},n.range=function(X){return arguments.length?(s=[+X[0],+X[1]],J()):s.slice()},n.rangeRound=function(X){return s=[+X[0],+X[1]],y=!0,J()},n.bandwidth=function(){return p},n.step=function(){return l},n.round=function(X){return arguments.length?(y=!!X,J()):y},n.padding=function(X){return arguments.length?(C=Math.min(1,P=+X),J()):C},n.paddingInner=function(X){return arguments.length?(C=Math.min(1,X),J()):C},n.paddingOuter=function(X){return arguments.length?(P=+X,J()):P},n.align=function(X){return arguments.length?(O=Math.max(0,Math.min(1,X)),J()):O},n.copy=function(){return yu(c(),s).round(y).paddingInner(C).paddingOuter(P).align(O)},initRange.apply(J(),arguments)}function Df(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return Df(c())},n}function Cl(){return Df(yu.apply(null,arguments).paddingInner(1))}var sh=x(26257),Tl=x(73626);function kf(n,c){return n=+n,c=+c,function(o){return Math.round(n*(1-o)+c*o)}}function Ff(n){return function(){return n}}function uh(n){return+n}var Bf=[0,1];function Yl(n){return n}function es(n,c){return(c-=n=+n)?function(o){return(o-n)/c}:Ff(isNaN(c)?NaN:.5)}function mo(n){var c=n[0],o=n[n.length-1],s;return c>o&&(s=c,c=o,o=s),function(l){return Math.max(c,Math.min(o,l))}}function Gp(n,c,o){var s=n[0],l=n[1],p=c[0],y=c[1];return l<s?(s=es(l,s),p=o(y,p)):(s=es(s,l),p=o(p,y)),function(C){return p(s(C))}}function Hp(n,c,o){var s=Math.min(n.length,c.length)-1,l=new Array(s),p=new Array(s),y=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++y<s;)l[y]=es(n[y],n[y+1]),p[y]=o(c[y],c[y+1]);return function(C){var P=Wi(n,C,1,s)-1;return p[P](l[P](C))}}function lh(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Uh(){var n=Bf,c=Bf,o=sh.Z,s,l,p,y=Yl,C,P,O;function J(){return C=Math.min(n.length,c.length)>2?Hp:Gp,P=O=null,X}function X(le){return isNaN(le=+le)?p:(P||(P=C(n.map(s),c,o)))(s(y(le)))}return X.invert=function(le){return y(l((O||(O=C(c,n.map(s),Tl.Z)))(le)))},X.domain=function(le){return arguments.length?(n=Ii.call(le,uh),y===Yl||(y=mo(n)),J()):n.slice()},X.range=function(le){return arguments.length?(c=In.call(le),J()):c.slice()},X.rangeRound=function(le){return c=In.call(le),o=kf,J()},X.clamp=function(le){return arguments.length?(y=le?mo(n):Yl,X):y!==Yl},X.interpolate=function(le){return arguments.length?(o=le,J()):o},X.unknown=function(le){return arguments.length?(p=le,X):p},function(le,Re){return s=le,l=Re,J()}}function gp(n,c){return Uh()(n,c)}var yp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Jc(n){if(!(c=yp.exec(n)))throw new Error("invalid format: "+n);var c;return new hf({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Jc.prototype=hf.prototype;function hf(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}hf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Wp(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Vo(n,c){if((o=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var o,s=n.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+n.slice(o+1)]}function Qc(n){return n=Vo(Math.abs(n)),n?n[1]:NaN}function pf(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qc(c)/3)))*3-Qc(Math.abs(n)))}function jh(n,c){return function(o,s){for(var l=o.length,p=[],y=0,C=n[0],P=0;l>0&&C>0&&(P+C+1>s&&(C=Math.max(1,s-P)),p.push(o.substring(l-=C,l+C)),!((P+=C+1)>s));)C=n[y=(y+1)%n.length];return p.reverse().join(c)}}function Vh(n){return function(c){return c.replace(/[0-9]/g,function(o){return n[+o]})}}function _p(n){e:for(var c=n.length,o=1,s=-1,l;o<c;++o)switch(n[o]){case".":s=l=o;break;case"0":s===0&&(s=o),l=o;break;default:if(!+n[o])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Nf;function df(n,c){var o=Vo(n,c);if(!o)return n+"";var s=o[0],l=o[1],p=l-(Nf=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,y=s.length;return p===y?s:p>y?s+new Array(p-y+1).join("0"):p>0?s.slice(0,p)+"."+s.slice(p):"0."+new Array(1-p).join("0")+Vo(n,Math.max(0,c+p-1))[0]}function xp(n,c){var o=Vo(n,c);if(!o)return n+"";var s=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var bp={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Wp,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return xp(n*100,c)},r:xp,s:df,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function Xp(n){return n}var ws=Array.prototype.map,vf=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Yp(n){var c=n.grouping===void 0||n.thousands===void 0?Xp:jh(ws.call(n.grouping,Number),n.thousands+""),o=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",p=n.numerals===void 0?Xp:Vh(ws.call(n.numerals,String)),y=n.percent===void 0?"%":n.percent+"",C=n.minus===void 0?"-":n.minus+"",P=n.nan===void 0?"NaN":n.nan+"";function O(X){X=Jc(X);var le=X.fill,Re=X.align,ot=X.sign,It=X.symbol,vr=X.zero,br=X.width,Zr=X.comma,cn=X.precision,xn=X.trim,Ln=X.type;Ln==="n"?(Zr=!0,Ln="g"):bp[Ln]||(cn===void 0&&(cn=12),xn=!0,Ln="g"),(vr||le==="0"&&Re==="=")&&(vr=!0,le="0",Re="=");var ni=It==="$"?o:It==="#"&&/[boxX]/.test(Ln)?"0"+Ln.toLowerCase():"",Nn=It==="$"?s:/[%p]/.test(Ln)?y:"",xi=bp[Ln],Ji=/[defgprs%]/.test(Ln);cn=cn===void 0?6:/[gprs]/.test(Ln)?Math.max(1,Math.min(21,cn)):Math.max(0,Math.min(20,cn));function ga(hi){var wa=ni,co=Nn,ju,sp,up;if(Ln==="c")co=xi(hi)+co,hi="";else{hi=+hi;var lp=hi<0||1/hi<0;if(hi=isNaN(hi)?P:xi(Math.abs(hi),cn),xn&&(hi=_p(hi)),lp&&+hi==0&&ot!=="+"&&(lp=!1),wa=(lp?ot==="("?ot:C:ot==="-"||ot==="("?"":ot)+wa,co=(Ln==="s"?vf[8+Nf/3]:"")+co+(lp&&ot==="("?")":""),Ji){for(ju=-1,sp=hi.length;++ju<sp;)if(up=hi.charCodeAt(ju),48>up||up>57){co=(up===46?l+hi.slice(ju+1):hi.slice(ju))+co,hi=hi.slice(0,ju);break}}}Zr&&!vr&&(hi=c(hi,Infinity));var cp=wa.length+hi.length+co.length,bf=cp<br?new Array(br-cp+1).join(le):"";switch(Zr&&vr&&(hi=c(bf+hi,bf.length?br-co.length:Infinity),bf=""),Re){case"<":hi=wa+hi+co+bf;break;case"=":hi=wa+bf+hi+co;break;case"^":hi=bf.slice(0,cp=bf.length>>1)+wa+hi+co+bf.slice(cp);break;default:hi=bf+wa+hi+co;break}return p(hi)}return ga.toString=function(){return X+""},ga}function J(X,le){var Re=O((X=Jc(X),X.type="f",X)),ot=Math.max(-8,Math.min(8,Math.floor(Qc(le)/3)))*3,It=Math.pow(10,-ot),vr=vf[8+ot/3];return function(br){return Re(It*br)+vr}}return{format:O,formatPrefix:J}}var e,t,r;f({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function f(n){return e=Yp(n),t=e.format,r=e.formatPrefix,e}function v(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,Qc(c)-Qc(n))+1}function m(n){return Math.max(0,-Qc(Math.abs(n)))}function _(n,c,o,s){var l=Xi(n,c,o),p;switch(s=Jc(s==null?",f":s),s.type){case"s":{var y=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(p=pf(l,y))&&(s.precision=p),r(s,y)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(p=v(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=p-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(p=m(l))&&(s.precision=p-(s.type==="%")*2);break}}return t(s)}function A(n){var c=n.domain;return n.ticks=function(o){var s=c();return Wt(s[0],s[s.length-1],o==null?10:o)},n.tickFormat=function(o,s){var l=c();return _(l[0],l[l.length-1],o==null?10:o,s)},n.nice=function(o){o==null&&(o=10);var s=c(),l=0,p=s.length-1,y=s[l],C=s[p],P;return C<y&&(P=y,y=C,C=P,P=l,l=p,p=P),P=Cn(y,C,o),P>0?(y=Math.floor(y/P)*P,C=Math.ceil(C/P)*P,P=Cn(y,C,o)):P<0&&(y=Math.ceil(y*P)/P,C=Math.floor(C*P)/P,P=Cn(y,C,o)),P>0?(s[l]=Math.floor(y/P)*P,s[p]=Math.ceil(C/P)*P,c(s)):P<0&&(s[l]=Math.ceil(y*P)/P,s[p]=Math.floor(C*P)/P,c(s)),n},n}function F(){var n=gp(Yl,Yl);return n.copy=function(){return lh(n,F())},$n.apply(n,arguments),A(n)}function Z(n){var c;function o(s){return isNaN(s=+s)?c:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(n=Ii.call(s,uh),o):n.slice()},o.unknown=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return Z(n).unknown(c)},n=arguments.length?Ii.call(n,uh):[0,1],A(o)}function K(n,c){n=n.slice();var o=0,s=n.length-1,l=n[o],p=n[s],y;return p<l&&(y=o,o=s,s=y,y=l,l=p,p=y),n[o]=c.floor(l),n[s]=c.ceil(p),n}function q(n){return Math.log(n)}function ue(n){return Math.exp(n)}function de(n){return-Math.log(-n)}function je(n){return-Math.exp(-n)}function Xe(n){return isFinite(n)?+("1e"+n):n<0?0:n}function st(n){return n===10?Xe:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function et(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function Mt(n){return function(c){return-n(-c)}}function Gt(n){var c=n(q,ue),o=c.domain,s=10,l,p;function y(){return l=et(s),p=st(s),o()[0]<0?(l=Mt(l),p=Mt(p),n(de,je)):n(q,ue),c}return c.base=function(C){return arguments.length?(s=+C,y()):s},c.domain=function(C){return arguments.length?(o(C),y()):o()},c.ticks=function(C){var P=o(),O=P[0],J=P[P.length-1],X;(X=J<O)&&(le=O,O=J,J=le);var le=l(O),Re=l(J),ot,It,vr,br=C==null?10:+C,Zr=[];if(!(s%1)&&Re-le<br){if(le=Math.round(le)-1,Re=Math.round(Re)+1,O>0){for(;le<Re;++le)for(It=1,ot=p(le);It<s;++It)if(vr=ot*It,!(vr<O)){if(vr>J)break;Zr.push(vr)}}else for(;le<Re;++le)for(It=s-1,ot=p(le);It>=1;--It)if(vr=ot*It,!(vr<O)){if(vr>J)break;Zr.push(vr)}}else Zr=Wt(le,Re,Math.min(Re-le,br)).map(p);return X?Zr.reverse():Zr},c.tickFormat=function(C,P){if(P==null&&(P=s===10?".0e":","),typeof P!="function"&&(P=t(P)),C===Infinity)return P;C==null&&(C=10);var O=Math.max(1,s*C/c.ticks().length);return function(J){var X=J/p(Math.round(l(J)));return X*s<s-.5&&(X*=s),X<=O?P(J):""}},c.nice=function(){return o(K(o(),{floor:function(C){return p(Math.floor(l(C)))},ceil:function(C){return p(Math.ceil(l(C)))}}))},c}function ir(){var n=Gt(Uh()).domain([1,10]);return n.copy=function(){return lh(n,ir()).base(n.base())},$n.apply(n,arguments),n}function cr(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function Ar(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function en(n){var c=1,o=n(cr(c),Ar(c));return o.constant=function(s){return arguments.length?n(cr(c=+s),Ar(c)):c},linearish(o)}function pn(){var n=en(transformer());return n.copy=function(){return copy(n,pn()).constant(n.constant())},initRange.apply(n,arguments)}function Hn(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function En(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function ei(n){return n<0?-n*n:n*n}function Tn(n){var c=n(Yl,Yl),o=1;function s(){return o===1?n(Yl,Yl):o===.5?n(En,ei):n(Hn(o),Hn(1/o))}return c.exponent=function(l){return arguments.length?(o=+l,s()):o},A(c)}function Vi(){var n=Tn(Uh());return n.copy=function(){return lh(n,Vi()).exponent(n.exponent())},$n.apply(n,arguments),n}function mi(){return Vi.apply(null,arguments).exponent(.5)}function Bn(){var n=[],c=[],o=[],s;function l(){var y=0,C=Math.max(1,c.length);for(o=new Array(C-1);++y<C;)o[y-1]=Ot(n,y/C);return p}function p(y){return isNaN(y=+y)?s:c[Wi(o,y)]}return p.invertExtent=function(y){var C=c.indexOf(y);return C<0?[NaN,NaN]:[C>0?o[C-1]:n[0],C<o.length?o[C]:n[n.length-1]]},p.domain=function(y){if(!arguments.length)return n.slice();n=[];for(var C=0,P=y.length,O;C<P;++C)O=y[C],O!=null&&!isNaN(O=+O)&&n.push(O);return n.sort(_s),l()},p.range=function(y){return arguments.length?(c=In.call(y),l()):c.slice()},p.unknown=function(y){return arguments.length?(s=y,p):s},p.quantiles=function(){return o.slice()},p.copy=function(){return Bn().domain(n).range(c).unknown(s)},$n.apply(p,arguments)}function ta(){var n=0,c=1,o=1,s=[.5],l=[0,1],p;function y(P){return P<=P?l[Wi(s,P,0,o)]:p}function C(){var P=-1;for(s=new Array(o);++P<o;)s[P]=((P+1)*c-(P-o)*n)/(o+1);return y}return y.domain=function(P){return arguments.length?(n=+P[0],c=+P[1],C()):[n,c]},y.range=function(P){return arguments.length?(o=(l=In.call(P)).length-1,C()):l.slice()},y.invertExtent=function(P){var O=l.indexOf(P);return O<0?[NaN,NaN]:O<1?[n,s[0]]:O>=o?[s[o-1],c]:[s[O-1],s[O]]},y.unknown=function(P){return arguments.length&&(p=P),y},y.thresholds=function(){return s.slice()},y.copy=function(){return ta().domain([n,c]).range(l).unknown(p)},$n.apply(A(y),arguments)}function Li(){var n=[.5],c=[0,1],o,s=1;function l(p){return p<=p?c[Wi(n,p,0,s)]:o}return l.domain=function(p){return arguments.length?(n=In.call(p),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(p){return arguments.length?(c=In.call(p),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(p){var y=c.indexOf(p);return[n[y-1],n[y]]},l.unknown=function(p){return arguments.length?(o=p,l):o},l.copy=function(){return Li().domain(n).range(c).unknown(o)},$n.apply(l,arguments)}var la=new Date,Jn=new Date;function zi(n,c,o,s){function l(p){return n(p=arguments.length===0?new Date:new Date(+p)),p}return l.floor=function(p){return n(p=new Date(+p)),p},l.ceil=function(p){return n(p=new Date(p-1)),c(p,1),n(p),p},l.round=function(p){var y=l(p),C=l.ceil(p);return p-y<C-p?y:C},l.offset=function(p,y){return c(p=new Date(+p),y==null?1:Math.floor(y)),p},l.range=function(p,y,C){var P=[],O;if(p=l.ceil(p),C=C==null?1:Math.floor(C),!(p<y)||!(C>0))return P;do P.push(O=new Date(+p)),c(p,C),n(p);while(O<p&&p<y);return P},l.filter=function(p){return zi(function(y){if(y>=y)for(;n(y),!p(y);)y.setTime(y-1)},function(y,C){if(y>=y)if(C<0)for(;++C<=0;)for(;c(y,-1),!p(y););else for(;--C>=0;)for(;c(y,1),!p(y););})},o&&(l.count=function(p,y){return la.setTime(+p),Jn.setTime(+y),n(la),n(Jn),Math.floor(o(la,Jn))},l.every=function(p){return p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?l.filter(s?function(y){return s(y)%p==0}:function(y){return l.count(0,y)%p==0}):l}),l}var uo=zi(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});uo.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:zi(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,o){c.setFullYear(c.getFullYear()+o*n)})};var lo=uo,Go=uo.range,go=zi(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),Ho=go,Bs=go.range,ts=1e3,Cs=6e4,Ts=36e5,iu=864e5,Wo=6048e5;function Bo(n){return zi(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,o){c.setDate(c.getDate()+o*7)},function(c,o){return(o-c-(o.getTimezoneOffset()-c.getTimezoneOffset())*Cs)/Wo})}var na=Bo(0),Ia=Bo(1),Da=Bo(2),pa=Bo(3),As=Bo(4),au=Bo(5),yo=Bo(6),xs=na.range,_u=Ia.range,Ea=Da.range,mf=pa.range,Kl=As.range,gf=au.range,us=yo.range,Cc=zi(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*Cs)/iu},function(n){return n.getDate()-1}),Al=Cc,ch=Cc.range,Tf=zi(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ts-n.getMinutes()*Cs)},function(n,c){n.setTime(+n+c*Ts)},function(n,c){return(c-n)/Ts},function(n){return n.getHours()}),$f=Tf,Af=Tf.range,zf=zi(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ts)},function(n,c){n.setTime(+n+c*Cs)},function(n,c){return(c-n)/Cs},function(n){return n.getMinutes()}),Gh=zf,fh=zf.range,Jf=zi(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*ts)},function(n,c){return(c-n)/ts},function(n){return n.getUTCSeconds()}),Hh=Jf,Sp=Jf.range,lc=zi(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});lc.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?zi(function(c){c.setTime(Math.floor(c/n)*n)},function(c,o){c.setTime(+c+o*n)},function(c,o){return(o-c)/n}):lc};var hh=lc,ph=lc.range;function Pl(n){return zi(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCDate(c.getUTCDate()+o*7)},function(c,o){return(o-c)/Wo})}var Zf=Pl(0),Uf=Pl(1),Wh=Pl(2),dh=Pl(3),qc=Pl(4),Xh=Pl(5),vh=Pl(6),Yh=Zf.range,Kh=Uf.range,Ep=Wh.range,mh=dh.range,wp=qc.range,gh=Xh.range,$h=vh.range,Pf=zi(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/iu},function(n){return n.getUTCDate()-1}),Qf=Pf,yh=Pf.range,_h=zi(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});_h.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:zi(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCFullYear(c.getUTCFullYear()+o*n)})};var qf=_h,Kp=_h.range;function Jh(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function xh(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function bh(n,c,o){return{y:n,m:c,d:o,H:0,M:0,S:0,L:0}}function Sh(n){var c=n.dateTime,o=n.date,s=n.time,l=n.periods,p=n.days,y=n.shortDays,C=n.months,P=n.shortMonths,O=If(l),J=Ml(l),X=If(p),le=Ml(p),Re=If(y),ot=Ml(y),It=If(C),vr=Ml(C),br=If(P),Zr=Ml(P),cn={a:lp,A:cp,b:bf,B:d0,c:null,d:Vf,e:Vf,f:id,g:ld,G:cd,H:rh,I:nh,j:nd,L:Pp,m:ad,M:Mp,p:v0,q:m0,Q:Kd,s:$d,S:Ip,u:yf,U:od,V:Op,w:sd,W:Lp,x:null,X:null,y:ud,Y:Rp,Z:wh,"%":Yd},xn={a:g0,A:y0,b:_0,B:x0,c:null,d:Dp,e:Dp,f:Rd,g:vd,G:Um,H:np,I:Ld,j:fd,L:hd,m:Dd,M:kd,p:b0,q:S0,Q:Kd,s:$d,S:Fd,u:Bd,U:Nd,V:tf,w:ip,W:dd,x:null,X:null,y:Ch,Y:Zm,Z:jm,"%":Yd},Ln={a:ga,A:hi,b:wa,B:co,c:ju,d:Ap,e:Ap,f:Od,g:eh,G:Tp,H:ol,I:ol,j:ed,L:ef,m:qp,M:tp,p:Ji,q:Qp,Q:jf,s:th,S:td,u:Eh,U:qh,V:ep,w:Qh,W:Cp,x:sp,X:up,y:eh,Y:Tp,Z:Jp,"%":rd};cn.x=ni(o,cn),cn.X=ni(s,cn),cn.c=ni(c,cn),xn.x=ni(o,xn),xn.X=ni(s,xn),xn.c=ni(c,xn);function ni(_i,Na){return function(_o){var An=[],cc=-1,ls=0,Tc=_i.length,Ac,Ph,zm;for(_o instanceof Date||(_o=new Date(+_o));++cc<Tc;)_i.charCodeAt(cc)===37&&(An.push(_i.slice(ls,cc)),(Ph=Xo[Ac=_i.charAt(++cc)])!=null?Ac=_i.charAt(++cc):Ph=Ac==="e"?" ":"0",(zm=Na[Ac])&&(Ac=zm(_o,Ph)),An.push(Ac),ls=cc+1);return An.push(_i.slice(ls,cc)),An.join("")}}function Nn(_i,Na){return function(_o){var An=bh(1900,void 0,1),cc=xi(An,_i,_o+="",0),ls,Tc;if(cc!=_o.length)return null;if("Q"in An)return new Date(An.Q);if("s"in An)return new Date(An.s*1e3+("L"in An?An.L:0));if(Na&&!("Z"in An)&&(An.Z=0),"p"in An&&(An.H=An.H%12+An.p*12),An.m===void 0&&(An.m="q"in An?An.q:0),"V"in An){if(An.V<1||An.V>53)return null;"w"in An||(An.w=1),"Z"in An?(ls=xh(bh(An.y,0,1)),Tc=ls.getUTCDay(),ls=Tc>4||Tc===0?Uf.ceil(ls):Uf(ls),ls=Qf.offset(ls,(An.V-1)*7),An.y=ls.getUTCFullYear(),An.m=ls.getUTCMonth(),An.d=ls.getUTCDate()+(An.w+6)%7):(ls=Jh(bh(An.y,0,1)),Tc=ls.getDay(),ls=Tc>4||Tc===0?Ia.ceil(ls):Ia(ls),ls=Al.offset(ls,(An.V-1)*7),An.y=ls.getFullYear(),An.m=ls.getMonth(),An.d=ls.getDate()+(An.w+6)%7)}else("W"in An||"U"in An)&&("w"in An||(An.w="u"in An?An.u%7:"W"in An?1:0),Tc="Z"in An?xh(bh(An.y,0,1)).getUTCDay():Jh(bh(An.y,0,1)).getDay(),An.m=0,An.d="W"in An?(An.w+6)%7+An.W*7-(Tc+5)%7:An.w+An.U*7-(Tc+6)%7);return"Z"in An?(An.H+=An.Z/100|0,An.M+=An.Z%100,xh(An)):Jh(An)}}function xi(_i,Na,_o,An){for(var cc=0,ls=Na.length,Tc=_o.length,Ac,Ph;cc<ls;){if(An>=Tc)return-1;if(Ac=Na.charCodeAt(cc++),Ac===37){if(Ac=Na.charAt(cc++),Ph=Ln[Ac in Xo?Na.charAt(cc++):Ac],!Ph||(An=Ph(_i,_o,An))<0)return-1}else if(Ac!=_o.charCodeAt(An++))return-1}return An}function Ji(_i,Na,_o){var An=O.exec(Na.slice(_o));return An?(_i.p=J[An[0].toLowerCase()],_o+An[0].length):-1}function ga(_i,Na,_o){var An=Re.exec(Na.slice(_o));return An?(_i.w=ot[An[0].toLowerCase()],_o+An[0].length):-1}function hi(_i,Na,_o){var An=X.exec(Na.slice(_o));return An?(_i.w=le[An[0].toLowerCase()],_o+An[0].length):-1}function wa(_i,Na,_o){var An=br.exec(Na.slice(_o));return An?(_i.m=Zr[An[0].toLowerCase()],_o+An[0].length):-1}function co(_i,Na,_o){var An=It.exec(Na.slice(_o));return An?(_i.m=vr[An[0].toLowerCase()],_o+An[0].length):-1}function ju(_i,Na,_o){return xi(_i,c,Na,_o)}function sp(_i,Na,_o){return xi(_i,o,Na,_o)}function up(_i,Na,_o){return xi(_i,s,Na,_o)}function lp(_i){return y[_i.getDay()]}function cp(_i){return p[_i.getDay()]}function bf(_i){return P[_i.getMonth()]}function d0(_i){return C[_i.getMonth()]}function v0(_i){return l[+(_i.getHours()>=12)]}function m0(_i){return 1+~~(_i.getMonth()/3)}function g0(_i){return y[_i.getUTCDay()]}function y0(_i){return p[_i.getUTCDay()]}function _0(_i){return P[_i.getUTCMonth()]}function x0(_i){return C[_i.getUTCMonth()]}function b0(_i){return l[+(_i.getUTCHours()>=12)]}function S0(_i){return 1+~~(_i.getUTCMonth()/3)}return{format:function(_i){var Na=ni(_i+="",cn);return Na.toString=function(){return _i},Na},parse:function(_i){var Na=Nn(_i+="",!1);return Na.toString=function(){return _i},Na},utcFormat:function(_i){var Na=ni(_i+="",xn);return Na.toString=function(){return _i},Na},utcParse:function(_i){var Na=Nn(_i+="",!0);return Na.toString=function(){return _i},Na}}}var Xo={"-":"",_:" ","0":"0"},Io=/^\s*\d+/,Id=/^%/,Mf=/[\\^$*+?|[\]().{}]/g;function Ba(n,c,o){var s=n<0?"-":"",l=(s?-n:n)+"",p=l.length;return s+(p<o?new Array(o-p+1).join(c)+l:l)}function $p(n){return n.replace(Mf,"\\$&")}function If(n){return new RegExp("^(?:"+n.map($p).join("|")+")","i")}function Ml(n){for(var c={},o=-1,s=n.length;++o<s;)c[n[o].toLowerCase()]=o;return c}function Qh(n,c,o){var s=Io.exec(c.slice(o,o+1));return s?(n.w=+s[0],o+s[0].length):-1}function Eh(n,c,o){var s=Io.exec(c.slice(o,o+1));return s?(n.u=+s[0],o+s[0].length):-1}function qh(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.U=+s[0],o+s[0].length):-1}function ep(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.V=+s[0],o+s[0].length):-1}function Cp(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.W=+s[0],o+s[0].length):-1}function Tp(n,c,o){var s=Io.exec(c.slice(o,o+4));return s?(n.y=+s[0],o+s[0].length):-1}function eh(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function Jp(n,c,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(o,o+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Qp(n,c,o){var s=Io.exec(c.slice(o,o+1));return s?(n.q=s[0]*3-3,o+s[0].length):-1}function qp(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.m=s[0]-1,o+s[0].length):-1}function Ap(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.d=+s[0],o+s[0].length):-1}function ed(n,c,o){var s=Io.exec(c.slice(o,o+3));return s?(n.m=0,n.d=+s[0],o+s[0].length):-1}function ol(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.H=+s[0],o+s[0].length):-1}function tp(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.M=+s[0],o+s[0].length):-1}function td(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.S=+s[0],o+s[0].length):-1}function ef(n,c,o){var s=Io.exec(c.slice(o,o+3));return s?(n.L=+s[0],o+s[0].length):-1}function Od(n,c,o){var s=Io.exec(c.slice(o,o+6));return s?(n.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function rd(n,c,o){var s=Id.exec(c.slice(o,o+1));return s?o+s[0].length:-1}function jf(n,c,o){var s=Io.exec(c.slice(o));return s?(n.Q=+s[0],o+s[0].length):-1}function th(n,c,o){var s=Io.exec(c.slice(o));return s?(n.s=+s[0],o+s[0].length):-1}function Vf(n,c){return Ba(n.getDate(),c,2)}function rh(n,c){return Ba(n.getHours(),c,2)}function nh(n,c){return Ba(n.getHours()%12||12,c,2)}function nd(n,c){return Ba(1+Al.count(lo(n),n),c,3)}function Pp(n,c){return Ba(n.getMilliseconds(),c,3)}function id(n,c){return Pp(n,c)+"000"}function ad(n,c){return Ba(n.getMonth()+1,c,2)}function Mp(n,c){return Ba(n.getMinutes(),c,2)}function Ip(n,c){return Ba(n.getSeconds(),c,2)}function yf(n){var c=n.getDay();return c===0?7:c}function od(n,c){return Ba(na.count(lo(n)-1,n),c,2)}function rp(n){var c=n.getDay();return c>=4||c===0?As(n):As.ceil(n)}function Op(n,c){return n=rp(n),Ba(As.count(lo(n),n)+(lo(n).getDay()===4),c,2)}function sd(n){return n.getDay()}function Lp(n,c){return Ba(Ia.count(lo(n)-1,n),c,2)}function ud(n,c){return Ba(n.getFullYear()%100,c,2)}function ld(n,c){return n=rp(n),Ba(n.getFullYear()%100,c,2)}function Rp(n,c){return Ba(n.getFullYear()%1e4,c,4)}function cd(n,c){var o=n.getDay();return n=o>=4||o===0?As(n):As.ceil(n),Ba(n.getFullYear()%1e4,c,4)}function wh(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+Ba(c/60|0,"0",2)+Ba(c%60,"0",2)}function Dp(n,c){return Ba(n.getUTCDate(),c,2)}function np(n,c){return Ba(n.getUTCHours(),c,2)}function Ld(n,c){return Ba(n.getUTCHours()%12||12,c,2)}function fd(n,c){return Ba(1+Qf.count(qf(n),n),c,3)}function hd(n,c){return Ba(n.getUTCMilliseconds(),c,3)}function Rd(n,c){return hd(n,c)+"000"}function Dd(n,c){return Ba(n.getUTCMonth()+1,c,2)}function kd(n,c){return Ba(n.getUTCMinutes(),c,2)}function Fd(n,c){return Ba(n.getUTCSeconds(),c,2)}function Bd(n){var c=n.getUTCDay();return c===0?7:c}function Nd(n,c){return Ba(Zf.count(qf(n)-1,n),c,2)}function pd(n){var c=n.getUTCDay();return c>=4||c===0?qc(n):qc.ceil(n)}function tf(n,c){return n=pd(n),Ba(qc.count(qf(n),n)+(qf(n).getUTCDay()===4),c,2)}function ip(n){return n.getUTCDay()}function dd(n,c){return Ba(Uf.count(qf(n)-1,n),c,2)}function Ch(n,c){return Ba(n.getUTCFullYear()%100,c,2)}function vd(n,c){return n=pd(n),Ba(n.getUTCFullYear()%100,c,2)}function Zm(n,c){return Ba(n.getUTCFullYear()%1e4,c,4)}function Um(n,c){var o=n.getUTCDay();return n=o>=4||o===0?qc(n):qc.ceil(n),Ba(n.getUTCFullYear()%1e4,c,4)}function jm(){return"+0000"}function Yd(){return"%"}function Kd(n){return+n}function $d(n){return Math.floor(+n/1e3)}var ap,Jd,Vm,Gm,Hm;Wm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Wm(n){return ap=Sh(n),Jd=ap.format,Vm=ap.parse,Gm=ap.utcFormat,Hm=ap.utcParse,ap}var kp=1e3,Fp=kp*60,Bp=Fp*60,Np=Bp*24,Xm=Np*7,Qd=Np*30,zd=Np*365;function Ym(n){return new Date(n)}function Km(n){return n instanceof Date?+n:+new Date(+n)}function qd(n,c,o,s,l,p,y,C,P){var O=gp(Yl,Yl),J=O.invert,X=O.domain,le=P(".%L"),Re=P(":%S"),ot=P("%I:%M"),It=P("%I %p"),vr=P("%a %d"),br=P("%b %d"),Zr=P("%B"),cn=P("%Y"),xn=[[y,1,kp],[y,5,5*kp],[y,15,15*kp],[y,30,30*kp],[p,1,Fp],[p,5,5*Fp],[p,15,15*Fp],[p,30,30*Fp],[l,1,Bp],[l,3,3*Bp],[l,6,6*Bp],[l,12,12*Bp],[s,1,Np],[s,2,2*Np],[o,1,Xm],[c,1,Qd],[c,3,3*Qd],[n,1,zd]];function Ln(Nn){return(y(Nn)<Nn?le:p(Nn)<Nn?Re:l(Nn)<Nn?ot:s(Nn)<Nn?It:c(Nn)<Nn?o(Nn)<Nn?vr:br:n(Nn)<Nn?Zr:cn)(Nn)}function ni(Nn,xi,Ji,ga){if(Nn==null&&(Nn=10),typeof Nn=="number"){var hi=Math.abs(Ji-xi)/Nn,wa=Fo(function(co){return co[2]}).right(xn,hi);wa===xn.length?(ga=Xi(xi/zd,Ji/zd,Nn),Nn=n):wa?(wa=xn[hi/xn[wa-1][2]<xn[wa][2]/hi?wa-1:wa],ga=wa[1],Nn=wa[0]):(ga=Math.max(Xi(xi,Ji,Nn),1),Nn=C)}return ga==null?Nn:Nn.every(ga)}return O.invert=function(Nn){return new Date(J(Nn))},O.domain=function(Nn){return arguments.length?X(Ii.call(Nn,Km)):X().map(Ym)},O.ticks=function(Nn,xi){var Ji=X(),ga=Ji[0],hi=Ji[Ji.length-1],wa=hi<ga,co;return wa&&(co=ga,ga=hi,hi=co),co=ni(Nn,ga,hi,xi),co=co?co.range(ga,hi+1):[],wa?co.reverse():co},O.tickFormat=function(Nn,xi){return xi==null?Ln:P(xi)},O.nice=function(Nn,xi){var Ji=X();return(Nn=ni(Nn,Ji[0],Ji[Ji.length-1],xi))?X(K(Ji,Nn)):O},O.copy=function(){return lh(O,qd(n,c,o,s,l,p,y,C,P))},O}function $m(){return $n.apply(qd(lo,Ho,na,Al,$f,Gh,Hh,hh,Jd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function E0(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function md(){var n=0,c=1,o,s,l,p,y=identity,C=!1,P;function O(J){return isNaN(J=+J)?P:y(l===0?.5:(J=(p(J)-o)*l,C?Math.max(0,Math.min(1,J)):J))}return O.domain=function(J){return arguments.length?(o=p(n=+J[0]),s=p(c=+J[1]),l=o===s?0:1/(s-o),O):[n,c]},O.clamp=function(J){return arguments.length?(C=!!J,O):C},O.interpolator=function(J){return arguments.length?(y=J,O):y},O.unknown=function(J){return arguments.length?(P=J,O):P},function(J){return p=J,o=J(n),s=J(c),l=o===s?0:1/(s-o),O}}function gd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Jm(){var n=linearish(md()(identity));return n.copy=function(){return gd(n,Jm())},initInterpolator.apply(n,arguments)}function Qm(){var n=loggish(md()).domain([1,10]);return n.copy=function(){return gd(n,Qm()).base(n.base())},initInterpolator.apply(n,arguments)}function qm(){var n=symlogish(md());return n.copy=function(){return gd(n,qm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function ev(){var n=powish(md());return n.copy=function(){return gd(n,ev()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function w0(){return ev.apply(null,arguments).exponent(.5)}function eg(){var n=[],c=identity;function o(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return o.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,p=s.length,y;l<p;++l)y=s[l],y!=null&&!isNaN(y=+y)&&n.push(y);return n.sort(ascending),o},o.interpolator=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return eg(c).domain(n)},initInterpolator.apply(o,arguments)}function yd(){var n=0,c=.5,o=1,s,l,p,y,C,P=identity,O,J=!1,X;function le(Re){return isNaN(Re=+Re)?X:(Re=.5+((Re=+O(Re))-l)*(Re<l?y:C),P(J?Math.max(0,Math.min(1,Re)):Re))}return le.domain=function(Re){return arguments.length?(s=O(n=+Re[0]),l=O(c=+Re[1]),p=O(o=+Re[2]),y=s===l?0:.5/(l-s),C=l===p?0:.5/(p-l),le):[n,c,o]},le.clamp=function(Re){return arguments.length?(J=!!Re,le):J},le.interpolator=function(Re){return arguments.length?(P=Re,le):P},le.unknown=function(Re){return arguments.length?(X=Re,le):X},function(Re){return O=Re,s=Re(n),l=Re(c),p=Re(o),y=s===l?0:.5/(l-s),C=l===p?0:.5/(p-l),le}}function tg(){var n=linearish(yd()(identity));return n.copy=function(){return copy(n,tg())},initInterpolator.apply(n,arguments)}function rg(){var n=loggish(yd()).domain([.1,1,10]);return n.copy=function(){return copy(n,rg()).base(n.base())},initInterpolator.apply(n,arguments)}function ng(){var n=symlogish(yd());return n.copy=function(){return copy(n,ng()).constant(n.constant())},initInterpolator.apply(n,arguments)}function tv(){var n=powish(yd());return n.copy=function(){return copy(n,tv()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function C0(){return tv.apply(null,arguments).exponent(.5)}var _f,rv,nv,iv,av,_d,ov,sv,ig=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ag=(_f={},(0,I.Z)(_f,b.ScaleTypes.LINEAR,F),(0,I.Z)(_f,b.ScaleTypes.POWER,Vi),(0,I.Z)(_f,b.ScaleTypes.LOG,ir),(0,I.Z)(_f,b.ScaleTypes.IDENTITY,Z),(0,I.Z)(_f,b.ScaleTypes.TIME,$m),(0,I.Z)(_f,b.ScaleTypes.QUANTILE,Bn),(0,I.Z)(_f,b.ScaleTypes.QUANTIZE,ta),(0,I.Z)(_f,b.ScaleTypes.THRESHOLD,Li),(0,I.Z)(_f,b.ScaleTypes.CAT,Co),_f),og=(rv=(0,H.b2)(),nv=(0,H.f3)(b.vK.IGlobalConfigService),iv=(0,H.f3)(b.vK.ILogService),rv(av=(_d=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"configService",ov,this),(0,Wn.Z)(this,"logger",sv,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,p=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=p.getLayerStyleAttributes(),C=o.getSource().data.dataArray;C.length!==0&&l.caculateScalesForAttributes(y||[],C)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=p.getLayerStyleAttributes(),C=o.getSource().data.dataArray;return l.caculateScalesForAttributes(y||[],C),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var y=p.getLayerStyleAttributes();if(y){var C=o.getSource().data.dataArray;if(C.length===0)return;var P=y.filter(function(O){return O.needRescale});P.length&&(l.caculateScalesForAttributes(P,C),l.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var l=this;this.scaleCache={},o.forEach(function(p){if(p.scale){var y=p.scale,C=p.name;y.names=l.parseFields(p.scale.field||[]);var P=[];y.names.forEach(function(O){P.push(l.getOrCreateScale(O,p,s))}),P.some(function(O){return O.type===b.StyleScaleType.VARIABLE})?(y.type=b.StyleScaleType.VARIABLE,P.forEach(function(O){if(!y.callback){var J;if(y.values&&y.values!=="text"){var X;if(((X=O.option)===null||X===void 0?void 0:X.type)==="linear"&&y.values.length>2){var le=O.scale.ticks(y.values.length);C==="color"&&O.scale.domain(le)}O.scale.range(y.values)}else((J=O.option)===null||J===void 0?void 0:J.type)==="cat"&&O.scale.range(O.option.domain)}})):(y.type=b.StyleScaleType.CONSTANT,y.defaultValues=P.map(function(O,J){return O.scale(y.names[J])})),y.scalers=P.map(function(O){return{field:O.field,func:O.scale,option:O.option}}),p.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,l){var p,y=[o,s.name].join("_"),C=(p=s.scale)===null||p===void 0?void 0:p.values,P=this.createScale(o,s.name,C,l);return P}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:Za()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,l,p){var y,C,P=this.scaleOptions[s]&&((y=this.scaleOptions[s])===null||y===void 0?void 0:y.field)===o?this.scaleOptions[s]:this.scaleOptions[o],O={field:o,scale:void 0,type:b.StyleScaleType.VARIABLE,option:P};if(!p||!p.length)return P&&P.type?O.scale=this.createDefaultScale(P):(O.scale=Co([o]),O.type=b.StyleScaleType.CONSTANT),O;var J=(C=p.find(function(Re){return!Kn()(Re[o])}))===null||C===void 0?void 0:C[o];if(this.isNumber(o)||Kn()(J)&&!P)O.scale=Co([o]),O.type=b.StyleScaleType.CONSTANT;else{var X=P&&P.type||this.getDefaultType(J);l==="text"&&(X=b.ScaleTypes.CAT);var le=this.createDefaultScaleConfig(X,o,p);Object.assign(le,P),O.scale=this.createDefaultScale(le),O.option=le}return O}},{key:"getDefaultType",value:function(o){var s=b.ScaleTypes.LINEAR;return typeof o=="string"&&(s=ig.test(o)?b.ScaleTypes.TIME:b.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,l){var p={type:o},y=(l==null?void 0:l.map(function(C){return C[s]}))||[];return o!==b.ScaleTypes.CAT&&o!==b.ScaleTypes.QUANTILE?p.domain=Pi(y):o===b.ScaleTypes.CAT?p.domain=nn()(y):o===b.ScaleTypes.QUANTILE&&(p.domain=y),p}},{key:"createDefaultScale",value:function(o){var s=o.type,l=o.domain,p=ag[s]();return l&&p.domain(l),p}}]),n}(),ov=(0,ai.Z)(_d.prototype,"configService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv=(0,ai.Z)(_d.prototype,"logger",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||av),uv,lv,cv,fv,xd,hv,pv;function dv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function sg(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?dv(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):dv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var ug=(uv=(0,H.b2)(),lv=(0,H.f3)(b.vK.ICameraService),cv=(0,H.f3)(b.vK.IRendererService),uv(fv=(xd=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"cameraService",hv,this),(0,Wn.Z)(this,"rendererService",pv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(sg({},o.layerModel.getAnimateUniforms()))})})}}]),n}(),hv=(0,ai.Z)(xd.prototype,"cameraService",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pv=(0,ai.Z)(xd.prototype,"rendererService",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||fv),vv,mv,lg=(vv=(0,H.b2)(),vv(mv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),n}())||mv),gv,yv,cg=(gv=(0,H.b2)(),gv(yv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),l=s.autoFit,p=s.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(p)},100)})}}]),n}())||yv),_v,xv;function bv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function zp(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?bv(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):bv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var Sv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},fg={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},hg={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},pg={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},T0=null;function dg(n){var c={u_DirectionalLights:new Array(3).fill(zp({},hg)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(zp({},pg)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[fg]),n.forEach(function(o,s){var l=o.type,p=l===void 0?"directional":l,y=(0,za.Z)(o,["type"]),C=Sv[p].lights,P=Sv[p].num,O=c[P];c[C][O]=zp(zp({},c[C][O]),y),c[P]++}),c}var vg=(_v=(0,H.b2)(),_v(xv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),l=s.enableLighting;l&&o.models.forEach(function(p){return p.addUniforms(zp({},dg()))})})}}]),n}())||xv),Ev,wv,bd={NONE:0,ENCODE:1,HIGHLIGHT:2},mg=(Ev=(0,H.b2)(),Ev(wv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=s.rendererService,p=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;p.registerStyleAttribute({name:"pickingColor",type:b.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:b.gl.FLOAT},size:3,update:function(O,J){var X=O.id;return C?(0,$e.Z6)(X):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;C&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:bd.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;C&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:bd.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(y){var C=o.getLayerConfig(),P=C.highlightColor,O=typeof P=="string"?(0,$e.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(y))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:bd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:O.map(function(X){return X*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(y){var C=o.getLayerConfig(),P=C.selectColor,O=typeof P=="string"?(0,$e.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(y))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:bd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:O.map(function(X){return X*255})})})})}}]),n}())||wv),Cv,Tv,Av,Zd,Pv,gg=(Cv=(0,H.b2)(),Tv=(0,H.f3)(b.vK.ILogService),Cv(Av=(Zd=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"logger",Pv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,p=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(p)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:b.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:b.gl.FLOAT},size:3,update:function(l,p,y){return y.length===2?[y[0],y[1],0]:[y[0],y[1],y[2]]}}}),o.registerStyleAttribute({name:"filter",type:b.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(l,p){var y=l.filter;return y?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:b.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(l,p){var y=l.color;return!y||!y.length?[1,1,1,1]:y}}}),o.registerStyleAttribute({name:"vertexId",type:b.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(l,p,y,C){return[p]}}})}}]),n}(),Pv=(0,ai.Z)(Zd.prototype,"logger",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd))||Av),Mv,Iv,Ov,Lv,Rv,Dv,op,kv,Fv,Bv,Nv,yg=(Mv=(0,H.b2)(),Iv=(0,H.f3)(b.vK.ICameraService),Ov=(0,H.f3)(b.vK.ICoordinateSystemService),Lv=(0,H.f3)(b.vK.IRendererService),Rv=(0,H.f3)(b.vK.IMapService),Mv(Dv=(op=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"cameraService",kv,this),(0,Wn.Z)(this,"coordinateSystemService",Fv,this),(0,Wn.Z)(this,"rendererService",Bv,this),(0,Wn.Z)(this,"mapService",Nv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o){var s=this,l=this.mapService.version,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(p=s.mapService.map.customCoords.getMVPMatrix(),y=s.mapService.getCustomCoordCenter());var C=s.rendererService.getViewportSize(),P=C.width,O=C.height;o.models.forEach(function(J){var X;J.addUniforms((X={},(0,I.Z)(X,b.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,I.Z)(X,b.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,I.Z)(X,b.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,I.Z)(X,b.CameraUniform.Zoom,s.cameraService.getZoom()),(0,I.Z)(X,b.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,I.Z)(X,b.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,I.Z)(X,b.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,I.Z)(X,b.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(X,b.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,I.Z)(X,b.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(X,b.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(X,b.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(X,b.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(X,b.CoordinateUniform.Mvp,p),(0,I.Z)(X,"u_SceneCenterMKT",y),(0,I.Z)(X,"u_ViewportSize",[P,O]),(0,I.Z)(X,"u_DevicePixelRatio",window.devicePixelRatio),(0,I.Z)(X,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,I.Z)(X,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),X))})})}}]),n}(),kv=(0,ai.Z)(op.prototype,"cameraService",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=(0,ai.Z)(op.prototype,"coordinateSystemService",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=(0,ai.Z)(op.prototype,"rendererService",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=(0,ai.Z)(op.prototype,"mapService",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),op))||Dv),zv,Zv,_g=(zv=(0,H.b2)(),zv(Zv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),n}())||Zv),Uv,jv,Vv,Ud,Gv,xg=(Uv=(0,H.b2)(),jv=(0,H.f3)(b.vK.ILogService),Uv(Vv=(Ud=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"logger",Gv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,p=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:p})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:p})})}},{key:"updateStyleAtrribute",value:function(o,s){var l=this,p=s.styleAttributeService,y=p.getLayerStyleAttributes()||[],C=p.getLayerStyleAttribute("filter"),P=p.getLayerStyleAttribute("shape");if(C&&C.needRegenerateVertices||P&&P.needRegenerateVertices){o.layerModelNeedUpdate=!0,y.forEach(function(O){return O.needRegenerateVertices=!1});return}y.filter(function(O){return O.needRegenerateVertices}).forEach(function(O){p.updateAttributeByFeatureRange(O.name,o.getEncodedData(),O.featureRange.startIndex,O.featureRange.endIndex),O.needRegenerateVertices=!1,l.logger.debug("regenerate vertex attributes: ".concat(O.name," finished"))})}},{key:"initStyleAttribute",value:function(o,s){var l=this,p=s.styleAttributeService,y=p.getLayerStyleAttributes()||[];y.filter(function(C){return C.needRegenerateVertices}).forEach(function(C){p.updateAttributeByFeatureRange(C.name,o.getEncodedData(),C.featureRange.startIndex,C.featureRange.endIndex),C.needRegenerateVertices=!1,l.logger.debug("init vertex attributes: ".concat(C.name," finished"))})}}]),n}(),Gv=(0,ai.Z)(Ud.prototype,"logger",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud))||Vv);b.nC.bind(b.vK.ILayerPlugin).to(sn).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(gg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(og).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Ec).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(cg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(xg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(_g).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Yo).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(yg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(ug).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(vg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(mg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(lg).inRequestScope();var A0="2.5.5";function Hv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function P0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Hv(Object(o),!0).forEach(function(s){bg(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Hv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function bg(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function M0(n,c){return Cg(n)||wg(n,c)||Eg(n,c)||Sg()}function Sg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eg(n,c){if(!!n){if(typeof n=="string")return Wv(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Wv(n,c)}}function Wv(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function wg(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function Cg(n){if(Array.isArray(n))return n}var I0=null,O0=null,Xv,Yv,Sd,Kv,$v;function Jv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Qv(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Jv(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Jv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var Tg=(Xv=(0,b.yT)(b.vK.ILogService),Yv=(0,b.yT)(b.vK.IGlobalConfigService),Sd=function(){function n(c){(0,W.Z)(this,n),(0,Wn.Z)(this,"logger",Kv,this),(0,Wn.Z)(this,"configService",$v,this),(0,I.Z)(this,"config",void 0),this.config=c}return(0,$.Z)(n,[{key:"setContainer",value:function(o,s){o.bind(b.vK.MapConfig).toConstantValue(Qv(Qv({},this.config),{},{id:s})),o.bind(b.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Kv=(0,ai.Z)(Sd.prototype,"logger",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v=(0,ai.Z)(Sd.prototype,"configService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd),Ag=x(6158),Pg=x.n(Ag),jd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP"})(jd||(jd={}));function Zp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ed(n,c){var o=i.fF([],c,n);return i.bA(o,o,1/o[3]),o}function L0(n,c){var o=n%c;return o<0?c+o:o}function R0(n,c,o){return o*c+(1-o)*n}function Th(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var xf=Math.PI,qv=xf/4,Gf=xf/180,em=180/xf,Vd=512,Gd=4003e4,Mg=1.5;function tm(n){return Math.pow(2,n)}function Ig(n){return Math.log2(n)}function wd(n,c){var o=(0,Y.Z)(n,2),s=o[0],l=o[1];Th(Number.isFinite(s)&&Number.isFinite(c)),Th(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Vd;var p=s*Gf,y=l*Gf,C=c*(p+xf)/(2*xf),P=c*(xf-Math.log(Math.tan(qv+y*.5)))/(2*xf);return[C,P]}function Hd(n,c){var o=(0,Y.Z)(n,2),s=o[0],l=o[1];c*=Vd;var p=s/c*(2*xf)-xf,y=2*(Math.atan(Math.exp(xf-l/c*(2*xf)))-qv);return[p*em,y*em]}function D0(n){var c=n.latitude;assert(Number.isFinite(c));var o=Math.cos(c*Gf);return Ig(Gd*o)-9}function rm(n){var c=n.latitude,o=n.longitude,s=n.zoom,l=n.scale,p=n.highPrecision,y=p===void 0?!1:p;l=l!==void 0?l:tm(s),Th(Number.isFinite(c)&&Number.isFinite(o)&&Number.isFinite(l));var C={},P=Vd*l,O=Math.cos(c*Gf),J=P/360,X=J/O,le=P/Gd/O;if(C.pixelsPerMeter=[le,-le,le],C.metersPerPixel=[1/le,-1/le,1/le],C.pixelsPerDegree=[J,-X,le],C.degreesPerPixel=[1/J,-1/X,1/le],y){var Re=Gf*Math.tan(c*Gf)/O,ot=J*Re/2,It=P/Gd*Re,vr=It/X*le;C.pixelsPerDegree2=[0,-ot,It],C.pixelsPerMeter2=[vr,0,vr]}return C}function k0(n,c){var o=_slicedToArray(n,3),s=o[0],l=o[1],p=o[2],y=_slicedToArray(c,3),C=y[0],P=y[1],O=y[2],J=1,X=rm({longitude:s,latitude:l,scale:J,highPrecision:!0}),le=X.pixelsPerMeter,Re=X.pixelsPerMeter2,ot=wd(n,J);ot[0]+=C*(le[0]+Re[0]*P),ot[1]+=P*(le[1]+Re[1]*P);var It=Hd(ot,J),vr=(p||0)+(O||0);return Number.isFinite(p)||Number.isFinite(O)?[It[0],It[1],vr]:It}function Og(n){var c=n.height,o=n.pitch,s=n.bearing,l=n.altitude,p=n.center,y=p===void 0?null:p,C=n.flipY,P=C===void 0?!1:C,O=Zp();return Fa.translate(O,O,[0,0,-l]),Fa.scale(O,O,[1,1,1/c]),Fa.rotateX(O,O,-o*Gf),Fa.rotateZ(O,O,s*Gf),P&&Fa.scale(O,O,[1,-1,1]),y&&Fa.translate(O,O,Ui.negate([],y)),O}function Lg(n){var c=n.width,o=n.height,s=n.altitude,l=s===void 0?Mg:s,p=n.pitch,y=p===void 0?0:p,C=n.nearZMultiplier,P=C===void 0?1:C,O=n.farZMultiplier,J=O===void 0?1:O,X=y*Gf,le=Math.atan(.5/l),Re=Math.sin(le)*l/Math.sin(Math.PI/2-X-le),ot=Math.cos(Math.PI/2-X)*Re+l;return{fov:2*Math.atan(o/2/l),aspect:c/o,focalDistance:l,near:P,far:ot*J}}function Rg(n){var c=n.width,o=n.height,s=n.pitch,l=n.altitude,p=n.nearZMultiplier,y=n.farZMultiplier,C=Lg({width:c,height:o,altitude:l,pitch:s,nearZMultiplier:p,farZMultiplier:y}),P=C.fov,O=C.aspect,J=C.near,X=C.far,le=Fa.perspective([],P,O,J,X);return le}function Dg(n,c){var o=(0,Y.Z)(n,3),s=o[0],l=o[1],p=o[2],y=p===void 0?0:p;return Th(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(y)),Ed(c,[s,l,y,1])}function nm(n,c){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Y.Z)(n,3),l=s[0],p=s[1],y=s[2];if(Th(Number.isFinite(l)&&Number.isFinite(p),"invalid pixel coordinate"),Number.isFinite(y)){var C=Ed(c,[l,p,y,1]);return C}var P=Ed(c,[l,p,0,1]),O=Ed(c,[l,p,1,1]),J=P[2],X=O[2],le=J===X?0:((o||0)-J)/(X-J);return qn.lerp([],P,O,le)}var im=Zp(),kg=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=c.width,s=c.height,l=c.viewMatrix,p=l===void 0?im:l,y=c.projectionMatrix,C=y===void 0?im:y;(0,W.Z)(this,n),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=p,this.projectionMatrix=C;var P=Zp();Fa.multiply(P,P,this.projectionMatrix),Fa.multiply(P,P,this.viewMatrix),this.viewProjectionMatrix=P;var O=Zp();Fa.scale(O,O,[this.width/2,-this.height/2,1]),Fa.translate(O,O,[1,-1,0]),Fa.multiply(O,O,this.viewProjectionMatrix);var J=Fa.invert(Zp(),O);if(!J)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=O,this.pixelUnprojectionMatrix=J,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,$.Z)(n,[{key:"equals",value:function(o){return o instanceof n?o.width===this.width&&o.height===this.height&&Fa.equals(o.projectionMatrix,this.projectionMatrix)&&Fa.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,y=this.projectPosition(o),C=Dg(y,this.pixelProjectionMatrix),P=(0,Y.Z)(C,2),O=P[0],J=P[1],X=p?J:this.height-J;return o.length===2?[O,X]:[O,X,C[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,y=s.targetZ,C=(0,Y.Z)(o,3),P=C[0],O=C[1],J=C[2],X=p?O:this.height-O,le=y&&y*this.pixelsPerMeter,Re=nm([P,X,J],this.pixelUnprojectionMatrix,le),ot=this.unprojectPosition(Re),It=(0,Y.Z)(ot,3),vr=It[0],br=It[1],Zr=It[2];return Number.isFinite(J)?[vr,br,Zr]:Number.isFinite(y)?[vr,br,y]:[vr,br]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),l=(0,Y.Z)(s,2),p=l[0],y=l[1],C=(o[2]||0)*this.pixelsPerMeter;return[p,y,C]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),l=(0,Y.Z)(s,2),p=l[0],y=l[1],C=(o[2]||0)/this.pixelsPerMeter;return[p,y,C]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),n}();function Fg(n){var c=n.width,o=n.height,s=n.bounds,l=n.minExtent,p=l===void 0?0:l,y=n.maxZoom,C=y===void 0?24:y,P=n.padding,O=P===void 0?0:P,J=n.offset,X=J===void 0?[0,0]:J,le=(0,Y.Z)(s,2),Re=(0,Y.Z)(le[0],2),ot=Re[0],It=Re[1],vr=(0,Y.Z)(le[1],2),br=vr[0],Zr=vr[1];if(Number.isFinite(O)){var cn=O;O={top:cn,bottom:cn,left:cn,right:cn}}else Th(Number.isFinite(O.top)&&Number.isFinite(O.bottom)&&Number.isFinite(O.left)&&Number.isFinite(O.right));var xn=new am({width:c,height:o,longitude:0,latitude:0,zoom:0}),Ln=xn.project([ot,Zr]),ni=xn.project([br,It]),Nn=[Math.max(Math.abs(ni[0]-Ln[0]),p),Math.max(Math.abs(ni[1]-Ln[1]),p)],xi=[c-O.left-O.right-Math.abs(X[0])*2,o-O.top-O.bottom-Math.abs(X[1])*2];Th(xi[0]>0&&xi[1]>0);var Ji=xi[0]/Nn[0],ga=xi[1]/Nn[1],hi=(O.right-O.left)/2/Ji,wa=(O.bottom-O.top)/2/ga,co=[(ni[0]+Ln[0])/2+hi,(ni[1]+Ln[1])/2+wa],ju=xn.unproject(co),sp=xn.zoom+Math.log2(Math.abs(Math.min(Ji,ga)));return{longitude:ju[0],latitude:ju[1],zoom:Math.min(sp,C)}}var am=function(n){(0,we.Z)(c,n);function c(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,p=s.height,y=s.latitude,C=y===void 0?0:y,P=s.longitude,O=P===void 0?0:P,J=s.zoom,X=J===void 0?0:J,le=s.pitch,Re=le===void 0?0:le,ot=s.bearing,It=ot===void 0?0:ot,vr=s.altitude,br=vr===void 0?1.5:vr,Zr=s.nearZMultiplier,cn=s.farZMultiplier;(0,W.Z)(this,c),l=l||1,p=p||1;var xn=tm(X);br=Math.max(.75,br);var Ln=wd([O,C],xn);Ln[2]=0;var ni=Rg({width:l,height:p,pitch:Re,bearing:It,altitude:br,nearZMultiplier:Zr||1/p,farZMultiplier:cn||1.01}),Nn=Og({height:p,center:Ln,pitch:Re,bearing:It,altitude:br,flipY:!0});return o=(0,Be.Z)(this,(0,We.Z)(c).call(this,{width:l,height:p,viewMatrix:Nn,projectionMatrix:ni})),o.latitude=C,o.longitude=O,o.zoom=X,o.pitch=Re,o.bearing=It,o.altitude=br,o.scale=xn,o.center=Ln,o.pixelsPerMeter=rm((0,k.Z)((0,k.Z)(o))).pixelsPerMeter[2],Object.freeze((0,k.Z)((0,k.Z)(o))),o}return(0,$.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return wd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Hd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,p=s.pos,y=nm(p,this.pixelUnprojectionMatrix),C=wd(l,this.scale),P=qn.add([],C,qn.negate([],y)),O=qn.add([],this.center,P);return Hd(O,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,p=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:p})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=this.width,y=this.height,C=Fg(Object.assign({width:p,height:y,bounds:s},l)),P=C.longitude,O=C.latitude,J=C.zoom;return new c({width:p,height:y,longitude:P,latitude:O,zoom:J})}}]),c}(kg),Bg=function(){function n(){(0,W.Z)(this,n),(0,I.Z)(this,"viewport",void 0)}return(0,$.Z)(n,[{key:"syncWithMapCamera",value:function(o){var s=o.center,l=o.zoom,p=o.pitch,y=o.bearing,C=o.viewportHeight,P=o.viewportWidth;this.viewport=new am({width:P,height:C,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:p,bearing:y})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),n}(),om={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},sm,um,lm,cm,fm,hm,pm,Ah,dm,vm,mm,gm,ym;function _m(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Ng(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?_m(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):_m(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}x(68982)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Pg();var xm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},zg=0,Zg=12,bm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Ug=(sm=(0,H.b2)(),um=(0,H.f3)(b.vK.MapConfig),lm=(0,H.f3)(b.vK.IGlobalConfigService),cm=(0,H.f3)(b.vK.ILogService),fm=(0,H.f3)(b.vK.ICoordinateSystemService),hm=(0,H.f3)(b.vK.IEventEmitter),sm(pm=(Ah=function(){function n(){var c=this;(0,W.Z)(this,n),(0,I.Z)(this,"version",jd.MAPBOX),(0,I.Z)(this,"map",void 0),(0,Wn.Z)(this,"config",dm,this),(0,Wn.Z)(this,"configService",vm,this),(0,Wn.Z)(this,"logger",mm,this),(0,Wn.Z)(this,"coordinateSystemService",gm,this),(0,Wn.Z)(this,"eventEmitter",ym,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var o=c.map.getCenter().wrap(),s=o.lat,l=o.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var p=c.config.offsetZoom,y=p===void 0?Zg:p;c.viewport.getZoom()>y?c.coordinateSystemService.setCoordinateSystem(b.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(b.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,$.Z)(n,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=$e.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){b.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on(xm[o]||o,s)}},{key:"off",value:function(o,s){this.map.off(xm[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),p=l.x,y=p===void 0?0:p,C=l.y,P=C===void 0?0:C,O=l.z,J=O===void 0?0:O;return{x:y,y:P,z:J}}},{key:"getModelMatrix",value:function(o,s,l){var p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},C=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),P=C.meterInMercatorCoordinateUnits(),O=Fa.create();return Fa.translate(O,O,Ui.fromValues(C.x-y.x,C.y-y.y,C.z||0-y.z)),Fa.scale(O,O,Ui.fromValues(P*p[0],-P*p[1],P*p[2])),Fa.rotateX(O,O,l[0]),Fa.rotateY(O,O,l[1]),Fa.rotateZ(O,O,l[2]),O}},{key:"init",value:function(){var c=(0,qe.Z)(Ct().mark(function s(){var l,p,y,C,P,O,J,X,le,Re,ot,It,vr;return Ct().wrap(function(Zr){for(;;)switch(Zr.prev=Zr.next){case 0:l=this.config,p=l.id,y=p===void 0?"map":p,C=l.attributionControl,P=C===void 0?!1:C,O=l.style,J=O===void 0?"light":O,X=l.token,le=X===void 0?bm:X,Re=l.rotation,ot=Re===void 0?0:Re,It=l.mapInstance,vr=(0,za.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new Bg,!It&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),le===bm&&J!=="blank"&&!window.mapboxgl.accessToken&&!It&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!It&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=le),It?(this.map=It,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(Ng({container:this.$mapContainer,style:this.getMapStyle(J),attributionControl:P,bearing:ot},vr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Zr.stop()}},s,this)}));function o(){return c.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),y=1;y<l;y++)p[y-1]=arguments[y];(s=this.eventEmitter).emit.apply(s,[o].concat(p))}},{key:"once",value:function(o){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),y=1;y<l;y++)p[y-1]=arguments[y];(s=this.eventEmitter).once.apply(s,[o].concat(p))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+zg++,s.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:om[o]?om[o]:o}}]),n}(),dm=(0,ai.Z)(Ah.prototype,"config",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=(0,ai.Z)(Ah.prototype,"configService",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm=(0,ai.Z)(Ah.prototype,"logger",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=(0,ai.Z)(Ah.prototype,"coordinateSystemService",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym=(0,ai.Z)(Ah.prototype,"eventEmitter",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah))||pm);function jg(n){var c=Vg();return function(){var s=(0,We.Z)(n),l;if(c){var p=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Vg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}x(68982)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Gg=function(n){(0,we.Z)(o,n);var c=jg(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getServiceConstructor",value:function(){return Ug}}]),o}(Tg);function Sm(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Em(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Sm(Object(o),!0).forEach(function(s){Hg(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Sm(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Hg(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function Wg(n,c){return $g(n)||Kg(n,c)||Yg(n,c)||Xg()}function Xg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yg(n,c){if(!!n){if(typeof n=="string")return wm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return wm(n,c)}}function wm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function Kg(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function $g(n){if(Array.isArray(n))return n}var Jg=Q.memo(function(n){var c=n.style,o=n.className,s=n.map,l=n.option,p=n.onSceneLoaded,y=(0,Q.createRef)(),C=(0,Q.useState)(),P=Wg(C,2),O=P[0],J=P[1];return(0,Q.useEffect)(function(){var X=new ki(Em(Em({id:y.current},l),{},{map:new Gg(s)}));return X.on("loaded",function(){J(X),p&&p(X)}),function(){X.destroy()}},[]),(0,Q.useEffect)(function(){O&&s.style&&O.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,Q.useEffect)(function(){O&&s.zoom&&O.setZoom(s.zoom)},[s.zoom]),(0,Q.useEffect)(function(){O&&s.center&&O.setCenter(s.center)},[JSON.stringify(s.center)]),(0,Q.useEffect)(function(){O&&s.pitch!==void 0&&O.setPitch(s.pitch||0)},[s.pitch]),(0,Q.useEffect)(function(){O&&s.rotation&&O.setRotation(s.rotation)},[s.rotation]),Q.createElement(w.Provider,{value:O},(0,Q.createElement)("div",{ref:y,style:c,className:o},O&&n.children))}),Qg=Jg;function Cm(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function F0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Cm(Object(o),!0).forEach(function(s){qg(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Cm(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function qg(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function B0(n,c){return ny(n)||ry(n,c)||ty(n,c)||ey()}function ey(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ty(n,c){if(!!n){if(typeof n=="string")return Tm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Tm(n,c)}}function Tm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function ry(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function ny(n){if(Array.isArray(n))return n}var N0=null,z0=null;function Am(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Z0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Am(Object(o),!0).forEach(function(s){iy(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Am(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function iy(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function U0(n,c){return uy(n)||sy(n,c)||oy(n,c)||ay()}function ay(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oy(n,c){if(!!n){if(typeof n=="string")return Pm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Pm(n,c)}}function Pm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function sy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function uy(n){if(Array.isArray(n))return n}var j0=null,V0=null;function G0(n,c){return hy(n)||fy(n,c)||cy(n,c)||ly()}function ly(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cy(n,c){if(!!n){if(typeof n=="string")return Mm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Mm(n,c)}}function Mm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function fy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function hy(n){if(Array.isArray(n))return n}var H0=null,W0=null;function Im(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function X0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Im(Object(o),!0).forEach(function(s){py(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Im(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function py(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function Y0(n,c){if(n==null)return{};var o=dy(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(o[s]=n[s]))}return o}function dy(n,c){if(n==null)return{};var o={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(o[l]=n[l]);return o}var K0=null,Om=x(73935);function vy(n,c){return _y(n)||yy(n,c)||gy(n,c)||my()}function my(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gy(n,c){if(!!n){if(typeof n=="string")return Lm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Lm(n,c)}}function Lm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function yy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function _y(n){if(Array.isArray(n))return n}var xy=Q.useEffect,by=Q.useState;function $0(n){var c=n.className,o=n.style,s=n.children,l=n.position,p=useSceneValue(),y=by(function(){return document.createElement("div")}),C=vy(y,1),P=C[0];return xy(function(){var O=new Control({position:l});return O.onAdd=function(){if(c&&(P.className=c),o){var J=Object.keys(o).map(function(X){return"".concat(X,":").concat(o[X])}).join(";");P.style.cssText=J}return P},p.addControl(O),function(){p.removeControl(O)}},[]),createPortal(s,P)}var Rm=(0,Q.createContext)({});function J0(){return useContext(Rm)}var Sy=Q.useEffect,Ey=Q.memo(function(c){var o=c.layer,s=c.active;return Sy(function(){o.active(s.option)},[JSON.stringify(s)]),null}),wy=Q.useEffect,Cy=Q.memo(function(c){var o=c.layer,s=c.animate;return wy(function(){o.animate(s)},[JSON.stringify(s)]),null}),Ty=Q.useEffect,Ay=Q.memo(function(c){var o=c.layer,s=c.color;return Ty(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Py=Q.useEffect,My=Q.memo(function(c){var o=c.layer,s=c.filter;return Py(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Iy=Q.useEffect,Oy=Q.memo(function(c){var o=c.layer,s=c.scale;return Iy(function(){o.scale(s.values)},[s.values]),null}),Ly=Q.useEffect,Ry=Q.memo(function(c){var o=c.layer,s=c.select;return Ly(function(){o.select(s.option)},[JSON.stringify(s)]),null}),Dy=Q.useEffect,ky=Q.memo(function(c){var o=c.layer,s=c.shape;return Dy(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Fy=Q.useEffect,By=Q.memo(function(c){var o=c.layer,s=c.size;return Fy(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ny=["data"];function zy(n,c){if(n==null)return{};var o=Zy(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(o[s]=n[s]))}return o}function Zy(n,c){if(n==null)return{};var o={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(o[l]=n[l]);return o}var Uy=Q.useEffect,jy=Q.memo(function(c){var o=c.layer,s=c.source,l=s.data,p=zy(s,Ny);return Uy(function(){o.inited?o.setData(l,p):o.source(l,p),p.autoFit&&o.fitBounds(p&&p.fitBoundsOptions)},[l,JSON.stringify(p)]),null}),Vy=Q.useEffect,Gy=Q.memo(function(c){var o=c.layer,s=c.style;return Vy(function(){o.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Hy(n,c){return Ky(n)||Yy(n,c)||Xy(n,c)||Wy()}function Wy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xy(n,c){if(!!n){if(typeof n=="string")return Dm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Dm(n,c)}}function Dm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function Yy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,p=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){p=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(p)throw C}}return s}}function Ky(n){if(Array.isArray(n))return n}var Up=Q.useEffect,$y=Q.useState;function km(n,c){var o=c.source,s=c.color,l=c.shape,p=c.style,y=c.size,C=c.scale,P=c.active,O=c.select,J=c.filter,X=c.animate,le=c.options,Re=c.onLayerLoaded,ot=d(),It=$y(function(){var Zr;switch(n){case"polygonLayer":Zr=new ds(le);break;case"lineLayer":Zr=new hu(le);break;case"pointLayer":Zr=new Qi(le);break;case"heatmapLayer":Zr=new wn(le);break;case"rasterLayer":Zr=new Vl(le);break;case"imageLayer":Zr=new Ju(le);break;case"citybuildingLayer":Zr=new Dl(le);break;default:Zr=new ds(le)}return Zr.on("inited",function(){Re&&Re(Zr,ot)}),Zr}),vr=Hy(It,1),br=vr[0];return Up(function(){return ot.addLayer(br),function(){ot.removeLayer(br)}},[]),Up(function(){br.inited&&le&&br.updateLayerConfig(le)},[le==null?void 0:le.minZoom,le==null?void 0:le.maxZoom,le==null?void 0:le.visible]),Up(function(){br.inited&&(le==null?void 0:le.zIndex)&&br.setIndex(le.zIndex)},[le==null?void 0:le.zIndex]),Up(function(){br.inited&&(le==null?void 0:le.blend)&&br.setBlend(le.blend)},[le==null?void 0:le.blend]),Up(function(){ot.render()}),Q.createElement(Rm.Provider,{value:br},Q.createElement(jy,{layer:br,source:o}),C&&Q.createElement(Oy,{layer:br,scale:C}),s&&Q.createElement(Ay,{layer:br,color:s}),y&&Q.createElement(By,{layer:br,size:y}),l&&Q.createElement(ky,{layer:br,shape:l}),p&&Q.createElement(Gy,{layer:br,style:p}),P&&Q.createElement(Ey,{layer:br,active:P}),O&&Q.createElement(Ry,{layer:br,select:O}),J&&Q.createElement(My,{layer:br,filter:J}),X&&Q.createElement(Cy,{layer:br,animate:X}),c.children)}var Q0=null,q0=null,Jy=Q.memo(function(c){return km("pointLayer",c)}),Qy=Q.memo(function(c){return km("heatmapLayer",c)}),e1=null,t1=null,r1=null,n1=Q.useEffect,i1=null,a1=null;function Cd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cd=function(o){return typeof o}:Cd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Cd(n)}function Fm(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Td(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Fm(Object(o),!0).forEach(function(s){qy(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Fm(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function qy(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function e0(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Bm(n,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function t0(n,c,o){return c&&Bm(n.prototype,c),o&&Bm(n,o),n}function r0(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Wd(n,c)}function Wd(n,c){return Wd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Wd(n,c)}function n0(n){var c=o0();return function(){var s=Ad(n),l;if(c){var p=Ad(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return i0(this,l)}}function i0(n,c){return c&&(Cd(c)==="object"||typeof c=="function")?c:a0(n)}function a0(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function o0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Ad(n){return Ad=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Ad(n)}var o1=function(n){r0(o,n);var c=n0(o);function o(s){var l;return e0(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return t0(o,[{key:"componentDidMount",value:function(){var l,p=this.props,y=p.lnglat,C=p.children,P=p.option,O=p.lngLat,J=new Ze(Td(Td({},P),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));y&&J.setLnglat(y),O&&J.setLnglat(O),C&&J.setDOMContent(this.el),this.popup=J,this.scene.addPopup(J)}},{key:"componentDidUpdate",value:function(l){var p,y,C,P,O,J,X=Array.isArray(l.lnglat)?l.lnglat:[l==null||(p=l.lnglat)===null||p===void 0?void 0:p.lng,l==null||(y=l.lnglat)===null||y===void 0?void 0:y.lat],le=Array.isArray(this.props.lnglat)?this.props.lnglat:[(C=this.props)===null||C===void 0||(P=C.lnglat)===null||P===void 0?void 0:P.lng,(O=this.props)===null||O===void 0||(J=O.lnglat)===null||J===void 0?void 0:J.lat],Re=X.toString()!==le.toString();if(Re){var ot;this.popup.remove(),this.popup=new Ze(Td(Td({},this.props.option),{},{stopPropagation:(ot=this.props.option)===null||ot===void 0?void 0:ot.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return Q.createElement(w.Consumer,{},function(p){return p&&(l.scene=p),(0,Om.createPortal)(l.props.children,l.el)})}}]),o}(Q.PureComponent);function Pd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Pd=function(o){return typeof o}:Pd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Pd(n)}function s0(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Nm(n,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function u0(n,c,o){return c&&Nm(n.prototype,c),o&&Nm(n,o),n}function l0(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Xd(n,c)}function Xd(n,c){return Xd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Xd(n,c)}function c0(n){var c=p0();return function(){var s=Md(n),l;if(c){var p=Md(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return f0(this,l)}}function f0(n,c){return c&&(Pd(c)==="object"||typeof c=="function")?c:h0(n)}function h0(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function p0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Md(n){return Md=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Md(n)}var s1=function(n){l0(o,n);var c=c0(o);function o(s){var l;return s0(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return u0(o,[{key:"componentDidMount",value:function(){var l=this.props,p=l.lnglat,y=l.children,C=l.option,P=l.onMarkerLoaded,O=new Jt(C);p&&O.setLnglat(p),y&&O.setElement(this.el),this.marker=O,P&&P(O),this.scene.addMarker(O)}},{key:"componentDidUpdate",value:function(l){var p,y=(l==null?void 0:l.lnglat.toString())!==((p=this.props)===null||p===void 0?void 0:p.lnglat.toString());y&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return Q.createElement(w.Consumer,{},function(p){return p&&(l.scene=p),(0,Om.createPortal)(l.props.children,l.el)})}}]),o}(Q.PureComponent),u1=Q.useEffect,l1=null,c1=null,f1=Q.useEffect,h1=null},4771:function(){},6901:function(sr,L,x){"use strict";x.d(L,{SO:function(){return Q},z6:function(){return yt},a5:function(){return w},Z:function(){return Kt},rQ:function(){return vn},bV:function(){return pr},zi:function(){return Pn},ds:function(){return Je},Ev:function(){return ht},oO:function(){return Pr},W0:function(){return lt},Z6:function(){return Rt},We:function(){return Dt},Cl:function(){return Qt},gJ:function(){return ke},vP:function(){return Ze},yM:function(){return hr},yA:function(){return Tr},CI:function(){return $r}});var Q={};x.r(Q),x.d(Q,{DPR:function(){return Ke},addClass:function(){return $e},create:function(){return Be},empty:function(){return bt},getClass:function(){return Lt},getContainer:function(){return $},getViewPortScale:function(){return xt},hasClass:function(){return Yt},printCanvas:function(){return nr},remove:function(){return We},removeClass:function(){return Ut},setClass:function(){return kt},setTransform:function(){return Ir},splitWords:function(){return k},triggerResize:function(){return er},trim:function(){return I}});var w={};x.r(w),x.d(w,{getColumn:function(){return ie},getSatByColumn:function(){return ce},max:function(){return bi},mean:function(){return ia},min:function(){return Si},mode:function(){return pi},statMap:function(){return G},sum:function(){return Ri}});function d(B){var re=131,fe=137,Se=0;B+="x";for(var te=Math.floor(9007199254740991/fe),me=0;me<B.length;me++)Se>te&&(Se=Math.floor(Se/fe)),Se=Se*re+B.charCodeAt(me);return Se}function b(B){B=B.toString();for(var re=5381,fe=B.length;fe;)re=re*33^B.charCodeAt(--fe);return re>>>0}var Y=x(28481),W=window.document.documentElement.style;function $(B){var re=B;return typeof B=="string"&&(re=document.getElementById(B)),re}function I(B){return B.trim?B.trim():B.replace(/^\s+|\s+$/g,"")}function k(B){return I(B).split(/\s+/)}function we(B){if(!W)return B[0];for(var re in B)if(B[re]&&B[re]in W)return B[re];return B[0]}function Be(B,re,fe){var Se=document.createElement(B);return Se.className=re||"",fe&&fe.appendChild(Se),Se}function We(B){var re=B.parentNode;re&&re.removeChild(B)}function $e(B,re){if(B.classList!==void 0)for(var fe=k(re),Se=0,te=fe.length;Se<te;Se++)B.classList.add(fe[Se]);else if(!Yt(B,re)){var me=Lt(B);kt(B,(me?me+" ":"")+re)}}function Ut(B,re){B.classList!==void 0?B.classList.remove(re):kt(B,I((" "+Lt(B)+" ").replace(" "+re+" "," ")))}function Yt(B,re){if(B.classList!==void 0)return B.classList.contains(re);var fe=Lt(B);return fe.length>0&&new RegExp("(^|\\s)"+re+"(\\s|$)").test(fe)}function kt(B,re){B instanceof HTMLElement?B.className=re:B.className.baseVal=re}function Lt(B){return B instanceof SVGElement&&(B=B.correspondingElement),B.className.baseVal===void 0?B.className:B.className.baseVal}function bt(B){for(;B&&B.firstChild;)B.removeChild(B.firstChild)}var pt=we(["transform","WebkitTransform"]);function Ir(B,re){B.style[pt]=re}function er(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var B=window.document.createEvent("UIEvents");B.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(B)}}function nr(B){var re=["padding: "+(B.height/2-8)+"px "+B.width/2+"px;","line-height: "+B.height+"px;","background-image: url("+B.toDataURL()+");"];console.log(`%c
`,re.join(""))}function xt(){var B,re=document.querySelector('meta[name="viewport"]');if(!re)return 1;var fe=(B=re.content)===null||B===void 0?void 0:B.split(","),Se=fe.find(function(te){var me=te.split("="),ct=(0,Y.Z)(me,2),yr=ct[0],Or=ct[1];return yr==="initial-scale"});return Se?Se.split("=")[1]*1:1}var Ke=xt()<1?1:window.devicePixelRatio,_t=x(6610),Fe=x(5991),Pe=x(63349),Ve=x(10379),Et=x(46070),gr=x(77608),ae=x(14665);function Ae(B){return Function.toString.call(B).indexOf("[native code]")!==-1}var oe=x(51814);function ge(B,re,fe){return(0,oe.Z)()?ge=Reflect.construct:ge=function(te,me,ct){var yr=[null];yr.push.apply(yr,me);var Or=Function.bind.apply(te,yr),Ft=new Or;return ct&&(0,ae.Z)(Ft,ct.prototype),Ft},ge.apply(null,arguments)}function Me(B){var re=typeof Map=="function"?new Map:void 0;return Me=function(Se){if(Se===null||!Ae(Se))return Se;if(typeof Se!="function")throw new TypeError("Super expression must either be null or a function");if(typeof re!="undefined"){if(re.has(Se))return re.get(Se);re.set(Se,te)}function te(){return ge(Se,arguments,(0,gr.Z)(this).constructor)}return te.prototype=Object.create(Se.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),(0,ae.Z)(te,Se)},Me(B)}var Qe=x(96156);function gt(B){var re=Jt();return function(){var Se=(0,gr.Z)(B),te;if(re){var me=(0,gr.Z)(this).constructor;te=Reflect.construct(Se,arguments,me)}else te=Se.apply(this,arguments);return(0,Et.Z)(this,te)}}function Jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Dr=function(B){(0,Ve.Z)(fe,B);var re=gt(fe);function fe(Se,te,me){var ct;return(0,_t.Z)(this,fe),ct=re.call(this,Se),(0,Qe.Z)((0,Pe.Z)(ct),"status",void 0),(0,Qe.Z)((0,Pe.Z)(ct),"url",void 0),ct.status=te,ct.url=me,ct.name=ct.constructor.name,ct.message=Se,ct}return(0,Fe.Z)(fe,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),fe}(Me(Error));function Br(B){var re=new XMLHttpRequest;re.open("GET",B.url,!0);for(var fe in B.headers)B.headers.hasOwnProperty(fe)&&re.setRequestHeader(fe,B.headers[fe]);return re.withCredentials=B.credentials==="include",re}var un=function(re,fe){var Se=Br(re);return Se.setRequestHeader("Accept","application/json"),Se.onerror=function(){fe(new Error(Se.statusText))},Se.onload=function(){if(Se.status>=200&&Se.status<300&&Se.response){var te;try{te=JSON.parse(Se.response)}catch(me){return fe(me)}fe(null,te)}else Se.status===401?fe(new Dr("".concat(Se.statusText),Se.status,re.url)):fe(new Dr(Se.statusText,Se.status,re.url))},Se.send(),Se},tr=function(re,fe){var Se=Br(re);return Se.responseType="arraybuffer",Se.onerror=function(){fe(new Error(Se.statusText))},Se.onload=function(){var te=Se.response;if(te.byteLength===0&&Se.status===200)return fe(new Error("http status 200 returned without content."));Se.status>=200&&Se.status<300&&Se.response?fe(null,{data:te,cacheControl:Se.getResponseHeader("Cache-Control"),expires:Se.getResponseHeader("Expires")}):fe(new Dr(Se.statusText,Se.status,re.url))},Se.send(),Se};function se(B){var re=window.document.createElement("a");return re.href=B,re.protocol===window.document.location.protocol&&re.host===window.document.location.host}var be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",ke=function(re,fe){return tr(re,function(Se,te){if(Se)fe(Se);else if(te){var me=new window.Image;me.crossOrigin="anonymous";var ct=window.URL||window.webkitURL;me.onload=function(){fe(null,me),ct.revokeObjectURL(me.src)};var yr=new window.Blob([new Uint8Array(te.data)],{type:"image/png"});me.src=te.data.byteLength?ct.createObjectURL(yr):be}})},Ce=x(40271),Pt=2*Math.PI*6378137/2;function Dt(B){var re=[Infinity,Infinity,-Infinity,-Infinity];return B.forEach(function(fe){var Se=fe.coordinates;E(re,Se)}),re}function E(B,re){return Array.isArray(re[0])?re.forEach(function(fe){E(B,fe)}):(B[0]>re[0]&&(B[0]=re[0]),B[1]>re[1]&&(B[1]=re[1]),B[2]<re[0]&&(B[2]=re[0]),B[3]<re[1]&&(B[3]=re[1])),B}function N(B,re){return he(B,re)}function he(B,re){return Array.isArray(B[0])?B.map(function(fe){return he(fe,re)}):re(B)}function Ze(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};B=H(B,re);var Se=B[0],te=B[1],me=Se*Pt/180,ct=Math.log(Math.tan((90+te)*Math.PI/360))/(Math.PI/180);return ct=ct*Pt/180,fe.enable&&(me=Number(me.toFixed(fe.decimal)),ct=Number(ct.toFixed(fe.decimal))),B.length===3?[me,ct,B[2]]:[me,ct]}function qe(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,fe=B[0],Se=B[1],te=fe/Pt*180,me=Se/Pt*180;return me=180/Math.PI*(2*Math.atan(Math.exp(me*Math.PI/180))-Math.PI/2),re!=null&&(te=Number(te.toFixed(re)),me=Number(me.toFixed(re))),B.length===3?[te,me,B[2]]:[te,me]}function mt(B){if(B==null)throw new Error("lng is required");return(B>180||B<-180)&&(B=B%360,B>180&&(B=-360+B),B<-180&&(B=360+B),B===0&&(B=0)),B}function Ct(B){if(B==null)throw new Error("lat is required");return(B>90||B<-90)&&(B=B%180,B>90&&(B=-180+B),B<-90&&(B=180+B),B===0&&(B=0)),B}function H(B,re){if(re===!1)return B;var fe=mt(B[0]),Se=Ct(B[1]);return Se>85&&(Se=85),Se<-85&&(Se=-85),B.length===3?[fe,Se,B[2]]:[fe,Se]}function Kt(B){var re=85.0511287798,fe=Math.max(Math.min(re,B[1]),-re),Se=256<<20,te=Math.PI/180,me=B[0]*te,ct=fe*te;ct=Math.log(Math.tan(Math.PI/4+ct/2));var yr=.5/Math.PI,Or=.5,Ft=-.5/Math.PI;return te=.5,me=Se*(yr*me+Or),ct=Se*(Ft*ct+te),[Math.floor(me),Math.floor(ct)]}function jt(B){var re=.5/Math.PI,fe=.5,Se=-.5/Math.PI,te=.5,me=256<<20,ct=_slicedToArray(B,2),yr=ct[0],Or=ct[1];yr=(yr/me-fe)/re,Or=(Or/me-te)/Se,Or=(Math.atan(Math.pow(Math.E,Or))-Math.PI/4)*2,te=Math.PI/180;var Ft=Or/te,kr=yr/te;return[kr,Ft]}function hr(B,re,fe){var Se=(0,Ce.Ht)(re[1]-B[1]),te=(0,Ce.Ht)(re[0]-B[0]),me=(0,Ce.Ht)(B[1]),ct=(0,Ce.Ht)(re[1]),yr=Math.pow(Math.sin(Se/2),2)+Math.pow(Math.sin(te/2),2)*Math.cos(me)*Math.cos(ct);return(0,Ce.DL)(2*Math.atan2(Math.sqrt(yr),Math.sqrt(1-yr)),fe="meters")}function Cr(B){var re=Math.PI/180,fe=85.0511287798,Se=6378137,te=Math.max(Math.min(fe,B[1]),-fe),me=Math.sin(te*re),ct=Se*B[0]*re,yr=Se*Math.log((1+me)/(1-me))/2;return[ct,yr]}function Tr(B,re){var fe=Math.abs(B[1][1]-B[0][1])*re,Se=Math.abs(B[1][0]-B[0][0])*re;return[[B[0][0]-Se,B[0][1]-fe],[B[1][0]+Se,B[1][1]+fe]]}function Pr(B,re){return B[0][0]<=re[0][0]&&B[0][1]<=re[0][1]&&B[1][0]>=re[1][0]&&B[1][1]>=re[1][1]}function Je(B){return[[B[0],B[1]],[B[2],B[3]]]}var yt=function(){function B(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,fe=arguments.length>1?arguments[1]:void 0;(0,_t.Z)(this,B),(0,Qe.Z)(this,"limit",void 0),(0,Qe.Z)(this,"cache",void 0),(0,Qe.Z)(this,"destroy",void 0),(0,Qe.Z)(this,"order",void 0),this.limit=re,this.destroy=fe||this.defaultDestroy,this.order=[],this.clear()}return(0,Fe.Z)(B,[{key:"clear",value:function(){var fe=this;this.order.forEach(function(Se){fe.delete(Se)}),this.cache={},this.order=[]}},{key:"get",value:function(fe){var Se=this.cache[fe];return Se&&(this.deleteOrder(fe),this.appendOrder(fe)),Se}},{key:"set",value:function(fe,Se){this.cache[fe]?(this.delete(fe),this.cache[fe]=Se,this.appendOrder(fe)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[fe]=Se,this.appendOrder(fe))}},{key:"delete",value:function(fe){var Se=this.cache[fe];Se&&(this.deleteCache(fe),this.deleteOrder(fe),this.destroy(Se,fe))}},{key:"deleteCache",value:function(fe){delete this.cache[fe]}},{key:"deleteOrder",value:function(fe){var Se=this.order.findIndex(function(te){return te===fe});Se>=0&&this.order.splice(Se,1)}},{key:"appendOrder",value:function(fe){this.order.push(fe)}},{key:"defaultDestroy",value:function(fe,Se){return null}}]),B}();function ht(B,re){B.forEach(function(fe){!re[fe]||(re[fe]=re[fe].bind(re))})}var fr=x(2650);function $r(B){var re=fr.ZP(B),fe=[0,0,0,0];return re!=null&&(fe[0]=re.r/255,fe[1]=re.g/255,fe[2]=re.b/255,fe[3]=re.opacity),fe}function lt(B){var re=B&&B[0],fe=B&&B[1],Se=B&&B[2],te=re+fe*256+Se*65536-1;return te}function Rt(B){return[B+1&255,B+1>>8&255,B+1>>8>>8&255]}function Qt(B){var re=document.createElement("canvas"),fe=re.getContext("2d");re.width=256,re.height=1;for(var Se=fe.createLinearGradient(0,0,256,1),te=null,me=B.positions[0],ct=B.positions[B.positions.length-1],yr=0;yr<B.colors.length;++yr){var Or=(B.positions[yr]-me)/(ct-me);Se.addColorStop(Or,B.colors[yr])}return fe.fillStyle=Se,fe.fillRect(0,0,256,1),te=new Uint8ClampedArray(fe.getImageData(0,0,256,1).data),new ImageData(te,256,1)}var pr;(function(B){B.CENTER="center",B.TOP="top",B["TOP-LEFT"]="top-left",B["TOP-RIGHT"]="top-right",B.BOTTOM="bottom",B["BOTTOM-LEFT"]="bottom-left",B.LEFT="left",B.RIGHT="right"})(pr||(pr={}));var vn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pn(B,re,fe){var Se=B.classList;for(var te in vn)vn.hasOwnProperty(te)&&Se.remove("l7-".concat(fe,"-anchor-").concat(te));Se.add("l7-".concat(fe,"-anchor-").concat(re))}function bi(B){if(B.length===0)throw new Error("max requires at least one data point");for(var re=B[0],fe=1;fe<B.length;fe++)B[fe]>re&&(re=B[fe]);return re*1}function Si(B){if(B.length===0)throw new Error("min requires at least one data point");for(var re=B[0],fe=1;fe<B.length;fe++)B[fe]<re&&(re=B[fe]);return re*1}function Ri(B){if(B.length===0)return 0;for(var re=B[0]*1,fe=1;fe<B.length;fe++)re+=B[fe]*1;return re}function ia(B){if(B.length===0)throw new Error("mean requires at least one data point");return Ri(B)/B.length}function pi(B){if(B.length===0)throw new Error("mean requires at least one data point");if(B.length<3)return B[0];B.sort();for(var re=B[0],fe=NaN,Se=0,te=1,me=1;me<B.length+1;me++)B[me]!==re?(te>Se&&(Se=te,fe=re),te=1,re=B[me]):te++;return fe*1}var G={min:Si,max:bi,mean:ia,sum:Ri,mode:pi};function ie(B,re){return B.map(function(fe){return fe[re]})}function ce(B,re){return G[B](re)}},3473:function(sr,L,x){"use strict";x.d(L,{Z:function(){return Q}});function Q(w,d,b,Y,W){var $={};return Object.keys(Y).forEach(function(I){$[I]=Y[I]}),$.enumerable=!!$.enumerable,$.configurable=!!$.configurable,("value"in $||$.initializer)&&($.writable=!0),$=b.slice().reverse().reduce(function(I,k){return k(w,d,I)||I},$),W&&$.initializer!==void 0&&($.value=$.initializer?$.initializer.call(W):void 0,$.initializer=void 0),$.initializer===void 0&&(Object.defineProperty(w,d,$),$=null),$}},66213:function(sr,L,x){"use strict";x.d(L,{Z:function(){return d}});var Q=x(77608);function w(b,Y){for(;!Object.prototype.hasOwnProperty.call(b,Y)&&(b=(0,Q.Z)(b),b!==null););return b}function d(b,Y,W){return typeof Reflect!="undefined"&&Reflect.get?d=Reflect.get:d=function(I,k,we){var Be=w(I,k);if(!!Be){var We=Object.getOwnPropertyDescriptor(Be,k);return We.get?We.get.call(we):We.value}},d(b,Y,W||b)}},55770:function(sr,L,x){"use strict";x.d(L,{Z:function(){return Q}});function Q(w,d,b,Y){!b||Object.defineProperty(w,d,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(Y):void 0})}},31795:function(sr,L,x){var Q=x(75752);sr.exports.geometry=w,sr.exports.ring=b;function w(W){var $=0,I;switch(W.type){case"Polygon":return d(W.coordinates);case"MultiPolygon":for(I=0;I<W.coordinates.length;I++)$+=d(W.coordinates[I]);return $;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(I=0;I<W.geometries.length;I++)$+=w(W.geometries[I]);return $}}function d(W){var $=0;if(W&&W.length>0){$+=Math.abs(b(W[0]));for(var I=1;I<W.length;I++)$-=Math.abs(b(W[I]))}return $}function b(W){var $,I,k,we,Be,We,$e,Ut=0,Yt=W.length;if(Yt>2){for($e=0;$e<Yt;$e++)$e===Yt-2?(we=Yt-2,Be=Yt-1,We=0):$e===Yt-1?(we=Yt-1,Be=0,We=1):(we=$e,Be=$e+1,We=$e+2),$=W[we],I=W[Be],k=W[We],Ut+=(Y(k[0])-Y($[0]))*Math.sin(Y(I[1]));Ut=Ut*Q.RADIUS*Q.RADIUS/2}return Ut}function Y(W){return W*Math.PI/180}},38163:function(sr,L,x){var Q=x(31795);sr.exports=w;function w(I,k){switch(I&&I.type||null){case"FeatureCollection":return I.features=I.features.map(d(w,k)),I;case"GeometryCollection":return I.geometries=I.geometries.map(d(w,k)),I;case"Feature":return I.geometry=w(I.geometry,k),I;case"Polygon":case"MultiPolygon":return b(I,k);default:return I}}function d(I,k){return function(we){return I(we,k)}}function b(I,k){return I.type==="Polygon"?I.coordinates=Y(I.coordinates,k):I.type==="MultiPolygon"&&(I.coordinates=I.coordinates.map(d(Y,k))),I}function Y(I,k){k=!!k,I[0]=W(I[0],k);for(var we=1;we<I.length;we++)I[we]=W(I[we],!k);return I}function W(I,k){return $(I)===k?I:I.reverse()}function $(I){return Q.ring(I)>=0}},49296:function(sr){"use strict";sr.exports=x,sr.exports.default=x;var L=1e20;function x(Y,W,$,I,k,we){this.fontSize=Y||24,this.buffer=W===void 0?3:W,this.cutoff=I||.25,this.fontFamily=k||"sans-serif",this.fontWeight=we||"normal",this.radius=$||8;var Be=this.size=this.fontSize+this.buffer*2,We=Be+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Be,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(We*We),this.gridInner=new Float64Array(We*We),this.f=new Float64Array(We),this.z=new Float64Array(We+1),this.v=new Uint16Array(We),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Be/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Q(Y,W,$,I,k,we,Be){we.fill(L,0,W*$),Be.fill(0,0,W*$);for(var We=(W-I)/2,$e=0;$e<k;$e++)for(var Ut=0;Ut<I;Ut++){var Yt=($e+We)*W+Ut+We,kt=Y.data[4*($e*I+Ut)+3]/255;if(kt===1)we[Yt]=0,Be[Yt]=L;else if(kt===0)we[Yt]=L,Be[Yt]=0;else{var Lt=Math.max(0,.5-kt),bt=Math.max(0,kt-.5);we[Yt]=Lt*Lt,Be[Yt]=bt*bt}}}function w(Y,W,$,I,k,we,Be){for(var We=0;We<W*$;We++){var $e=Math.sqrt(I[We])-Math.sqrt(k[We]);Y[We]=Math.round(255-255*($e/we+Be))}}x.prototype._draw=function(Y,W){var $=this.ctx.measureText(Y),I=$.width,k=2*this.buffer,we,Be,We,$e,Ut,Yt,kt,Lt;W&&this.useMetrics?(Ut=Math.floor($.actualBoundingBoxAscent),Lt=this.buffer+Math.ceil($.actualBoundingBoxAscent),Yt=this.buffer,kt=this.buffer,Be=Math.min(this.size,Math.ceil($.actualBoundingBoxRight-$.actualBoundingBoxLeft)),$e=Math.min(this.size-Yt,Math.ceil($.actualBoundingBoxAscent+$.actualBoundingBoxDescent)),we=Be+k,We=$e+k,this.ctx.textBaseline="alphabetic"):(we=Be=this.size,We=$e=this.size,Ut=19*this.fontSize/24,Yt=kt=0,Lt=this.middle,this.ctx.textBaseline="middle");var bt;Be&&$e&&(this.ctx.clearRect(kt,Yt,Be,$e),this.ctx.fillText(Y,this.buffer,Lt),bt=this.ctx.getImageData(kt,Yt,Be,$e));var pt=new Uint8ClampedArray(we*We);return Q(bt,we,We,Be,$e,this.gridOuter,this.gridInner),d(this.gridOuter,we,We,this.f,this.v,this.z),d(this.gridInner,we,We,this.f,this.v,this.z),w(pt,we,We,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:Be,height:$e,sdfWidth:we,sdfHeight:We,top:Ut,left:0,advance:I}}},x.prototype.draw=function(Y){return this._draw(Y,!1).data},x.prototype.drawWithMetrics=function(Y){return this._draw(Y,!0)};function d(Y,W,$,I,k,we){for(var Be=0;Be<W;Be++)b(Y,Be,W,$,I,k,we);for(var We=0;We<$;We++)b(Y,We*W,1,W,I,k,we)}function b(Y,W,$,I,k,we,Be){var We,$e,Ut,Yt;for(we[0]=0,Be[0]=-L,Be[1]=L,We=0;We<I;We++)k[We]=Y[W+We*$];for(We=1,$e=0,Ut=0;We<I;We++){do Yt=we[$e],Ut=(k[We]-k[Yt]+We*We-Yt*Yt)/(We-Yt)/2;while(Ut<=Be[$e]&&--$e>-1);$e++,we[$e]=We,Be[$e]=Ut,Be[$e+1]=L}for(We=0,$e=0;We<I;We++){for(;Be[$e+1]<We;)$e++;Yt=we[$e],Y[W+We*$]=k[Yt]+(We-Yt)*(We-Yt)}}},40271:function(sr,L,x){"use strict";x.d(L,{zL:function(){return Y},DL:function(){return pt},Ht:function(){return Ke}});var Q=63710088e-1,w={centimeters:Q*100,centimetres:Q*100,degrees:Q/111325,feet:Q*3.28084,inches:Q*39.37,kilometers:Q/1e3,kilometres:Q/1e3,meters:Q,metres:Q,miles:Q/1609.344,millimeters:Q*1e3,millimetres:Q*1e3,nauticalmiles:Q/1852,radians:1,yards:Q*1.0936},d={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Q,yards:1.0936133},b={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Y(ae,Ae,oe){oe===void 0&&(oe={});var ge={type:"Feature"};return(oe.id===0||oe.id)&&(ge.id=oe.id),oe.bbox&&(ge.bbox=oe.bbox),ge.properties=Ae||{},ge.geometry=ae,ge}function W(ae,Ae,oe){switch(oe===void 0&&(oe={}),ae){case"Point":return $(Ae).geometry;case"LineString":return Be(Ae).geometry;case"Polygon":return k(Ae).geometry;case"MultiPoint":return Yt(Ae).geometry;case"MultiLineString":return Ut(Ae).geometry;case"MultiPolygon":return kt(Ae).geometry;default:throw new Error(ae+" is invalid")}}function $(ae,Ae,oe){if(oe===void 0&&(oe={}),!ae)throw new Error("coordinates is required");if(!Array.isArray(ae))throw new Error("coordinates must be an Array");if(ae.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pe(ae[0])||!Pe(ae[1]))throw new Error("coordinates must contain numbers");var ge={type:"Point",coordinates:ae};return Y(ge,Ae,oe)}function I(ae,Ae,oe){return oe===void 0&&(oe={}),$e(ae.map(function(ge){return $(ge,Ae)}),oe)}function k(ae,Ae,oe){oe===void 0&&(oe={});for(var ge=0,Me=ae;ge<Me.length;ge++){var Qe=Me[ge];if(Qe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var gt=0;gt<Qe[Qe.length-1].length;gt++)if(Qe[Qe.length-1][gt]!==Qe[0][gt])throw new Error("First and last Position are not equivalent.")}var Jt={type:"Polygon",coordinates:ae};return Y(Jt,Ae,oe)}function we(ae,Ae,oe){return oe===void 0&&(oe={}),$e(ae.map(function(ge){return k(ge,Ae)}),oe)}function Be(ae,Ae,oe){if(oe===void 0&&(oe={}),ae.length<2)throw new Error("coordinates must be an array of two or more positions");var ge={type:"LineString",coordinates:ae};return Y(ge,Ae,oe)}function We(ae,Ae,oe){return oe===void 0&&(oe={}),$e(ae.map(function(ge){return Be(ge,Ae)}),oe)}function $e(ae,Ae){Ae===void 0&&(Ae={});var oe={type:"FeatureCollection"};return Ae.id&&(oe.id=Ae.id),Ae.bbox&&(oe.bbox=Ae.bbox),oe.features=ae,oe}function Ut(ae,Ae,oe){oe===void 0&&(oe={});var ge={type:"MultiLineString",coordinates:ae};return Y(ge,Ae,oe)}function Yt(ae,Ae,oe){oe===void 0&&(oe={});var ge={type:"MultiPoint",coordinates:ae};return Y(ge,Ae,oe)}function kt(ae,Ae,oe){oe===void 0&&(oe={});var ge={type:"MultiPolygon",coordinates:ae};return Y(ge,Ae,oe)}function Lt(ae,Ae,oe){oe===void 0&&(oe={});var ge={type:"GeometryCollection",geometries:ae};return Y(ge,Ae,oe)}function bt(ae,Ae){if(Ae===void 0&&(Ae=0),Ae&&!(Ae>=0))throw new Error("precision must be a positive number");var oe=Math.pow(10,Ae||0);return Math.round(ae*oe)/oe}function pt(ae,Ae){Ae===void 0&&(Ae="kilometers");var oe=w[Ae];if(!oe)throw new Error(Ae+" units is invalid");return ae*oe}function Ir(ae,Ae){Ae===void 0&&(Ae="kilometers");var oe=w[Ae];if(!oe)throw new Error(Ae+" units is invalid");return ae/oe}function er(ae,Ae){return xt(Ir(ae,Ae))}function nr(ae){var Ae=ae%360;return Ae<0&&(Ae+=360),Ae}function xt(ae){var Ae=ae%(2*Math.PI);return Ae*180/Math.PI}function Ke(ae){var Ae=ae%360;return Ae*Math.PI/180}function _t(ae,Ae,oe){if(Ae===void 0&&(Ae="kilometers"),oe===void 0&&(oe="kilometers"),!(ae>=0))throw new Error("length must be a positive number");return pt(Ir(ae,Ae),oe)}function Fe(ae,Ae,oe){if(Ae===void 0&&(Ae="meters"),oe===void 0&&(oe="kilometers"),!(ae>=0))throw new Error("area must be a positive number");var ge=b[Ae];if(!ge)throw new Error("invalid original units");var Me=b[oe];if(!Me)throw new Error("invalid final units");return ae/ge*Me}function Pe(ae){return!isNaN(ae)&&ae!==null&&!Array.isArray(ae)}function Ve(ae){return!!ae&&ae.constructor===Object}function Et(ae){if(!ae)throw new Error("bbox is required");if(!Array.isArray(ae))throw new Error("bbox must be an Array");if(ae.length!==4&&ae.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ae.forEach(function(Ae){if(!Pe(Ae))throw new Error("bbox must only contain numbers")})}function gr(ae){if(!ae)throw new Error("id is required");if(["string","number"].indexOf(typeof ae)===-1)throw new Error("id must be a number or a string")}},17781:function(){},48583:function(sr,L,x){"use strict";var Q=x(27418);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function w(Pe,Ve){if(Pe===Ve)return 0;for(var Et=Pe.length,gr=Ve.length,ae=0,Ae=Math.min(Et,gr);ae<Ae;++ae)if(Pe[ae]!==Ve[ae]){Et=Pe[ae],gr=Ve[ae];break}return Et<gr?-1:gr<Et?1:0}function d(Pe){return x.g.Buffer&&typeof x.g.Buffer.isBuffer=="function"?x.g.Buffer.isBuffer(Pe):!!(Pe!=null&&Pe._isBuffer)}var b=x(30069),Y=Object.prototype.hasOwnProperty,W=Array.prototype.slice,$=function(){return function(){}.name==="foo"}();function I(Pe){return Object.prototype.toString.call(Pe)}function k(Pe){return d(Pe)||typeof x.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Pe):Pe?!!(Pe instanceof DataView||Pe.buffer&&Pe.buffer instanceof ArrayBuffer):!1}var we=sr.exports=Lt,Be=/\s*function\s+([^\(\s]*)\s*/;function We(Pe){if(!!b.isFunction(Pe)){if($)return Pe.name;var Ve=Pe.toString(),Et=Ve.match(Be);return Et&&Et[1]}}we.AssertionError=function(Ve){this.name="AssertionError",this.actual=Ve.actual,this.expected=Ve.expected,this.operator=Ve.operator,Ve.message?(this.message=Ve.message,this.generatedMessage=!1):(this.message=Yt(this),this.generatedMessage=!0);var Et=Ve.stackStartFunction||kt;if(Error.captureStackTrace)Error.captureStackTrace(this,Et);else{var gr=new Error;if(gr.stack){var ae=gr.stack,Ae=We(Et),oe=ae.indexOf(`
`+Ae);if(oe>=0){var ge=ae.indexOf(`
`,oe+1);ae=ae.substring(ge+1)}this.stack=ae}}},b.inherits(we.AssertionError,Error);function $e(Pe,Ve){return typeof Pe=="string"?Pe.length<Ve?Pe:Pe.slice(0,Ve):Pe}function Ut(Pe){if($||!b.isFunction(Pe))return b.inspect(Pe);var Ve=We(Pe),Et=Ve?": "+Ve:"";return"[Function"+Et+"]"}function Yt(Pe){return $e(Ut(Pe.actual),128)+" "+Pe.operator+" "+$e(Ut(Pe.expected),128)}function kt(Pe,Ve,Et,gr,ae){throw new we.AssertionError({message:Et,actual:Pe,expected:Ve,operator:gr,stackStartFunction:ae})}we.fail=kt;function Lt(Pe,Ve){Pe||kt(Pe,!0,Ve,"==",we.ok)}we.ok=Lt,we.equal=function(Ve,Et,gr){Ve!=Et&&kt(Ve,Et,gr,"==",we.equal)},we.notEqual=function(Ve,Et,gr){Ve==Et&&kt(Ve,Et,gr,"!=",we.notEqual)},we.deepEqual=function(Ve,Et,gr){bt(Ve,Et,!1)||kt(Ve,Et,gr,"deepEqual",we.deepEqual)},we.deepStrictEqual=function(Ve,Et,gr){bt(Ve,Et,!0)||kt(Ve,Et,gr,"deepStrictEqual",we.deepStrictEqual)};function bt(Pe,Ve,Et,gr){if(Pe===Ve)return!0;if(d(Pe)&&d(Ve))return w(Pe,Ve)===0;if(b.isDate(Pe)&&b.isDate(Ve))return Pe.getTime()===Ve.getTime();if(b.isRegExp(Pe)&&b.isRegExp(Ve))return Pe.source===Ve.source&&Pe.global===Ve.global&&Pe.multiline===Ve.multiline&&Pe.lastIndex===Ve.lastIndex&&Pe.ignoreCase===Ve.ignoreCase;if((Pe===null||typeof Pe!="object")&&(Ve===null||typeof Ve!="object"))return Et?Pe===Ve:Pe==Ve;if(k(Pe)&&k(Ve)&&I(Pe)===I(Ve)&&!(Pe instanceof Float32Array||Pe instanceof Float64Array))return w(new Uint8Array(Pe.buffer),new Uint8Array(Ve.buffer))===0;if(d(Pe)!==d(Ve))return!1;gr=gr||{actual:[],expected:[]};var ae=gr.actual.indexOf(Pe);return ae!==-1&&ae===gr.expected.indexOf(Ve)?!0:(gr.actual.push(Pe),gr.expected.push(Ve),Ir(Pe,Ve,Et,gr))}function pt(Pe){return Object.prototype.toString.call(Pe)=="[object Arguments]"}function Ir(Pe,Ve,Et,gr){if(Pe==null||Ve===null||Ve===void 0)return!1;if(b.isPrimitive(Pe)||b.isPrimitive(Ve))return Pe===Ve;if(Et&&Object.getPrototypeOf(Pe)!==Object.getPrototypeOf(Ve))return!1;var ae=pt(Pe),Ae=pt(Ve);if(ae&&!Ae||!ae&&Ae)return!1;if(ae)return Pe=W.call(Pe),Ve=W.call(Ve),bt(Pe,Ve,Et);var oe=Fe(Pe),ge=Fe(Ve),Me,Qe;if(oe.length!==ge.length)return!1;for(oe.sort(),ge.sort(),Qe=oe.length-1;Qe>=0;Qe--)if(oe[Qe]!==ge[Qe])return!1;for(Qe=oe.length-1;Qe>=0;Qe--)if(Me=oe[Qe],!bt(Pe[Me],Ve[Me],Et,gr))return!1;return!0}we.notDeepEqual=function(Ve,Et,gr){bt(Ve,Et,!1)&&kt(Ve,Et,gr,"notDeepEqual",we.notDeepEqual)},we.notDeepStrictEqual=er;function er(Pe,Ve,Et){bt(Pe,Ve,!0)&&kt(Pe,Ve,Et,"notDeepStrictEqual",er)}we.strictEqual=function(Ve,Et,gr){Ve!==Et&&kt(Ve,Et,gr,"===",we.strictEqual)},we.notStrictEqual=function(Ve,Et,gr){Ve===Et&&kt(Ve,Et,gr,"!==",we.notStrictEqual)};function nr(Pe,Ve){if(!Pe||!Ve)return!1;if(Object.prototype.toString.call(Ve)=="[object RegExp]")return Ve.test(Pe);try{if(Pe instanceof Ve)return!0}catch(Et){}return Error.isPrototypeOf(Ve)?!1:Ve.call({},Pe)===!0}function xt(Pe){var Ve;try{Pe()}catch(Et){Ve=Et}return Ve}function Ke(Pe,Ve,Et,gr){var ae;if(typeof Ve!="function")throw new TypeError('"block" argument must be a function');typeof Et=="string"&&(gr=Et,Et=null),ae=xt(Ve),gr=(Et&&Et.name?" ("+Et.name+").":".")+(gr?" "+gr:"."),Pe&&!ae&&kt(ae,Et,"Missing expected exception"+gr);var Ae=typeof gr=="string",oe=!Pe&&b.isError(ae),ge=!Pe&&ae&&!Et;if((oe&&Ae&&nr(ae,Et)||ge)&&kt(ae,Et,"Got unwanted exception"+gr),Pe&&ae&&Et&&!nr(ae,Et)||!Pe&&ae)throw ae}we.throws=function(Pe,Ve,Et){Ke(!0,Pe,Ve,Et)},we.doesNotThrow=function(Pe,Ve,Et){Ke(!1,Pe,Ve,Et)},we.ifError=function(Pe){if(Pe)throw Pe};function _t(Pe,Ve){Pe||kt(Pe,!0,Ve,"==",_t)}we.strict=Q(_t,we,{equal:we.strictEqual,deepEqual:we.deepStrictEqual,notEqual:we.notStrictEqual,notDeepEqual:we.notDeepStrictEqual}),we.strict.strict=we.strict;var Fe=Object.keys||function(Pe){var Ve=[];for(var Et in Pe)Y.call(Pe,Et)&&Ve.push(Et);return Ve}},16076:function(sr){typeof Object.create=="function"?sr.exports=function(x,Q){x.super_=Q,x.prototype=Object.create(Q.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}})}:sr.exports=function(x,Q){x.super_=Q;var w=function(){};w.prototype=Q.prototype,x.prototype=new w,x.prototype.constructor=x}},52014:function(sr){sr.exports=function(x){return x&&typeof x=="object"&&typeof x.copy=="function"&&typeof x.fill=="function"&&typeof x.readUInt8=="function"}},30069:function(sr,L,x){var Q=x(34155),w=/%[sdj%]/g;L.format=function(ge){if(!Ir(ge)){for(var Me=[],Qe=0;Qe<arguments.length;Qe++)Me.push(Y(arguments[Qe]));return Me.join(" ")}for(var Qe=1,gt=arguments,Jt=gt.length,Dr=String(ge).replace(w,function(un){if(un==="%%")return"%";if(Qe>=Jt)return un;switch(un){case"%s":return String(gt[Qe++]);case"%d":return Number(gt[Qe++]);case"%j":try{return JSON.stringify(gt[Qe++])}catch(tr){return"[Circular]"}default:return un}}),Br=gt[Qe];Qe<Jt;Br=gt[++Qe])Lt(Br)||!Ke(Br)?Dr+=" "+Br:Dr+=" "+Y(Br);return Dr},L.deprecate=function(ge,Me){if(nr(x.g.process))return function(){return L.deprecate(ge,Me).apply(this,arguments)};if(Q.noDeprecation===!0)return ge;var Qe=!1;function gt(){if(!Qe){if(Q.throwDeprecation)throw new Error(Me);Q.traceDeprecation?console.trace(Me):console.error(Me),Qe=!0}return ge.apply(this,arguments)}return gt};var d={},b;L.debuglog=function(ge){if(nr(b)&&(b={NODE_ENV:"production"}.NODE_DEBUG||""),ge=ge.toUpperCase(),!d[ge])if(new RegExp("\\b"+ge+"\\b","i").test(b)){var Me=Q.pid;d[ge]=function(){var Qe=L.format.apply(L,arguments);console.error("%s %d: %s",ge,Me,Qe)}}else d[ge]=function(){};return d[ge]};function Y(ge,Me){var Qe={seen:[],stylize:$};return arguments.length>=3&&(Qe.depth=arguments[2]),arguments.length>=4&&(Qe.colors=arguments[3]),kt(Me)?Qe.showHidden=Me:Me&&L._extend(Qe,Me),nr(Qe.showHidden)&&(Qe.showHidden=!1),nr(Qe.depth)&&(Qe.depth=2),nr(Qe.colors)&&(Qe.colors=!1),nr(Qe.customInspect)&&(Qe.customInspect=!0),Qe.colors&&(Qe.stylize=W),k(Qe,ge,Qe.depth)}L.inspect=Y,Y.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Y.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function W(ge,Me){var Qe=Y.styles[Me];return Qe?"["+Y.colors[Qe][0]+"m"+ge+"["+Y.colors[Qe][1]+"m":ge}function $(ge,Me){return ge}function I(ge){var Me={};return ge.forEach(function(Qe,gt){Me[Qe]=!0}),Me}function k(ge,Me,Qe){if(ge.customInspect&&Me&&Pe(Me.inspect)&&Me.inspect!==L.inspect&&!(Me.constructor&&Me.constructor.prototype===Me)){var gt=Me.inspect(Qe,ge);return Ir(gt)||(gt=k(ge,gt,Qe)),gt}var Jt=we(ge,Me);if(Jt)return Jt;var Dr=Object.keys(Me),Br=I(Dr);if(ge.showHidden&&(Dr=Object.getOwnPropertyNames(Me)),Fe(Me)&&(Dr.indexOf("message")>=0||Dr.indexOf("description")>=0))return Be(Me);if(Dr.length===0){if(Pe(Me)){var un=Me.name?": "+Me.name:"";return ge.stylize("[Function"+un+"]","special")}if(xt(Me))return ge.stylize(RegExp.prototype.toString.call(Me),"regexp");if(_t(Me))return ge.stylize(Date.prototype.toString.call(Me),"date");if(Fe(Me))return Be(Me)}var tr="",se=!1,be=["{","}"];if(Yt(Me)&&(se=!0,be=["[","]"]),Pe(Me)){var ke=Me.name?": "+Me.name:"";tr=" [Function"+ke+"]"}if(xt(Me)&&(tr=" "+RegExp.prototype.toString.call(Me)),_t(Me)&&(tr=" "+Date.prototype.toUTCString.call(Me)),Fe(Me)&&(tr=" "+Be(Me)),Dr.length===0&&(!se||Me.length==0))return be[0]+tr+be[1];if(Qe<0)return xt(Me)?ge.stylize(RegExp.prototype.toString.call(Me),"regexp"):ge.stylize("[Object]","special");ge.seen.push(Me);var Ce;return se?Ce=We(ge,Me,Qe,Br,Dr):Ce=Dr.map(function(Pt){return $e(ge,Me,Qe,Br,Pt,se)}),ge.seen.pop(),Ut(Ce,tr,be)}function we(ge,Me){if(nr(Me))return ge.stylize("undefined","undefined");if(Ir(Me)){var Qe="'"+JSON.stringify(Me).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ge.stylize(Qe,"string")}if(pt(Me))return ge.stylize(""+Me,"number");if(kt(Me))return ge.stylize(""+Me,"boolean");if(Lt(Me))return ge.stylize("null","null")}function Be(ge){return"["+Error.prototype.toString.call(ge)+"]"}function We(ge,Me,Qe,gt,Jt){for(var Dr=[],Br=0,un=Me.length;Br<un;++Br)oe(Me,String(Br))?Dr.push($e(ge,Me,Qe,gt,String(Br),!0)):Dr.push("");return Jt.forEach(function(tr){tr.match(/^\d+$/)||Dr.push($e(ge,Me,Qe,gt,tr,!0))}),Dr}function $e(ge,Me,Qe,gt,Jt,Dr){var Br,un,tr;if(tr=Object.getOwnPropertyDescriptor(Me,Jt)||{value:Me[Jt]},tr.get?tr.set?un=ge.stylize("[Getter/Setter]","special"):un=ge.stylize("[Getter]","special"):tr.set&&(un=ge.stylize("[Setter]","special")),oe(gt,Jt)||(Br="["+Jt+"]"),un||(ge.seen.indexOf(tr.value)<0?(Lt(Qe)?un=k(ge,tr.value,null):un=k(ge,tr.value,Qe-1),un.indexOf(`
`)>-1&&(Dr?un=un.split(`
`).map(function(se){return"  "+se}).join(`
`).substr(2):un=`
`+un.split(`
`).map(function(se){return"   "+se}).join(`
`))):un=ge.stylize("[Circular]","special")),nr(Br)){if(Dr&&Jt.match(/^\d+$/))return un;Br=JSON.stringify(""+Jt),Br.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Br=Br.substr(1,Br.length-2),Br=ge.stylize(Br,"name")):(Br=Br.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Br=ge.stylize(Br,"string"))}return Br+": "+un}function Ut(ge,Me,Qe){var gt=0,Jt=ge.reduce(function(Dr,Br){return gt++,Br.indexOf(`
`)>=0&&gt++,Dr+Br.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Jt>60?Qe[0]+(Me===""?"":Me+`
 `)+" "+ge.join(`,
  `)+" "+Qe[1]:Qe[0]+Me+" "+ge.join(", ")+" "+Qe[1]}function Yt(ge){return Array.isArray(ge)}L.isArray=Yt;function kt(ge){return typeof ge=="boolean"}L.isBoolean=kt;function Lt(ge){return ge===null}L.isNull=Lt;function bt(ge){return ge==null}L.isNullOrUndefined=bt;function pt(ge){return typeof ge=="number"}L.isNumber=pt;function Ir(ge){return typeof ge=="string"}L.isString=Ir;function er(ge){return typeof ge=="symbol"}L.isSymbol=er;function nr(ge){return ge===void 0}L.isUndefined=nr;function xt(ge){return Ke(ge)&&Et(ge)==="[object RegExp]"}L.isRegExp=xt;function Ke(ge){return typeof ge=="object"&&ge!==null}L.isObject=Ke;function _t(ge){return Ke(ge)&&Et(ge)==="[object Date]"}L.isDate=_t;function Fe(ge){return Ke(ge)&&(Et(ge)==="[object Error]"||ge instanceof Error)}L.isError=Fe;function Pe(ge){return typeof ge=="function"}L.isFunction=Pe;function Ve(ge){return ge===null||typeof ge=="boolean"||typeof ge=="number"||typeof ge=="string"||typeof ge=="symbol"||typeof ge=="undefined"}L.isPrimitive=Ve,L.isBuffer=x(52014);function Et(ge){return Object.prototype.toString.call(ge)}function gr(ge){return ge<10?"0"+ge.toString(10):ge.toString(10)}var ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ae(){var ge=new Date,Me=[gr(ge.getHours()),gr(ge.getMinutes()),gr(ge.getSeconds())].join(":");return[ge.getDate(),ae[ge.getMonth()],Me].join(" ")}L.log=function(){console.log("%s - %s",Ae(),L.format.apply(L,arguments))},L.inherits=x(16076),L._extend=function(ge,Me){if(!Me||!Ke(Me))return ge;for(var Qe=Object.keys(Me),gt=Qe.length;gt--;)ge[Qe[gt]]=Me[Qe[gt]];return ge};function oe(ge,Me){return Object.prototype.hasOwnProperty.call(ge,Me)}},9187:function(sr){"use strict";sr.exports=L,sr.exports.default=L;function L(ae,Ae,oe){oe=oe||2;var ge=Ae&&Ae.length,Me=ge?Ae[0]*oe:ae.length,Qe=x(ae,0,Me,oe,!0),gt=[];if(!Qe||Qe.next===Qe.prev)return gt;var Jt,Dr,Br,un,tr,se,be;if(ge&&(Qe=$(ae,Ae,Qe,oe)),ae.length>80*oe){Jt=Br=ae[0],Dr=un=ae[1];for(var ke=oe;ke<Me;ke+=oe)tr=ae[ke],se=ae[ke+1],tr<Jt&&(Jt=tr),se<Dr&&(Dr=se),tr>Br&&(Br=tr),se>un&&(un=se);be=Math.max(Br-Jt,un-Dr),be=be!==0?1/be:0}return w(Qe,gt,oe,Jt,Dr,be),gt}function x(ae,Ae,oe,ge,Me){var Qe,gt;if(Me===gr(ae,Ae,oe,ge)>0)for(Qe=Ae;Qe<oe;Qe+=ge)gt=Pe(Qe,ae[Qe],ae[Qe+1],gt);else for(Qe=oe-ge;Qe>=Ae;Qe-=ge)gt=Pe(Qe,ae[Qe],ae[Qe+1],gt);return gt&&pt(gt,gt.next)&&(Ve(gt),gt=gt.next),gt}function Q(ae,Ae){if(!ae)return ae;Ae||(Ae=ae);var oe=ae,ge;do if(ge=!1,!oe.steiner&&(pt(oe,oe.next)||bt(oe.prev,oe,oe.next)===0)){if(Ve(oe),oe=Ae=oe.prev,oe===oe.next)break;ge=!0}else oe=oe.next;while(ge||oe!==Ae);return Ae}function w(ae,Ae,oe,ge,Me,Qe,gt){if(!!ae){!gt&&Qe&&We(ae,ge,Me,Qe);for(var Jt=ae,Dr,Br;ae.prev!==ae.next;){if(Dr=ae.prev,Br=ae.next,Qe?b(ae,ge,Me,Qe):d(ae)){Ae.push(Dr.i/oe),Ae.push(ae.i/oe),Ae.push(Br.i/oe),Ve(ae),ae=Br.next,Jt=Br.next;continue}if(ae=Br,ae===Jt){gt?gt===1?(ae=Y(Q(ae),Ae,oe),w(ae,Ae,oe,ge,Me,Qe,2)):gt===2&&W(ae,Ae,oe,ge,Me,Qe):w(Q(ae),Ae,oe,ge,Me,Qe,1);break}}}}function d(ae){var Ae=ae.prev,oe=ae,ge=ae.next;if(bt(Ae,oe,ge)>=0)return!1;for(var Me=ae.next.next;Me!==ae.prev;){if(kt(Ae.x,Ae.y,oe.x,oe.y,ge.x,ge.y,Me.x,Me.y)&&bt(Me.prev,Me,Me.next)>=0)return!1;Me=Me.next}return!0}function b(ae,Ae,oe,ge){var Me=ae.prev,Qe=ae,gt=ae.next;if(bt(Me,Qe,gt)>=0)return!1;for(var Jt=Me.x<Qe.x?Me.x<gt.x?Me.x:gt.x:Qe.x<gt.x?Qe.x:gt.x,Dr=Me.y<Qe.y?Me.y<gt.y?Me.y:gt.y:Qe.y<gt.y?Qe.y:gt.y,Br=Me.x>Qe.x?Me.x>gt.x?Me.x:gt.x:Qe.x>gt.x?Qe.x:gt.x,un=Me.y>Qe.y?Me.y>gt.y?Me.y:gt.y:Qe.y>gt.y?Qe.y:gt.y,tr=Ut(Jt,Dr,Ae,oe,ge),se=Ut(Br,un,Ae,oe,ge),be=ae.prevZ,ke=ae.nextZ;be&&be.z>=tr&&ke&&ke.z<=se;){if(be!==ae.prev&&be!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,be.x,be.y)&&bt(be.prev,be,be.next)>=0||(be=be.prevZ,ke!==ae.prev&&ke!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,ke.x,ke.y)&&bt(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;be&&be.z>=tr;){if(be!==ae.prev&&be!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,be.x,be.y)&&bt(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;ke&&ke.z<=se;){if(ke!==ae.prev&&ke!==ae.next&&kt(Me.x,Me.y,Qe.x,Qe.y,gt.x,gt.y,ke.x,ke.y)&&bt(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function Y(ae,Ae,oe){var ge=ae;do{var Me=ge.prev,Qe=ge.next.next;!pt(Me,Qe)&&Ir(Me,ge,ge.next,Qe)&&Ke(Me,Qe)&&Ke(Qe,Me)&&(Ae.push(Me.i/oe),Ae.push(ge.i/oe),Ae.push(Qe.i/oe),Ve(ge),Ve(ge.next),ge=ae=Qe),ge=ge.next}while(ge!==ae);return Q(ge)}function W(ae,Ae,oe,ge,Me,Qe){var gt=ae;do{for(var Jt=gt.next.next;Jt!==gt.prev;){if(gt.i!==Jt.i&&Lt(gt,Jt)){var Dr=Fe(gt,Jt);gt=Q(gt,gt.next),Dr=Q(Dr,Dr.next),w(gt,Ae,oe,ge,Me,Qe),w(Dr,Ae,oe,ge,Me,Qe);return}Jt=Jt.next}gt=gt.next}while(gt!==ae)}function $(ae,Ae,oe,ge){var Me=[],Qe,gt,Jt,Dr,Br;for(Qe=0,gt=Ae.length;Qe<gt;Qe++)Jt=Ae[Qe]*ge,Dr=Qe<gt-1?Ae[Qe+1]*ge:ae.length,Br=x(ae,Jt,Dr,ge,!1),Br===Br.next&&(Br.steiner=!0),Me.push(Yt(Br));for(Me.sort(I),Qe=0;Qe<Me.length;Qe++)oe=k(Me[Qe],oe),oe=Q(oe,oe.next);return oe}function I(ae,Ae){return ae.x-Ae.x}function k(ae,Ae){var oe=we(ae,Ae);if(!oe)return Ae;var ge=Fe(oe,ae),Me=Q(oe,oe.next);return Q(ge,ge.next),Ae===oe?Me:Ae}function we(ae,Ae){var oe=Ae,ge=ae.x,Me=ae.y,Qe=-Infinity,gt;do{if(Me<=oe.y&&Me>=oe.next.y&&oe.next.y!==oe.y){var Jt=oe.x+(Me-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(Jt<=ge&&Jt>Qe){if(Qe=Jt,Jt===ge){if(Me===oe.y)return oe;if(Me===oe.next.y)return oe.next}gt=oe.x<oe.next.x?oe:oe.next}}oe=oe.next}while(oe!==Ae);if(!gt)return null;if(ge===Qe)return gt;var Dr=gt,Br=gt.x,un=gt.y,tr=Infinity,se;oe=gt;do ge>=oe.x&&oe.x>=Br&&ge!==oe.x&&kt(Me<un?ge:Qe,Me,Br,un,Me<un?Qe:ge,Me,oe.x,oe.y)&&(se=Math.abs(Me-oe.y)/(ge-oe.x),Ke(oe,ae)&&(se<tr||se===tr&&(oe.x>gt.x||oe.x===gt.x&&Be(gt,oe)))&&(gt=oe,tr=se)),oe=oe.next;while(oe!==Dr);return gt}function Be(ae,Ae){return bt(ae.prev,ae,Ae.prev)<0&&bt(Ae.next,ae,ae.next)<0}function We(ae,Ae,oe,ge){var Me=ae;do Me.z===null&&(Me.z=Ut(Me.x,Me.y,Ae,oe,ge)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==ae);Me.prevZ.nextZ=null,Me.prevZ=null,$e(Me)}function $e(ae){var Ae,oe,ge,Me,Qe,gt,Jt,Dr,Br=1;do{for(oe=ae,ae=null,Qe=null,gt=0;oe;){for(gt++,ge=oe,Jt=0,Ae=0;Ae<Br&&(Jt++,ge=ge.nextZ,!!ge);Ae++);for(Dr=Br;Jt>0||Dr>0&&ge;)Jt!==0&&(Dr===0||!ge||oe.z<=ge.z)?(Me=oe,oe=oe.nextZ,Jt--):(Me=ge,ge=ge.nextZ,Dr--),Qe?Qe.nextZ=Me:ae=Me,Me.prevZ=Qe,Qe=Me;oe=ge}Qe.nextZ=null,Br*=2}while(gt>1);return ae}function Ut(ae,Ae,oe,ge,Me){return ae=32767*(ae-oe)*Me,Ae=32767*(Ae-ge)*Me,ae=(ae|ae<<8)&16711935,ae=(ae|ae<<4)&252645135,ae=(ae|ae<<2)&858993459,ae=(ae|ae<<1)&1431655765,Ae=(Ae|Ae<<8)&16711935,Ae=(Ae|Ae<<4)&252645135,Ae=(Ae|Ae<<2)&858993459,Ae=(Ae|Ae<<1)&1431655765,ae|Ae<<1}function Yt(ae){var Ae=ae,oe=ae;do(Ae.x<oe.x||Ae.x===oe.x&&Ae.y<oe.y)&&(oe=Ae),Ae=Ae.next;while(Ae!==ae);return oe}function kt(ae,Ae,oe,ge,Me,Qe,gt,Jt){return(Me-gt)*(Ae-Jt)-(ae-gt)*(Qe-Jt)>=0&&(ae-gt)*(ge-Jt)-(oe-gt)*(Ae-Jt)>=0&&(oe-gt)*(Qe-Jt)-(Me-gt)*(ge-Jt)>=0}function Lt(ae,Ae){return ae.next.i!==Ae.i&&ae.prev.i!==Ae.i&&!xt(ae,Ae)&&(Ke(ae,Ae)&&Ke(Ae,ae)&&_t(ae,Ae)&&(bt(ae.prev,ae,Ae.prev)||bt(ae,Ae.prev,Ae))||pt(ae,Ae)&&bt(ae.prev,ae,ae.next)>0&&bt(Ae.prev,Ae,Ae.next)>0)}function bt(ae,Ae,oe){return(Ae.y-ae.y)*(oe.x-Ae.x)-(Ae.x-ae.x)*(oe.y-Ae.y)}function pt(ae,Ae){return ae.x===Ae.x&&ae.y===Ae.y}function Ir(ae,Ae,oe,ge){var Me=nr(bt(ae,Ae,oe)),Qe=nr(bt(ae,Ae,ge)),gt=nr(bt(oe,ge,ae)),Jt=nr(bt(oe,ge,Ae));return!!(Me!==Qe&&gt!==Jt||Me===0&&er(ae,oe,Ae)||Qe===0&&er(ae,ge,Ae)||gt===0&&er(oe,ae,ge)||Jt===0&&er(oe,Ae,ge))}function er(ae,Ae,oe){return Ae.x<=Math.max(ae.x,oe.x)&&Ae.x>=Math.min(ae.x,oe.x)&&Ae.y<=Math.max(ae.y,oe.y)&&Ae.y>=Math.min(ae.y,oe.y)}function nr(ae){return ae>0?1:ae<0?-1:0}function xt(ae,Ae){var oe=ae;do{if(oe.i!==ae.i&&oe.next.i!==ae.i&&oe.i!==Ae.i&&oe.next.i!==Ae.i&&Ir(oe,oe.next,ae,Ae))return!0;oe=oe.next}while(oe!==ae);return!1}function Ke(ae,Ae){return bt(ae.prev,ae,ae.next)<0?bt(ae,Ae,ae.next)>=0&&bt(ae,ae.prev,Ae)>=0:bt(ae,Ae,ae.prev)<0||bt(ae,ae.next,Ae)<0}function _t(ae,Ae){var oe=ae,ge=!1,Me=(ae.x+Ae.x)/2,Qe=(ae.y+Ae.y)/2;do oe.y>Qe!=oe.next.y>Qe&&oe.next.y!==oe.y&&Me<(oe.next.x-oe.x)*(Qe-oe.y)/(oe.next.y-oe.y)+oe.x&&(ge=!ge),oe=oe.next;while(oe!==ae);return ge}function Fe(ae,Ae){var oe=new Et(ae.i,ae.x,ae.y),ge=new Et(Ae.i,Ae.x,Ae.y),Me=ae.next,Qe=Ae.prev;return ae.next=Ae,Ae.prev=ae,oe.next=Me,Me.prev=oe,ge.next=oe,oe.prev=ge,Qe.next=ge,ge.prev=Qe,ge}function Pe(ae,Ae,oe,ge){var Me=new Et(ae,Ae,oe);return ge?(Me.next=ge.next,Me.prev=ge,ge.next.prev=Me,ge.next=Me):(Me.prev=Me,Me.next=Me),Me}function Ve(ae){ae.next.prev=ae.prev,ae.prev.next=ae.next,ae.prevZ&&(ae.prevZ.nextZ=ae.nextZ),ae.nextZ&&(ae.nextZ.prevZ=ae.prevZ)}function Et(ae,Ae,oe){this.i=ae,this.x=Ae,this.y=oe,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}L.deviation=function(ae,Ae,oe,ge){var Me=Ae&&Ae.length,Qe=Me?Ae[0]*oe:ae.length,gt=Math.abs(gr(ae,0,Qe,oe));if(Me)for(var Jt=0,Dr=Ae.length;Jt<Dr;Jt++){var Br=Ae[Jt]*oe,un=Jt<Dr-1?Ae[Jt+1]*oe:ae.length;gt-=Math.abs(gr(ae,Br,un,oe))}var tr=0;for(Jt=0;Jt<ge.length;Jt+=3){var se=ge[Jt]*oe,be=ge[Jt+1]*oe,ke=ge[Jt+2]*oe;tr+=Math.abs((ae[se]-ae[ke])*(ae[be+1]-ae[se+1])-(ae[se]-ae[be])*(ae[ke+1]-ae[se+1]))}return gt===0&&tr===0?0:Math.abs((tr-gt)/gt)};function gr(ae,Ae,oe,ge){for(var Me=0,Qe=Ae,gt=oe-ge;Qe<oe;Qe+=ge)Me+=(ae[gt]-ae[Qe])*(ae[Qe+1]+ae[gt+1]),gt=Qe;return Me}L.flatten=function(ae){for(var Ae=ae[0][0].length,oe={vertices:[],holes:[],dimensions:Ae},ge=0,Me=0;Me<ae.length;Me++){for(var Qe=0;Qe<ae[Me].length;Qe++)for(var gt=0;gt<Ae;gt++)oe.vertices.push(ae[Me][Qe][gt]);Me>0&&(ge+=ae[Me-1].length,oe.holes.push(ge))}return oe}},67709:function(sr){function L(Q){var w=Q.target||Q.srcElement;w.__resizeRAF__&&cancelAnimationFrame(w.__resizeRAF__),w.__resizeRAF__=requestAnimationFrame(function(){var d=w.__resizeTrigger__,b=d&&d.__resizeListeners__;b&&b.forEach(function(Y){Y.call(d,Q)})})}var x=function(w,d){var b=this,Y=b.document,W,$=Y.attachEvent;typeof navigator!="undefined"&&(W=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function I(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",L)}if(!w.__resizeListeners__)if(w.__resizeListeners__=[],$)w.__resizeTrigger__=w,w.attachEvent("onresize",L);else{getComputedStyle(w).position==="static"&&(w.style.position="relative");var k=w.__resizeTrigger__=Y.createElement("object");k.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),k.setAttribute("class","resize-sensor"),k.setAttribute("tabindex","-1"),k.setAttribute("title",""),k.__resizeElement__=w,k.onload=I,k.type="text/html",W&&w.appendChild(k),k.data="about:blank",W||w.appendChild(k)}w.__resizeListeners__.push(d)};sr.exports=typeof window=="undefined"?x:x.bind(window),sr.exports.unbind=function(Q,w){var d=document.attachEvent,b=Q.__resizeListeners__||[];if(w){var Y=b.indexOf(w);Y!==-1&&b.splice(Y,1)}else b=Q.__resizeListeners__=[];if(!b.length){if(d)Q.detachEvent("onresize",L);else if(Q.__resizeTrigger__){var W=Q.__resizeTrigger__.contentDocument,$=W&&W.defaultView;$&&($.removeEventListener("resize",L),delete $.__resizeTrigger__),Q.__resizeTrigger__=!Q.removeChild(Q.__resizeTrigger__)}delete Q.__resizeListeners__}}},26729:function(sr){"use strict";var L=Object.prototype.hasOwnProperty,x="~";function Q(){}Object.create&&(Q.prototype=Object.create(null),new Q().__proto__||(x=!1));function w(W,$,I){this.fn=W,this.context=$,this.once=I||!1}function d(W,$,I,k,we){if(typeof I!="function")throw new TypeError("The listener must be a function");var Be=new w(I,k||W,we),We=x?x+$:$;return W._events[We]?W._events[We].fn?W._events[We]=[W._events[We],Be]:W._events[We].push(Be):(W._events[We]=Be,W._eventsCount++),W}function b(W,$){--W._eventsCount==0?W._events=new Q:delete W._events[$]}function Y(){this._events=new Q,this._eventsCount=0}Y.prototype.eventNames=function(){var $=[],I,k;if(this._eventsCount===0)return $;for(k in I=this._events)L.call(I,k)&&$.push(x?k.slice(1):k);return Object.getOwnPropertySymbols?$.concat(Object.getOwnPropertySymbols(I)):$},Y.prototype.listeners=function($){var I=x?x+$:$,k=this._events[I];if(!k)return[];if(k.fn)return[k.fn];for(var we=0,Be=k.length,We=new Array(Be);we<Be;we++)We[we]=k[we].fn;return We},Y.prototype.listenerCount=function($){var I=x?x+$:$,k=this._events[I];return k?k.fn?1:k.length:0},Y.prototype.emit=function($,I,k,we,Be,We){var $e=x?x+$:$;if(!this._events[$e])return!1;var Ut=this._events[$e],Yt=arguments.length,kt,Lt;if(Ut.fn){switch(Ut.once&&this.removeListener($,Ut.fn,void 0,!0),Yt){case 1:return Ut.fn.call(Ut.context),!0;case 2:return Ut.fn.call(Ut.context,I),!0;case 3:return Ut.fn.call(Ut.context,I,k),!0;case 4:return Ut.fn.call(Ut.context,I,k,we),!0;case 5:return Ut.fn.call(Ut.context,I,k,we,Be),!0;case 6:return Ut.fn.call(Ut.context,I,k,we,Be,We),!0}for(Lt=1,kt=new Array(Yt-1);Lt<Yt;Lt++)kt[Lt-1]=arguments[Lt];Ut.fn.apply(Ut.context,kt)}else{var bt=Ut.length,pt;for(Lt=0;Lt<bt;Lt++)switch(Ut[Lt].once&&this.removeListener($,Ut[Lt].fn,void 0,!0),Yt){case 1:Ut[Lt].fn.call(Ut[Lt].context);break;case 2:Ut[Lt].fn.call(Ut[Lt].context,I);break;case 3:Ut[Lt].fn.call(Ut[Lt].context,I,k);break;case 4:Ut[Lt].fn.call(Ut[Lt].context,I,k,we);break;default:if(!kt)for(pt=1,kt=new Array(Yt-1);pt<Yt;pt++)kt[pt-1]=arguments[pt];Ut[Lt].fn.apply(Ut[Lt].context,kt)}}return!0},Y.prototype.on=function($,I,k){return d(this,$,I,k,!1)},Y.prototype.once=function($,I,k){return d(this,$,I,k,!0)},Y.prototype.removeListener=function($,I,k,we){var Be=x?x+$:$;if(!this._events[Be])return this;if(!I)return b(this,Be),this;var We=this._events[Be];if(We.fn)We.fn===I&&(!we||We.once)&&(!k||We.context===k)&&b(this,Be);else{for(var $e=0,Ut=[],Yt=We.length;$e<Yt;$e++)(We[$e].fn!==I||we&&!We[$e].once||k&&We[$e].context!==k)&&Ut.push(We[$e]);Ut.length?this._events[Be]=Ut.length===1?Ut[0]:Ut:b(this,Be)}return this},Y.prototype.removeAllListeners=function($){var I;return $?(I=x?x+$:$,this._events[I]&&b(this,I)):(this._events=new Q,this._eventsCount=0),this},Y.prototype.off=Y.prototype.removeListener,Y.prototype.addListener=Y.prototype.on,Y.prefixed=x,Y.EventEmitter=Y,sr.exports=Y},85975:function(sr,L,x){"use strict";x.r(L),x.d(L,{create:function(){return w},clone:function(){return d},copy:function(){return b},fromValues:function(){return Y},set:function(){return W},identity:function(){return $},transpose:function(){return I},invert:function(){return k},adjoint:function(){return we},determinant:function(){return Be},multiply:function(){return We},translate:function(){return $e},scale:function(){return Ut},rotate:function(){return Yt},rotateX:function(){return kt},rotateY:function(){return Lt},rotateZ:function(){return bt},fromTranslation:function(){return pt},fromScaling:function(){return Ir},fromRotation:function(){return er},fromXRotation:function(){return nr},fromYRotation:function(){return xt},fromZRotation:function(){return Ke},fromRotationTranslation:function(){return _t},fromQuat2:function(){return Fe},getTranslation:function(){return Pe},getScaling:function(){return Ve},getRotation:function(){return Et},fromRotationTranslationScale:function(){return gr},fromRotationTranslationScaleOrigin:function(){return ae},fromQuat:function(){return Ae},frustum:function(){return oe},perspective:function(){return ge},perspectiveFromFieldOfView:function(){return Me},ortho:function(){return Qe},lookAt:function(){return gt},targetTo:function(){return Jt},str:function(){return Dr},frob:function(){return Br},add:function(){return un},subtract:function(){return tr},multiplyScalar:function(){return se},multiplyScalarAndAdd:function(){return be},exactEquals:function(){return ke},equals:function(){return Ce},mul:function(){return Pt},sub:function(){return Dt}});var Q=x(49685);function w(){var E=new Q.WT(16);return Q.WT!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=0,E[12]=0,E[13]=0,E[14]=0),E[0]=1,E[5]=1,E[10]=1,E[15]=1,E}function d(E){var N=new Q.WT(16);return N[0]=E[0],N[1]=E[1],N[2]=E[2],N[3]=E[3],N[4]=E[4],N[5]=E[5],N[6]=E[6],N[7]=E[7],N[8]=E[8],N[9]=E[9],N[10]=E[10],N[11]=E[11],N[12]=E[12],N[13]=E[13],N[14]=E[14],N[15]=E[15],N}function b(E,N){return E[0]=N[0],E[1]=N[1],E[2]=N[2],E[3]=N[3],E[4]=N[4],E[5]=N[5],E[6]=N[6],E[7]=N[7],E[8]=N[8],E[9]=N[9],E[10]=N[10],E[11]=N[11],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15],E}function Y(E,N,he,Ze,qe,mt,Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je,yt){var ht=new Q.WT(16);return ht[0]=E,ht[1]=N,ht[2]=he,ht[3]=Ze,ht[4]=qe,ht[5]=mt,ht[6]=Ct,ht[7]=H,ht[8]=Kt,ht[9]=jt,ht[10]=hr,ht[11]=Cr,ht[12]=Tr,ht[13]=Pr,ht[14]=Je,ht[15]=yt,ht}function W(E,N,he,Ze,qe,mt,Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je,yt,ht){return E[0]=N,E[1]=he,E[2]=Ze,E[3]=qe,E[4]=mt,E[5]=Ct,E[6]=H,E[7]=Kt,E[8]=jt,E[9]=hr,E[10]=Cr,E[11]=Tr,E[12]=Pr,E[13]=Je,E[14]=yt,E[15]=ht,E}function $(E){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function I(E,N){if(E===N){var he=N[1],Ze=N[2],qe=N[3],mt=N[6],Ct=N[7],H=N[11];E[1]=N[4],E[2]=N[8],E[3]=N[12],E[4]=he,E[6]=N[9],E[7]=N[13],E[8]=Ze,E[9]=mt,E[11]=N[14],E[12]=qe,E[13]=Ct,E[14]=H}else E[0]=N[0],E[1]=N[4],E[2]=N[8],E[3]=N[12],E[4]=N[1],E[5]=N[5],E[6]=N[9],E[7]=N[13],E[8]=N[2],E[9]=N[6],E[10]=N[10],E[11]=N[14],E[12]=N[3],E[13]=N[7],E[14]=N[11],E[15]=N[15];return E}function k(E,N){var he=N[0],Ze=N[1],qe=N[2],mt=N[3],Ct=N[4],H=N[5],Kt=N[6],jt=N[7],hr=N[8],Cr=N[9],Tr=N[10],Pr=N[11],Je=N[12],yt=N[13],ht=N[14],fr=N[15],$r=he*H-Ze*Ct,lt=he*Kt-qe*Ct,Rt=he*jt-mt*Ct,Qt=Ze*Kt-qe*H,pr=Ze*jt-mt*H,vn=qe*jt-mt*Kt,Pn=hr*yt-Cr*Je,bi=hr*ht-Tr*Je,Si=hr*fr-Pr*Je,Ri=Cr*ht-Tr*yt,ia=Cr*fr-Pr*yt,pi=Tr*fr-Pr*ht,G=$r*pi-lt*ia+Rt*Ri+Qt*Si-pr*bi+vn*Pn;return G?(G=1/G,E[0]=(H*pi-Kt*ia+jt*Ri)*G,E[1]=(qe*ia-Ze*pi-mt*Ri)*G,E[2]=(yt*vn-ht*pr+fr*Qt)*G,E[3]=(Tr*pr-Cr*vn-Pr*Qt)*G,E[4]=(Kt*Si-Ct*pi-jt*bi)*G,E[5]=(he*pi-qe*Si+mt*bi)*G,E[6]=(ht*Rt-Je*vn-fr*lt)*G,E[7]=(hr*vn-Tr*Rt+Pr*lt)*G,E[8]=(Ct*ia-H*Si+jt*Pn)*G,E[9]=(Ze*Si-he*ia-mt*Pn)*G,E[10]=(Je*pr-yt*Rt+fr*$r)*G,E[11]=(Cr*Rt-hr*pr-Pr*$r)*G,E[12]=(H*bi-Ct*Ri-Kt*Pn)*G,E[13]=(he*Ri-Ze*bi+qe*Pn)*G,E[14]=(yt*lt-Je*Qt-ht*$r)*G,E[15]=(hr*Qt-Cr*lt+Tr*$r)*G,E):null}function we(E,N){var he=N[0],Ze=N[1],qe=N[2],mt=N[3],Ct=N[4],H=N[5],Kt=N[6],jt=N[7],hr=N[8],Cr=N[9],Tr=N[10],Pr=N[11],Je=N[12],yt=N[13],ht=N[14],fr=N[15];return E[0]=H*(Tr*fr-Pr*ht)-Cr*(Kt*fr-jt*ht)+yt*(Kt*Pr-jt*Tr),E[1]=-(Ze*(Tr*fr-Pr*ht)-Cr*(qe*fr-mt*ht)+yt*(qe*Pr-mt*Tr)),E[2]=Ze*(Kt*fr-jt*ht)-H*(qe*fr-mt*ht)+yt*(qe*jt-mt*Kt),E[3]=-(Ze*(Kt*Pr-jt*Tr)-H*(qe*Pr-mt*Tr)+Cr*(qe*jt-mt*Kt)),E[4]=-(Ct*(Tr*fr-Pr*ht)-hr*(Kt*fr-jt*ht)+Je*(Kt*Pr-jt*Tr)),E[5]=he*(Tr*fr-Pr*ht)-hr*(qe*fr-mt*ht)+Je*(qe*Pr-mt*Tr),E[6]=-(he*(Kt*fr-jt*ht)-Ct*(qe*fr-mt*ht)+Je*(qe*jt-mt*Kt)),E[7]=he*(Kt*Pr-jt*Tr)-Ct*(qe*Pr-mt*Tr)+hr*(qe*jt-mt*Kt),E[8]=Ct*(Cr*fr-Pr*yt)-hr*(H*fr-jt*yt)+Je*(H*Pr-jt*Cr),E[9]=-(he*(Cr*fr-Pr*yt)-hr*(Ze*fr-mt*yt)+Je*(Ze*Pr-mt*Cr)),E[10]=he*(H*fr-jt*yt)-Ct*(Ze*fr-mt*yt)+Je*(Ze*jt-mt*H),E[11]=-(he*(H*Pr-jt*Cr)-Ct*(Ze*Pr-mt*Cr)+hr*(Ze*jt-mt*H)),E[12]=-(Ct*(Cr*ht-Tr*yt)-hr*(H*ht-Kt*yt)+Je*(H*Tr-Kt*Cr)),E[13]=he*(Cr*ht-Tr*yt)-hr*(Ze*ht-qe*yt)+Je*(Ze*Tr-qe*Cr),E[14]=-(he*(H*ht-Kt*yt)-Ct*(Ze*ht-qe*yt)+Je*(Ze*Kt-qe*H)),E[15]=he*(H*Tr-Kt*Cr)-Ct*(Ze*Tr-qe*Cr)+hr*(Ze*Kt-qe*H),E}function Be(E){var N=E[0],he=E[1],Ze=E[2],qe=E[3],mt=E[4],Ct=E[5],H=E[6],Kt=E[7],jt=E[8],hr=E[9],Cr=E[10],Tr=E[11],Pr=E[12],Je=E[13],yt=E[14],ht=E[15],fr=N*Ct-he*mt,$r=N*H-Ze*mt,lt=N*Kt-qe*mt,Rt=he*H-Ze*Ct,Qt=he*Kt-qe*Ct,pr=Ze*Kt-qe*H,vn=jt*Je-hr*Pr,Pn=jt*yt-Cr*Pr,bi=jt*ht-Tr*Pr,Si=hr*yt-Cr*Je,Ri=hr*ht-Tr*Je,ia=Cr*ht-Tr*yt;return fr*ia-$r*Ri+lt*Si+Rt*bi-Qt*Pn+pr*vn}function We(E,N,he){var Ze=N[0],qe=N[1],mt=N[2],Ct=N[3],H=N[4],Kt=N[5],jt=N[6],hr=N[7],Cr=N[8],Tr=N[9],Pr=N[10],Je=N[11],yt=N[12],ht=N[13],fr=N[14],$r=N[15],lt=he[0],Rt=he[1],Qt=he[2],pr=he[3];return E[0]=lt*Ze+Rt*H+Qt*Cr+pr*yt,E[1]=lt*qe+Rt*Kt+Qt*Tr+pr*ht,E[2]=lt*mt+Rt*jt+Qt*Pr+pr*fr,E[3]=lt*Ct+Rt*hr+Qt*Je+pr*$r,lt=he[4],Rt=he[5],Qt=he[6],pr=he[7],E[4]=lt*Ze+Rt*H+Qt*Cr+pr*yt,E[5]=lt*qe+Rt*Kt+Qt*Tr+pr*ht,E[6]=lt*mt+Rt*jt+Qt*Pr+pr*fr,E[7]=lt*Ct+Rt*hr+Qt*Je+pr*$r,lt=he[8],Rt=he[9],Qt=he[10],pr=he[11],E[8]=lt*Ze+Rt*H+Qt*Cr+pr*yt,E[9]=lt*qe+Rt*Kt+Qt*Tr+pr*ht,E[10]=lt*mt+Rt*jt+Qt*Pr+pr*fr,E[11]=lt*Ct+Rt*hr+Qt*Je+pr*$r,lt=he[12],Rt=he[13],Qt=he[14],pr=he[15],E[12]=lt*Ze+Rt*H+Qt*Cr+pr*yt,E[13]=lt*qe+Rt*Kt+Qt*Tr+pr*ht,E[14]=lt*mt+Rt*jt+Qt*Pr+pr*fr,E[15]=lt*Ct+Rt*hr+Qt*Je+pr*$r,E}function $e(E,N,he){var Ze=he[0],qe=he[1],mt=he[2],Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je,yt,ht,fr;return N===E?(E[12]=N[0]*Ze+N[4]*qe+N[8]*mt+N[12],E[13]=N[1]*Ze+N[5]*qe+N[9]*mt+N[13],E[14]=N[2]*Ze+N[6]*qe+N[10]*mt+N[14],E[15]=N[3]*Ze+N[7]*qe+N[11]*mt+N[15]):(Ct=N[0],H=N[1],Kt=N[2],jt=N[3],hr=N[4],Cr=N[5],Tr=N[6],Pr=N[7],Je=N[8],yt=N[9],ht=N[10],fr=N[11],E[0]=Ct,E[1]=H,E[2]=Kt,E[3]=jt,E[4]=hr,E[5]=Cr,E[6]=Tr,E[7]=Pr,E[8]=Je,E[9]=yt,E[10]=ht,E[11]=fr,E[12]=Ct*Ze+hr*qe+Je*mt+N[12],E[13]=H*Ze+Cr*qe+yt*mt+N[13],E[14]=Kt*Ze+Tr*qe+ht*mt+N[14],E[15]=jt*Ze+Pr*qe+fr*mt+N[15]),E}function Ut(E,N,he){var Ze=he[0],qe=he[1],mt=he[2];return E[0]=N[0]*Ze,E[1]=N[1]*Ze,E[2]=N[2]*Ze,E[3]=N[3]*Ze,E[4]=N[4]*qe,E[5]=N[5]*qe,E[6]=N[6]*qe,E[7]=N[7]*qe,E[8]=N[8]*mt,E[9]=N[9]*mt,E[10]=N[10]*mt,E[11]=N[11]*mt,E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15],E}function Yt(E,N,he,Ze){var qe=Ze[0],mt=Ze[1],Ct=Ze[2],H=Math.hypot(qe,mt,Ct),Kt,jt,hr,Cr,Tr,Pr,Je,yt,ht,fr,$r,lt,Rt,Qt,pr,vn,Pn,bi,Si,Ri,ia,pi,G,ie;return H<Q.Ib?null:(H=1/H,qe*=H,mt*=H,Ct*=H,Kt=Math.sin(he),jt=Math.cos(he),hr=1-jt,Cr=N[0],Tr=N[1],Pr=N[2],Je=N[3],yt=N[4],ht=N[5],fr=N[6],$r=N[7],lt=N[8],Rt=N[9],Qt=N[10],pr=N[11],vn=qe*qe*hr+jt,Pn=mt*qe*hr+Ct*Kt,bi=Ct*qe*hr-mt*Kt,Si=qe*mt*hr-Ct*Kt,Ri=mt*mt*hr+jt,ia=Ct*mt*hr+qe*Kt,pi=qe*Ct*hr+mt*Kt,G=mt*Ct*hr-qe*Kt,ie=Ct*Ct*hr+jt,E[0]=Cr*vn+yt*Pn+lt*bi,E[1]=Tr*vn+ht*Pn+Rt*bi,E[2]=Pr*vn+fr*Pn+Qt*bi,E[3]=Je*vn+$r*Pn+pr*bi,E[4]=Cr*Si+yt*Ri+lt*ia,E[5]=Tr*Si+ht*Ri+Rt*ia,E[6]=Pr*Si+fr*Ri+Qt*ia,E[7]=Je*Si+$r*Ri+pr*ia,E[8]=Cr*pi+yt*G+lt*ie,E[9]=Tr*pi+ht*G+Rt*ie,E[10]=Pr*pi+fr*G+Qt*ie,E[11]=Je*pi+$r*G+pr*ie,N!==E&&(E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E)}function kt(E,N,he){var Ze=Math.sin(he),qe=Math.cos(he),mt=N[4],Ct=N[5],H=N[6],Kt=N[7],jt=N[8],hr=N[9],Cr=N[10],Tr=N[11];return N!==E&&(E[0]=N[0],E[1]=N[1],E[2]=N[2],E[3]=N[3],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E[4]=mt*qe+jt*Ze,E[5]=Ct*qe+hr*Ze,E[6]=H*qe+Cr*Ze,E[7]=Kt*qe+Tr*Ze,E[8]=jt*qe-mt*Ze,E[9]=hr*qe-Ct*Ze,E[10]=Cr*qe-H*Ze,E[11]=Tr*qe-Kt*Ze,E}function Lt(E,N,he){var Ze=Math.sin(he),qe=Math.cos(he),mt=N[0],Ct=N[1],H=N[2],Kt=N[3],jt=N[8],hr=N[9],Cr=N[10],Tr=N[11];return N!==E&&(E[4]=N[4],E[5]=N[5],E[6]=N[6],E[7]=N[7],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E[0]=mt*qe-jt*Ze,E[1]=Ct*qe-hr*Ze,E[2]=H*qe-Cr*Ze,E[3]=Kt*qe-Tr*Ze,E[8]=mt*Ze+jt*qe,E[9]=Ct*Ze+hr*qe,E[10]=H*Ze+Cr*qe,E[11]=Kt*Ze+Tr*qe,E}function bt(E,N,he){var Ze=Math.sin(he),qe=Math.cos(he),mt=N[0],Ct=N[1],H=N[2],Kt=N[3],jt=N[4],hr=N[5],Cr=N[6],Tr=N[7];return N!==E&&(E[8]=N[8],E[9]=N[9],E[10]=N[10],E[11]=N[11],E[12]=N[12],E[13]=N[13],E[14]=N[14],E[15]=N[15]),E[0]=mt*qe+jt*Ze,E[1]=Ct*qe+hr*Ze,E[2]=H*qe+Cr*Ze,E[3]=Kt*qe+Tr*Ze,E[4]=jt*qe-mt*Ze,E[5]=hr*qe-Ct*Ze,E[6]=Cr*qe-H*Ze,E[7]=Tr*qe-Kt*Ze,E}function pt(E,N){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=N[0],E[13]=N[1],E[14]=N[2],E[15]=1,E}function Ir(E,N){return E[0]=N[0],E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=N[1],E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=N[2],E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function er(E,N,he){var Ze=he[0],qe=he[1],mt=he[2],Ct=Math.hypot(Ze,qe,mt),H,Kt,jt;return Ct<Q.Ib?null:(Ct=1/Ct,Ze*=Ct,qe*=Ct,mt*=Ct,H=Math.sin(N),Kt=Math.cos(N),jt=1-Kt,E[0]=Ze*Ze*jt+Kt,E[1]=qe*Ze*jt+mt*H,E[2]=mt*Ze*jt-qe*H,E[3]=0,E[4]=Ze*qe*jt-mt*H,E[5]=qe*qe*jt+Kt,E[6]=mt*qe*jt+Ze*H,E[7]=0,E[8]=Ze*mt*jt+qe*H,E[9]=qe*mt*jt-Ze*H,E[10]=mt*mt*jt+Kt,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E)}function nr(E,N){var he=Math.sin(N),Ze=Math.cos(N);return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=Ze,E[6]=he,E[7]=0,E[8]=0,E[9]=-he,E[10]=Ze,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function xt(E,N){var he=Math.sin(N),Ze=Math.cos(N);return E[0]=Ze,E[1]=0,E[2]=-he,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=he,E[9]=0,E[10]=Ze,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Ke(E,N){var he=Math.sin(N),Ze=Math.cos(N);return E[0]=Ze,E[1]=he,E[2]=0,E[3]=0,E[4]=-he,E[5]=Ze,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function _t(E,N,he){var Ze=N[0],qe=N[1],mt=N[2],Ct=N[3],H=Ze+Ze,Kt=qe+qe,jt=mt+mt,hr=Ze*H,Cr=Ze*Kt,Tr=Ze*jt,Pr=qe*Kt,Je=qe*jt,yt=mt*jt,ht=Ct*H,fr=Ct*Kt,$r=Ct*jt;return E[0]=1-(Pr+yt),E[1]=Cr+$r,E[2]=Tr-fr,E[3]=0,E[4]=Cr-$r,E[5]=1-(hr+yt),E[6]=Je+ht,E[7]=0,E[8]=Tr+fr,E[9]=Je-ht,E[10]=1-(hr+Pr),E[11]=0,E[12]=he[0],E[13]=he[1],E[14]=he[2],E[15]=1,E}function Fe(E,N){var he=new Q.WT(3),Ze=-N[0],qe=-N[1],mt=-N[2],Ct=N[3],H=N[4],Kt=N[5],jt=N[6],hr=N[7],Cr=Ze*Ze+qe*qe+mt*mt+Ct*Ct;return Cr>0?(he[0]=(H*Ct+hr*Ze+Kt*mt-jt*qe)*2/Cr,he[1]=(Kt*Ct+hr*qe+jt*Ze-H*mt)*2/Cr,he[2]=(jt*Ct+hr*mt+H*qe-Kt*Ze)*2/Cr):(he[0]=(H*Ct+hr*Ze+Kt*mt-jt*qe)*2,he[1]=(Kt*Ct+hr*qe+jt*Ze-H*mt)*2,he[2]=(jt*Ct+hr*mt+H*qe-Kt*Ze)*2),_t(E,N,he),E}function Pe(E,N){return E[0]=N[12],E[1]=N[13],E[2]=N[14],E}function Ve(E,N){var he=N[0],Ze=N[1],qe=N[2],mt=N[4],Ct=N[5],H=N[6],Kt=N[8],jt=N[9],hr=N[10];return E[0]=Math.hypot(he,Ze,qe),E[1]=Math.hypot(mt,Ct,H),E[2]=Math.hypot(Kt,jt,hr),E}function Et(E,N){var he=new Q.WT(3);Ve(he,N);var Ze=1/he[0],qe=1/he[1],mt=1/he[2],Ct=N[0]*Ze,H=N[1]*qe,Kt=N[2]*mt,jt=N[4]*Ze,hr=N[5]*qe,Cr=N[6]*mt,Tr=N[8]*Ze,Pr=N[9]*qe,Je=N[10]*mt,yt=Ct+hr+Je,ht=0;return yt>0?(ht=Math.sqrt(yt+1)*2,E[3]=.25*ht,E[0]=(Cr-Pr)/ht,E[1]=(Tr-Kt)/ht,E[2]=(H-jt)/ht):Ct>hr&&Ct>Je?(ht=Math.sqrt(1+Ct-hr-Je)*2,E[3]=(Cr-Pr)/ht,E[0]=.25*ht,E[1]=(H+jt)/ht,E[2]=(Tr+Kt)/ht):hr>Je?(ht=Math.sqrt(1+hr-Ct-Je)*2,E[3]=(Tr-Kt)/ht,E[0]=(H+jt)/ht,E[1]=.25*ht,E[2]=(Cr+Pr)/ht):(ht=Math.sqrt(1+Je-Ct-hr)*2,E[3]=(H-jt)/ht,E[0]=(Tr+Kt)/ht,E[1]=(Cr+Pr)/ht,E[2]=.25*ht),E}function gr(E,N,he,Ze){var qe=N[0],mt=N[1],Ct=N[2],H=N[3],Kt=qe+qe,jt=mt+mt,hr=Ct+Ct,Cr=qe*Kt,Tr=qe*jt,Pr=qe*hr,Je=mt*jt,yt=mt*hr,ht=Ct*hr,fr=H*Kt,$r=H*jt,lt=H*hr,Rt=Ze[0],Qt=Ze[1],pr=Ze[2];return E[0]=(1-(Je+ht))*Rt,E[1]=(Tr+lt)*Rt,E[2]=(Pr-$r)*Rt,E[3]=0,E[4]=(Tr-lt)*Qt,E[5]=(1-(Cr+ht))*Qt,E[6]=(yt+fr)*Qt,E[7]=0,E[8]=(Pr+$r)*pr,E[9]=(yt-fr)*pr,E[10]=(1-(Cr+Je))*pr,E[11]=0,E[12]=he[0],E[13]=he[1],E[14]=he[2],E[15]=1,E}function ae(E,N,he,Ze,qe){var mt=N[0],Ct=N[1],H=N[2],Kt=N[3],jt=mt+mt,hr=Ct+Ct,Cr=H+H,Tr=mt*jt,Pr=mt*hr,Je=mt*Cr,yt=Ct*hr,ht=Ct*Cr,fr=H*Cr,$r=Kt*jt,lt=Kt*hr,Rt=Kt*Cr,Qt=Ze[0],pr=Ze[1],vn=Ze[2],Pn=qe[0],bi=qe[1],Si=qe[2],Ri=(1-(yt+fr))*Qt,ia=(Pr+Rt)*Qt,pi=(Je-lt)*Qt,G=(Pr-Rt)*pr,ie=(1-(Tr+fr))*pr,ce=(ht+$r)*pr,B=(Je+lt)*vn,re=(ht-$r)*vn,fe=(1-(Tr+yt))*vn;return E[0]=Ri,E[1]=ia,E[2]=pi,E[3]=0,E[4]=G,E[5]=ie,E[6]=ce,E[7]=0,E[8]=B,E[9]=re,E[10]=fe,E[11]=0,E[12]=he[0]+Pn-(Ri*Pn+G*bi+B*Si),E[13]=he[1]+bi-(ia*Pn+ie*bi+re*Si),E[14]=he[2]+Si-(pi*Pn+ce*bi+fe*Si),E[15]=1,E}function Ae(E,N){var he=N[0],Ze=N[1],qe=N[2],mt=N[3],Ct=he+he,H=Ze+Ze,Kt=qe+qe,jt=he*Ct,hr=Ze*Ct,Cr=Ze*H,Tr=qe*Ct,Pr=qe*H,Je=qe*Kt,yt=mt*Ct,ht=mt*H,fr=mt*Kt;return E[0]=1-Cr-Je,E[1]=hr+fr,E[2]=Tr-ht,E[3]=0,E[4]=hr-fr,E[5]=1-jt-Je,E[6]=Pr+yt,E[7]=0,E[8]=Tr+ht,E[9]=Pr-yt,E[10]=1-jt-Cr,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function oe(E,N,he,Ze,qe,mt,Ct){var H=1/(he-N),Kt=1/(qe-Ze),jt=1/(mt-Ct);return E[0]=mt*2*H,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=mt*2*Kt,E[6]=0,E[7]=0,E[8]=(he+N)*H,E[9]=(qe+Ze)*Kt,E[10]=(Ct+mt)*jt,E[11]=-1,E[12]=0,E[13]=0,E[14]=Ct*mt*2*jt,E[15]=0,E}function ge(E,N,he,Ze,qe){var mt=1/Math.tan(N/2),Ct;return E[0]=mt/he,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=mt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,qe!=null&&qe!==Infinity?(Ct=1/(Ze-qe),E[10]=(qe+Ze)*Ct,E[14]=2*qe*Ze*Ct):(E[10]=-1,E[14]=-2*Ze),E}function Me(E,N,he,Ze){var qe=Math.tan(N.upDegrees*Math.PI/180),mt=Math.tan(N.downDegrees*Math.PI/180),Ct=Math.tan(N.leftDegrees*Math.PI/180),H=Math.tan(N.rightDegrees*Math.PI/180),Kt=2/(Ct+H),jt=2/(qe+mt);return E[0]=Kt,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=jt,E[6]=0,E[7]=0,E[8]=-((Ct-H)*Kt*.5),E[9]=(qe-mt)*jt*.5,E[10]=Ze/(he-Ze),E[11]=-1,E[12]=0,E[13]=0,E[14]=Ze*he/(he-Ze),E[15]=0,E}function Qe(E,N,he,Ze,qe,mt,Ct){var H=1/(N-he),Kt=1/(Ze-qe),jt=1/(mt-Ct);return E[0]=-2*H,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=-2*Kt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=2*jt,E[11]=0,E[12]=(N+he)*H,E[13]=(qe+Ze)*Kt,E[14]=(Ct+mt)*jt,E[15]=1,E}function gt(E,N,he,Ze){var qe,mt,Ct,H,Kt,jt,hr,Cr,Tr,Pr,Je=N[0],yt=N[1],ht=N[2],fr=Ze[0],$r=Ze[1],lt=Ze[2],Rt=he[0],Qt=he[1],pr=he[2];return Math.abs(Je-Rt)<Q.Ib&&Math.abs(yt-Qt)<Q.Ib&&Math.abs(ht-pr)<Q.Ib?$(E):(hr=Je-Rt,Cr=yt-Qt,Tr=ht-pr,Pr=1/Math.hypot(hr,Cr,Tr),hr*=Pr,Cr*=Pr,Tr*=Pr,qe=$r*Tr-lt*Cr,mt=lt*hr-fr*Tr,Ct=fr*Cr-$r*hr,Pr=Math.hypot(qe,mt,Ct),Pr?(Pr=1/Pr,qe*=Pr,mt*=Pr,Ct*=Pr):(qe=0,mt=0,Ct=0),H=Cr*Ct-Tr*mt,Kt=Tr*qe-hr*Ct,jt=hr*mt-Cr*qe,Pr=Math.hypot(H,Kt,jt),Pr?(Pr=1/Pr,H*=Pr,Kt*=Pr,jt*=Pr):(H=0,Kt=0,jt=0),E[0]=qe,E[1]=H,E[2]=hr,E[3]=0,E[4]=mt,E[5]=Kt,E[6]=Cr,E[7]=0,E[8]=Ct,E[9]=jt,E[10]=Tr,E[11]=0,E[12]=-(qe*Je+mt*yt+Ct*ht),E[13]=-(H*Je+Kt*yt+jt*ht),E[14]=-(hr*Je+Cr*yt+Tr*ht),E[15]=1,E)}function Jt(E,N,he,Ze){var qe=N[0],mt=N[1],Ct=N[2],H=Ze[0],Kt=Ze[1],jt=Ze[2],hr=qe-he[0],Cr=mt-he[1],Tr=Ct-he[2],Pr=hr*hr+Cr*Cr+Tr*Tr;Pr>0&&(Pr=1/Math.sqrt(Pr),hr*=Pr,Cr*=Pr,Tr*=Pr);var Je=Kt*Tr-jt*Cr,yt=jt*hr-H*Tr,ht=H*Cr-Kt*hr;return Pr=Je*Je+yt*yt+ht*ht,Pr>0&&(Pr=1/Math.sqrt(Pr),Je*=Pr,yt*=Pr,ht*=Pr),E[0]=Je,E[1]=yt,E[2]=ht,E[3]=0,E[4]=Cr*ht-Tr*yt,E[5]=Tr*Je-hr*ht,E[6]=hr*yt-Cr*Je,E[7]=0,E[8]=hr,E[9]=Cr,E[10]=Tr,E[11]=0,E[12]=qe,E[13]=mt,E[14]=Ct,E[15]=1,E}function Dr(E){return"mat4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+", "+E[8]+", "+E[9]+", "+E[10]+", "+E[11]+", "+E[12]+", "+E[13]+", "+E[14]+", "+E[15]+")"}function Br(E){return Math.hypot(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15])}function un(E,N,he){return E[0]=N[0]+he[0],E[1]=N[1]+he[1],E[2]=N[2]+he[2],E[3]=N[3]+he[3],E[4]=N[4]+he[4],E[5]=N[5]+he[5],E[6]=N[6]+he[6],E[7]=N[7]+he[7],E[8]=N[8]+he[8],E[9]=N[9]+he[9],E[10]=N[10]+he[10],E[11]=N[11]+he[11],E[12]=N[12]+he[12],E[13]=N[13]+he[13],E[14]=N[14]+he[14],E[15]=N[15]+he[15],E}function tr(E,N,he){return E[0]=N[0]-he[0],E[1]=N[1]-he[1],E[2]=N[2]-he[2],E[3]=N[3]-he[3],E[4]=N[4]-he[4],E[5]=N[5]-he[5],E[6]=N[6]-he[6],E[7]=N[7]-he[7],E[8]=N[8]-he[8],E[9]=N[9]-he[9],E[10]=N[10]-he[10],E[11]=N[11]-he[11],E[12]=N[12]-he[12],E[13]=N[13]-he[13],E[14]=N[14]-he[14],E[15]=N[15]-he[15],E}function se(E,N,he){return E[0]=N[0]*he,E[1]=N[1]*he,E[2]=N[2]*he,E[3]=N[3]*he,E[4]=N[4]*he,E[5]=N[5]*he,E[6]=N[6]*he,E[7]=N[7]*he,E[8]=N[8]*he,E[9]=N[9]*he,E[10]=N[10]*he,E[11]=N[11]*he,E[12]=N[12]*he,E[13]=N[13]*he,E[14]=N[14]*he,E[15]=N[15]*he,E}function be(E,N,he,Ze){return E[0]=N[0]+he[0]*Ze,E[1]=N[1]+he[1]*Ze,E[2]=N[2]+he[2]*Ze,E[3]=N[3]+he[3]*Ze,E[4]=N[4]+he[4]*Ze,E[5]=N[5]+he[5]*Ze,E[6]=N[6]+he[6]*Ze,E[7]=N[7]+he[7]*Ze,E[8]=N[8]+he[8]*Ze,E[9]=N[9]+he[9]*Ze,E[10]=N[10]+he[10]*Ze,E[11]=N[11]+he[11]*Ze,E[12]=N[12]+he[12]*Ze,E[13]=N[13]+he[13]*Ze,E[14]=N[14]+he[14]*Ze,E[15]=N[15]+he[15]*Ze,E}function ke(E,N){return E[0]===N[0]&&E[1]===N[1]&&E[2]===N[2]&&E[3]===N[3]&&E[4]===N[4]&&E[5]===N[5]&&E[6]===N[6]&&E[7]===N[7]&&E[8]===N[8]&&E[9]===N[9]&&E[10]===N[10]&&E[11]===N[11]&&E[12]===N[12]&&E[13]===N[13]&&E[14]===N[14]&&E[15]===N[15]}function Ce(E,N){var he=E[0],Ze=E[1],qe=E[2],mt=E[3],Ct=E[4],H=E[5],Kt=E[6],jt=E[7],hr=E[8],Cr=E[9],Tr=E[10],Pr=E[11],Je=E[12],yt=E[13],ht=E[14],fr=E[15],$r=N[0],lt=N[1],Rt=N[2],Qt=N[3],pr=N[4],vn=N[5],Pn=N[6],bi=N[7],Si=N[8],Ri=N[9],ia=N[10],pi=N[11],G=N[12],ie=N[13],ce=N[14],B=N[15];return Math.abs(he-$r)<=Q.Ib*Math.max(1,Math.abs(he),Math.abs($r))&&Math.abs(Ze-lt)<=Q.Ib*Math.max(1,Math.abs(Ze),Math.abs(lt))&&Math.abs(qe-Rt)<=Q.Ib*Math.max(1,Math.abs(qe),Math.abs(Rt))&&Math.abs(mt-Qt)<=Q.Ib*Math.max(1,Math.abs(mt),Math.abs(Qt))&&Math.abs(Ct-pr)<=Q.Ib*Math.max(1,Math.abs(Ct),Math.abs(pr))&&Math.abs(H-vn)<=Q.Ib*Math.max(1,Math.abs(H),Math.abs(vn))&&Math.abs(Kt-Pn)<=Q.Ib*Math.max(1,Math.abs(Kt),Math.abs(Pn))&&Math.abs(jt-bi)<=Q.Ib*Math.max(1,Math.abs(jt),Math.abs(bi))&&Math.abs(hr-Si)<=Q.Ib*Math.max(1,Math.abs(hr),Math.abs(Si))&&Math.abs(Cr-Ri)<=Q.Ib*Math.max(1,Math.abs(Cr),Math.abs(Ri))&&Math.abs(Tr-ia)<=Q.Ib*Math.max(1,Math.abs(Tr),Math.abs(ia))&&Math.abs(Pr-pi)<=Q.Ib*Math.max(1,Math.abs(Pr),Math.abs(pi))&&Math.abs(Je-G)<=Q.Ib*Math.max(1,Math.abs(Je),Math.abs(G))&&Math.abs(yt-ie)<=Q.Ib*Math.max(1,Math.abs(yt),Math.abs(ie))&&Math.abs(ht-ce)<=Q.Ib*Math.max(1,Math.abs(ht),Math.abs(ce))&&Math.abs(fr-B)<=Q.Ib*Math.max(1,Math.abs(fr),Math.abs(B))}var Pt=We,Dt=tr},98333:function(sr,L,x){"use strict";x.d(L,{Ue:function(){return w},al:function(){return b},bA:function(){return kt},fF:function(){return Et}});var Q=x(49685);function w(){var se=new Q.WT(4);return Q.WT!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0,se[3]=0),se}function d(se){var be=new glMatrix.ARRAY_TYPE(4);return be[0]=se[0],be[1]=se[1],be[2]=se[2],be[3]=se[3],be}function b(se,be,ke,Ce){var Pt=new Q.WT(4);return Pt[0]=se,Pt[1]=be,Pt[2]=ke,Pt[3]=Ce,Pt}function Y(se,be){return se[0]=be[0],se[1]=be[1],se[2]=be[2],se[3]=be[3],se}function W(se,be,ke,Ce,Pt){return se[0]=be,se[1]=ke,se[2]=Ce,se[3]=Pt,se}function $(se,be,ke){return se[0]=be[0]+ke[0],se[1]=be[1]+ke[1],se[2]=be[2]+ke[2],se[3]=be[3]+ke[3],se}function I(se,be,ke){return se[0]=be[0]-ke[0],se[1]=be[1]-ke[1],se[2]=be[2]-ke[2],se[3]=be[3]-ke[3],se}function k(se,be,ke){return se[0]=be[0]*ke[0],se[1]=be[1]*ke[1],se[2]=be[2]*ke[2],se[3]=be[3]*ke[3],se}function we(se,be,ke){return se[0]=be[0]/ke[0],se[1]=be[1]/ke[1],se[2]=be[2]/ke[2],se[3]=be[3]/ke[3],se}function Be(se,be){return se[0]=Math.ceil(be[0]),se[1]=Math.ceil(be[1]),se[2]=Math.ceil(be[2]),se[3]=Math.ceil(be[3]),se}function We(se,be){return se[0]=Math.floor(be[0]),se[1]=Math.floor(be[1]),se[2]=Math.floor(be[2]),se[3]=Math.floor(be[3]),se}function $e(se,be,ke){return se[0]=Math.min(be[0],ke[0]),se[1]=Math.min(be[1],ke[1]),se[2]=Math.min(be[2],ke[2]),se[3]=Math.min(be[3],ke[3]),se}function Ut(se,be,ke){return se[0]=Math.max(be[0],ke[0]),se[1]=Math.max(be[1],ke[1]),se[2]=Math.max(be[2],ke[2]),se[3]=Math.max(be[3],ke[3]),se}function Yt(se,be){return se[0]=Math.round(be[0]),se[1]=Math.round(be[1]),se[2]=Math.round(be[2]),se[3]=Math.round(be[3]),se}function kt(se,be,ke){return se[0]=be[0]*ke,se[1]=be[1]*ke,se[2]=be[2]*ke,se[3]=be[3]*ke,se}function Lt(se,be,ke,Ce){return se[0]=be[0]+ke[0]*Ce,se[1]=be[1]+ke[1]*Ce,se[2]=be[2]+ke[2]*Ce,se[3]=be[3]+ke[3]*Ce,se}function bt(se,be){var ke=be[0]-se[0],Ce=be[1]-se[1],Pt=be[2]-se[2],Dt=be[3]-se[3];return Math.hypot(ke,Ce,Pt,Dt)}function pt(se,be){var ke=be[0]-se[0],Ce=be[1]-se[1],Pt=be[2]-se[2],Dt=be[3]-se[3];return ke*ke+Ce*Ce+Pt*Pt+Dt*Dt}function Ir(se){var be=se[0],ke=se[1],Ce=se[2],Pt=se[3];return Math.hypot(be,ke,Ce,Pt)}function er(se){var be=se[0],ke=se[1],Ce=se[2],Pt=se[3];return be*be+ke*ke+Ce*Ce+Pt*Pt}function nr(se,be){return se[0]=-be[0],se[1]=-be[1],se[2]=-be[2],se[3]=-be[3],se}function xt(se,be){return se[0]=1/be[0],se[1]=1/be[1],se[2]=1/be[2],se[3]=1/be[3],se}function Ke(se,be){var ke=be[0],Ce=be[1],Pt=be[2],Dt=be[3],E=ke*ke+Ce*Ce+Pt*Pt+Dt*Dt;return E>0&&(E=1/Math.sqrt(E)),se[0]=ke*E,se[1]=Ce*E,se[2]=Pt*E,se[3]=Dt*E,se}function _t(se,be){return se[0]*be[0]+se[1]*be[1]+se[2]*be[2]+se[3]*be[3]}function Fe(se,be,ke,Ce){var Pt=ke[0]*Ce[1]-ke[1]*Ce[0],Dt=ke[0]*Ce[2]-ke[2]*Ce[0],E=ke[0]*Ce[3]-ke[3]*Ce[0],N=ke[1]*Ce[2]-ke[2]*Ce[1],he=ke[1]*Ce[3]-ke[3]*Ce[1],Ze=ke[2]*Ce[3]-ke[3]*Ce[2],qe=be[0],mt=be[1],Ct=be[2],H=be[3];return se[0]=mt*Ze-Ct*he+H*N,se[1]=-(qe*Ze)+Ct*E-H*Dt,se[2]=qe*he-mt*E+H*Pt,se[3]=-(qe*N)+mt*Dt-Ct*Pt,se}function Pe(se,be,ke,Ce){var Pt=be[0],Dt=be[1],E=be[2],N=be[3];return se[0]=Pt+Ce*(ke[0]-Pt),se[1]=Dt+Ce*(ke[1]-Dt),se[2]=E+Ce*(ke[2]-E),se[3]=N+Ce*(ke[3]-N),se}function Ve(se,be){be=be||1;var ke,Ce,Pt,Dt,E,N;do ke=glMatrix.RANDOM()*2-1,Ce=glMatrix.RANDOM()*2-1,E=ke*ke+Ce*Ce;while(E>=1);do Pt=glMatrix.RANDOM()*2-1,Dt=glMatrix.RANDOM()*2-1,N=Pt*Pt+Dt*Dt;while(N>=1);var he=Math.sqrt((1-E)/N);return se[0]=be*ke,se[1]=be*Ce,se[2]=be*Pt*he,se[3]=be*Dt*he,se}function Et(se,be,ke){var Ce=be[0],Pt=be[1],Dt=be[2],E=be[3];return se[0]=ke[0]*Ce+ke[4]*Pt+ke[8]*Dt+ke[12]*E,se[1]=ke[1]*Ce+ke[5]*Pt+ke[9]*Dt+ke[13]*E,se[2]=ke[2]*Ce+ke[6]*Pt+ke[10]*Dt+ke[14]*E,se[3]=ke[3]*Ce+ke[7]*Pt+ke[11]*Dt+ke[15]*E,se}function gr(se,be,ke){var Ce=be[0],Pt=be[1],Dt=be[2],E=ke[0],N=ke[1],he=ke[2],Ze=ke[3],qe=Ze*Ce+N*Dt-he*Pt,mt=Ze*Pt+he*Ce-E*Dt,Ct=Ze*Dt+E*Pt-N*Ce,H=-E*Ce-N*Pt-he*Dt;return se[0]=qe*Ze+H*-E+mt*-he-Ct*-N,se[1]=mt*Ze+H*-N+Ct*-E-qe*-he,se[2]=Ct*Ze+H*-he+qe*-N-mt*-E,se[3]=be[3],se}function ae(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=0,se}function Ae(se){return"vec4("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"}function oe(se,be){return se[0]===be[0]&&se[1]===be[1]&&se[2]===be[2]&&se[3]===be[3]}function ge(se,be){var ke=se[0],Ce=se[1],Pt=se[2],Dt=se[3],E=be[0],N=be[1],he=be[2],Ze=be[3];return Math.abs(ke-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(ke),Math.abs(E))&&Math.abs(Ce-N)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(N))&&Math.abs(Pt-he)<=glMatrix.EPSILON*Math.max(1,Math.abs(Pt),Math.abs(he))&&Math.abs(Dt-Ze)<=glMatrix.EPSILON*Math.max(1,Math.abs(Dt),Math.abs(Ze))}var Me=null,Qe=null,gt=null,Jt=null,Dr=null,Br=null,un=null,tr=function(){var se=w();return function(be,ke,Ce,Pt,Dt,E){var N,he;for(ke||(ke=4),Ce||(Ce=0),Pt?he=Math.min(Pt*ke+Ce,be.length):he=be.length,N=Ce;N<he;N+=ke)se[0]=be[N],se[1]=be[N+1],se[2]=be[N+2],se[3]=be[N+3],Dt(se,se,E),be[N]=se[0],be[N+1]=se[1],be[N+2]=se[2],be[N+3]=se[3];return be}}()},50840:function(sr,L,x){var Q;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(w,d,b,Y){"use strict";var W=["","webkit","Moz","MS","ms","o"],$=d.createElement("div"),I="function",k=Math.round,we=Math.abs,Be=Date.now;function We(pe,Oe,ft){return setTimeout(Ir(pe,ft),Oe)}function $e(pe,Oe,ft){return Array.isArray(pe)?(Ut(pe,ft[Oe],ft),!0):!1}function Ut(pe,Oe,ft){var ur;if(!!pe)if(pe.forEach)pe.forEach(Oe,ft);else if(pe.length!==Y)for(ur=0;ur<pe.length;)Oe.call(ft,pe[ur],ur,pe),ur++;else for(ur in pe)pe.hasOwnProperty(ur)&&Oe.call(ft,pe[ur],ur,pe)}function Yt(pe,Oe,ft){var ur="DEPRECATED METHOD: "+Oe+`
`+ft+` AT 
`;return function(){var Qr=new Error("get-stack-trace"),Dn=Qr&&Qr.stack?Qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ki=w.console&&(w.console.warn||w.console.log);return Ki&&Ki.call(w.console,ur,Dn),pe.apply(this,arguments)}}var kt;typeof Object.assign!="function"?kt=function(Oe){if(Oe===Y||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ft=Object(Oe),ur=1;ur<arguments.length;ur++){var Qr=arguments[ur];if(Qr!==Y&&Qr!==null)for(var Dn in Qr)Qr.hasOwnProperty(Dn)&&(ft[Dn]=Qr[Dn])}return ft}:kt=Object.assign;var Lt=Yt(function(Oe,ft,ur){for(var Qr=Object.keys(ft),Dn=0;Dn<Qr.length;)(!ur||ur&&Oe[Qr[Dn]]===Y)&&(Oe[Qr[Dn]]=ft[Qr[Dn]]),Dn++;return Oe},"extend","Use `assign`."),bt=Yt(function(Oe,ft){return Lt(Oe,ft,!0)},"merge","Use `assign`.");function pt(pe,Oe,ft){var ur=Oe.prototype,Qr;Qr=pe.prototype=Object.create(ur),Qr.constructor=pe,Qr._super=ur,ft&&kt(Qr,ft)}function Ir(pe,Oe){return function(){return pe.apply(Oe,arguments)}}function er(pe,Oe){return typeof pe==I?pe.apply(Oe&&Oe[0]||Y,Oe):pe}function nr(pe,Oe){return pe===Y?Oe:pe}function xt(pe,Oe,ft){Ut(Pe(Oe),function(ur){pe.addEventListener(ur,ft,!1)})}function Ke(pe,Oe,ft){Ut(Pe(Oe),function(ur){pe.removeEventListener(ur,ft,!1)})}function _t(pe,Oe){for(;pe;){if(pe==Oe)return!0;pe=pe.parentNode}return!1}function Fe(pe,Oe){return pe.indexOf(Oe)>-1}function Pe(pe){return pe.trim().split(/\s+/g)}function Ve(pe,Oe,ft){if(pe.indexOf&&!ft)return pe.indexOf(Oe);for(var ur=0;ur<pe.length;){if(ft&&pe[ur][ft]==Oe||!ft&&pe[ur]===Oe)return ur;ur++}return-1}function Et(pe){return Array.prototype.slice.call(pe,0)}function gr(pe,Oe,ft){for(var ur=[],Qr=[],Dn=0;Dn<pe.length;){var Ki=Oe?pe[Dn][Oe]:pe[Dn];Ve(Qr,Ki)<0&&ur.push(pe[Dn]),Qr[Dn]=Ki,Dn++}return ft&&(Oe?ur=ur.sort(function(La,ja){return La[Oe]>ja[Oe]}):ur=ur.sort()),ur}function ae(pe,Oe){for(var ft,ur,Qr=Oe[0].toUpperCase()+Oe.slice(1),Dn=0;Dn<W.length;){if(ft=W[Dn],ur=ft?ft+Qr:Oe,ur in pe)return ur;Dn++}return Y}var Ae=1;function oe(){return Ae++}function ge(pe){var Oe=pe.ownerDocument||pe;return Oe.defaultView||Oe.parentWindow||w}var Me=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in w,gt=ae(w,"PointerEvent")!==Y,Jt=Qe&&Me.test(navigator.userAgent),Dr="touch",Br="pen",un="mouse",tr="kinect",se=25,be=1,ke=2,Ce=4,Pt=8,Dt=1,E=2,N=4,he=8,Ze=16,qe=E|N,mt=he|Ze,Ct=qe|mt,H=["x","y"],Kt=["clientX","clientY"];function jt(pe,Oe){var ft=this;this.manager=pe,this.callback=Oe,this.element=pe.element,this.target=pe.options.inputTarget,this.domHandler=function(ur){er(pe.options.enable,[pe])&&ft.handler(ur)},this.init()}jt.prototype={handler:function(){},init:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(ge(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(ge(this.element),this.evWin,this.domHandler)}};function hr(pe){var Oe,ft=pe.options.inputClass;return ft?Oe=ft:gt?Oe=ie:Jt?Oe=ct:Qe?Oe=kr:Oe=Si,new Oe(pe,Cr)}function Cr(pe,Oe,ft){var ur=ft.pointers.length,Qr=ft.changedPointers.length,Dn=Oe&be&&ur-Qr==0,Ki=Oe&(Ce|Pt)&&ur-Qr==0;ft.isFirst=!!Dn,ft.isFinal=!!Ki,Dn&&(pe.session={}),ft.eventType=Oe,Tr(pe,ft),pe.emit("hammer.input",ft),pe.recognize(ft),pe.session.prevInput=ft}function Tr(pe,Oe){var ft=pe.session,ur=Oe.pointers,Qr=ur.length;ft.firstInput||(ft.firstInput=yt(Oe)),Qr>1&&!ft.firstMultiple?ft.firstMultiple=yt(Oe):Qr===1&&(ft.firstMultiple=!1);var Dn=ft.firstInput,Ki=ft.firstMultiple,Ua=Ki?Ki.center:Dn.center,La=Oe.center=ht(ur);Oe.timeStamp=Be(),Oe.deltaTime=Oe.timeStamp-Dn.timeStamp,Oe.angle=Rt(Ua,La),Oe.distance=lt(Ua,La),Pr(ft,Oe),Oe.offsetDirection=$r(Oe.deltaX,Oe.deltaY);var ja=fr(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=ja.x,Oe.overallVelocityY=ja.y,Oe.overallVelocity=we(ja.x)>we(ja.y)?ja.x:ja.y,Oe.scale=Ki?pr(Ki.pointers,ur):1,Oe.rotation=Ki?Qt(Ki.pointers,ur):0,Oe.maxPointers=ft.prevInput?Oe.pointers.length>ft.prevInput.maxPointers?Oe.pointers.length:ft.prevInput.maxPointers:Oe.pointers.length,Je(ft,Oe);var To=pe.element;_t(Oe.srcEvent.target,To)&&(To=Oe.srcEvent.target),Oe.target=To}function Pr(pe,Oe){var ft=Oe.center,ur=pe.offsetDelta||{},Qr=pe.prevDelta||{},Dn=pe.prevInput||{};(Oe.eventType===be||Dn.eventType===Ce)&&(Qr=pe.prevDelta={x:Dn.deltaX||0,y:Dn.deltaY||0},ur=pe.offsetDelta={x:ft.x,y:ft.y}),Oe.deltaX=Qr.x+(ft.x-ur.x),Oe.deltaY=Qr.y+(ft.y-ur.y)}function Je(pe,Oe){var ft=pe.lastInterval||Oe,ur=Oe.timeStamp-ft.timeStamp,Qr,Dn,Ki,Ua;if(Oe.eventType!=Pt&&(ur>se||ft.velocity===Y)){var La=Oe.deltaX-ft.deltaX,ja=Oe.deltaY-ft.deltaY,To=fr(ur,La,ja);Dn=To.x,Ki=To.y,Qr=we(To.x)>we(To.y)?To.x:To.y,Ua=$r(La,ja),pe.lastInterval=Oe}else Qr=ft.velocity,Dn=ft.velocityX,Ki=ft.velocityY,Ua=ft.direction;Oe.velocity=Qr,Oe.velocityX=Dn,Oe.velocityY=Ki,Oe.direction=Ua}function yt(pe){for(var Oe=[],ft=0;ft<pe.pointers.length;)Oe[ft]={clientX:k(pe.pointers[ft].clientX),clientY:k(pe.pointers[ft].clientY)},ft++;return{timeStamp:Be(),pointers:Oe,center:ht(Oe),deltaX:pe.deltaX,deltaY:pe.deltaY}}function ht(pe){var Oe=pe.length;if(Oe===1)return{x:k(pe[0].clientX),y:k(pe[0].clientY)};for(var ft=0,ur=0,Qr=0;Qr<Oe;)ft+=pe[Qr].clientX,ur+=pe[Qr].clientY,Qr++;return{x:k(ft/Oe),y:k(ur/Oe)}}function fr(pe,Oe,ft){return{x:Oe/pe||0,y:ft/pe||0}}function $r(pe,Oe){return pe===Oe?Dt:we(pe)>=we(Oe)?pe<0?E:N:Oe<0?he:Ze}function lt(pe,Oe,ft){ft||(ft=H);var ur=Oe[ft[0]]-pe[ft[0]],Qr=Oe[ft[1]]-pe[ft[1]];return Math.sqrt(ur*ur+Qr*Qr)}function Rt(pe,Oe,ft){ft||(ft=H);var ur=Oe[ft[0]]-pe[ft[0]],Qr=Oe[ft[1]]-pe[ft[1]];return Math.atan2(Qr,ur)*180/Math.PI}function Qt(pe,Oe){return Rt(Oe[1],Oe[0],Kt)+Rt(pe[1],pe[0],Kt)}function pr(pe,Oe){return lt(Oe[0],Oe[1],Kt)/lt(pe[0],pe[1],Kt)}var vn={mousedown:be,mousemove:ke,mouseup:Ce},Pn="mousedown",bi="mousemove mouseup";function Si(){this.evEl=Pn,this.evWin=bi,this.pressed=!1,jt.apply(this,arguments)}pt(Si,jt,{handler:function(Oe){var ft=vn[Oe.type];ft&be&&Oe.button===0&&(this.pressed=!0),ft&ke&&Oe.which!==1&&(ft=Ce),!!this.pressed&&(ft&Ce&&(this.pressed=!1),this.callback(this.manager,ft,{pointers:[Oe],changedPointers:[Oe],pointerType:un,srcEvent:Oe}))}});var Ri={pointerdown:be,pointermove:ke,pointerup:Ce,pointercancel:Pt,pointerout:Pt},ia={2:Dr,3:Br,4:un,5:tr},pi="pointerdown",G="pointermove pointerup pointercancel";w.MSPointerEvent&&!w.PointerEvent&&(pi="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function ie(){this.evEl=pi,this.evWin=G,jt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pt(ie,jt,{handler:function(Oe){var ft=this.store,ur=!1,Qr=Oe.type.toLowerCase().replace("ms",""),Dn=Ri[Qr],Ki=ia[Oe.pointerType]||Oe.pointerType,Ua=Ki==Dr,La=Ve(ft,Oe.pointerId,"pointerId");Dn&be&&(Oe.button===0||Ua)?La<0&&(ft.push(Oe),La=ft.length-1):Dn&(Ce|Pt)&&(ur=!0),!(La<0)&&(ft[La]=Oe,this.callback(this.manager,Dn,{pointers:ft,changedPointers:[Oe],pointerType:Ki,srcEvent:Oe}),ur&&ft.splice(La,1))}});var ce={touchstart:be,touchmove:ke,touchend:Ce,touchcancel:Pt},B="touchstart",re="touchstart touchmove touchend touchcancel";function fe(){this.evTarget=B,this.evWin=re,this.started=!1,jt.apply(this,arguments)}pt(fe,jt,{handler:function(Oe){var ft=ce[Oe.type];if(ft===be&&(this.started=!0),!!this.started){var ur=Se.call(this,Oe,ft);ft&(Ce|Pt)&&ur[0].length-ur[1].length==0&&(this.started=!1),this.callback(this.manager,ft,{pointers:ur[0],changedPointers:ur[1],pointerType:Dr,srcEvent:Oe})}}});function Se(pe,Oe){var ft=Et(pe.touches),ur=Et(pe.changedTouches);return Oe&(Ce|Pt)&&(ft=gr(ft.concat(ur),"identifier",!0)),[ft,ur]}var te={touchstart:be,touchmove:ke,touchend:Ce,touchcancel:Pt},me="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=me,this.targetIds={},jt.apply(this,arguments)}pt(ct,jt,{handler:function(Oe){var ft=te[Oe.type],ur=yr.call(this,Oe,ft);!ur||this.callback(this.manager,ft,{pointers:ur[0],changedPointers:ur[1],pointerType:Dr,srcEvent:Oe})}});function yr(pe,Oe){var ft=Et(pe.touches),ur=this.targetIds;if(Oe&(be|ke)&&ft.length===1)return ur[ft[0].identifier]=!0,[ft,ft];var Qr,Dn,Ki=Et(pe.changedTouches),Ua=[],La=this.target;if(Dn=ft.filter(function(ja){return _t(ja.target,La)}),Oe===be)for(Qr=0;Qr<Dn.length;)ur[Dn[Qr].identifier]=!0,Qr++;for(Qr=0;Qr<Ki.length;)ur[Ki[Qr].identifier]&&Ua.push(Ki[Qr]),Oe&(Ce|Pt)&&delete ur[Ki[Qr].identifier],Qr++;if(!!Ua.length)return[gr(Dn.concat(Ua),"identifier",!0),Ua]}var Or=2500,Ft=25;function kr(){jt.apply(this,arguments);var pe=Ir(this.handler,this);this.touch=new ct(this.manager,pe),this.mouse=new Si(this.manager,pe),this.primaryTouch=null,this.lastTouches=[]}pt(kr,jt,{handler:function(Oe,ft,ur){var Qr=ur.pointerType==Dr,Dn=ur.pointerType==un;if(!(Dn&&ur.sourceCapabilities&&ur.sourceCapabilities.firesTouchEvents)){if(Qr)bn.call(this,ft,ur);else if(Dn&&mr.call(this,ur))return;this.callback(Oe,ft,ur)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function bn(pe,Oe){pe&be?(this.primaryTouch=Oe.changedPointers[0].identifier,gn.call(this,Oe)):pe&(Ce|Pt)&&gn.call(this,Oe)}function gn(pe){var Oe=pe.changedPointers[0];if(Oe.identifier===this.primaryTouch){var ft={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(ft);var ur=this.lastTouches,Qr=function(){var Dn=ur.indexOf(ft);Dn>-1&&ur.splice(Dn,1)};setTimeout(Qr,Or)}}function mr(pe){for(var Oe=pe.srcEvent.clientX,ft=pe.srcEvent.clientY,ur=0;ur<this.lastTouches.length;ur++){var Qr=this.lastTouches[ur],Dn=Math.abs(Oe-Qr.x),Ki=Math.abs(ft-Qr.y);if(Dn<=Ft&&Ki<=Ft)return!0}return!1}var dn=ae($.style,"touchAction"),Wr=dn!==Y,ln="compute",Ei="auto",hn="manipulation",wi="none",Yi="pan-x",Yn="pan-y",Di=Wn();function ki(pe,Oe){this.manager=pe,this.set(Oe)}ki.prototype={set:function(pe){pe==ln&&(pe=this.compute()),Wr&&this.manager.element.style&&Di[pe]&&(this.manager.element.style[dn]=pe),this.actions=pe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var pe=[];return Ut(this.manager.recognizers,function(Oe){er(Oe.options.enable,[Oe])&&(pe=pe.concat(Oe.getTouchAction()))}),za(pe.join(" "))},preventDefaults:function(pe){var Oe=pe.srcEvent,ft=pe.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var ur=this.actions,Qr=Fe(ur,wi)&&!Di[wi],Dn=Fe(ur,Yn)&&!Di[Yn],Ki=Fe(ur,Yi)&&!Di[Yi];if(Qr){var Ua=pe.pointers.length===1,La=pe.distance<2,ja=pe.deltaTime<250;if(Ua&&La&&ja)return}if(!(Ki&&Dn)&&(Qr||Dn&&ft&qe||Ki&&ft&mt))return this.preventSrc(Oe)},preventSrc:function(pe){this.manager.session.prevented=!0,pe.preventDefault()}};function za(pe){if(Fe(pe,wi))return wi;var Oe=Fe(pe,Yi),ft=Fe(pe,Yn);return Oe&&ft?wi:Oe||ft?Oe?Yi:Yn:Fe(pe,hn)?hn:Ei}function Wn(){if(!Wr)return!1;var pe={},Oe=w.CSS&&w.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ft){pe[ft]=Oe?w.CSS.supports("touch-action",ft):!0}),pe}var ai=1,Ai=2,Qn=4,Fi=8,ya=Fi,Xa=16,_a=32;function da(pe){this.options=kt({},this.defaults,pe||{}),this.id=oe(),this.manager=null,this.options.enable=nr(this.options.enable,!0),this.state=ai,this.simultaneous={},this.requireFail=[]}da.prototype={defaults:{},set:function(pe){return kt(this.options,pe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(pe){if($e(pe,"recognizeWith",this))return this;var Oe=this.simultaneous;return pe=gi(pe,this),Oe[pe.id]||(Oe[pe.id]=pe,pe.recognizeWith(this)),this},dropRecognizeWith:function(pe){return $e(pe,"dropRecognizeWith",this)?this:(pe=gi(pe,this),delete this.simultaneous[pe.id],this)},requireFailure:function(pe){if($e(pe,"requireFailure",this))return this;var Oe=this.requireFail;return pe=gi(pe,this),Ve(Oe,pe)===-1&&(Oe.push(pe),pe.requireFailure(this)),this},dropRequireFailure:function(pe){if($e(pe,"dropRequireFailure",this))return this;pe=gi(pe,this);var Oe=Ve(this.requireFail,pe);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(pe){return!!this.simultaneous[pe.id]},emit:function(pe){var Oe=this,ft=this.state;function ur(Qr){Oe.manager.emit(Qr,pe)}ft<Fi&&ur(Oe.options.event+Vu(ft)),ur(Oe.options.event),pe.additionalEvent&&ur(pe.additionalEvent),ft>=Fi&&ur(Oe.options.event+Vu(ft))},tryEmit:function(pe){if(this.canEmit())return this.emit(pe);this.state=_a},canEmit:function(){for(var pe=0;pe<this.requireFail.length;){if(!(this.requireFail[pe].state&(_a|ai)))return!1;pe++}return!0},recognize:function(pe){var Oe=kt({},pe);if(!er(this.options.enable,[this,Oe])){this.reset(),this.state=_a;return}this.state&(ya|Xa|_a)&&(this.state=ai),this.state=this.process(Oe),this.state&(Ai|Qn|Fi|Xa)&&this.tryEmit(Oe)},process:function(pe){},getTouchAction:function(){},reset:function(){}};function Vu(pe){return pe&Xa?"cancel":pe&Fi?"end":pe&Qn?"move":pe&Ai?"start":""}function Ya(pe){return pe==Ze?"down":pe==he?"up":pe==E?"left":pe==N?"right":""}function gi(pe,Oe){var ft=Oe.manager;return ft?ft.get(pe):pe}function qa(){da.apply(this,arguments)}pt(qa,da,{defaults:{pointers:1},attrTest:function(pe){var Oe=this.options.pointers;return Oe===0||pe.pointers.length===Oe},process:function(pe){var Oe=this.state,ft=pe.eventType,ur=Oe&(Ai|Qn),Qr=this.attrTest(pe);return ur&&(ft&Pt||!Qr)?Oe|Xa:ur||Qr?ft&Ce?Oe|Fi:Oe&Ai?Oe|Qn:Ai:_a}});function Ka(){qa.apply(this,arguments),this.pX=null,this.pY=null}pt(Ka,qa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ct},getTouchAction:function(){var pe=this.options.direction,Oe=[];return pe&qe&&Oe.push(Yn),pe&mt&&Oe.push(Yi),Oe},directionTest:function(pe){var Oe=this.options,ft=!0,ur=pe.distance,Qr=pe.direction,Dn=pe.deltaX,Ki=pe.deltaY;return Qr&Oe.direction||(Oe.direction&qe?(Qr=Dn===0?Dt:Dn<0?E:N,ft=Dn!=this.pX,ur=Math.abs(pe.deltaX)):(Qr=Ki===0?Dt:Ki<0?he:Ze,ft=Ki!=this.pY,ur=Math.abs(pe.deltaY))),pe.direction=Qr,ft&&ur>Oe.threshold&&Qr&Oe.direction},attrTest:function(pe){return qa.prototype.attrTest.call(this,pe)&&(this.state&Ai||!(this.state&Ai)&&this.directionTest(pe))},emit:function(pe){this.pX=pe.deltaX,this.pY=pe.deltaY;var Oe=Ya(pe.direction);Oe&&(pe.additionalEvent=this.options.event+Oe),this._super.emit.call(this,pe)}});function $a(){qa.apply(this,arguments)}pt($a,qa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.scale-1)>this.options.threshold||this.state&Ai)},emit:function(pe){if(pe.scale!==1){var Oe=pe.scale<1?"in":"out";pe.additionalEvent=this.options.event+Oe}this._super.emit.call(this,pe)}});function Yo(){da.apply(this,arguments),this._timer=null,this._input=null}pt(Yo,da,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ei]},process:function(pe){var Oe=this.options,ft=pe.pointers.length===Oe.pointers,ur=pe.distance<Oe.threshold,Qr=pe.deltaTime>Oe.time;if(this._input=pe,!ur||!ft||pe.eventType&(Ce|Pt)&&!Qr)this.reset();else if(pe.eventType&be)this.reset(),this._timer=We(function(){this.state=ya,this.tryEmit()},Oe.time,this);else if(pe.eventType&Ce)return ya;return _a},reset:function(){clearTimeout(this._timer)},emit:function(pe){this.state===ya&&(pe&&pe.eventType&Ce?this.manager.emit(this.options.event+"up",pe):(this._input.timeStamp=Be(),this.manager.emit(this.options.event,this._input)))}});function Gi(){qa.apply(this,arguments)}pt(Gi,qa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.rotation)>this.options.threshold||this.state&Ai)}});function Oo(){qa.apply(this,arguments)}pt(Oo,qa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qe|mt,pointers:1},getTouchAction:function(){return Ka.prototype.getTouchAction.call(this)},attrTest:function(pe){var Oe=this.options.direction,ft;return Oe&(qe|mt)?ft=pe.overallVelocity:Oe&qe?ft=pe.overallVelocityX:Oe&mt&&(ft=pe.overallVelocityY),this._super.attrTest.call(this,pe)&&Oe&pe.offsetDirection&&pe.distance>this.options.threshold&&pe.maxPointers==this.options.pointers&&we(ft)>this.options.velocity&&pe.eventType&Ce},emit:function(pe){var Oe=Ya(pe.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,pe),this.manager.emit(this.options.event,pe)}});function Oa(){da.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pt(Oa,da,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hn]},process:function(pe){var Oe=this.options,ft=pe.pointers.length===Oe.pointers,ur=pe.distance<Oe.threshold,Qr=pe.deltaTime<Oe.time;if(this.reset(),pe.eventType&be&&this.count===0)return this.failTimeout();if(ur&&Qr&&ft){if(pe.eventType!=Ce)return this.failTimeout();var Dn=this.pTime?pe.timeStamp-this.pTime<Oe.interval:!0,Ki=!this.pCenter||lt(this.pCenter,pe.center)<Oe.posThreshold;this.pTime=pe.timeStamp,this.pCenter=pe.center,!Ki||!Dn?this.count=1:this.count+=1,this._input=pe;var Ua=this.count%Oe.taps;if(Ua===0)return this.hasRequireFailures()?(this._timer=We(function(){this.state=ya,this.tryEmit()},Oe.interval,this),Ai):ya}return _a},failTimeout:function(){return this._timer=We(function(){this.state=_a},this.options.interval,this),_a},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ya&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Za(pe,Oe){return Oe=Oe||{},Oe.recognizers=nr(Oe.recognizers,Za.defaults.preset),new fs(pe,Oe)}Za.VERSION="2.0.7",Za.defaults={domEvents:!1,touchAction:ln,enable:!0,inputTarget:null,inputClass:null,preset:[[Gi,{enable:!1}],[$a,{enable:!1},["rotate"]],[Oo,{direction:qe}],[Ka,{direction:qe},["swipe"]],[Oa],[Oa,{event:"doubletap",taps:2},["tap"]],[Yo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var cs=1,va=2;function fs(pe,Oe){this.options=kt({},Za.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||pe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=pe,this.input=hr(this),this.touchAction=new ki(this,this.options.touchAction),Ca(this,!0),Ut(this.options.recognizers,function(ft){var ur=this.add(new ft[0](ft[1]));ft[2]&&ur.recognizeWith(ft[2]),ft[3]&&ur.requireFailure(ft[3])},this)}fs.prototype={set:function(pe){return kt(this.options,pe),pe.touchAction&&this.touchAction.update(),pe.inputTarget&&(this.input.destroy(),this.input.target=pe.inputTarget,this.input.init()),this},stop:function(pe){this.session.stopped=pe?va:cs},recognize:function(pe){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(pe);var ft,ur=this.recognizers,Qr=Oe.curRecognizer;(!Qr||Qr&&Qr.state&ya)&&(Qr=Oe.curRecognizer=null);for(var Dn=0;Dn<ur.length;)ft=ur[Dn],Oe.stopped!==va&&(!Qr||ft==Qr||ft.canRecognizeWith(Qr))?ft.recognize(pe):ft.reset(),!Qr&&ft.state&(Ai|Qn|Fi)&&(Qr=Oe.curRecognizer=ft),Dn++}},get:function(pe){if(pe instanceof da)return pe;for(var Oe=this.recognizers,ft=0;ft<Oe.length;ft++)if(Oe[ft].options.event==pe)return Oe[ft];return null},add:function(pe){if($e(pe,"add",this))return this;var Oe=this.get(pe.options.event);return Oe&&this.remove(Oe),this.recognizers.push(pe),pe.manager=this,this.touchAction.update(),pe},remove:function(pe){if($e(pe,"remove",this))return this;if(pe=this.get(pe),pe){var Oe=this.recognizers,ft=Ve(Oe,pe);ft!==-1&&(Oe.splice(ft,1),this.touchAction.update())}return this},on:function(pe,Oe){if(pe!==Y&&Oe!==Y){var ft=this.handlers;return Ut(Pe(pe),function(ur){ft[ur]=ft[ur]||[],ft[ur].push(Oe)}),this}},off:function(pe,Oe){if(pe!==Y){var ft=this.handlers;return Ut(Pe(pe),function(ur){Oe?ft[ur]&&ft[ur].splice(Ve(ft[ur],Oe),1):delete ft[ur]}),this}},emit:function(pe,Oe){this.options.domEvents&&fo(pe,Oe);var ft=this.handlers[pe]&&this.handlers[pe].slice();if(!(!ft||!ft.length)){Oe.type=pe,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var ur=0;ur<ft.length;)ft[ur](Oe),ur++}},destroy:function(){this.element&&Ca(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ca(pe,Oe){var ft=pe.element;if(!!ft.style){var ur;Ut(pe.options.cssProps,function(Qr,Dn){ur=ae(ft.style,Dn),Oe?(pe.oldCssProps[ur]=ft.style[ur],ft.style[ur]=Qr):ft.style[ur]=pe.oldCssProps[ur]||""}),Oe||(pe.oldCssProps={})}}function fo(pe,Oe){var ft=d.createEvent("Event");ft.initEvent(pe,!0,!0),ft.gesture=Oe,Oe.target.dispatchEvent(ft)}kt(Za,{INPUT_START:be,INPUT_MOVE:ke,INPUT_END:Ce,INPUT_CANCEL:Pt,STATE_POSSIBLE:ai,STATE_BEGAN:Ai,STATE_CHANGED:Qn,STATE_ENDED:Fi,STATE_RECOGNIZED:ya,STATE_CANCELLED:Xa,STATE_FAILED:_a,DIRECTION_NONE:Dt,DIRECTION_LEFT:E,DIRECTION_RIGHT:N,DIRECTION_UP:he,DIRECTION_DOWN:Ze,DIRECTION_HORIZONTAL:qe,DIRECTION_VERTICAL:mt,DIRECTION_ALL:Ct,Manager:fs,Input:jt,TouchAction:ki,TouchInput:ct,MouseInput:Si,PointerEventInput:ie,TouchMouseInput:kr,SingleTouchInput:fe,Recognizer:da,AttrRecognizer:qa,Tap:Oa,Pan:Ka,Swipe:Oo,Pinch:$a,Rotate:Gi,Press:Yo,on:xt,off:Ke,each:Ut,merge:bt,extend:Lt,assign:kt,inherit:pt,bindFn:Ir,prefixed:ae});var Zi=typeof w!="undefined"?w:typeof self!="undefined"?self:{};Zi.Hammer=Za,Q=function(){return Za}.call(L,x,L,sr),Q!==Y&&(sr.exports=Q)})(window,document,"Hammer")},7375:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var x=Symbol.for("INJECTION");function Q(W,$,I,k){function we(){return k&&!Reflect.hasMetadata(x,this,$)&&Reflect.defineMetadata(x,I(),this,$),Reflect.hasMetadata(x,this,$)?Reflect.getMetadata(x,this,$):I()}function Be(We){Reflect.defineMetadata(x,We,this,$)}Object.defineProperty(W,$,{configurable:!0,enumerable:!0,get:we,set:Be})}function w(W,$){return function(I){return function(k,we){var Be=function(){return W.get(I)};Q(k,we,Be,$)}}}L.makePropertyInjectDecorator=w;function d(W,$){return function(I,k){return function(we,Be){var We=function(){return W.getNamed(I,k)};Q(we,Be,We,$)}}}L.makePropertyInjectNamedDecorator=d;function b(W,$){return function(I,k,we){return function(Be,We){var $e=function(){return W.getTagged(I,k,we)};Q(Be,We,$e,$)}}}L.makePropertyInjectTaggedDecorator=b;function Y(W,$){return function(I){return function(k,we){var Be=function(){return W.getAll(I)};Q(k,we,Be,$)}}}L.makePropertyMultiInjectDecorator=Y},84879:function(sr,L,x){"use strict";var Q;Q={value:!0};var w=x(7375);function d(b,Y){Y===void 0&&(Y=!0);var W=w.makePropertyInjectDecorator(b,Y),$=w.makePropertyInjectNamedDecorator(b,Y),I=w.makePropertyInjectTaggedDecorator(b,Y),k=w.makePropertyMultiInjectDecorator(b,Y);return{lazyInject:W,lazyInjectNamed:$,lazyInjectTagged:I,lazyMultiInject:k}}L.Z=d},99934:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.tagProperty=L.tagParameter=L.decorate=void 0;var Q=x(16674),w=x(6867);function d(k,we,Be,We){var $e=w.TAGGED;Y($e,k,we,We,Be)}L.tagParameter=d;function b(k,we,Be){var We=w.TAGGED_PROP;Y(We,k.constructor,we,Be)}L.tagProperty=b;function Y(k,we,Be,We,$e){var Ut={},Yt=typeof $e=="number",kt=$e!==void 0&&Yt?$e.toString():Be;if(Yt&&Be!==void 0)throw new Error(Q.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(k,we)&&(Ut=Reflect.getMetadata(k,we));var Lt=Ut[kt];if(!Array.isArray(Lt))Lt=[];else for(var bt=0,pt=Lt;bt<pt.length;bt++){var Ir=pt[bt];if(Ir.key===We.key)throw new Error(Q.DUPLICATED_METADATA+" "+Ir.key.toString())}Lt.push(We),Ut[kt]=Lt,Reflect.defineMetadata(k,Ut,we)}function W(k,we){Reflect.decorate(k,we)}function $(k,we){return function(Be,We){we(Be,We,k)}}function I(k,we,Be){typeof Be=="number"?W([$(Be,k)],we):typeof Be=="string"?Reflect.decorate([k],we,Be):W([k],we)}L.decorate=I},5744:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.inject=L.LazyServiceIdentifer=void 0;var Q=x(16674),w=x(6867),d=x(47738),b=x(99934),Y=function(){function $(I){this._cb=I}return $.prototype.unwrap=function(){return this._cb()},$}();L.LazyServiceIdentifer=Y;function W($){return function(I,k,we){if($===void 0)throw new Error(Q.UNDEFINED_INJECT_ANNOTATION(I.name));var Be=new d.Metadata(w.INJECT_TAG,$);typeof we=="number"?b.tagParameter(I,k,we,Be):b.tagProperty(I,k,Be)}}L.inject=W},64315:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.injectable=void 0;var Q=x(16674),w=x(6867);function d(){return function(b){if(Reflect.hasOwnMetadata(w.PARAM_TYPES,b))throw new Error(Q.DUPLICATED_INJECTABLE_DECORATOR);var Y=Reflect.getMetadata(w.DESIGN_PARAM_TYPES,b)||[];return Reflect.defineMetadata(w.PARAM_TYPES,Y,b),b}}L.injectable=d},71693:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.multiInject=void 0;var Q=x(6867),w=x(47738),d=x(99934);function b(Y){return function(W,$,I){var k=new w.Metadata(Q.MULTI_INJECT_TAG,Y);typeof I=="number"?d.tagParameter(W,$,I,k):d.tagProperty(W,$,k)}}L.multiInject=b},38085:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.named=void 0;var Q=x(6867),w=x(47738),d=x(99934);function b(Y){return function(W,$,I){var k=new w.Metadata(Q.NAMED_TAG,Y);typeof I=="number"?d.tagParameter(W,$,I,k):d.tagProperty(W,$,k)}}L.named=b},6515:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.optional=void 0;var Q=x(6867),w=x(47738),d=x(99934);function b(){return function(Y,W,$){var I=new w.Metadata(Q.OPTIONAL_TAG,!0);typeof $=="number"?d.tagParameter(Y,W,$,I):d.tagProperty(Y,W,I)}}L.optional=b},7014:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.postConstruct=void 0;var Q=x(16674),w=x(6867),d=x(47738);function b(){return function(Y,W,$){var I=new d.Metadata(w.POST_CONSTRUCT,W);if(Reflect.hasOwnMetadata(w.POST_CONSTRUCT,Y.constructor))throw new Error(Q.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(w.POST_CONSTRUCT,I,Y.constructor)}}L.postConstruct=b},32052:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.tagged=void 0;var Q=x(47738),w=x(99934);function d(b,Y){return function(W,$,I){var k=new Q.Metadata(b,Y);typeof I=="number"?w.tagParameter(W,$,I,k):w.tagProperty(W,$,k)}}L.tagged=d},55638:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.targetName=void 0;var Q=x(6867),w=x(47738),d=x(99934);function b(Y){return function(W,$,I){var k=new w.Metadata(Q.NAME_TAG,Y);d.tagParameter(W,$,I,k)}}L.targetName=b},86757:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.unmanaged=void 0;var Q=x(6867),w=x(47738),d=x(99934);function b(){return function(Y,W,$){var I=new w.Metadata(Q.UNMANAGED_TAG,!0);d.tagParameter(Y,W,$,I)}}L.unmanaged=b},44290:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Binding=void 0;var Q=x(28421),w=x(37791),d=function(){function b(Y,W){this.id=w.id(),this.activated=!1,this.serviceIdentifier=Y,this.scope=W,this.type=Q.BindingTypeEnum.Invalid,this.constraint=function($){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return b.prototype.clone=function(){var Y=new b(this.serviceIdentifier,this.scope);return Y.activated=Y.scope===Q.BindingScopeEnum.Singleton?this.activated:!1,Y.implementationType=this.implementationType,Y.dynamicValue=this.dynamicValue,Y.scope=this.scope,Y.type=this.type,Y.factory=this.factory,Y.provider=this.provider,Y.constraint=this.constraint,Y.onActivation=this.onActivation,Y.cache=this.cache,Y},b}();L.Binding=d},23184:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingCount=void 0;var x={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};L.BindingCount=x},16674:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.STACK_OVERFLOW=L.CIRCULAR_DEPENDENCY_IN_FACTORY=L.POST_CONSTRUCT_ERROR=L.MULTIPLE_POST_CONSTRUCT_METHODS=L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=L.ARGUMENTS_LENGTH_MISMATCH=L.INVALID_DECORATOR_OPERATION=L.INVALID_TO_SELF_VALUE=L.INVALID_FUNCTION_BINDING=L.INVALID_MIDDLEWARE_RETURN=L.NO_MORE_SNAPSHOTS_AVAILABLE=L.INVALID_BINDING_TYPE=L.NOT_IMPLEMENTED=L.CIRCULAR_DEPENDENCY=L.UNDEFINED_INJECT_ANNOTATION=L.MISSING_INJECT_ANNOTATION=L.MISSING_INJECTABLE_ANNOTATION=L.NOT_REGISTERED=L.CANNOT_UNBIND=L.AMBIGUOUS_MATCH=L.KEY_NOT_FOUND=L.NULL_ARGUMENT=L.DUPLICATED_METADATA=L.DUPLICATED_INJECTABLE_DECORATOR=void 0,L.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",L.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",L.NULL_ARGUMENT="NULL argument",L.KEY_NOT_FOUND="Key Not Found",L.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",L.CANNOT_UNBIND="Could not unbind serviceIdentifier:",L.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",L.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",L.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var x=function(b){return"@inject called with undefined this could mean that the class "+b+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};L.UNDEFINED_INJECT_ANNOTATION=x,L.CIRCULAR_DEPENDENCY="Circular dependency found:",L.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",L.INVALID_BINDING_TYPE="Invalid binding type:",L.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",L.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",L.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",L.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",L.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Q=function(){for(var b=[],Y=0;Y<arguments.length;Y++)b[Y]=arguments[Y];return"The number of constructor arguments in the derived class "+(b[0]+" must be >= than the number of constructor arguments of its base class.")};L.ARGUMENTS_LENGTH_MISMATCH=Q,L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",L.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var w=function(){for(var b=[],Y=0;Y<arguments.length;Y++)b[Y]=arguments[Y];return"@postConstruct error in class "+b[0]+": "+b[1]};L.POST_CONSTRUCT_ERROR=w;var d=function(){for(var b=[],Y=0;Y<arguments.length;Y++)b[Y]=arguments[Y];return"It looks like there is a circular dependency "+("in one of the '"+b[0]+"' bindings. Please investigate bindings with")+("service identifier '"+b[1]+"'.")};L.CIRCULAR_DEPENDENCY_IN_FACTORY=d,L.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.TargetTypeEnum=L.BindingTypeEnum=L.BindingScopeEnum=void 0;var x={Request:"Request",Singleton:"Singleton",Transient:"Transient"};L.BindingScopeEnum=x;var Q={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};L.BindingTypeEnum=Q;var w={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};L.TargetTypeEnum=w},6867:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.NON_CUSTOM_TAG_KEYS=L.POST_CONSTRUCT=L.DESIGN_PARAM_TYPES=L.PARAM_TYPES=L.TAGGED_PROP=L.TAGGED=L.MULTI_INJECT_TAG=L.INJECT_TAG=L.OPTIONAL_TAG=L.UNMANAGED_TAG=L.NAME_TAG=L.NAMED_TAG=void 0,L.NAMED_TAG="named",L.NAME_TAG="name",L.UNMANAGED_TAG="unmanaged",L.OPTIONAL_TAG="optional",L.INJECT_TAG="inject",L.MULTI_INJECT_TAG="multi_inject",L.TAGGED="inversify:tagged",L.TAGGED_PROP="inversify:tagged_props",L.PARAM_TYPES="inversify:paramtypes",L.DESIGN_PARAM_TYPES="design:paramtypes",L.POST_CONSTRUCT="post_construct";function x(){return[L.INJECT_TAG,L.MULTI_INJECT_TAG,L.NAME_TAG,L.UNMANAGED_TAG,L.NAMED_TAG,L.OPTIONAL_TAG]}L.NON_CUSTOM_TAG_KEYS=x()},51389:function(sr,L,x){"use strict";var Q=this&&this.__awaiter||function(Lt,bt,pt,Ir){function er(nr){return nr instanceof pt?nr:new pt(function(xt){xt(nr)})}return new(pt||(pt=Promise))(function(nr,xt){function Ke(Pe){try{Fe(Ir.next(Pe))}catch(Ve){xt(Ve)}}function _t(Pe){try{Fe(Ir.throw(Pe))}catch(Ve){xt(Ve)}}function Fe(Pe){Pe.done?nr(Pe.value):er(Pe.value).then(Ke,_t)}Fe((Ir=Ir.apply(Lt,bt||[])).next())})},w=this&&this.__generator||function(Lt,bt){var pt={label:0,sent:function(){if(nr[0]&1)throw nr[1];return nr[1]},trys:[],ops:[]},Ir,er,nr,xt;return xt={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(xt[Symbol.iterator]=function(){return this}),xt;function Ke(Fe){return function(Pe){return _t([Fe,Pe])}}function _t(Fe){if(Ir)throw new TypeError("Generator is already executing.");for(;pt;)try{if(Ir=1,er&&(nr=Fe[0]&2?er.return:Fe[0]?er.throw||((nr=er.return)&&nr.call(er),0):er.next)&&!(nr=nr.call(er,Fe[1])).done)return nr;switch(er=0,nr&&(Fe=[Fe[0]&2,nr.value]),Fe[0]){case 0:case 1:nr=Fe;break;case 4:return pt.label++,{value:Fe[1],done:!1};case 5:pt.label++,er=Fe[1],Fe=[0];continue;case 7:Fe=pt.ops.pop(),pt.trys.pop();continue;default:if(nr=pt.trys,!(nr=nr.length>0&&nr[nr.length-1])&&(Fe[0]===6||Fe[0]===2)){pt=0;continue}if(Fe[0]===3&&(!nr||Fe[1]>nr[0]&&Fe[1]<nr[3])){pt.label=Fe[1];break}if(Fe[0]===6&&pt.label<nr[1]){pt.label=nr[1],nr=Fe;break}if(nr&&pt.label<nr[2]){pt.label=nr[2],pt.ops.push(Fe);break}nr[2]&&pt.ops.pop(),pt.trys.pop();continue}Fe=bt.call(Lt,pt)}catch(Pe){Fe=[6,Pe],er=0}finally{Ir=nr=0}if(Fe[0]&5)throw Fe[1];return{value:Fe[0]?Fe[1]:void 0,done:!0}}},d=this&&this.__spreadArray||function(Lt,bt){for(var pt=0,Ir=bt.length,er=Lt.length;pt<Ir;pt++,er++)Lt[er]=bt[pt];return Lt};Object.defineProperty(L,"__esModule",{value:!0}),L.Container=void 0;var b=x(44290),Y=x(16674),W=x(28421),$=x(6867),I=x(51377),k=x(86311),we=x(31927),Be=x(15451),We=x(37791),$e=x(55800),Ut=x(85700),Yt=x(80175),kt=function(){function Lt(bt){this._appliedMiddleware=[];var pt=bt||{};if(typeof pt!="object")throw new Error(""+Y.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=W.BindingScopeEnum.Transient;else if(pt.defaultScope!==W.BindingScopeEnum.Singleton&&pt.defaultScope!==W.BindingScopeEnum.Transient&&pt.defaultScope!==W.BindingScopeEnum.Request)throw new Error(""+Y.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+Y.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+Y.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=We.id(),this._bindingDictionary=new Yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new I.MetadataReader}return Lt.merge=function(bt,pt){for(var Ir=[],er=2;er<arguments.length;er++)Ir[er-2]=arguments[er];var nr=new Lt,xt=d([bt,pt],Ir).map(function(Fe){return k.getBindingDictionary(Fe)}),Ke=k.getBindingDictionary(nr);function _t(Fe,Pe){Fe.traverse(function(Ve,Et){Et.forEach(function(gr){Pe.add(gr.serviceIdentifier,gr.clone())})})}return xt.forEach(function(Fe){_t(Fe,Ke)}),nr},Lt.prototype.load=function(){for(var bt=[],pt=0;pt<arguments.length;pt++)bt[pt]=arguments[pt];for(var Ir=this._getContainerModuleHelpersFactory(),er=0,nr=bt;er<nr.length;er++){var xt=nr[er],Ke=Ir(xt.id);xt.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},Lt.prototype.loadAsync=function(){for(var bt=[],pt=0;pt<arguments.length;pt++)bt[pt]=arguments[pt];return Q(this,void 0,void 0,function(){var Ir,er,nr,xt,Ke;return w(this,function(_t){switch(_t.label){case 0:Ir=this._getContainerModuleHelpersFactory(),er=0,nr=bt,_t.label=1;case 1:return er<nr.length?(xt=nr[er],Ke=Ir(xt.id),[4,xt.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:_t.sent(),_t.label=3;case 3:return er++,[3,1];case 4:return[2]}})})},Lt.prototype.unload=function(){for(var bt=this,pt=[],Ir=0;Ir<arguments.length;Ir++)pt[Ir]=arguments[Ir];var er=function(nr){return function(xt){return xt.moduleId===nr}};pt.forEach(function(nr){var xt=er(nr.id);bt._bindingDictionary.removeByCondition(xt)})},Lt.prototype.bind=function(bt){var pt=this.options.defaultScope||W.BindingScopeEnum.Transient,Ir=new b.Binding(bt,pt);return this._bindingDictionary.add(bt,Ir),new Be.BindingToSyntax(Ir)},Lt.prototype.rebind=function(bt){return this.unbind(bt),this.bind(bt)},Lt.prototype.unbind=function(bt){try{this._bindingDictionary.remove(bt)}catch(pt){throw new Error(Y.CANNOT_UNBIND+" "+$e.getServiceIdentifierAsString(bt))}},Lt.prototype.unbindAll=function(){this._bindingDictionary=new Yt.Lookup},Lt.prototype.isBound=function(bt){var pt=this._bindingDictionary.hasKey(bt);return!pt&&this.parent&&(pt=this.parent.isBound(bt)),pt},Lt.prototype.isBoundNamed=function(bt,pt){return this.isBoundTagged(bt,$.NAMED_TAG,pt)},Lt.prototype.isBoundTagged=function(bt,pt,Ir){var er=!1;if(this._bindingDictionary.hasKey(bt)){var nr=this._bindingDictionary.get(bt),xt=k.createMockRequest(this,bt,pt,Ir);er=nr.some(function(Ke){return Ke.constraint(xt)})}return!er&&this.parent&&(er=this.parent.isBoundTagged(bt,pt,Ir)),er},Lt.prototype.snapshot=function(){this._snapshots.push(Ut.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Lt.prototype.restore=function(){var bt=this._snapshots.pop();if(bt===void 0)throw new Error(Y.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=bt.bindings,this._middleware=bt.middleware},Lt.prototype.createChild=function(bt){var pt=new Lt(bt||this.options);return pt.parent=this,pt},Lt.prototype.applyMiddleware=function(){for(var bt=[],pt=0;pt<arguments.length;pt++)bt[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(bt);var Ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=bt.reduce(function(er,nr){return nr(er)},Ir)},Lt.prototype.applyCustomMetadataReader=function(bt){this._metadataReader=bt},Lt.prototype.get=function(bt){return this._get(!1,!1,W.TargetTypeEnum.Variable,bt)},Lt.prototype.getTagged=function(bt,pt,Ir){return this._get(!1,!1,W.TargetTypeEnum.Variable,bt,pt,Ir)},Lt.prototype.getNamed=function(bt,pt){return this.getTagged(bt,$.NAMED_TAG,pt)},Lt.prototype.getAll=function(bt){return this._get(!0,!0,W.TargetTypeEnum.Variable,bt)},Lt.prototype.getAllTagged=function(bt,pt,Ir){return this._get(!1,!0,W.TargetTypeEnum.Variable,bt,pt,Ir)},Lt.prototype.getAllNamed=function(bt,pt){return this.getAllTagged(bt,$.NAMED_TAG,pt)},Lt.prototype.resolve=function(bt){var pt=this.createChild();return pt.bind(bt).toSelf(),this._appliedMiddleware.forEach(function(Ir){pt.applyMiddleware(Ir)}),pt.get(bt)},Lt.prototype._getContainerModuleHelpersFactory=function(){var bt=this,pt=function(Ke,_t){Ke._binding.moduleId=_t},Ir=function(Ke){return function(_t){var Fe=bt.bind.bind(bt),Pe=Fe(_t);return pt(Pe,Ke),Pe}},er=function(Ke){return function(_t){var Fe=bt.unbind.bind(bt);Fe(_t)}},nr=function(Ke){return function(_t){var Fe=bt.isBound.bind(bt);return Fe(_t)}},xt=function(Ke){return function(_t){var Fe=bt.rebind.bind(bt),Pe=Fe(_t);return pt(Pe,Ke),Pe}};return function(Ke){return{bindFunction:Ir(Ke),isboundFunction:nr(Ke),rebindFunction:xt(Ke),unbindFunction:er(Ke)}}},Lt.prototype._get=function(bt,pt,Ir,er,nr,xt){var Ke=null,_t={avoidConstraints:bt,contextInterceptor:function(Fe){return Fe},isMultiInject:pt,key:nr,serviceIdentifier:er,targetType:Ir,value:xt};if(this._middleware){if(Ke=this._middleware(_t),Ke==null)throw new Error(Y.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(_t);return Ke},Lt.prototype._planAndResolve=function(){var bt=this;return function(pt){var Ir=k.plan(bt._metadataReader,bt,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);Ir=pt.contextInterceptor(Ir);var er=we.resolve(Ir);return er}},Lt}();L.Container=kt},33244:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.AsyncContainerModule=L.ContainerModule=void 0;var Q=x(37791),w=function(){function b(Y){this.id=Q.id(),this.registry=Y}return b}();L.ContainerModule=w;var d=function(){function b(Y){this.id=Q.id(),this.registry=Y}return b}();L.AsyncContainerModule=d},85700:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.ContainerSnapshot=void 0;var x=function(){function Q(){}return Q.of=function(w,d){var b=new Q;return b.bindings=w,b.middleware=d,b},Q}();L.ContainerSnapshot=x},80175:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Lookup=void 0;var Q=x(16674),w=function(){function d(){this._map=new Map}return d.prototype.getMap=function(){return this._map},d.prototype.add=function(b,Y){if(b==null)throw new Error(Q.NULL_ARGUMENT);if(Y==null)throw new Error(Q.NULL_ARGUMENT);var W=this._map.get(b);W!==void 0?(W.push(Y),this._map.set(b,W)):this._map.set(b,[Y])},d.prototype.get=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);var Y=this._map.get(b);if(Y!==void 0)return Y;throw new Error(Q.KEY_NOT_FOUND)},d.prototype.remove=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);if(!this._map.delete(b))throw new Error(Q.KEY_NOT_FOUND)},d.prototype.removeByCondition=function(b){var Y=this;this._map.forEach(function(W,$){var I=W.filter(function(k){return!b(k)});I.length>0?Y._map.set($,I):Y._map.delete($)})},d.prototype.hasKey=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);return this._map.has(b)},d.prototype.clone=function(){var b=new d;return this._map.forEach(function(Y,W){Y.forEach(function($){return b.add(W,$.clone())})}),b},d.prototype.traverse=function(b){this._map.forEach(function(Y,W){b(W,Y)})},d}();L.Lookup=w},86700:function(sr,L,x){"use strict";var Q;Q={value:!0},Q=Q=Q=Q=Q=Q=L.GW=Q=Q=L.zY=Q=Q=Q=Q=Q=L.f3=Q=Q=L.b2=Q=Q=Q=Q=Q=L.W2=Q=void 0;var w=x(6867);Q=w;var d=x(51389);Object.defineProperty(L,"W2",{enumerable:!0,get:function(){return d.Container}});var b=x(28421);Q={enumerable:!0,get:function(){return b.BindingScopeEnum}},Q={enumerable:!0,get:function(){return b.BindingTypeEnum}},Q={enumerable:!0,get:function(){return b.TargetTypeEnum}};var Y=x(33244);Q={enumerable:!0,get:function(){return Y.AsyncContainerModule}},Q={enumerable:!0,get:function(){return Y.ContainerModule}};var W=x(64315);Object.defineProperty(L,"b2",{enumerable:!0,get:function(){return W.injectable}});var $=x(32052);Q={enumerable:!0,get:function(){return $.tagged}};var I=x(38085);Q={enumerable:!0,get:function(){return I.named}};var k=x(5744);Object.defineProperty(L,"f3",{enumerable:!0,get:function(){return k.inject}}),Q={enumerable:!0,get:function(){return k.LazyServiceIdentifer}};var we=x(6515);Q={enumerable:!0,get:function(){return we.optional}};var Be=x(86757);Q={enumerable:!0,get:function(){return Be.unmanaged}};var We=x(71693);Q={enumerable:!0,get:function(){return We.multiInject}};var $e=x(55638);Q={enumerable:!0,get:function(){return $e.targetName}};var Ut=x(7014);Object.defineProperty(L,"zY",{enumerable:!0,get:function(){return Ut.postConstruct}});var Yt=x(51377);Q={enumerable:!0,get:function(){return Yt.MetadataReader}};var kt=x(37791);Q={enumerable:!0,get:function(){return kt.id}};var Lt=x(99934);Object.defineProperty(L,"GW",{enumerable:!0,get:function(){return Lt.decorate}});var bt=x(80758);Q={enumerable:!0,get:function(){return bt.traverseAncerstors}},Q={enumerable:!0,get:function(){return bt.taggedConstraint}},Q={enumerable:!0,get:function(){return bt.namedConstraint}},Q={enumerable:!0,get:function(){return bt.typeConstraint}};var pt=x(55800);Q={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var Ir=x(70600);Q={enumerable:!0,get:function(){return Ir.multiBindToService}}},95228:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Context=void 0;var Q=x(37791),w=function(){function d(b){this.id=Q.id(),this.container=b}return d.prototype.addPlan=function(b){this.plan=b},d.prototype.setCurrentRequest=function(b){this.currentRequest=b},d}();L.Context=w},47738:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Metadata=void 0;var Q=x(6867),w=function(){function d(b,Y){this.key=b,this.value=Y}return d.prototype.toString=function(){return this.key===Q.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},d}();L.Metadata=w},51377:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.MetadataReader=void 0;var Q=x(6867),w=function(){function d(){}return d.prototype.getConstructorMetadata=function(b){var Y=Reflect.getMetadata(Q.PARAM_TYPES,b),W=Reflect.getMetadata(Q.TAGGED,b);return{compilerGeneratedMetadata:Y,userGeneratedMetadata:W||{}}},d.prototype.getPropertiesMetadata=function(b){var Y=Reflect.getMetadata(Q.TAGGED_PROP,b)||[];return Y},d}();L.MetadataReader=w},55314:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Plan=void 0;var x=function(){function Q(w,d){this.parentContext=w,this.rootRequest=d}return Q}();L.Plan=x},86311:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.getBindingDictionary=L.createMockRequest=L.plan=void 0;var Q=x(23184),w=x(16674),d=x(28421),b=x(6867),Y=x(85265),W=x(55800),$=x(95228),I=x(47738),k=x(55314),we=x(6e3),Be=x(6748),We=x(18924);function $e(er){return er._bindingDictionary}L.getBindingDictionary=$e;function Ut(er,nr,xt,Ke,_t,Fe){var Pe=er?b.MULTI_INJECT_TAG:b.INJECT_TAG,Ve=new I.Metadata(Pe,xt),Et=new We.Target(nr,Ke,xt,Ve);if(_t!==void 0){var gr=new I.Metadata(_t,Fe);Et.metadata.push(gr)}return Et}function Yt(er,nr,xt,Ke,_t){var Fe=bt(xt.container,_t.serviceIdentifier),Pe=[];return Fe.length===Q.BindingCount.NoBindingsAvailable&&xt.container.options.autoBindInjectable&&typeof _t.serviceIdentifier=="function"&&er.getConstructorMetadata(_t.serviceIdentifier).compilerGeneratedMetadata&&(xt.container.bind(_t.serviceIdentifier).toSelf(),Fe=bt(xt.container,_t.serviceIdentifier)),nr?Pe=Fe:Pe=Fe.filter(function(Ve){var Et=new Be.Request(Ve.serviceIdentifier,xt,Ke,Ve,_t);return Ve.constraint(Et)}),kt(_t.serviceIdentifier,Pe,_t,xt.container),Pe}function kt(er,nr,xt,Ke){switch(nr.length){case Q.BindingCount.NoBindingsAvailable:if(xt.isOptional())return nr;var _t=W.getServiceIdentifierAsString(er),Fe=w.NOT_REGISTERED;throw Fe+=W.listMetadataForTarget(_t,xt),Fe+=W.listRegisteredBindingsForServiceIdentifier(Ke,_t,bt),new Error(Fe);case Q.BindingCount.OnlyOneBindingAvailable:if(!xt.isArray())return nr;case Q.BindingCount.MultipleBindingsAvailable:default:if(xt.isArray())return nr;var _t=W.getServiceIdentifierAsString(er),Fe=w.AMBIGUOUS_MATCH+" "+_t;throw Fe+=W.listRegisteredBindingsForServiceIdentifier(Ke,_t,bt),new Error(Fe)}}function Lt(er,nr,xt,Ke,_t,Fe){var Pe,Ve;if(_t===null){Pe=Yt(er,nr,Ke,null,Fe),Ve=new Be.Request(xt,Ke,null,Pe,Fe);var Et=new k.Plan(Ke,Ve);Ke.addPlan(Et)}else Pe=Yt(er,nr,Ke,_t,Fe),Ve=_t.addChildRequest(Fe.serviceIdentifier,Pe,Fe);Pe.forEach(function(gr){var ae=null;if(Fe.isArray())ae=Ve.addChildRequest(gr.serviceIdentifier,gr,Fe);else{if(gr.cache)return;ae=Ve}if(gr.type===d.BindingTypeEnum.Instance&&gr.implementationType!==null){var Ae=we.getDependencies(er,gr.implementationType);if(!Ke.container.options.skipBaseClassChecks){var oe=we.getBaseClassDependencyCount(er,gr.implementationType);if(Ae.length<oe){var ge=w.ARGUMENTS_LENGTH_MISMATCH(we.getFunctionName(gr.implementationType));throw new Error(ge)}}Ae.forEach(function(Me){Lt(er,!1,Me.serviceIdentifier,Ke,ae,Me)})}})}function bt(er,nr){var xt=[],Ke=$e(er);return Ke.hasKey(nr)?xt=Ke.get(nr):er.parent!==null&&(xt=bt(er.parent,nr)),xt}function pt(er,nr,xt,Ke,_t,Fe,Pe,Ve){Ve===void 0&&(Ve=!1);var Et=new $.Context(nr),gr=Ut(xt,Ke,_t,"",Fe,Pe);try{return Lt(er,Ve,_t,Et,null,gr),Et}catch(ae){throw Y.isStackOverflowExeption(ae)&&Et.plan&&W.circularDependencyToException(Et.plan.rootRequest),ae}}L.plan=pt;function Ir(er,nr,xt,Ke){var _t=new We.Target(d.TargetTypeEnum.Variable,"",nr,new I.Metadata(xt,Ke)),Fe=new $.Context(er),Pe=new Be.Request(nr,Fe,null,[],_t);return Pe}L.createMockRequest=Ir},88460:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.QueryableString=void 0;var x=function(){function Q(w){this.str=w}return Q.prototype.startsWith=function(w){return this.str.indexOf(w)===0},Q.prototype.endsWith=function(w){var d="",b=w.split("").reverse().join("");return d=this.str.split("").reverse().join(""),this.startsWith.call({str:d},b)},Q.prototype.contains=function(w){return this.str.indexOf(w)!==-1},Q.prototype.equals=function(w){return this.str===w},Q.prototype.value=function(){return this.str},Q}();L.QueryableString=x},6e3:function(sr,L,x){"use strict";var Q=this&&this.__spreadArray||function(Yt,kt){for(var Lt=0,bt=kt.length,pt=Yt.length;Lt<bt;Lt++,pt++)Yt[pt]=kt[Lt];return Yt};Object.defineProperty(L,"__esModule",{value:!0}),L.getFunctionName=L.getBaseClassDependencyCount=L.getDependencies=void 0;var w=x(5744),d=x(16674),b=x(28421),Y=x(6867),W=x(55800);Object.defineProperty(L,"getFunctionName",{enumerable:!0,get:function(){return W.getFunctionName}});var $=x(18924);function I(Yt,kt){var Lt=W.getFunctionName(kt),bt=k(Yt,Lt,kt,!1);return bt}L.getDependencies=I;function k(Yt,kt,Lt,bt){var pt=Yt.getConstructorMetadata(Lt),Ir=pt.compilerGeneratedMetadata;if(Ir===void 0){var er=d.MISSING_INJECTABLE_ANNOTATION+" "+kt+".";throw new Error(er)}var nr=pt.userGeneratedMetadata,xt=Object.keys(nr),Ke=Lt.length===0&&xt.length>0,_t=xt.length>Lt.length,Fe=Ke||_t?xt.length:Lt.length,Pe=Be(bt,kt,Ir,nr,Fe),Ve=We(Yt,Lt),Et=Q(Q([],Pe),Ve);return Et}function we(Yt,kt,Lt,bt,pt){var Ir=pt[Yt.toString()]||[],er=Ut(Ir),nr=er.unmanaged!==!0,xt=bt[Yt],Ke=er.inject||er.multiInject;if(xt=Ke||xt,xt instanceof w.LazyServiceIdentifer&&(xt=xt.unwrap()),nr){var _t=xt===Object,Fe=xt===Function,Pe=xt===void 0,Ve=_t||Fe||Pe;if(!kt&&Ve){var Et=d.MISSING_INJECT_ANNOTATION+" argument "+Yt+" in class "+Lt+".";throw new Error(Et)}var gr=new $.Target(b.TargetTypeEnum.ConstructorArgument,er.targetName,xt);return gr.metadata=Ir,gr}return null}function Be(Yt,kt,Lt,bt,pt){for(var Ir=[],er=0;er<pt;er++){var nr=er,xt=we(nr,Yt,kt,Lt,bt);xt!==null&&Ir.push(xt)}return Ir}function We(Yt,kt){for(var Lt=Yt.getPropertiesMetadata(kt),bt=[],pt=Object.keys(Lt),Ir=0,er=pt;Ir<er.length;Ir++){var nr=er[Ir],xt=Lt[nr],Ke=Ut(Lt[nr]),_t=Ke.targetName||nr,Fe=Ke.inject||Ke.multiInject,Pe=new $.Target(b.TargetTypeEnum.ClassProperty,_t,Fe);Pe.metadata=xt,bt.push(Pe)}var Ve=Object.getPrototypeOf(kt.prototype).constructor;if(Ve!==Object){var Et=We(Yt,Ve);bt=Q(Q([],bt),Et)}return bt}function $e(Yt,kt){var Lt=Object.getPrototypeOf(kt.prototype).constructor;if(Lt!==Object){var bt=W.getFunctionName(Lt),pt=k(Yt,bt,Lt,!0),Ir=pt.map(function(xt){return xt.metadata.filter(function(Ke){return Ke.key===Y.UNMANAGED_TAG})}),er=[].concat.apply([],Ir).length,nr=pt.length-er;return nr>0?nr:$e(Yt,Lt)}else return 0}L.getBaseClassDependencyCount=$e;function Ut(Yt){var kt={};return Yt.forEach(function(Lt){kt[Lt.key.toString()]=Lt.value}),{inject:kt[Y.INJECT_TAG],multiInject:kt[Y.MULTI_INJECT_TAG],targetName:kt[Y.NAME_TAG],unmanaged:kt[Y.UNMANAGED_TAG]}}},6748:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Request=void 0;var Q=x(37791),w=function(){function d(b,Y,W,$,I){this.id=Q.id(),this.serviceIdentifier=b,this.parentContext=Y,this.parentRequest=W,this.target=I,this.childRequests=[],this.bindings=Array.isArray($)?$:[$],this.requestScope=W===null?new Map:null}return d.prototype.addChildRequest=function(b,Y,W){var $=new d(b,this.parentContext,this,Y,W);return this.childRequests.push($),$},d}();L.Request=w},18924:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Target=void 0;var Q=x(6867),w=x(37791),d=x(47738),b=x(88460),Y=function(){function W($,I,k,we){this.id=w.id(),this.type=$,this.serviceIdentifier=k,this.name=new b.QueryableString(I||""),this.metadata=new Array;var Be=null;typeof we=="string"?Be=new d.Metadata(Q.NAMED_TAG,we):we instanceof d.Metadata&&(Be=we),Be!==null&&this.metadata.push(Be)}return W.prototype.hasTag=function($){for(var I=0,k=this.metadata;I<k.length;I++){var we=k[I];if(we.key===$)return!0}return!1},W.prototype.isArray=function(){return this.hasTag(Q.MULTI_INJECT_TAG)},W.prototype.matchesArray=function($){return this.matchesTag(Q.MULTI_INJECT_TAG)($)},W.prototype.isNamed=function(){return this.hasTag(Q.NAMED_TAG)},W.prototype.isTagged=function(){return this.metadata.some(function($){return Q.NON_CUSTOM_TAG_KEYS.every(function(I){return $.key!==I})})},W.prototype.isOptional=function(){return this.matchesTag(Q.OPTIONAL_TAG)(!0)},W.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function($){return $.key===Q.NAMED_TAG})[0]:null},W.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function($){return Q.NON_CUSTOM_TAG_KEYS.every(function(I){return $.key!==I})}):null},W.prototype.matchesNamedTag=function($){return this.matchesTag(Q.NAMED_TAG)($)},W.prototype.matchesTag=function($){var I=this;return function(k){for(var we=0,Be=I.metadata;we<Be.length;we++){var We=Be[we];if(We.key===$&&We.value===k)return!0}return!1}},W}();L.Target=Y},52279:function(sr,L,x){"use strict";var Q=this&&this.__spreadArray||function(k,we){for(var Be=0,We=we.length,$e=k.length;Be<We;Be++,$e++)k[$e]=we[Be];return k};Object.defineProperty(L,"__esModule",{value:!0}),L.resolveInstance=void 0;var w=x(16674),d=x(28421),b=x(6867);function Y(k,we,Be){var We=we.filter(function(Ut){return Ut.target!==null&&Ut.target.type===d.TargetTypeEnum.ClassProperty}),$e=We.map(Be);return We.forEach(function(Ut,Yt){var kt="";kt=Ut.target.name.value();var Lt=$e[Yt];k[kt]=Lt}),k}function W(k,we){return new(k.bind.apply(k,Q([void 0],we)))}function $(k,we){if(Reflect.hasMetadata(b.POST_CONSTRUCT,k)){var Be=Reflect.getMetadata(b.POST_CONSTRUCT,k);try{we[Be.value]()}catch(We){throw new Error(w.POST_CONSTRUCT_ERROR(k.name,We.message))}}}function I(k,we,Be){var We=null;if(we.length>0){var $e=we.filter(function(Yt){return Yt.target!==null&&Yt.target.type===d.TargetTypeEnum.ConstructorArgument}),Ut=$e.map(Be);We=W(k,Ut),We=Y(We,we,Be)}else We=new k;return $(k,We),We}L.resolveInstance=I},31927:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.resolve=void 0;var Q=x(16674),w=x(28421),d=x(85265),b=x(55800),Y=x(52279),W=function(k,we,Be){try{return Be()}catch(We){throw d.isStackOverflowExeption(We)?new Error(Q.CIRCULAR_DEPENDENCY_IN_FACTORY(k,we.toString())):We}},$=function(k){return function(we){we.parentContext.setCurrentRequest(we);var Be=we.bindings,We=we.childRequests,$e=we.target&&we.target.isArray(),Ut=!we.parentRequest||!we.parentRequest.target||!we.target||!we.parentRequest.target.matchesArray(we.target.serviceIdentifier);if($e&&Ut)return We.map(function(Ir){var er=$(k);return er(Ir)});var Yt=null;if(we.target.isOptional()&&Be.length===0)return;var kt=Be[0],Lt=kt.scope===w.BindingScopeEnum.Singleton,bt=kt.scope===w.BindingScopeEnum.Request;if(Lt&&kt.activated)return kt.cache;if(bt&&k!==null&&k.has(kt.id))return k.get(kt.id);if(kt.type===w.BindingTypeEnum.ConstantValue)Yt=kt.cache,kt.activated=!0;else if(kt.type===w.BindingTypeEnum.Function)Yt=kt.cache,kt.activated=!0;else if(kt.type===w.BindingTypeEnum.Constructor)Yt=kt.implementationType;else if(kt.type===w.BindingTypeEnum.DynamicValue&&kt.dynamicValue!==null)Yt=W("toDynamicValue",kt.serviceIdentifier,function(){return kt.dynamicValue(we.parentContext)});else if(kt.type===w.BindingTypeEnum.Factory&&kt.factory!==null)Yt=W("toFactory",kt.serviceIdentifier,function(){return kt.factory(we.parentContext)});else if(kt.type===w.BindingTypeEnum.Provider&&kt.provider!==null)Yt=W("toProvider",kt.serviceIdentifier,function(){return kt.provider(we.parentContext)});else if(kt.type===w.BindingTypeEnum.Instance&&kt.implementationType!==null)Yt=Y.resolveInstance(kt.implementationType,We,$(k));else{var pt=b.getServiceIdentifierAsString(we.serviceIdentifier);throw new Error(Q.INVALID_BINDING_TYPE+" "+pt)}return typeof kt.onActivation=="function"&&(Yt=kt.onActivation(we.parentContext,Yt)),Lt&&(kt.cache=Yt,kt.activated=!0),bt&&k!==null&&!k.has(kt.id)&&k.set(kt.id,Yt),Yt}};function I(k){var we=$(k.plan.rootRequest.requestScope);return we(k.plan.rootRequest)}L.resolve=I},83366:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingInSyntax=void 0;var Q=x(28421),w=x(71325),d=function(){function b(Y){this._binding=Y}return b.prototype.inRequestScope=function(){return this._binding.scope=Q.BindingScopeEnum.Request,new w.BindingWhenOnSyntax(this._binding)},b.prototype.inSingletonScope=function(){return this._binding.scope=Q.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},b.prototype.inTransientScope=function(){return this._binding.scope=Q.BindingScopeEnum.Transient,new w.BindingWhenOnSyntax(this._binding)},b}();L.BindingInSyntax=d},74889:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingInWhenOnSyntax=void 0;var Q=x(83366),w=x(51811),d=x(98370),b=function(){function Y(W){this._binding=W,this._bindingWhenSyntax=new d.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new w.BindingOnSyntax(this._binding),this._bindingInSyntax=new Q.BindingInSyntax(W)}return Y.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Y.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Y.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Y.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},Y.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},Y.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Y.prototype.whenTargetTagged=function(W,$){return this._bindingWhenSyntax.whenTargetTagged(W,$)},Y.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},Y.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},Y.prototype.whenParentTagged=function(W,$){return this._bindingWhenSyntax.whenParentTagged(W,$)},Y.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},Y.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},Y.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},Y.prototype.whenAnyAncestorTagged=function(W,$){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,$)},Y.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},Y.prototype.whenNoAncestorTagged=function(W,$){return this._bindingWhenSyntax.whenNoAncestorTagged(W,$)},Y.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},Y.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},Y.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},Y}();L.BindingInWhenOnSyntax=b},51811:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingOnSyntax=void 0;var Q=x(98370),w=function(){function d(b){this._binding=b}return d.prototype.onActivation=function(b){return this._binding.onActivation=b,new Q.BindingWhenSyntax(this._binding)},d}();L.BindingOnSyntax=w},15451:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingToSyntax=void 0;var Q=x(16674),w=x(28421),d=x(74889),b=x(71325),Y=function(){function W($){this._binding=$}return W.prototype.to=function($){return this._binding.type=w.BindingTypeEnum.Instance,this._binding.implementationType=$,new d.BindingInWhenOnSyntax(this._binding)},W.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Q.INVALID_TO_SELF_VALUE);var $=this._binding.serviceIdentifier;return this.to($)},W.prototype.toConstantValue=function($){return this._binding.type=w.BindingTypeEnum.ConstantValue,this._binding.cache=$,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toDynamicValue=function($){return this._binding.type=w.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=$,this._binding.implementationType=null,new d.BindingInWhenOnSyntax(this._binding)},W.prototype.toConstructor=function($){return this._binding.type=w.BindingTypeEnum.Constructor,this._binding.implementationType=$,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toFactory=function($){return this._binding.type=w.BindingTypeEnum.Factory,this._binding.factory=$,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toFunction=function($){if(typeof $!="function")throw new Error(Q.INVALID_FUNCTION_BINDING);var I=this.toConstantValue($);return this._binding.type=w.BindingTypeEnum.Function,this._binding.scope=w.BindingScopeEnum.Singleton,I},W.prototype.toAutoFactory=function($){return this._binding.type=w.BindingTypeEnum.Factory,this._binding.factory=function(I){var k=function(){return I.container.get($)};return k},this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toProvider=function($){return this._binding.type=w.BindingTypeEnum.Provider,this._binding.provider=$,this._binding.scope=w.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toService=function($){this.toDynamicValue(function(I){return I.container.get($)})},W}();L.BindingToSyntax=Y},71325:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingWhenOnSyntax=void 0;var Q=x(51811),w=x(98370),d=function(){function b(Y){this._binding=Y,this._bindingWhenSyntax=new w.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Q.BindingOnSyntax(this._binding)}return b.prototype.when=function(Y){return this._bindingWhenSyntax.when(Y)},b.prototype.whenTargetNamed=function(Y){return this._bindingWhenSyntax.whenTargetNamed(Y)},b.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},b.prototype.whenTargetTagged=function(Y,W){return this._bindingWhenSyntax.whenTargetTagged(Y,W)},b.prototype.whenInjectedInto=function(Y){return this._bindingWhenSyntax.whenInjectedInto(Y)},b.prototype.whenParentNamed=function(Y){return this._bindingWhenSyntax.whenParentNamed(Y)},b.prototype.whenParentTagged=function(Y,W){return this._bindingWhenSyntax.whenParentTagged(Y,W)},b.prototype.whenAnyAncestorIs=function(Y){return this._bindingWhenSyntax.whenAnyAncestorIs(Y)},b.prototype.whenNoAncestorIs=function(Y){return this._bindingWhenSyntax.whenNoAncestorIs(Y)},b.prototype.whenAnyAncestorNamed=function(Y){return this._bindingWhenSyntax.whenAnyAncestorNamed(Y)},b.prototype.whenAnyAncestorTagged=function(Y,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(Y,W)},b.prototype.whenNoAncestorNamed=function(Y){return this._bindingWhenSyntax.whenNoAncestorNamed(Y)},b.prototype.whenNoAncestorTagged=function(Y,W){return this._bindingWhenSyntax.whenNoAncestorTagged(Y,W)},b.prototype.whenAnyAncestorMatches=function(Y){return this._bindingWhenSyntax.whenAnyAncestorMatches(Y)},b.prototype.whenNoAncestorMatches=function(Y){return this._bindingWhenSyntax.whenNoAncestorMatches(Y)},b.prototype.onActivation=function(Y){return this._bindingOnSyntax.onActivation(Y)},b}();L.BindingWhenOnSyntax=d},98370:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingWhenSyntax=void 0;var Q=x(51811),w=x(80758),d=function(){function b(Y){this._binding=Y}return b.prototype.when=function(Y){return this._binding.constraint=Y,new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetNamed=function(Y){return this._binding.constraint=w.namedConstraint(Y),new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Y){var W=Y.target!==null&&!Y.target.isNamed()&&!Y.target.isTagged();return W},new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetTagged=function(Y,W){return this._binding.constraint=w.taggedConstraint(Y)(W),new Q.BindingOnSyntax(this._binding)},b.prototype.whenInjectedInto=function(Y){return this._binding.constraint=function(W){return w.typeConstraint(Y)(W.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenParentNamed=function(Y){return this._binding.constraint=function(W){return w.namedConstraint(Y)(W.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenParentTagged=function(Y,W){return this._binding.constraint=function($){return w.taggedConstraint(Y)(W)($.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorIs=function(Y){return this._binding.constraint=function(W){return w.traverseAncerstors(W,w.typeConstraint(Y))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorIs=function(Y){return this._binding.constraint=function(W){return!w.traverseAncerstors(W,w.typeConstraint(Y))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorNamed=function(Y){return this._binding.constraint=function(W){return w.traverseAncerstors(W,w.namedConstraint(Y))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorNamed=function(Y){return this._binding.constraint=function(W){return!w.traverseAncerstors(W,w.namedConstraint(Y))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorTagged=function(Y,W){return this._binding.constraint=function($){return w.traverseAncerstors($,w.taggedConstraint(Y)(W))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorTagged=function(Y,W){return this._binding.constraint=function($){return!w.traverseAncerstors($,w.taggedConstraint(Y)(W))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorMatches=function(Y){return this._binding.constraint=function(W){return w.traverseAncerstors(W,Y)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorMatches=function(Y){return this._binding.constraint=function(W){return!w.traverseAncerstors(W,Y)},new Q.BindingOnSyntax(this._binding)},b}();L.BindingWhenSyntax=d},80758:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.typeConstraint=L.namedConstraint=L.taggedConstraint=L.traverseAncerstors=void 0;var Q=x(6867),w=x(47738),d=function($,I){var k=$.parentRequest;return k!==null?I(k)?!0:d(k,I):!1};L.traverseAncerstors=d;var b=function($){return function(I){var k=function(we){return we!==null&&we.target!==null&&we.target.matchesTag($)(I)};return k.metaData=new w.Metadata($,I),k}};L.taggedConstraint=b;var Y=b(Q.NAMED_TAG);L.namedConstraint=Y;var W=function($){return function(I){var k=null;if(I!==null)if(k=I.bindings[0],typeof $=="string"){var we=k.serviceIdentifier;return we===$}else{var Be=I.bindings[0].implementationType;return $===Be}return!1}};L.typeConstraint=W},70600:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.multiBindToService=void 0;var x=function(Q){return function(w){return function(){for(var d=[],b=0;b<arguments.length;b++)d[b]=arguments[b];return d.forEach(function(Y){return Q.bind(Y).toService(w)})}}};L.multiBindToService=x},85265:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.isStackOverflowExeption=void 0;var Q=x(16674);function w(d){return d instanceof RangeError||d.message===Q.STACK_OVERFLOW}L.isStackOverflowExeption=w},37791:function(sr,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.id=void 0;var x=0;function Q(){return x++}L.id=Q},55800:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.circularDependencyToException=L.listMetadataForTarget=L.listRegisteredBindingsForServiceIdentifier=L.getServiceIdentifierAsString=L.getFunctionName=void 0;var Q=x(16674);function w(k){if(typeof k=="function"){var we=k;return we.name}else{if(typeof k=="symbol")return k.toString();var we=k;return we}}L.getServiceIdentifierAsString=w;function d(k,we,Be){var We="",$e=Be(k,we);return $e.length!==0&&(We=`
Registered bindings:`,$e.forEach(function(Ut){var Yt="Object";Ut.implementationType!==null&&(Yt=I(Ut.implementationType)),We=We+`
 `+Yt,Ut.constraint.metaData&&(We=We+" - "+Ut.constraint.metaData)})),We}L.listRegisteredBindingsForServiceIdentifier=d;function b(k,we){return k.parentRequest===null?!1:k.parentRequest.serviceIdentifier===we?!0:b(k.parentRequest,we)}function Y(k){function we(We,$e){$e===void 0&&($e=[]);var Ut=w(We.serviceIdentifier);return $e.push(Ut),We.parentRequest!==null?we(We.parentRequest,$e):$e}var Be=we(k);return Be.reverse().join(" --> ")}function W(k){k.childRequests.forEach(function(we){if(b(we,we.serviceIdentifier)){var Be=Y(we);throw new Error(Q.CIRCULAR_DEPENDENCY+" "+Be)}else W(we)})}L.circularDependencyToException=W;function $(k,we){if(we.isTagged()||we.isNamed()){var Be="",We=we.getNamedTag(),$e=we.getCustomTags();return We!==null&&(Be+=We.toString()+`
`),$e!==null&&$e.forEach(function(Ut){Be+=Ut.toString()+`
`})," "+k+`
 `+k+" - "+Be}else return" "+k}L.listMetadataForTarget=$;function I(k){if(k.name)return k.name;var we=k.toString(),Be=we.match(/^function\s*([^\s(]+)/);return Be?Be[1]:"Anonymous function: "+we}L.getFunctionName=I},68982:function(sr){sr.exports=L;function L(x,Q){Q||(Q=document);var w=Q.head||Q.getElementsByTagName("head")[0];if(!w){w=Q.createElement("head");var d=Q.body||Q.getElementsByTagName("body")[0];d?d.parentNode.insertBefore(w,d):Q.documentElement.appendChild(w)}var b=Q.createElement("style");return b.type="text/css",b.styleSheet?b.styleSheet.cssText=x:b.appendChild(Q.createTextNode(x)),w.appendChild(b),b}},53778:function(sr){var L=Array.isArray;sr.exports=L},59722:function(sr){function L(x){return x==null}sr.exports=L},8146:function(sr){var L="[object Object]";function x(Be){var We=!1;if(Be!=null&&typeof Be.toString!="function")try{We=!!(Be+"")}catch($e){}return We}function Q(Be,We){return function($e){return Be(We($e))}}var w=Function.prototype,d=Object.prototype,b=w.toString,Y=d.hasOwnProperty,W=b.call(Object),$=d.toString,I=Q(Object.getPrototypeOf,Object);function k(Be){return!!Be&&typeof Be=="object"}function we(Be){if(!k(Be)||$.call(Be)!=L||x(Be))return!1;var We=I(Be);if(We===null)return!0;var $e=Y.call(We,"constructor")&&We.constructor;return typeof $e=="function"&&$e instanceof $e&&b.call($e)==W}sr.exports=we},38554:function(sr,L,x){sr=x.nmd(sr);var Q=200,w="__lodash_hash_undefined__",d=800,b=16,Y=9007199254740991,W="[object Arguments]",$="[object Array]",I="[object AsyncFunction]",k="[object Boolean]",we="[object Date]",Be="[object Error]",We="[object Function]",$e="[object GeneratorFunction]",Ut="[object Map]",Yt="[object Number]",kt="[object Null]",Lt="[object Object]",bt="[object Proxy]",pt="[object RegExp]",Ir="[object Set]",er="[object String]",nr="[object Undefined]",xt="[object WeakMap]",Ke="[object ArrayBuffer]",_t="[object DataView]",Fe="[object Float32Array]",Pe="[object Float64Array]",Ve="[object Int8Array]",Et="[object Int16Array]",gr="[object Int32Array]",ae="[object Uint8Array]",Ae="[object Uint8ClampedArray]",oe="[object Uint16Array]",ge="[object Uint32Array]",Me=/[\\^$.*+?()[\]{}|]/g,Qe=/^\[object .+?Constructor\]$/,gt=/^(?:0|[1-9]\d*)$/,Jt={};Jt[Fe]=Jt[Pe]=Jt[Ve]=Jt[Et]=Jt[gr]=Jt[ae]=Jt[Ae]=Jt[oe]=Jt[ge]=!0,Jt[W]=Jt[$]=Jt[Ke]=Jt[k]=Jt[_t]=Jt[we]=Jt[Be]=Jt[We]=Jt[Ut]=Jt[Yt]=Jt[Lt]=Jt[pt]=Jt[Ir]=Jt[er]=Jt[xt]=!1;var Dr=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,Br=typeof self=="object"&&self&&self.Object===Object&&self,un=Dr||Br||Function("return this")(),tr=L&&!L.nodeType&&L,se=tr&&!0&&sr&&!sr.nodeType&&sr,be=se&&se.exports===tr,ke=be&&Dr.process,Ce=function(){try{var He=se&&se.require&&se.require("util").types;return He||ke&&ke.binding&&ke.binding("util")}catch(Tt){}}(),Pt=Ce&&Ce.isTypedArray;function Dt(He,Tt,_r){switch(_r.length){case 0:return He.call(Tt);case 1:return He.call(Tt,_r[0]);case 2:return He.call(Tt,_r[0],_r[1]);case 3:return He.call(Tt,_r[0],_r[1],_r[2])}return He.apply(Tt,_r)}function E(He,Tt){for(var _r=-1,Zn=Array(He);++_r<He;)Zn[_r]=Tt(_r);return Zn}function N(He){return function(Tt){return He(Tt)}}function he(He,Tt){return He==null?void 0:He[Tt]}function Ze(He,Tt){return function(_r){return He(Tt(_r))}}var qe=Array.prototype,mt=Function.prototype,Ct=Object.prototype,H=un["__core-js_shared__"],Kt=mt.toString,jt=Ct.hasOwnProperty,hr=function(){var He=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return He?"Symbol(src)_1."+He:""}(),Cr=Ct.toString,Tr=Kt.call(Object),Pr=RegExp("^"+Kt.call(jt).replace(Me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Je=be?un.Buffer:void 0,yt=un.Symbol,ht=un.Uint8Array,fr=Je?Je.allocUnsafe:void 0,$r=Ze(Object.getPrototypeOf,Object),lt=Object.create,Rt=Ct.propertyIsEnumerable,Qt=qe.splice,pr=yt?yt.toStringTag:void 0,vn=function(){try{var He=Za(Object,"defineProperty");return He({},"",{}),He}catch(Tt){}}(),Pn=Je?Je.isBuffer:void 0,bi=Math.max,Si=Date.now,Ri=Za(un,"Map"),ia=Za(Object,"create"),pi=function(){function He(){}return function(Tt){if(!ua(Tt))return{};if(lt)return lt(Tt);He.prototype=Tt;var _r=new He;return He.prototype=void 0,_r}}();function G(He){var Tt=-1,_r=He==null?0:He.length;for(this.clear();++Tt<_r;){var Zn=He[Tt];this.set(Zn[0],Zn[1])}}function ie(){this.__data__=ia?ia(null):{},this.size=0}function ce(He){var Tt=this.has(He)&&delete this.__data__[He];return this.size-=Tt?1:0,Tt}function B(He){var Tt=this.__data__;if(ia){var _r=Tt[He];return _r===w?void 0:_r}return jt.call(Tt,He)?Tt[He]:void 0}function re(He){var Tt=this.__data__;return ia?Tt[He]!==void 0:jt.call(Tt,He)}function fe(He,Tt){var _r=this.__data__;return this.size+=this.has(He)?0:1,_r[He]=ia&&Tt===void 0?w:Tt,this}G.prototype.clear=ie,G.prototype.delete=ce,G.prototype.get=B,G.prototype.has=re,G.prototype.set=fe;function Se(He){var Tt=-1,_r=He==null?0:He.length;for(this.clear();++Tt<_r;){var Zn=He[Tt];this.set(Zn[0],Zn[1])}}function te(){this.__data__=[],this.size=0}function me(He){var Tt=this.__data__,_r=za(Tt,He);if(_r<0)return!1;var Zn=Tt.length-1;return _r==Zn?Tt.pop():Qt.call(Tt,_r,1),--this.size,!0}function ct(He){var Tt=this.__data__,_r=za(Tt,He);return _r<0?void 0:Tt[_r][1]}function yr(He){return za(this.__data__,He)>-1}function Or(He,Tt){var _r=this.__data__,Zn=za(_r,He);return Zn<0?(++this.size,_r.push([He,Tt])):_r[Zn][1]=Tt,this}Se.prototype.clear=te,Se.prototype.delete=me,Se.prototype.get=ct,Se.prototype.has=yr,Se.prototype.set=Or;function Ft(He){var Tt=-1,_r=He==null?0:He.length;for(this.clear();++Tt<_r;){var Zn=He[Tt];this.set(Zn[0],Zn[1])}}function kr(){this.size=0,this.__data__={hash:new G,map:new(Ri||Se),string:new G}}function bn(He){var Tt=Oa(this,He).delete(He);return this.size-=Tt?1:0,Tt}function gn(He){return Oa(this,He).get(He)}function mr(He){return Oa(this,He).has(He)}function dn(He,Tt){var _r=Oa(this,He),Zn=_r.size;return _r.set(He,Tt),this.size+=_r.size==Zn?0:1,this}Ft.prototype.clear=kr,Ft.prototype.delete=bn,Ft.prototype.get=gn,Ft.prototype.has=mr,Ft.prototype.set=dn;function Wr(He){var Tt=this.__data__=new Se(He);this.size=Tt.size}function ln(){this.__data__=new Se,this.size=0}function Ei(He){var Tt=this.__data__,_r=Tt.delete(He);return this.size=Tt.size,_r}function hn(He){return this.__data__.get(He)}function wi(He){return this.__data__.has(He)}function Yi(He,Tt){var _r=this.__data__;if(_r instanceof Se){var Zn=_r.__data__;if(!Ri||Zn.length<Q-1)return Zn.push([He,Tt]),this.size=++_r.size,this;_r=this.__data__=new Ft(Zn)}return _r.set(He,Tt),this.size=_r.size,this}Wr.prototype.clear=ln,Wr.prototype.delete=Ei,Wr.prototype.get=hn,Wr.prototype.has=wi,Wr.prototype.set=Yi;function Yn(He,Tt){var _r=To(He),Zn=!_r&&ja(He),sa=!_r&&!Zn&&Il(He),xa=!_r&&!Zn&&!sa&&bs(He),ka=_r||Zn||sa||xa,vi=ka?E(He.length,String):[],Ta=vi.length;for(var eo in He)(Tt||jt.call(He,eo))&&!(ka&&(eo=="length"||sa&&(eo=="offset"||eo=="parent")||xa&&(eo=="buffer"||eo=="byteLength"||eo=="byteOffset")||fs(eo,Ta)))&&vi.push(eo);return vi}function Di(He,Tt,_r){(_r!==void 0&&!La(He[Tt],_r)||_r===void 0&&!(Tt in He))&&Wn(He,Tt,_r)}function ki(He,Tt,_r){var Zn=He[Tt];(!(jt.call(He,Tt)&&La(Zn,_r))||_r===void 0&&!(Tt in He))&&Wn(He,Tt,_r)}function za(He,Tt){for(var _r=He.length;_r--;)if(La(He[_r][0],Tt))return _r;return-1}function Wn(He,Tt,_r){Tt=="__proto__"&&vn?vn(He,Tt,{configurable:!0,enumerable:!0,value:_r,writable:!0}):He[Tt]=_r}var ai=Oo();function Ai(He){return He==null?He===void 0?nr:kt:pr&&pr in Object(He)?cs(He):ft(He)}function Qn(He){return Ns(He)&&Ai(He)==W}function Fi(He){if(!ua(He)||Zi(He))return!1;var Tt=Lo(He)?Pr:Qe;return Tt.test(Ua(He))}function ya(He){return Ns(He)&&Xs(He.length)&&!!Jt[Ai(He)]}function Xa(He){if(!ua(He))return Oe(He);var Tt=pe(He),_r=[];for(var Zn in He)Zn=="constructor"&&(Tt||!jt.call(He,Zn))||_r.push(Zn);return _r}function _a(He,Tt,_r,Zn,sa){He!==Tt&&ai(Tt,function(xa,ka){if(sa||(sa=new Wr),ua(xa))da(He,Tt,ka,_r,_a,Zn,sa);else{var vi=Zn?Zn(Qr(He,ka),xa,ka+"",He,Tt,sa):void 0;vi===void 0&&(vi=xa),Di(He,ka,vi)}},ti)}function da(He,Tt,_r,Zn,sa,xa,ka){var vi=Qr(He,_r),Ta=Qr(Tt,_r),eo=ka.get(Ta);if(eo){Di(He,_r,eo);return}var qn=xa?xa(vi,Ta,_r+"",He,Tt,ka):void 0,ba=qn===void 0;if(ba){var Jl=To(Ta),Ra=!Jl&&Il(Ta),Ro=!Jl&&!Ra&&bs(Ta);qn=Ta,Jl||Ra||Ro?To(vi)?qn=vi:$l(vi)?qn=$a(vi):Ra?(ba=!1,qn=gi(Ta,!0)):Ro?(ba=!1,qn=Ka(Ta,!0)):qn=[]:ou(Ta)||ja(Ta)?(qn=vi,ja(vi)?qn=Ps(vi):(!ua(vi)||Lo(vi))&&(qn=va(Ta))):ba=!1}ba&&(ka.set(Ta,qn),sa(qn,Ta,Zn,xa,ka),ka.delete(Ta)),Di(He,_r,qn)}function Vu(He,Tt){return Dn(ur(He,Tt,Ol),He+"")}var Ya=vn?function(He,Tt){return vn(He,"toString",{configurable:!0,enumerable:!1,value:su(Tt),writable:!0})}:Ol;function gi(He,Tt){if(Tt)return He.slice();var _r=He.length,Zn=fr?fr(_r):new He.constructor(_r);return He.copy(Zn),Zn}function qa(He){var Tt=new He.constructor(He.byteLength);return new ht(Tt).set(new ht(He)),Tt}function Ka(He,Tt){var _r=Tt?qa(He.buffer):He.buffer;return new He.constructor(_r,He.byteOffset,He.length)}function $a(He,Tt){var _r=-1,Zn=He.length;for(Tt||(Tt=Array(Zn));++_r<Zn;)Tt[_r]=He[_r];return Tt}function Yo(He,Tt,_r,Zn){var sa=!_r;_r||(_r={});for(var xa=-1,ka=Tt.length;++xa<ka;){var vi=Tt[xa],Ta=Zn?Zn(_r[vi],He[vi],vi,_r,He):void 0;Ta===void 0&&(Ta=He[vi]),sa?Wn(_r,vi,Ta):ki(_r,vi,Ta)}return _r}function Gi(He){return Vu(function(Tt,_r){var Zn=-1,sa=_r.length,xa=sa>1?_r[sa-1]:void 0,ka=sa>2?_r[2]:void 0;for(xa=He.length>3&&typeof xa=="function"?(sa--,xa):void 0,ka&&Ca(_r[0],_r[1],ka)&&(xa=sa<3?void 0:xa,sa=1),Tt=Object(Tt);++Zn<sa;){var vi=_r[Zn];vi&&He(Tt,vi,Zn,xa)}return Tt})}function Oo(He){return function(Tt,_r,Zn){for(var sa=-1,xa=Object(Tt),ka=Zn(Tt),vi=ka.length;vi--;){var Ta=ka[He?vi:++sa];if(_r(xa[Ta],Ta,xa)===!1)break}return Tt}}function Oa(He,Tt){var _r=He.__data__;return fo(Tt)?_r[typeof Tt=="string"?"string":"hash"]:_r.map}function Za(He,Tt){var _r=he(He,Tt);return Fi(_r)?_r:void 0}function cs(He){var Tt=jt.call(He,pr),_r=He[pr];try{He[pr]=void 0;var Zn=!0}catch(xa){}var sa=Cr.call(He);return Zn&&(Tt?He[pr]=_r:delete He[pr]),sa}function va(He){return typeof He.constructor=="function"&&!pe(He)?pi($r(He)):{}}function fs(He,Tt){var _r=typeof He;return Tt=Tt==null?Y:Tt,!!Tt&&(_r=="number"||_r!="symbol"&&gt.test(He))&&He>-1&&He%1==0&&He<Tt}function Ca(He,Tt,_r){if(!ua(_r))return!1;var Zn=typeof Tt;return(Zn=="number"?Mu(_r)&&fs(Tt,_r.length):Zn=="string"&&Tt in _r)?La(_r[Tt],He):!1}function fo(He){var Tt=typeof He;return Tt=="string"||Tt=="number"||Tt=="symbol"||Tt=="boolean"?He!=="__proto__":He===null}function Zi(He){return!!hr&&hr in He}function pe(He){var Tt=He&&He.constructor,_r=typeof Tt=="function"&&Tt.prototype||Ct;return He===_r}function Oe(He){var Tt=[];if(He!=null)for(var _r in Object(He))Tt.push(_r);return Tt}function ft(He){return Cr.call(He)}function ur(He,Tt,_r){return Tt=bi(Tt===void 0?He.length-1:Tt,0),function(){for(var Zn=arguments,sa=-1,xa=bi(Zn.length-Tt,0),ka=Array(xa);++sa<xa;)ka[sa]=Zn[Tt+sa];sa=-1;for(var vi=Array(Tt+1);++sa<Tt;)vi[sa]=Zn[sa];return vi[Tt]=_r(ka),Dt(He,this,vi)}}function Qr(He,Tt){if(!(Tt==="constructor"&&typeof He[Tt]=="function")&&Tt!="__proto__")return He[Tt]}var Dn=Ki(Ya);function Ki(He){var Tt=0,_r=0;return function(){var Zn=Si(),sa=b-(Zn-_r);if(_r=Zn,sa>0){if(++Tt>=d)return arguments[0]}else Tt=0;return He.apply(void 0,arguments)}}function Ua(He){if(He!=null){try{return Kt.call(He)}catch(Tt){}try{return He+""}catch(Tt){}}return""}function La(He,Tt){return He===Tt||He!==He&&Tt!==Tt}var ja=Qn(function(){return arguments}())?Qn:function(He){return Ns(He)&&jt.call(He,"callee")&&!Rt.call(He,"callee")},To=Array.isArray;function Mu(He){return He!=null&&Xs(He.length)&&!Lo(He)}function $l(He){return Ns(He)&&Mu(He)}var Il=Pn||sl;function Lo(He){if(!ua(He))return!1;var Tt=Ai(He);return Tt==We||Tt==$e||Tt==I||Tt==bt}function Xs(He){return typeof He=="number"&&He>-1&&He%1==0&&He<=Y}function ua(He){var Tt=typeof He;return He!=null&&(Tt=="object"||Tt=="function")}function Ns(He){return He!=null&&typeof He=="object"}function ou(He){if(!Ns(He)||Ai(He)!=Lt)return!1;var Tt=$r(He);if(Tt===null)return!0;var _r=jt.call(Tt,"constructor")&&Tt.constructor;return typeof _r=="function"&&_r instanceof _r&&Kt.call(_r)==Tr}var bs=Pt?N(Pt):ya;function Ps(He){return Yo(He,ti(He))}function ti(He){return Mu(He)?Yn(He,!0):Xa(He)}var ho=Gi(function(He,Tt,_r,Zn){_a(He,Tt,_r,Zn)});function su(He){return function(){return He}}function Ol(He){return He}function sl(){return!1}sr.exports=ho},97644:function(sr,L,x){var Q=200,w="__lodash_hash_undefined__",d=1/0,b="[object Function]",Y="[object GeneratorFunction]",W=/[\\^$.*+?()[\]{}|]/g,$=/^\[object .+?Constructor\]$/,I=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,k=typeof self=="object"&&self&&self.Object===Object&&self,we=I||k||Function("return this")();function Be(lt,Rt){var Qt=lt?lt.length:0;return!!Qt&&Ut(lt,Rt,0)>-1}function We(lt,Rt,Qt){for(var pr=-1,vn=lt?lt.length:0;++pr<vn;)if(Qt(Rt,lt[pr]))return!0;return!1}function $e(lt,Rt,Qt,pr){for(var vn=lt.length,Pn=Qt+(pr?1:-1);pr?Pn--:++Pn<vn;)if(Rt(lt[Pn],Pn,lt))return Pn;return-1}function Ut(lt,Rt,Qt){if(Rt!==Rt)return $e(lt,Yt,Qt);for(var pr=Qt-1,vn=lt.length;++pr<vn;)if(lt[pr]===Rt)return pr;return-1}function Yt(lt){return lt!==lt}function kt(lt,Rt){return lt.has(Rt)}function Lt(lt,Rt){return lt==null?void 0:lt[Rt]}function bt(lt){var Rt=!1;if(lt!=null&&typeof lt.toString!="function")try{Rt=!!(lt+"")}catch(Qt){}return Rt}function pt(lt){var Rt=-1,Qt=Array(lt.size);return lt.forEach(function(pr){Qt[++Rt]=pr}),Qt}var Ir=Array.prototype,er=Function.prototype,nr=Object.prototype,xt=we["__core-js_shared__"],Ke=function(){var lt=/[^.]+$/.exec(xt&&xt.keys&&xt.keys.IE_PROTO||"");return lt?"Symbol(src)_1."+lt:""}(),_t=er.toString,Fe=nr.hasOwnProperty,Pe=nr.toString,Ve=RegExp("^"+_t.call(Fe).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Et=Ir.splice,gr=hr(we,"Map"),ae=hr(we,"Set"),Ae=hr(Object,"create");function oe(lt){var Rt=-1,Qt=lt?lt.length:0;for(this.clear();++Rt<Qt;){var pr=lt[Rt];this.set(pr[0],pr[1])}}function ge(){this.__data__=Ae?Ae(null):{}}function Me(lt){return this.has(lt)&&delete this.__data__[lt]}function Qe(lt){var Rt=this.__data__;if(Ae){var Qt=Rt[lt];return Qt===w?void 0:Qt}return Fe.call(Rt,lt)?Rt[lt]:void 0}function gt(lt){var Rt=this.__data__;return Ae?Rt[lt]!==void 0:Fe.call(Rt,lt)}function Jt(lt,Rt){var Qt=this.__data__;return Qt[lt]=Ae&&Rt===void 0?w:Rt,this}oe.prototype.clear=ge,oe.prototype.delete=Me,oe.prototype.get=Qe,oe.prototype.has=gt,oe.prototype.set=Jt;function Dr(lt){var Rt=-1,Qt=lt?lt.length:0;for(this.clear();++Rt<Qt;){var pr=lt[Rt];this.set(pr[0],pr[1])}}function Br(){this.__data__=[]}function un(lt){var Rt=this.__data__,Qt=mt(Rt,lt);if(Qt<0)return!1;var pr=Rt.length-1;return Qt==pr?Rt.pop():Et.call(Rt,Qt,1),!0}function tr(lt){var Rt=this.__data__,Qt=mt(Rt,lt);return Qt<0?void 0:Rt[Qt][1]}function se(lt){return mt(this.__data__,lt)>-1}function be(lt,Rt){var Qt=this.__data__,pr=mt(Qt,lt);return pr<0?Qt.push([lt,Rt]):Qt[pr][1]=Rt,this}Dr.prototype.clear=Br,Dr.prototype.delete=un,Dr.prototype.get=tr,Dr.prototype.has=se,Dr.prototype.set=be;function ke(lt){var Rt=-1,Qt=lt?lt.length:0;for(this.clear();++Rt<Qt;){var pr=lt[Rt];this.set(pr[0],pr[1])}}function Ce(){this.__data__={hash:new oe,map:new(gr||Dr),string:new oe}}function Pt(lt){return jt(this,lt).delete(lt)}function Dt(lt){return jt(this,lt).get(lt)}function E(lt){return jt(this,lt).has(lt)}function N(lt,Rt){return jt(this,lt).set(lt,Rt),this}ke.prototype.clear=Ce,ke.prototype.delete=Pt,ke.prototype.get=Dt,ke.prototype.has=E,ke.prototype.set=N;function he(lt){var Rt=-1,Qt=lt?lt.length:0;for(this.__data__=new ke;++Rt<Qt;)this.add(lt[Rt])}function Ze(lt){return this.__data__.set(lt,w),this}function qe(lt){return this.__data__.has(lt)}he.prototype.add=he.prototype.push=Ze,he.prototype.has=qe;function mt(lt,Rt){for(var Qt=lt.length;Qt--;)if(yt(lt[Qt][0],Rt))return Qt;return-1}function Ct(lt){if(!fr(lt)||Tr(lt))return!1;var Rt=ht(lt)||bt(lt)?Ve:$;return Rt.test(Pr(lt))}function H(lt,Rt,Qt){var pr=-1,vn=Be,Pn=lt.length,bi=!0,Si=[],Ri=Si;if(Qt)bi=!1,vn=We;else if(Pn>=Q){var ia=Rt?null:Kt(lt);if(ia)return pt(ia);bi=!1,vn=kt,Ri=new he}else Ri=Rt?[]:Si;e:for(;++pr<Pn;){var pi=lt[pr],G=Rt?Rt(pi):pi;if(pi=Qt||pi!==0?pi:0,bi&&G===G){for(var ie=Ri.length;ie--;)if(Ri[ie]===G)continue e;Rt&&Ri.push(G),Si.push(pi)}else vn(Ri,G,Qt)||(Ri!==Si&&Ri.push(G),Si.push(pi))}return Si}var Kt=ae&&1/pt(new ae([,-0]))[1]==d?function(lt){return new ae(lt)}:$r;function jt(lt,Rt){var Qt=lt.__data__;return Cr(Rt)?Qt[typeof Rt=="string"?"string":"hash"]:Qt.map}function hr(lt,Rt){var Qt=Lt(lt,Rt);return Ct(Qt)?Qt:void 0}function Cr(lt){var Rt=typeof lt;return Rt=="string"||Rt=="number"||Rt=="symbol"||Rt=="boolean"?lt!=="__proto__":lt===null}function Tr(lt){return!!Ke&&Ke in lt}function Pr(lt){if(lt!=null){try{return _t.call(lt)}catch(Rt){}try{return lt+""}catch(Rt){}}return""}function Je(lt){return lt&&lt.length?H(lt):[]}function yt(lt,Rt){return lt===Rt||lt!==lt&&Rt!==Rt}function ht(lt){var Rt=fr(lt)?Pe.call(lt):"";return Rt==b||Rt==Y}function fr(lt){var Rt=typeof lt;return!!lt&&(Rt=="object"||Rt=="function")}function $r(){}sr.exports=Je},49029:function(sr){var L=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function x(Q){return Q.match(L)||[]}sr.exports=x},29750:function(sr){function L(x,Q,w){return x===x&&(w!==void 0&&(x=x<=w?x:w),Q!==void 0&&(x=x>=Q?x:Q)),x}sr.exports=L},18674:function(sr){function L(x){return function(Q){return x==null?void 0:x[Q]}}sr.exports=L},98805:function(sr,L,x){var Q=x(40180),w=x(62689),d=x(83140),b=x(79833);function Y(W){return function($){$=b($);var I=w($)?d($):void 0,k=I?I[0]:$.charAt(0),we=I?Q(I,1).join(""):$.slice(1);return k[W]()+we}}sr.exports=Y},35393:function(sr,L,x){var Q=x(62663),w=x(53816),d=x(58748),b="['\u2019]",Y=RegExp(b,"g");function W($){return function(I){return Q(d(w(I).replace(Y,"")),$,"")}}sr.exports=W},69389:function(sr,L,x){var Q=x(18674),w={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},d=Q(w);sr.exports=d},93157:function(sr){var L=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function x(Q){return L.test(Q)}sr.exports=x},2757:function(sr){var L="\\ud800-\\udfff",x="\\u0300-\\u036f",Q="\\ufe20-\\ufe2f",w="\\u20d0-\\u20ff",d=x+Q+w,b="\\u2700-\\u27bf",Y="a-z\\xdf-\\xf6\\xf8-\\xff",W="\\xac\\xb1\\xd7\\xf7",$="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",I="\\u2000-\\u206f",k=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",we="A-Z\\xc0-\\xd6\\xd8-\\xde",Be="\\ufe0e\\ufe0f",We=W+$+I+k,$e="['\u2019]",Ut="["+We+"]",Yt="["+d+"]",kt="\\d+",Lt="["+b+"]",bt="["+Y+"]",pt="[^"+L+We+kt+b+Y+we+"]",Ir="\\ud83c[\\udffb-\\udfff]",er="(?:"+Yt+"|"+Ir+")",nr="[^"+L+"]",xt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",_t="["+we+"]",Fe="\\u200d",Pe="(?:"+bt+"|"+pt+")",Ve="(?:"+_t+"|"+pt+")",Et="(?:"+$e+"(?:d|ll|m|re|s|t|ve))?",gr="(?:"+$e+"(?:D|LL|M|RE|S|T|VE))?",ae=er+"?",Ae="["+Be+"]?",oe="(?:"+Fe+"(?:"+[nr,xt,Ke].join("|")+")"+Ae+ae+")*",ge="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Me="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Qe=Ae+ae+oe,gt="(?:"+[Lt,xt,Ke].join("|")+")"+Qe,Jt=RegExp([_t+"?"+bt+"+"+Et+"(?="+[Ut,_t,"$"].join("|")+")",Ve+"+"+gr+"(?="+[Ut,_t+Pe,"$"].join("|")+")",_t+"?"+Pe+"+"+Et,_t+"+"+gr,Me,ge,kt,gt].join("|"),"g");function Dr(Br){return Br.match(Jt)||[]}sr.exports=Dr},68929:function(sr,L,x){var Q=x(48403),w=x(35393),d=w(function(b,Y,W){return Y=Y.toLowerCase(),b+(W?Q(Y):Y)});sr.exports=d},48403:function(sr,L,x){var Q=x(79833),w=x(11700);function d(b){return w(Q(b).toLowerCase())}sr.exports=d},74691:function(sr,L,x){var Q=x(29750),w=x(14841);function d(b,Y,W){return W===void 0&&(W=Y,Y=void 0),W!==void 0&&(W=w(W),W=W===W?W:0),Y!==void 0&&(Y=w(Y),Y=Y===Y?Y:0),Q(w(b),Y,W)}sr.exports=d},53816:function(sr,L,x){var Q=x(69389),w=x(79833),d=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,b="\\u0300-\\u036f",Y="\\ufe20-\\ufe2f",W="\\u20d0-\\u20ff",$=b+Y+W,I="["+$+"]",k=RegExp(I,"g");function we(Be){return Be=w(Be),Be&&Be.replace(d,Q).replace(k,"")}sr.exports=we},60442:function(sr,L,x){var Q=x(90939);function w(d,b){return Q(d,b)}sr.exports=w},14293:function(sr){function L(x){return x==null}sr.exports=L},81763:function(sr,L,x){var Q=x(44239),w=x(37005),d="[object Number]";function b(Y){return typeof Y=="number"||w(Y)&&Q(Y)==d}sr.exports=b},30236:function(sr,L,x){var Q=x(42980),w=x(21463),d=w(function(b,Y,W,$){Q(b,Y,W,$)});sr.exports=d},44908:function(sr,L,x){var Q=x(45652);function w(d){return d&&d.length?Q(d):[]}sr.exports=w},11700:function(sr,L,x){var Q=x(98805),w=Q("toUpperCase");sr.exports=w},58748:function(sr,L,x){var Q=x(49029),w=x(93157),d=x(79833),b=x(2757);function Y(W,$,I){return W=d(W),$=I?void 0:$,$===void 0?w(W)?b(W):Q(W):W.match($)||[]}sr.exports=Y},6158:function(sr){(function(L,x){sr.exports=x()})(this,function(){"use strict";var L,x,Q;function w(d,b){if(!L)L=b;else if(!x)x=b;else{var Y="var sharedChunk = {}; ("+L+")(sharedChunk); ("+x+")(sharedChunk);",W={};L(W),Q=b(W),typeof window!="undefined"&&(Q.workerUrl=window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"})))}}return w(["exports"],function(d){"use strict";function b(e,t){return e(t={exports:{}},t.exports),t.exports}var Y=W;function W(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}W.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},W.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},W.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},W.prototype.solveCurveX=function(e,t){var r,f,v,m,_;for(t===void 0&&(t=1e-6),v=e,_=0;_<8;_++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var A=this.sampleCurveDerivativeX(v);if(Math.abs(A)<1e-6)break;v-=m/A}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:f=v,v=.5*(f-r)+r}return v},W.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var $=I;function I(e,t){this.x=e,this.y=t}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(e){return e instanceof I?e:Array.isArray(e)?new I(e[0],e[1]):e};var k=typeof self!="undefined"?self:{},we=Math.pow(2,53)-1;function Be(e,t,r,f){var v=new Y(e,t,r,f);return function(m){return v.solve(m)}}var We=Be(.25,.1,.25,1);function $e(e,t,r){return Math.min(r,Math.max(t,e))}function Ut(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Yt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var _ in m)e[_]=m[_]}return e}var kt=1;function Lt(){return kt++}function bt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function pt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Ir(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function er(e,t){return e.indexOf(t,e.length-t.length)!==-1}function nr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function xt(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ke(e){return Array.isArray(e)?e.map(Ke):typeof e=="object"&&e?nr(e,Ke):e}var _t={};function Fe(e){_t[e]||(typeof console!="undefined"&&console.warn(e),_t[e]=!0)}function Pe(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ve(e){for(var t=0,r=0,f=e.length,v=f-1,m=void 0,_=void 0;r<f;v=r++)t+=((_=e[v]).x-(m=e[r]).x)*(m.y+_.y);return t}function Et(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function gr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,m,_){var A=m||_;return t[v]=!A||A.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ae=null;function Ae(e){if(ae==null){var t=e.navigator?e.navigator.userAgent:null;ae=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ae}function oe(e){try{var t=k[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var ge,Me,Qe,gt,Jt=k.performance&&k.performance.now?k.performance.now.bind(k.performance):Date.now.bind(Date),Dr=k.requestAnimationFrame||k.mozRequestAnimationFrame||k.webkitRequestAnimationFrame||k.msRequestAnimationFrame,Br=k.cancelAnimationFrame||k.mozCancelAnimationFrame||k.webkitCancelAnimationFrame||k.msCancelAnimationFrame,un={now:Jt,frame:function(e){var t=Dr(e);return{cancel:function(){return Br(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=k.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return ge||(ge=k.document.createElement("a")),ge.href=e,ge.href},hardwareConcurrency:k.navigator&&k.navigator.hardwareConcurrency||4,get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(Me==null&&(Me=k.matchMedia("(prefers-reduced-motion: reduce)")),Me.matches)}},tr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},se={supported:!1,testSupport:function(e){!be&&gt&&(ke?Ce(e):Qe=e)}},be=!1,ke=!1;function Ce(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,gt),e.isContextLost())return;se.supported=!0}catch(r){}e.deleteTexture(t),be=!0}k.document&&((gt=k.document.createElement("img")).onload=function(){Qe&&Ce(Qe),Qe=null,ke=!0},gt.onerror=function(){be=!0,Qe=null},gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Pt="01",Dt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function E(e){return e.indexOf("mapbox:")===0}Dt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Dt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Dt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},Dt.prototype.normalizeStyleURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Dt.prototype.normalizeGlyphsURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Dt.prototype.normalizeSourceURL=function(e,t){if(!E(e))return e;var r=qe(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},Dt.prototype.normalizeSpriteURL=function(e,t,r,f){var v=qe(e);return E(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,mt(v))},Dt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!E(e))return e;var r=qe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(un.devicePixelRatio>=2||t===512?"@2x":"")+(se.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var m=0,_=v;m<_.length;m+=1){var A=_[m].match(/^access_token=(.*)$/);if(A)return A[1]}return null}(r.params)||tr.ACCESS_TOKEN;return tr.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},Dt.prototype.canonicalizeTileURL=function(e,t){var r=qe(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},Dt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&E(t),f=[],v=0,m=e.tiles||[];v<m.length;v+=1){var _=m[v];he(_)?f.push(this.canonicalizeTileURL(_,r)):f.push(_)}return f},Dt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=qe(tr.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!tr.REQUIRE_ACCESS_TOKEN)return mt(e);if(!(t=t||tr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),mt(e)};var N=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function he(e){return N.test(e)}var Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(e){var t=e.match(Ze);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function mt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ct(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var H=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};H.prototype.getStorageKey=function(e){var t,r=Ct(tr.ACCESS_TOKEN);return t=r&&r.u?k.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):tr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},H.prototype.fetchEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=k.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=k.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){Fe("Unable to read from LocalStorage")}},H.prototype.saveEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{k.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Fe("Unable to write to LocalStorage")}},H.prototype.processRequests=function(e){},H.prototype.postEvent=function(e,t,r,f){var v=this;if(tr.EVENTS_URL){var m=qe(tr.EVENTS_URL);m.params.push("access_token="+(f||tr.ACCESS_TOKEN||""));var _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Pt,userId:this.anonId},A=t?Yt(_,t):_,F={url:mt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=pi(F,function(Z){v.pendingRequest=null,r(Z),v.saveEventData(),v.processRequests(f)})}},H.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Kt,jt,hr=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,m){this.skuToken=v,(tr.EVENTS_URL&&m||tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(_){return E(_)||he(_)}))&&this.queueRequest({id:f,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,_=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=bt()),this.postEvent(_,{skuToken:this.skuToken},function(A){A||m&&(f.success[m]=!0)},r))}},t}(H),Cr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){tr.EVENTS_URL&&tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return E(v)||he(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ct(tr.ACCESS_TOKEN),m=v?v.u:tr.ACCESS_TOKEN,_=m!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=bt(),_=!0);var A=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),Z=new Date(A),K=(A-this.eventData.lastSuccess)/864e5;_=_||K>=1||K<-1||F.getDate()!==Z.getDate()}else _=!0;if(!_)return this.processRequests();this.postEvent(A,{"enabled.telemetry":!1},function(q){q||(f.eventData.lastSuccess=A,f.eventData.tokenU=m)},r)}},t}(H)),Tr=Cr.postTurnstileEvent.bind(Cr),Pr=new hr,Je=Pr.postMapLoadEvent.bind(Pr),yt=500,ht=50;function fr(){k.caches&&!Kt&&(Kt=k.caches.open("mapbox-tiles"))}function $r(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var lt,Rt=1/0;function Qt(){return lt==null&&(lt=k.OffscreenCanvas&&new k.OffscreenCanvas(1,1).getContext("2d")&&typeof k.createImageBitmap=="function"),lt}var pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(pr);var vn=function(e){function t(r,f,v){f===401&&he(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Pn=Et()?function(){return self.worker&&self.worker.referrer}:function(){return(k.location.protocol==="blob:"?k.parent:k).location.href},bi,Si,Ri=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Pn())&&!/^\w+:/.test(r))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(f,v){var m,_=new k.AbortController,A=new k.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Pn(),signal:_.signal}),F=!1,Z=!1,K=(m=A.url).indexOf("sku=")>0&&he(m);f.type==="json"&&A.headers.set("Accept","application/json");var q=function(de,je,Xe){if(!Z){if(de&&de.message!=="SecurityError"&&Fe(de),je&&Xe)return ue(je);var st=Date.now();k.fetch(A).then(function(et){if(et.ok){var Mt=K?et.clone():null;return ue(et,Mt,st)}return v(new vn(et.statusText,et.status,f.url))}).catch(function(et){et.code!==20&&v(new Error(et.message))})}},ue=function(de,je,Xe){(f.type==="arrayBuffer"?de.arrayBuffer():f.type==="json"?de.json():de.text()).then(function(st){Z||(je&&Xe&&function(et,Mt,Gt){if(fr(),Kt){var ir={status:Mt.status,statusText:Mt.statusText,headers:new k.Headers};Mt.headers.forEach(function(Ar,en){return ir.headers.set(en,Ar)});var cr=gr(Mt.headers.get("Cache-Control")||"");cr["no-store"]||(cr["max-age"]&&ir.headers.set("Expires",new Date(Gt+1e3*cr["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-Gt<42e4||function(Ar,en){if(jt===void 0)try{new Response(new ReadableStream),jt=!0}catch(pn){jt=!1}jt?en(Ar.body):Ar.blob().then(en)}(Mt,function(Ar){var en=new k.Response(Ar,ir);fr(),Kt&&Kt.then(function(pn){return pn.put($r(et.url),en)}).catch(function(pn){return Fe(pn.message)})}))}}(A,je,Xe),F=!0,v(null,st,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(st){Z||v(new Error(st.message))})};return K?function(de,je){if(fr(),!Kt)return je(null);var Xe=$r(de.url);Kt.then(function(st){st.match(Xe).then(function(et){var Mt=function(Gt){if(!Gt)return!1;var ir=new Date(Gt.headers.get("Expires")||0),cr=gr(Gt.headers.get("Cache-Control")||"");return ir>Date.now()&&!cr["no-cache"]}(et);st.delete(Xe),Mt&&st.put(Xe,et.clone()),je(null,et,Mt)}).catch(je)}).catch(je)}(A,q):q(null,null),{cancel:function(){Z=!0,F||_.abort()}}}(e,t);if(Et()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var m=new k.XMLHttpRequest;for(var _ in m.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(m.responseType="arraybuffer"),f.headers)m.setRequestHeader(_,f.headers[_]);return f.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=f.credentials==="include",m.onerror=function(){v(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var A=m.response;if(f.type==="json")try{A=JSON.parse(m.response)}catch(F){return v(F)}v(null,A,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else v(new vn(m.statusText,m.status,f.url))},m.send(f.body),{cancel:function(){return m.abort()}}}(e,t)},ia=function(e,t){return Ri(Yt(e,{type:"arrayBuffer"}),t)},pi=function(e,t){return Ri(Yt(e,{method:"POST"}),t)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";bi=[],Si=0;var ie=function(e,t){if(se.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Si>=tr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return bi.push(r),r}Si++;var f=!1,v=function(){if(!f)for(f=!0,Si--;bi.length&&Si<tr.MAX_PARALLEL_IMAGE_REQUESTS;){var _=bi.shift();_.cancelled||(_.cancel=ie(_.requestParameters,_.callback).cancel)}},m=ia(e,function(_,A,F,Z){v(),_?t(_):A&&(Qt()?function(K,q){var ue=new k.Blob([new Uint8Array(K)],{type:"image/png"});k.createImageBitmap(ue).then(function(de){q(null,de)}).catch(function(de){q(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(A,t):function(K,q,ue,de){var je=new k.Image,Xe=k.URL;je.onload=function(){q(null,je),Xe.revokeObjectURL(je.src),je.onload=null,k.requestAnimationFrame(function(){je.src=G})},je.onerror=function(){return q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var st=new k.Blob([new Uint8Array(K)],{type:"image/png"});je.cacheControl=ue,je.expires=de,je.src=K.byteLength?Xe.createObjectURL(st):G}(A,t,F,Z))});return{cancel:function(){m.cancel(),v()}}};function ce(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function B(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var re=function(e,t){t===void 0&&(t={}),Yt(this,t),this.type=e},fe=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Yt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(re),Se=function(){};Se.prototype.on=function(e,t){return this._listeners=this._listeners||{},ce(e,t,this._listeners),this},Se.prototype.off=function(e,t){return B(e,t,this._listeners),B(e,t,this._oneTimeListeners),this},Se.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ce(e,t,this._oneTimeListeners),this},Se.prototype.fire=function(e,t){typeof e=="string"&&(e=new re(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var m=0,_=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<_.length;m+=1){var A=_[m];B(r,A,this._oneTimeListeners),A.call(this,e)}var F=this._eventedParent;F&&(Yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(e))}else e instanceof fe&&console.error(e.error);return this},Se.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Se.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},me=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function ct(e){var t=e.value;return t?[new me(e.key,t,"constants have been deprecated as of v8")]:[]}function yr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var _ in m)e[_]=m[_]}return e}function Or(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ft(e){if(Array.isArray(e))return e.map(Ft);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Ft(e[r]);return t}return Or(e)}var kr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),bn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};bn.prototype.concat=function(e){return new bn(this,e)},bn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},bn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var gn={kind:"null"},mr={kind:"number"},dn={kind:"string"},Wr={kind:"boolean"},ln={kind:"color"},Ei={kind:"object"},hn={kind:"value"},wi={kind:"collator"},Yi={kind:"formatted"},Yn={kind:"resolvedImage"};function Di(e,t){return{kind:"array",itemType:e,N:t}}function ki(e){if(e.kind==="array"){var t=ki(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var za=[gn,mr,dn,Wr,ln,Yi,Ei,Di(hn),Yn];function Wn(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Wn(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=za;r<f.length;r+=1)if(!Wn(f[r],t))return null}}return"Expected "+ki(e)+" but found "+ki(t)+" instead."}function ai(e,t){return t.some(function(r){return r.kind===e.kind})}function Ai(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Qn=b(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(A){return(A=Math.round(A))<0?0:A>255?255:A}function v(A){return f(A[A.length-1]==="%"?parseFloat(A)/100*255:parseInt(A))}function m(A){return(F=A[A.length-1]==="%"?parseFloat(A)/100:parseFloat(A))<0?0:F>1?1:F;var F}function _(A,F,Z){return Z<0?Z+=1:Z>1&&(Z-=1),6*Z<1?A+(F-A)*Z*6:2*Z<1?F:3*Z<2?A+(F-A)*(2/3-Z)*6:A}try{t.parseCSSColor=function(A){var F,Z=A.replace(/ /g,"").toLowerCase();if(Z in r)return r[Z].slice();if(Z[0]==="#")return Z.length===4?(F=parseInt(Z.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:Z.length===7&&(F=parseInt(Z.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var K=Z.indexOf("("),q=Z.indexOf(")");if(K!==-1&&q+1===Z.length){var ue=Z.substr(0,K),de=Z.substr(K+1,q-(K+1)).split(","),je=1;switch(ue){case"rgba":if(de.length!==4)return null;je=m(de.pop());case"rgb":return de.length!==3?null:[v(de[0]),v(de[1]),v(de[2]),je];case"hsla":if(de.length!==4)return null;je=m(de.pop());case"hsl":if(de.length!==3)return null;var Xe=(parseFloat(de[0])%360+360)%360/360,st=m(de[1]),et=m(de[2]),Mt=et<=.5?et*(st+1):et+st-et*st,Gt=2*et-Mt;return[f(255*_(Gt,Mt,Xe+1/3)),f(255*_(Gt,Mt,Xe)),f(255*_(Gt,Mt,Xe-1/3)),je];default:return null}}return null}}catch(A){}}).parseCSSColor,Fi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Fi.parse=function(e){if(e){if(e instanceof Fi)return e;if(typeof e=="string"){var t=Qn(e);if(t)return new Fi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Fi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Fi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Fi.black=new Fi(0,0,0,1),Fi.white=new Fi(1,1,1,1),Fi.transparent=new Fi(0,0,0,0),Fi.red=new Fi(1,0,0,1);var ya=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ya.prototype.compare=function(e,t){return this.collator.compare(e,t)},ya.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Xa=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},_a=function(e){this.sections=e};_a.fromString=function(e){return new _a([new Xa(e,null,null,null,null)])},_a.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},_a.factory=function(e){return e instanceof _a?e:_a.fromString(e)},_a.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},_a.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var da=function(e){this.name=e.name,this.available=e.available};function Vu(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ya(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Fi||e instanceof ya||e instanceof _a||e instanceof da)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Ya(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Ya(e[f]))return!1;return!0}return!1}function gi(e){if(e===null)return gn;if(typeof e=="string")return dn;if(typeof e=="boolean")return Wr;if(typeof e=="number")return mr;if(e instanceof Fi)return ln;if(e instanceof ya)return wi;if(e instanceof _a)return Yi;if(e instanceof da)return Yn;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var m=gi(v[f]);if(t){if(t===m)continue;t=hn;break}t=m}return Di(t||hn,r)}return Ei}function qa(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Fi||e instanceof _a||e instanceof da?e.toString():JSON.stringify(e)}da.prototype.toString=function(){return this.name},da.fromString=function(e){return e?new da({name:e,available:!1}):null},da.prototype.serialize=function(){return["image",this.name]};var Ka=function(e,t){this.type=e,this.value=t};Ka.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Ya(e[1]))return t.error("invalid value");var r=e[1],f=gi(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Ka(f,r)},Ka.prototype.evaluate=function(){return this.value},Ka.prototype.eachChild=function(){},Ka.prototype.outputDefined=function(){return!0},Ka.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toArray()):this.value instanceof _a?this.value.serialize():this.value};var $a=function(e){this.name="ExpressionEvaluationError",this.message=e};$a.prototype.toJSON=function(){return this.message};var Yo={string:dn,number:mr,boolean:Wr,object:Ei},Gi=function(e,t){this.type=e,this.args=t};Gi.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var m,_;if(e.length>2){var A=e[1];if(typeof A!="string"||!(A in Yo)||A==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Yo[A],f++}else m=hn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);_=e[2],f++}r=Di(m,_)}else r=Yo[v];for(var F=[];f<e.length;f++){var Z=t.parse(e[f],f,hn);if(!Z)return null;F.push(Z)}return new Gi(r,F)},Gi.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!Wn(this.type,gi(r)))return r;if(t===this.args.length-1)throw new $a("Expected value to be of type "+ki(this.type)+", but found "+ki(gi(r))+" instead.")}return null},Gi.prototype.eachChild=function(e){this.args.forEach(e)},Gi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Gi.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Oo=function(e){this.type=Yi,this.sections=e};Oo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,m=1;m<=e.length-1;++m){var _=e[m];if(v&&typeof _=="object"&&!Array.isArray(_)){v=!1;var A=null;if(_["font-scale"]&&!(A=t.parse(_["font-scale"],1,mr)))return null;var F=null;if(_["text-font"]&&!(F=t.parse(_["text-font"],1,Di(dn))))return null;var Z=null;if(_["text-color"]&&!(Z=t.parse(_["text-color"],1,ln)))return null;var K=f[f.length-1];K.scale=A,K.font=F,K.textColor=Z}else{var q=t.parse(e[m],1,hn);if(!q)return null;var ue=q.type.kind;if(ue!=="string"&&ue!=="value"&&ue!=="null"&&ue!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:q,scale:null,font:null,textColor:null})}}return new Oo(f)},Oo.prototype.evaluate=function(e){return new _a(this.sections.map(function(t){var r=t.content.evaluate(e);return gi(r)===Yn?new Xa("",r,null,null,null):new Xa(qa(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Oo.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Oa=function(e){this.type=Yn,this.input=e};Oa.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,dn);return r?new Oa(r):t.error("No image name provided.")},Oa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=da.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Oa.prototype.eachChild=function(e){e(this.input)},Oa.prototype.outputDefined=function(){return!1},Oa.prototype.serialize=function(){return["image",this.input.serialize()]};var Za={"to-boolean":Wr,"to-color":ln,"to-number":mr,"to-string":dn},cs=function(e,t){this.type=e,this.args=t};cs.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=Za[r],v=[],m=1;m<e.length;m++){var _=t.parse(e[m],m,hn);if(!_)return null;v.push(_)}return new cs(f,v)},cs.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Fi)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Vu(t[0],t[1],t[2],t[3])))return new Fi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new $a(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var _=null,A=0,F=this.args;A<F.length;A+=1){if((_=F[A].evaluate(e))===null)return 0;var Z=Number(_);if(!isNaN(Z))return Z}throw new $a("Could not convert "+JSON.stringify(_)+" to number.")}return this.type.kind==="formatted"?_a.fromString(qa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?da.fromString(qa(this.args[0].evaluate(e))):qa(this.args[0].evaluate(e))},cs.prototype.eachChild=function(e){this.args.forEach(e)},cs.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},cs.prototype.serialize=function(){if(this.type.kind==="formatted")return new Oo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Oa(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var va=["Unknown","Point","LineString","Polygon"],fs=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};fs.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fs.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?va[this.feature.type]:this.feature.type:null},fs.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},fs.prototype.canonicalID=function(){return this.canonical},fs.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fs.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Fi.parse(e)),t};var Ca=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};Ca.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Ca.prototype.eachChild=function(e){this.args.forEach(e)},Ca.prototype.outputDefined=function(){return!1},Ca.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Ca.parse=function(e,t){var r,f=e[0],v=Ca.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,_=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=_.filter(function(ei){var Tn=ei[0];return!Array.isArray(Tn)||Tn.length===e.length-1}),F=null,Z=0,K=A;Z<K.length;Z+=1){var q=K[Z],ue=q[0],de=q[1];F=new bs(t.registry,t.path,null,t.scope);for(var je=[],Xe=!1,st=1;st<e.length;st++){var et=e[st],Mt=Array.isArray(ue)?ue[st-1]:ue.type,Gt=F.parse(et,1+je.length,Mt);if(!Gt){Xe=!0;break}je.push(Gt)}if(!Xe)if(Array.isArray(ue)&&ue.length!==je.length)F.error("Expected "+ue.length+" arguments, but found "+je.length+" instead.");else{for(var ir=0;ir<je.length;ir++){var cr=Array.isArray(ue)?ue[ir]:ue.type,Ar=je[ir];F.concat(ir+1).checkSubtype(cr,Ar.type)}if(F.errors.length===0)return new Ca(f,m,de,je)}}if(A.length===1)(r=t.errors).push.apply(r,F.errors);else{for(var en=(A.length?A:_).map(function(ei){var Tn;return Tn=ei[0],Array.isArray(Tn)?"("+Tn.map(ki).join(", ")+")":"("+ki(Tn.type)+"...)"}).join(" | "),pn=[],Hn=1;Hn<e.length;Hn++){var En=t.parse(e[Hn],1+pn.length);if(!En)return null;pn.push(ki(En.type))}t.error("Expected arguments of type "+en+", but found ("+pn.join(", ")+") instead.")}return null},Ca.register=function(e,t){for(var r in Ca.definitions=t,t)e[r]=Ca};var fo=function(e,t,r){this.type=wi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Zi(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function pe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Oe(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function ft(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function ur(e,t){for(var r,f,v,m,_,A,F,Z=!1,K=0,q=t.length;K<q;K++)for(var ue=t[K],de=0,je=ue.length;de<je-1;de++){if((m=(r=e)[0]-(f=ue[de])[0])*(F=r[1]-(v=ue[de+1])[1])-(A=r[0]-v[0])*(_=r[1]-f[1])==0&&m*A<=0&&_*F<=0)return!1;ft(e,ue[de],ue[de+1])&&(Z=!Z)}return Z}function Qr(e,t){for(var r=0;r<t.length;r++)if(ur(e,t[r]))return!0;return!1}function Dn(e,t,r,f){var v=f[0]-r[0],m=f[1]-r[1],_=(e[0]-r[0])*m-v*(e[1]-r[1]),A=(t[0]-r[0])*m-v*(t[1]-r[1]);return _>0&&A<0||_<0&&A>0}function Ki(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var m=v[f],_=0;_<m.length-1;++_)if((q=[(K=m[_+1])[0]-(Z=m[_])[0],K[1]-Z[1]])[0]*(ue=[(F=t)[0]-(A=e)[0],F[1]-A[1]])[1]-q[1]*ue[0]!=0&&Dn(A,F,Z,K)&&Dn(Z,K,A,F))return!0;var A,F,Z,K,q,ue;return!1}function Ua(e,t){for(var r=0;r<e.length;++r)if(!ur(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Ki(e[f],e[f+1],t))return!1;return!0}function La(e,t){for(var r=0;r<t.length;r++)if(Ua(e,t[r]))return!0;return!1}function ja(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var m=[],_=0;_<e[v].length;_++){var A=Oe(e[v][_],r);Zi(t,A),m.push(A)}f.push(m)}return f}function To(e,t,r){for(var f=[],v=0;v<e.length;v++){var m=ja(e[v],t,r);f.push(m)}return f}function Mu(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,m=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;m===0&&(m=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=m}Zi(t,e)}function $l(e,t,r,f){for(var v=8192*Math.pow(2,f.z),m=[8192*f.x,8192*f.y],_=[],A=0,F=e;A<F.length;A+=1)for(var Z=0,K=F[A];Z<K.length;Z+=1){var q=K[Z],ue=[q.x+m[0],q.y+m[1]];Mu(ue,t,r,v),_.push(ue)}return _}function Il(e,t,r,f){for(var v,m=8192*Math.pow(2,f.z),_=[8192*f.x,8192*f.y],A=[],F=0,Z=e;F<Z.length;F+=1){for(var K=[],q=0,ue=Z[F];q<ue.length;q+=1){var de=ue[q],je=[de.x+_[0],de.y+_[1]];Zi(t,je),K.push(je)}A.push(K)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Xe=0,st=A;Xe<st.length;Xe+=1)for(var et=0,Mt=st[Xe];et<Mt.length;et+=1)Mu(Mt[et],t,r,m)}return A}fo.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Wr);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Wr);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,dn))?null:new fo(f,v,m)},fo.prototype.evaluate=function(e){return new ya(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},fo.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},fo.prototype.outputDefined=function(){return!1},fo.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Lo=function(e,t){this.type=Wr,this.geojson=e,this.geometries=t};function Xs(e){if(e instanceof Ca&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Lo)return!1;var t=!0;return e.eachChild(function(r){t&&!Xs(r)&&(t=!1)}),t}function ua(e){if(e instanceof Ca&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ua(r)&&(t=!1)}),t}function Ns(e,t){if(e instanceof Ca&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!Ns(f,t)&&(r=!1)}),r}Lo.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Ya(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Lo(r,r.features[f].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Lo(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Lo(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Lo.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=ja(r.coordinates,v,m),A=$l(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var F=0,Z=A;F<Z.length;F+=1)if(!ur(Z[F],_))return!1}if(r.type==="MultiPolygon"){var K=To(r.coordinates,v,m),q=$l(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var ue=0,de=q;ue<de.length;ue+=1)if(!Qr(de[ue],K))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=ja(r.coordinates,v,m),A=Il(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var F=0,Z=A;F<Z.length;F+=1)if(!Ua(Z[F],_))return!1}if(r.type==="MultiPolygon"){var K=To(r.coordinates,v,m),q=Il(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var ue=0,de=q;ue<de.length;ue+=1)if(!La(de[ue],K))return!1}return!0}(e,this.geometries)}return!1},Lo.prototype.eachChild=function(){},Lo.prototype.outputDefined=function(){return!0},Lo.prototype.serialize=function(){return["within",this.geojson]};var ou=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};ou.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new ou(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},ou.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},ou.prototype.eachChild=function(){},ou.prototype.outputDefined=function(){return!1},ou.prototype.serialize=function(){return["var",this.name]};var bs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new bn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(m){return"["+m+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Ps(e,t){for(var r,f=e.length-1,v=0,m=f,_=0;v<=m;)if((r=e[_=Math.floor((v+m)/2)])<=t){if(_===f||t<e[_+1])return _;v=_+1}else{if(!(r>t))throw new $a("Input is not a number.");m=_-1}return 0}bs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},bs.prototype._parse=function(e,t){function r(Z,K,q){return q==="assert"?new Gi(K,[Z]):q==="coerce"?new cs(K,[Z]):Z}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var _=this.expectedType,A=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||A.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(_,A))return null}else m=r(m,_,t.typeAnnotation||"coerce");else m=r(m,_,t.typeAnnotation||"assert")}if(!(m instanceof Ka)&&m.type.kind!=="resolvedImage"&&function Z(K){if(K instanceof ou)return Z(K.boundExpression);if(K instanceof Ca&&K.name==="error"||K instanceof fo||K instanceof Lo)return!1;var q=K instanceof cs||K instanceof Gi,ue=!0;return K.eachChild(function(de){ue=q?ue&&Z(de):ue&&de instanceof Ka}),!!ue&&Xs(K)&&Ns(K,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var F=new fs;try{m=new Ka(m.type,m.evaluate(F))}catch(Z){return this.error(Z.message),null}}return m}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},bs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new bs(this.registry,f,t||null,v,this.errors)},bs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new kr(f,e))},bs.prototype.checkSubtype=function(e,t){var r=Wn(e,t);return r&&this.error(r),r};var ti=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var m=v[f],_=m[1];this.labels.push(m[0]),this.outputs.push(_)}};function ho(e,t,r){return e*(1-r)+t*r}ti.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,mr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var _=m===1?-1/0:e[m],A=e[m+1],F=m,Z=m+1;if(typeof _!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(f.length&&f[f.length-1][0]>=_)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var K=t.parse(A,Z,v);if(!K)return null;v=v||K.type,f.push([_,K])}return new ti(v,r,f)},ti.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Ps(t,f)].evaluate(e)},ti.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ti.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ti.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var su=Object.freeze({__proto__:null,number:ho,color:function(e,t,r){return new Fi(ho(e.r,t.r,r),ho(e.g,t.g,r),ho(e.b,t.b,r),ho(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return ho(f,t[v],r)})}}),Ol=6/29*3*(6/29),sl=Math.PI/180,He=180/Math.PI;function Tt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ol+4/29}function _r(e){return e>6/29?e*e*e:Ol*(e-4/29)}function Zn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function sa(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function xa(e){var t=sa(e.r),r=sa(e.g),f=sa(e.b),v=Tt((.4124564*t+.3575761*r+.1804375*f)/.95047),m=Tt((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Tt((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function ka(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*_r(t),r=.95047*_r(r),f=1.08883*_r(f),new Fi(Zn(3.2404542*r-1.5371385*t-.4985314*f),Zn(-.969266*r+1.8760108*t+.041556*f),Zn(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function vi(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var Ta={forward:xa,reverse:ka,interpolate:function(e,t,r){return{l:ho(e.l,t.l,r),a:ho(e.a,t.a,r),b:ho(e.b,t.b,r),alpha:ho(e.alpha,t.alpha,r)}}},eo={forward:function(e){var t=xa(e),r=t.l,f=t.a,v=t.b,m=Math.atan2(v,f)*He;return{h:m<0?m+360:m,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*sl,r=e.c;return ka({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:vi(e.h,t.h,r),c:ho(e.c,t.c,r),l:ho(e.l,t.l,r),alpha:ho(e.alpha,t.alpha,r)}}},qn=Object.freeze({__proto__:null,lab:Ta,hcl:eo}),ba=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var m=0,_=v;m<_.length;m+=1){var A=_[m],F=A[1];this.labels.push(A[0]),this.outputs.push(F)}};function Jl(e,t,r,f){var v=f-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}ba.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=Jl(t,e.base,r,f);else if(e.name==="linear")v=Jl(t,1,r,f);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new Y(m[0],m[1],m[2],m[3]).solve(Jl(t,1,r,f))}return v},ba.parse=function(e,t){var r=e[0],f=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var _=f[1];if(typeof _!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:_}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var A=f.slice(1);if(A.length!==4||A.some(function(st){return typeof st!="number"||st<0||st>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,mr)))return null;var F=[],Z=null;r==="interpolate-hcl"||r==="interpolate-lab"?Z=ln:t.expectedType&&t.expectedType.kind!=="value"&&(Z=t.expectedType);for(var K=0;K<m.length;K+=2){var q=m[K],ue=m[K+1],de=K+3,je=K+4;if(typeof q!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(F.length&&F[F.length-1][0]>=q)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var Xe=t.parse(ue,je,Z);if(!Xe)return null;Z=Z||Xe.type,F.push([q,Xe])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new ba(Z,r,f,v,F):t.error("Type "+ki(Z)+" is not interpolatable.")},ba.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var m=Ps(t,f),_=ba.interpolationFactor(this.interpolation,f,t[m],t[m+1]),A=r[m].evaluate(e),F=r[m+1].evaluate(e);return this.operator==="interpolate"?su[this.type.kind.toLowerCase()](A,F,_):this.operator==="interpolate-hcl"?eo.reverse(eo.interpolate(eo.forward(A),eo.forward(F),_)):Ta.reverse(Ta.interpolate(Ta.forward(A),Ta.forward(F),_))},ba.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ba.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ba.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Ra=function(e,t){this.type=e,this.args=t};Ra.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],m=0,_=e.slice(1);m<_.length;m+=1){var A=t.parse(_[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!A)return null;r=r||A.type,v.push(A)}var F=f&&v.some(function(Z){return Wn(f,Z.type)});return new Ra(F?hn:r,v)},Ra.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,m=this.args;v<m.length&&(f++,(r=m[v].evaluate(e))&&r instanceof da&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Ra.prototype.eachChild=function(e){this.args.forEach(e)},Ra.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ra.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ro=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Ro.prototype.evaluate=function(e){return this.result.evaluate(e)},Ro.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Ro.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var m=t.parse(e[f+1],f+1);if(!m)return null;r.push([v,m])}var _=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return _?new Ro(r,_):null},Ro.prototype.outputDefined=function(){return this.result.outputDefined()},Ro.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var xu=function(e,t,r){this.type=e,this.index=t,this.input=r};xu.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,mr),f=t.parse(e[2],2,Di(t.expectedType||hn));return r&&f?new xu(f.type.itemType,r,f):null},xu.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new $a("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new $a("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new $a("Array index must be an integer, but found "+t+" instead.");return r[t]},xu.prototype.eachChild=function(e){e(this.index),e(this.input)},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ys=function(e,t){this.type=Wr,this.needle=e,this.haystack=t};Ys.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),f=t.parse(e[2],2,hn);return r&&f?ai(r.type,[Wr,dn,mr,gn,hn])?new Ys(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+ki(r.type)+" instead"):null},Ys.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Ai(t,["boolean","string","number","null"]))throw new $a("Expected first argument to be of type boolean, string, number or null, but found "+ki(gi(t))+" instead.");if(!Ai(r,["string","array"]))throw new $a("Expected second argument to be of type array or string, but found "+ki(gi(r))+" instead.");return r.indexOf(t)>=0},Ys.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Ys.prototype.outputDefined=function(){return!0},Ys.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var zs=function(e,t,r){this.type=mr,this.needle=e,this.haystack=t,this.fromIndex=r};zs.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),f=t.parse(e[2],2,hn);if(!r||!f)return null;if(!ai(r.type,[Wr,dn,mr,gn,hn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+ki(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,mr);return v?new zs(r,f,v):null}return new zs(r,f)},zs.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Ai(t,["boolean","string","number","null"]))throw new $a("Expected first argument to be of type boolean, string, number or null, but found "+ki(gi(t))+" instead.");if(!Ai(r,["string","array"]))throw new $a("Expected second argument to be of type array or string, but found "+ki(gi(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},zs.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},zs.prototype.outputDefined=function(){return!1},zs.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var rs=function(e,t,r,f,v,m){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=m};rs.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},m=[],_=2;_<e.length-1;_+=2){var A=e[_],F=e[_+1];Array.isArray(A)||(A=[A]);var Z=t.concat(_);if(A.length===0)return Z.error("Expected at least one branch label.");for(var K=0,q=A;K<q.length;K+=1){var ue=q[K];if(typeof ue!="number"&&typeof ue!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ue=="number"&&Math.floor(ue)!==ue)return Z.error("Numeric branch labels must be integer values.");if(r){if(Z.checkSubtype(r,gi(ue)))return null}else r=gi(ue);if(v[String(ue)]!==void 0)return Z.error("Branch labels must be unique.");v[String(ue)]=m.length}var de=t.parse(F,_,f);if(!de)return null;f=f||de.type,m.push(de)}var je=t.parse(e[1],1,hn);if(!je)return null;var Xe=t.parse(e[e.length-1],e.length-1,f);return Xe?je.type.kind!=="value"&&t.concat(1).checkSubtype(r,je.type)?null:new rs(r,f,je,v,m,Xe):null},rs.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(gi(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},rs.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},rs.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},rs.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var _=m[v];(q=f[this.cases[_]])===void 0?(f[this.cases[_]]=r.length,r.push([this.cases[_],[_]])):r[q][1].push(_)}for(var A=function(de){return e.inputType.kind==="number"?Number(de):de},F=0,Z=r;F<Z.length;F+=1){var K=Z[F],q=K[0],ue=K[1];t.push(ue.length===1?A(ue[0]):ue.map(A)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Iu=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Iu.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,Wr);if(!m)return null;var _=t.parse(e[v+1],v+1,r);if(!_)return null;f.push([m,_]),r=r||_.type}var A=t.parse(e[e.length-1],e.length-1,r);return A?new Iu(r,f,A):null},Iu.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Iu.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},Iu.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Iu.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var xo=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function rf(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ul(e,t,r,f){return f.compare(t,r)===0}function Ui(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(m,_,A){this.type=Wr,this.lhs=m,this.rhs=_,this.collator=A,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}return v.parse=function(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");var A=m[0],F=_.parse(m[1],1,hn);if(!F)return null;if(!rf(A,F.type))return _.concat(1).error('"'+A+`" comparisons are not supported for type '`+ki(F.type)+"'.");var Z=_.parse(m[2],2,hn);if(!Z)return null;if(!rf(A,Z.type))return _.concat(2).error('"'+A+`" comparisons are not supported for type '`+ki(Z.type)+"'.");if(F.type.kind!==Z.type.kind&&F.type.kind!=="value"&&Z.type.kind!=="value")return _.error("Cannot compare types '"+ki(F.type)+"' and '"+ki(Z.type)+"'.");f&&(F.type.kind==="value"&&Z.type.kind!=="value"?F=new Gi(Z.type,[F]):F.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new Gi(F.type,[Z])));var K=null;if(m.length===4){if(F.type.kind!=="string"&&Z.type.kind!=="string"&&F.type.kind!=="value"&&Z.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(!(K=_.parse(m[3],3,wi)))return null}return new v(F,Z,K)},v.prototype.evaluate=function(m){var _=this.lhs.evaluate(m),A=this.rhs.evaluate(m);if(f&&this.hasUntypedArgument){var F=gi(_),Z=gi(A);if(F.kind!==Z.kind||F.kind!=="string"&&F.kind!=="number")throw new $a('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+F.kind+", "+Z.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var K=gi(_),q=gi(A);if(K.kind!=="string"||q.kind!=="string")return t(m,_,A)}return this.collator?r(m,_,A,this.collator.evaluate(m)):t(m,_,A)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(_){m.push(_.serialize())}),m},v}()}xo.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),f=t.parse(e[2],2,mr);if(!r||!f)return null;if(!ai(r.type,[Di(hn),dn,hn]))return t.error("Expected first argument to be of type array or string, but found "+ki(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,mr);return v?new xo(r.type,r,f,v):null}return new xo(r.type,r,f)},xo.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Ai(t,["string","array"]))throw new $a("Expected first argument to be of type array or string, but found "+ki(gi(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},xo.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},xo.prototype.outputDefined=function(){return!1},xo.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Hf=Ui("==",function(e,t,r){return t===r},ul),Ql=Ui("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ul(0,t,r,f)}),Sf=Ui("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),Ll=Ui(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Ko=Ui("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),Aa=Ui(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),to=function(e,t,r,f,v){this.type=dn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};to.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,mr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,dn)))return null;var m=null;if(f.currency&&!(m=t.parse(f.currency,1,dn)))return null;var _=null;if(f["min-fraction-digits"]&&!(_=t.parse(f["min-fraction-digits"],1,mr)))return null;var A=null;return f["max-fraction-digits"]&&!(A=t.parse(f["max-fraction-digits"],1,mr))?null:new to(r,v,m,_,A)},to.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},to.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ks=function(e){this.type=mr,this.input=e};Ks.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+ki(r.type)+" instead."):new Ks(r):null},Ks.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new $a("Expected value to be of type string or array, but found "+ki(gi(t))+" instead.")},Ks.prototype.eachChild=function(e){e(this.input)},Ks.prototype.outputDefined=function(){return!1},Ks.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ns={"==":Hf,"!=":Ql,">":Ll,"<":Sf,">=":Aa,"<=":Ko,array:Gi,at:xu,boolean:Gi,case:Iu,coalesce:Ra,collator:fo,format:Oo,image:Oa,in:Ys,"index-of":zs,interpolate:ba,"interpolate-hcl":ba,"interpolate-lab":ba,length:Ks,let:Ro,literal:Ka,match:rs,number:Gi,"number-format":to,object:Gi,slice:xo,step:ti,string:Gi,"to-boolean":cs,"to-color":cs,"to-number":cs,"to-string":cs,var:ou,within:Lo};function fc(e,t){var r=t[0],f=t[1],v=t[2],m=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var _=m?m.evaluate(e):1,A=Vu(r,f,v,_);if(A)throw new $a(A);return new Fi(r/255*_,f/255*_,v/255*_,_)}function Rl(e,t){return e in t}function bu(e,t){var r=t[e];return r===void 0?null:r}function Su(e){return{type:e}}function Ou(e){return{result:"success",value:e}}function Zs(e){return{result:"error",value:e}}function Eu(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function hc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Gu(e){return!!e.expression&&e.expression.interpolated}function ma(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Pc(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Ef(e){return e}function ll(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function nf(e,t,r,f,v){return ll(typeof r===v?f[r]:void 0,e.default,t.default)}function Mc(e,t,r){if(ma(r)!=="number")return ll(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Ps(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function pc(e,t,r){var f=e.base!==void 0?e.base:1;if(ma(r)!=="number")return ll(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=Ps(e.stops.map(function(q){return q[0]}),r),_=function(q,ue,de,je){var Xe=je-de,st=q-de;return Xe===0?0:ue===1?st/Xe:(Math.pow(ue,st)-1)/(Math.pow(ue,Xe)-1)}(r,f,e.stops[m][0],e.stops[m+1][0]),A=e.stops[m][1],F=e.stops[m+1][1],Z=su[t.type]||Ef;if(e.colorSpace&&e.colorSpace!=="rgb"){var K=qn[e.colorSpace];Z=function(q,ue){return K.reverse(K.interpolate(K.forward(q),K.forward(ue),_))}}return typeof A.evaluate=="function"?{evaluate:function(){for(var q=[],ue=arguments.length;ue--;)q[ue]=arguments[ue];var de=A.evaluate.apply(void 0,q),je=F.evaluate.apply(void 0,q);if(de!==void 0&&je!==void 0)return Z(de,je,_)}}:Z(A,F,_)}function ql(e,t,r){return t.type==="color"?r=Fi.parse(r):t.type==="formatted"?r=_a.fromString(r.toString()):t.type==="resolvedImage"?r=da.fromString(r.toString()):ma(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),ll(r,e.default,t.default)}Ca.register(ns,{error:[{kind:"error"},[dn],function(e,t){throw new $a(t[0].evaluate(e))}],typeof:[dn,[hn],function(e,t){return ki(gi(t[0].evaluate(e)))}],"to-rgba":[Di(mr,4),[ln],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[ln,[mr,mr,mr],fc],rgba:[ln,[mr,mr,mr,mr],fc],has:{type:Wr,overloads:[[[dn],function(e,t){return Rl(t[0].evaluate(e),e.properties())}],[[dn,Ei],function(e,t){var r=t[1];return Rl(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:hn,overloads:[[[dn],function(e,t){return bu(t[0].evaluate(e),e.properties())}],[[dn,Ei],function(e,t){var r=t[1];return bu(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[hn,[dn],function(e,t){return bu(t[0].evaluate(e),e.featureState||{})}],properties:[Ei,[],function(e){return e.properties()}],"geometry-type":[dn,[],function(e){return e.geometryType()}],id:[hn,[],function(e){return e.id()}],zoom:[mr,[],function(e){return e.globals.zoom}],"heatmap-density":[mr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[mr,[],function(e){return e.globals.lineProgress||0}],accumulated:[hn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[mr,Su(mr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[mr,Su(mr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:mr,overloads:[[[mr,mr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[mr],function(e,t){return-t[0].evaluate(e)}]]},"/":[mr,[mr,mr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[mr,[mr,mr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[mr,[],function(){return Math.LN2}],pi:[mr,[],function(){return Math.PI}],e:[mr,[],function(){return Math.E}],"^":[mr,[mr,mr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[mr,[mr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[mr,[mr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[mr,[mr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[mr,[mr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[mr,[mr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[mr,[mr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[mr,[mr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[mr,[mr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[mr,[mr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[mr,[mr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[mr,Su(mr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[mr,Su(mr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[mr,[mr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[mr,[mr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[mr,[mr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[mr,[mr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[Wr,[dn,hn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[Wr,[hn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[Wr,[dn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[Wr,[dn,hn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<m}],"filter-id-<":[Wr,[hn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[Wr,[dn,hn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>m}],"filter-id->":[Wr,[hn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[Wr,[dn,hn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[Wr,[hn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[Wr,[dn,hn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[Wr,[hn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[Wr,[hn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[Wr,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[Wr,[Di(dn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[Wr,[Di(hn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[Wr,[dn,Di(hn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[Wr,[dn,Di(hn)],function(e,t){var r=t[0],f=t[1];return function(v,m,_,A){for(;_<=A;){var F=_+A>>1;if(m[F]===v)return!0;m[F]>v?A=F-1:_=F+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:Wr,overloads:[[[Wr,Wr],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[Su(Wr),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:Wr,overloads:[[[Wr,Wr],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[Su(Wr),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[Wr,[Wr],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[Wr,[dn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[dn,[dn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[dn,[dn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[dn,Su(hn),function(e,t){return t.map(function(r){return qa(r.evaluate(e))}).join("")}],"resolved-locale":[dn,[wi],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var cl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new fs,this._defaultValue=t?function(r){return r.type==="color"&&Pc(r.default)?new Fi(0,0,0,0):r.type==="color"?Fi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function wu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in ns}function ec(e,t){var r=new bs(ns,[],t?function(v){var m={color:ln,string:dn,number:mr,enum:dn,boolean:Wr,formatted:Yi,resolvedImage:Yn};return v.type==="array"?Di(m[v.value]||hn,v.length):m[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ou(new cl(f,t)):Zs(r.errors)}cl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},cl.prototype.evaluate=function(e,t,r,f,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new $a("Expected value to be one of "+Object.keys(this._enumValues).map(function(A){return JSON.stringify(A)}).join(", ")+", but found "+JSON.stringify(_)+" instead.");return _}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console!="undefined"&&console.warn(A.message)),this._defaultValue}};var fl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ua(t.expression)};fl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},fl.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)};var uu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ua(t.expression),this.interpolationType=f};function dc(e,t){if((e=ec(e,t)).result==="error")return e;var r=e.value.expression,f=Xs(r);if(!f&&!Eu(t))return Zs([new kr("","data expressions not supported")]);var v=Ns(r,["zoom"]);if(!v&&!hc(t))return Zs([new kr("","zoom expressions not supported")]);var m=function _(A){var F=null;if(A instanceof Ro)F=_(A.result);else if(A instanceof Ra)for(var Z=0,K=A.args;Z<K.length&&!(F=_(K[Z]));Z+=1);else(A instanceof ti||A instanceof ba)&&A.input instanceof Ca&&A.input.name==="zoom"&&(F=A);return F instanceof kr||A.eachChild(function(q){var ue=_(q);ue instanceof kr?F=ue:!F&&ue?F=new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&ue&&F!==ue&&(F=new kr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(r);return m||v?m instanceof kr?Zs([m]):m instanceof ba&&!Gu(t)?Zs([new kr("",'"interpolate" expressions cannot be used with this property')]):Ou(m?new uu(f?"camera":"composite",e.value,m.labels,m instanceof ba?m.interpolation:void 0):new fl(f?"constant":"source",e.value)):Zs([new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}uu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},uu.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)},uu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?ba.interpolationFactor(this.interpolationType,e,t,r):0};var hl=function(e,t){this._parameters=e,this._specification=t,yr(this,function r(f,v){var m,_,A,F=v.type==="color",Z=f.stops&&typeof f.stops[0][0]=="object",K=Z||!(Z||f.property!==void 0),q=f.type||(Gu(v)?"exponential":"interval");if(F&&((f=yr({},f)).stops&&(f.stops=f.stops.map(function(En){return[En[0],Fi.parse(En[1])]})),f.default=Fi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!qn[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(q==="exponential")m=pc;else if(q==="interval")m=Mc;else if(q==="categorical"){m=nf,_=Object.create(null);for(var ue=0,de=f.stops;ue<de.length;ue+=1){var je=de[ue];_[je[0]]=je[1]}A=typeof f.stops[0][0]}else{if(q!=="identity")throw new Error('Unknown function type "'+q+'"');m=ql}if(Z){for(var Xe={},st=[],et=0;et<f.stops.length;et++){var Mt=f.stops[et],Gt=Mt[0].zoom;Xe[Gt]===void 0&&(Xe[Gt]={zoom:Gt,type:f.type,property:f.property,default:f.default,stops:[]},st.push(Gt)),Xe[Gt].stops.push([Mt[0].value,Mt[1]])}for(var ir=[],cr=0,Ar=st;cr<Ar.length;cr+=1){var en=Ar[cr];ir.push([Xe[en].zoom,r(Xe[en],v)])}var pn={name:"linear"};return{kind:"composite",interpolationType:pn,interpolationFactor:ba.interpolationFactor.bind(void 0,pn),zoomStops:ir.map(function(En){return En[0]}),evaluate:function(En,ei){var Tn=En.zoom;return pc({stops:ir,base:f.base},v,Tn).evaluate(Tn,ei)}}}if(K){var Hn=q==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:Hn,interpolationFactor:ba.interpolationFactor.bind(void 0,Hn),zoomStops:f.stops.map(function(En){return En[0]}),evaluate:function(En){return m(f,v,En.zoom,_,A)}}}return{kind:"source",evaluate:function(En,ei){var Tn=ei&&ei.properties?ei.properties[f.property]:void 0;return Tn===void 0?ll(f.default,v.default):m(f,v,Tn,_,A)}}}(this._parameters,this._specification))};function $s(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,_=e.styleSpec,A=[],F=ma(r);if(F!=="object")return[new me(t,r,"object expected, "+F+" found")];for(var Z in r){var K=Z.split(".")[0],q=f[K]||f["*"],ue=void 0;if(v[K])ue=v[K];else if(f[K])ue=Hi;else if(v["*"])ue=v["*"];else{if(!f["*"]){A.push(new me(t,r[Z],'unknown property "'+Z+'"'));continue}ue=Hi}A=A.concat(ue({key:(t&&t+".")+Z,value:r[Z],valueSpec:q,style:m,styleSpec:_,object:r,objectKey:Z},r))}for(var de in f)v[de]||f[de].required&&f[de].default===void 0&&r[de]===void 0&&A.push(new me(t,r,'missing required property "'+de+'"'));return A}function Ic(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,m=e.key,_=e.arrayElementValidator||Hi;if(ma(t)!=="array")return[new me(m,t,"array expected, "+ma(t)+" found")];if(r.length&&t.length!==r.length)return[new me(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new me(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var A={type:r.value,values:r.values};v.$version<7&&(A.function=r.function),ma(r.value)==="object"&&(A=r.value);for(var F=[],Z=0;Z<t.length;Z++)F=F.concat(_({array:t,arrayIndex:Z,value:t[Z],valueSpec:A,style:f,styleSpec:v,key:m+"["+Z+"]"}));return F}function Oc(e){var t=e.key,r=e.value,f=e.valueSpec,v=ma(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new me(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new me(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new me(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Lc(e){var t,r,f,v=e.valueSpec,m=Or(e.value.type),_={},A=m!=="categorical"&&e.value.property===void 0,F=!A,Z=ma(e.value.stops)==="array"&&ma(e.value.stops[0])==="array"&&ma(e.value.stops[0][0])==="object",K=$s({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(de){if(m==="identity")return[new me(de.key,de.value,'identity function may not have a "stops" property')];var je=[],Xe=de.value;return je=je.concat(Ic({key:de.key,value:Xe,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:q})),ma(Xe)==="array"&&Xe.length===0&&je.push(new me(de.key,Xe,"array must have at least one stop")),je},default:function(de){return Hi({key:de.key,value:de.value,valueSpec:v,style:de.style,styleSpec:de.styleSpec})}}});return m==="identity"&&A&&K.push(new me(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||K.push(new me(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!Gu(e.valueSpec)&&K.push(new me(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(F&&!Eu(e.valueSpec)?K.push(new me(e.key,e.value,"property functions not supported")):A&&!hc(e.valueSpec)&&K.push(new me(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!Z||e.value.property!==void 0||K.push(new me(e.key,e.value,'"property" property is required')),K;function q(de){var je=[],Xe=de.value,st=de.key;if(ma(Xe)!=="array")return[new me(st,Xe,"array expected, "+ma(Xe)+" found")];if(Xe.length!==2)return[new me(st,Xe,"array length 2 expected, length "+Xe.length+" found")];if(Z){if(ma(Xe[0])!=="object")return[new me(st,Xe,"object expected, "+ma(Xe[0])+" found")];if(Xe[0].zoom===void 0)return[new me(st,Xe,"object stop key must have zoom")];if(Xe[0].value===void 0)return[new me(st,Xe,"object stop key must have value")];if(f&&f>Or(Xe[0].zoom))return[new me(st,Xe[0].zoom,"stop zoom values must appear in ascending order")];Or(Xe[0].zoom)!==f&&(f=Or(Xe[0].zoom),r=void 0,_={}),je=je.concat($s({key:st+"[0]",value:Xe[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:Oc,value:ue}}))}else je=je.concat(ue({key:st+"[0]",value:Xe[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},Xe));return wu(Ft(Xe[1]))?je.concat([new me(st+"[1]",Xe[1],"expressions are not allowed in function stops.")]):je.concat(Hi({key:st+"[1]",value:Xe[1],valueSpec:v,style:de.style,styleSpec:de.styleSpec}))}function ue(de,je){var Xe=ma(de.value),st=Or(de.value),et=de.value!==null?de.value:je;if(t){if(Xe!==t)return[new me(de.key,et,Xe+" stop domain type must match previous stop domain type "+t)]}else t=Xe;if(Xe!=="number"&&Xe!=="string"&&Xe!=="boolean")return[new me(de.key,et,"stop domain value must be a number, string, or boolean")];if(Xe!=="number"&&m!=="categorical"){var Mt="number expected, "+Xe+" found";return Eu(v)&&m===void 0&&(Mt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new me(de.key,et,Mt)]}return m!=="categorical"||Xe!=="number"||isFinite(st)&&Math.floor(st)===st?m!=="categorical"&&Xe==="number"&&r!==void 0&&st<r?[new me(de.key,et,"stop domain values must appear in ascending order")]:(r=st,m==="categorical"&&st in _?[new me(de.key,et,"stop domain values must be unique")]:(_[st]=!0,[])):[new me(de.key,et,"integer expected, found "+st)]}}function Hu(e){var t=(e.expressionContext==="property"?dc:ec)(Ft(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new me(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new me(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ua(r))return[new me(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ua(r))return[new me(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Ns(r,["zoom","feature-state"]))return[new me(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Xs(r))return[new me(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Or(r))===-1&&v.push(new me(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Or(r))===-1&&v.push(new me(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function tc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!tc(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}hl.deserialize=function(e){return new hl(e._parameters,e._specification)},hl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var Wu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};tc(e)||(e=Xu(e));var t=ec(e,Wu);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Rc(e,t){return e<t?-1:e>t?1:0}function Xu(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?No(e[1],e[2],"=="):r==="!="?Fl(No(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?No(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Xu))):r==="all"?["all"].concat(e.slice(1).map(Xu)):r==="none"?["all"].concat(e.slice(1).map(Xu).map(Fl)):r==="in"?af(e[1],e.slice(2)):r==="!in"?Fl(af(e[1],e.slice(2))):r==="has"?of(e[1]):r==="!has"?Fl(of(e[1])):r!=="within"||e}function No(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function af(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Rc)]]:["filter-in-small",e,["literal",t]]}}function of(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Fl(e){return["!",e]}function Dc(e){return tc(Ft(e.value))?Hu(yr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(ma(f)!=="array")return[new me(v,f,"array expected, "+ma(f)+" found")];var m,_=r.styleSpec,A=[];if(f.length<1)return[new me(v,f,"filter array must have at least 1 element")];switch(A=A.concat(Dl({key:v+"[0]",value:f[0],valueSpec:_.filter_operator,style:r.style,styleSpec:r.styleSpec})),Or(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Or(f[1])==="$type"&&A.push(new me(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&A.push(new me(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(m=ma(f[1]))!=="string"&&A.push(new me(v+"[1]",f[1],"string expected, "+m+" found"));for(var F=2;F<f.length;F++)m=ma(f[F]),Or(f[1])==="$type"?A=A.concat(Dl({key:v+"["+F+"]",value:f[F],valueSpec:_.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&A.push(new me(v+"["+F+"]",f[F],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var Z=1;Z<f.length;Z++)A=A.concat(t({key:v+"["+Z+"]",value:f[Z],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=ma(f[1]),f.length!==2?A.push(new me(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="string"&&A.push(new me(v+"[1]",f[1],"string expected, "+m+" found"));break;case"within":m=ma(f[1]),f.length!==2?A.push(new me(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="object"&&A.push(new me(v+"[1]",f[1],"object expected, "+m+" found"))}return A}(e)}function Fa(e,t){var r=e.key,f=e.style,v=e.styleSpec,m=e.value,_=e.objectKey,A=v[t+"_"+e.layerType];if(!A)return[];var F=_.match(/^(.*)-transition$/);if(t==="paint"&&F&&A[F[1]]&&A[F[1]].transition)return Hi({key:r,value:m,valueSpec:v.transition,style:f,styleSpec:v});var Z,K=e.valueSpec||A[_];if(!K)return[new me(r,m,'unknown property "'+_+'"')];if(ma(m)==="string"&&Eu(K)&&!K.tokens&&(Z=/^{([^}]+)}$/.exec(m)))return[new me(r,m,'"'+_+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var q=[];return e.layerType==="symbol"&&(_==="text-field"&&f&&!f.glyphs&&q.push(new me(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Pc(Ft(m))&&Or(m.type)==="identity"&&q.push(new me(r,m,'"text-font" does not support identity functions'))),q.concat(Hi({key:e.key,value:m,valueSpec:K,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:_}))}function kc(e){return Fa(e,"paint")}function Yu(e){return Fa(e,"layout")}function Fc(e){var t=[],r=e.value,f=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new me(f,r,'either "type" or "ref" is required'));var _,A=Or(r.type),F=Or(r.ref);if(r.id)for(var Z=Or(r.id),K=0;K<e.arrayIndex;K++){var q=v.layers[K];Or(q.id)===Z&&t.push(new me(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+q.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(je){je in r&&t.push(new me(f,r[je],'"'+je+'" is prohibited for ref layers'))}),v.layers.forEach(function(je){Or(je.id)===F&&(_=je)}),_?_.ref?t.push(new me(f,r.ref,"ref cannot reference another ref layer")):A=Or(_.type):t.push(new me(f,r.ref,'ref layer "'+F+'" not found'));else if(A!=="background")if(r.source){var ue=v.sources&&v.sources[r.source],de=ue&&Or(ue.type);ue?de==="vector"&&A==="raster"?t.push(new me(f,r.source,'layer "'+r.id+'" requires a raster source')):de==="raster"&&A!=="raster"?t.push(new me(f,r.source,'layer "'+r.id+'" requires a vector source')):de!=="vector"||r["source-layer"]?de==="raster-dem"&&A!=="hillshade"?t.push(new me(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!r.paint||!r.paint["line-gradient"]||de==="geojson"&&ue.lineMetrics||t.push(new me(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new me(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new me(f,r.source,'source "'+r.source+'" not found'))}else t.push(new me(f,r,'missing required property "source"'));return t=t.concat($s({key:f,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Hi({key:f+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Dc,layout:function(je){return $s({layer:r,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(Xe){return Yu(yr({layerType:A},Xe))}}})},paint:function(je){return $s({layer:r,key:je.key,value:je.value,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{"*":function(Xe){return kc(yr({layerType:A},Xe))}}})}}}))}function Cu(e){var t=e.value,r=e.key,f=ma(t);return f!=="string"?[new me(r,t,"string expected, "+f+" found")]:[]}var Pa={promoteId:function(e){var t=e.key,r=e.value;if(ma(r)==="string")return Cu({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,Cu({key:t+"."+v,value:r[v]}));return f}};function rc(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new me(r,t,'"type" is required')];var m,_=Or(t.type);switch(_){case"vector":case"raster":case"raster-dem":return $s({key:r,value:t,valueSpec:f["source_"+_.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Pa});case"geojson":if(m=$s({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Pa}),t.cluster)for(var A in t.clusterProperties){var F=t.clusterProperties[A],Z=F[0],K=typeof Z=="string"?[Z,["accumulated"],["get",A]]:Z;m.push.apply(m,Hu({key:r+"."+A+".map",value:F[1],expressionContext:"cluster-map"})),m.push.apply(m,Hu({key:r+"."+A+".reduce",value:K,expressionContext:"cluster-reduce"}))}return m;case"video":return $s({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return $s({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new me(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Lu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,m=[],_=ma(t);if(t===void 0)return m;if(_!=="object")return m.concat([new me("light",t,"object expected, "+_+" found")]);for(var A in t){var F=A.match(/^(.*)-transition$/);m=m.concat(F&&f[F[1]]&&f[F[1]].transition?Hi({key:A,value:t[A],valueSpec:r.transition,style:v,styleSpec:r}):f[A]?Hi({key:A,value:t[A],valueSpec:f[A],style:v,styleSpec:r}):[new me(A,t[A],'unknown property "'+A+'"')])}return m}var Ku={"*":function(){return[]},array:Ic,boolean:function(e){var t=e.value,r=e.key,f=ma(t);return f!=="boolean"?[new me(r,t,"boolean expected, "+f+" found")]:[]},number:Oc,color:function(e){var t=e.key,r=e.value,f=ma(r);return f!=="string"?[new me(t,r,"color expected, "+f+" found")]:Qn(r)===null?[new me(t,r,'color expected, "'+r+'" found')]:[]},constants:ct,enum:Dl,filter:Dc,function:Lc,layer:Fc,object:$s,source:rc,light:Lu,string:Cu,formatted:function(e){return Cu(e).length===0?[]:Hu(e)},resolvedImage:function(e){return Cu(e).length===0?[]:Hu(e)}};function Hi(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&Pc(Or(t))?Lc(e):r.expression&&wu(Ft(t))?Hu(e):r.type&&Ku[r.type]?Ku[r.type](e):$s(yr({},e,{valueSpec:r.type?f[r.type]:r}))}function Ma(e){var t=e.value,r=e.key,f=Cu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new me(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new me(r,t,'"glyphs" url must include a "{range}" token'))),f}function Us(e,t){t===void 0&&(t=te);var r=[];return r=r.concat(Hi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),e.constants&&(r=r.concat(ct({key:"constants",value:e.constants,style:e,styleSpec:t}))),vc(r)}function vc(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function nc(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return vc(e.apply(this,t))}}Us.source=nc(rc),Us.light=nc(Lu),Us.layer=nc(Fc),Us.filter=nc(Dc),Us.paintProperty=nc(kc),Us.layoutProperty=nc(Yu);var ic=Us,Of=ic.light,Lf=ic.paintProperty,ac=ic.layoutProperty;function $u(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new fe(new Error(v[f].message))),r=!0;return r}var Ru=ro;function ro(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var _=v[3+m],A=v[3+m+1];f.push(_===A?null:v.subarray(_,A))}var F=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],F),this.bboxes=v.subarray(F),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Z=0;Z<this.d*this.d;Z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var K=r/t*e;this.min=-K,this.max=e+K}ro.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},ro.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ro.prototype._insertCell=function(e,t,r,f,v,m){this.cells[v].push(m)},ro.prototype.query=function(e,t,r,f,v){var m=this.min,_=this.max;if(e<=m&&t<=m&&_<=r&&_<=f&&!v)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(e,t,r,f,this._queryCell,A,{},v),A},ro.prototype._queryCell=function(e,t,r,f,v,m,_,A){var F=this.cells[v];if(F!==null)for(var Z=this.keys,K=this.bboxes,q=0;q<F.length;q++){var ue=F[q];if(_[ue]===void 0){var de=4*ue;(A?A(K[de+0],K[de+1],K[de+2],K[de+3]):e<=K[de+2]&&t<=K[de+3]&&r>=K[de+0]&&f>=K[de+1])?(_[ue]=!0,m.push(Z[ue])):_[ue]=!1}}},ro.prototype._forEachCell=function(e,t,r,f,v,m,_,A){for(var F=this._convertToCellCoord(e),Z=this._convertToCellCoord(t),K=this._convertToCellCoord(r),q=this._convertToCellCoord(f),ue=F;ue<=K;ue++)for(var de=Z;de<=q;de++){var je=this.d*de+ue;if((!A||A(this._convertFromCellCoord(ue),this._convertFromCellCoord(de),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(de+1)))&&v.call(this,e,t,r,f,je,m,_,A))return}},ro.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ro.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ro.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,_=0;_<e.length;_++){var A=e[_];v[3+_]=m,v.set(A,m),m+=A.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var hs=k.ImageData,pl=k.ImageBitmap,Va={};function wn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Va[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var js in wn("Object",Object),Ru.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Ru.deserialize=function(e){return new Ru(e.buffer)},wn("Grid",Ru),wn("Color",Fi),wn("Error",Error),wn("ResolvedImage",da),wn("StylePropertyFunction",hl),wn("StyleExpression",cl,{omit:["_evaluator"]}),wn("ZoomDependentExpression",uu),wn("ZoomConstantExpression",fl),wn("CompoundExpression",Ca,{omit:["_evaluate"]}),ns)ns[js]._classRegistryKey||wn("Expression_"+js,ns[js]);function mc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Bl(e){return pl&&e instanceof pl}function lu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(mc(e)||Bl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof hs)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,m=e;v<m.length;v+=1)f.push(lu(m[v],t));return f}if(typeof e=="object"){var _=e.constructor,A=_._classRegistryKey;if(!A)throw new Error("can't serialize object of unregistered class");var F=_.serialize?_.serialize(e,t):{};if(!_.serialize){for(var Z in e)if(e.hasOwnProperty(Z)&&!(Va[A].omit.indexOf(Z)>=0)){var K=e[Z];F[Z]=Va[A].shallow.indexOf(Z)>=0?K:lu(K,t)}e instanceof Error&&(F.message=e.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return A!=="Object"&&(F.$name=A),F}throw new Error("can't serialize object of type "+typeof e)}function Vs(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||mc(e)||Bl(e)||ArrayBuffer.isView(e)||e instanceof hs)return e;if(Array.isArray(e))return e.map(Vs);if(typeof e=="object"){var t=e.$name||"Object",r=Va[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var _=m[v];if(_!=="$name"){var A=e[_];f[_]=Va[t].shallow.indexOf(_)>=0?A:Vs(A)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var dl=function(){this.first=!0};dl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Kr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Bc(e){for(var t=0,r=e;t<r.length;t+=1)if(gc(r[t].charCodeAt(0)))return!0;return!1}function gc(e){return!(e!==746&&e!==747&&(e<4352||!(Kr["Bopomofo Extended"](e)||Kr.Bopomofo(e)||Kr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Kr["CJK Compatibility Ideographs"](e)||Kr["CJK Compatibility"](e)||Kr["CJK Radicals Supplement"](e)||Kr["CJK Strokes"](e)||!(!Kr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Kr["CJK Unified Ideographs Extension A"](e)||Kr["CJK Unified Ideographs"](e)||Kr["Enclosed CJK Letters and Months"](e)||Kr["Hangul Compatibility Jamo"](e)||Kr["Hangul Jamo Extended-A"](e)||Kr["Hangul Jamo Extended-B"](e)||Kr["Hangul Jamo"](e)||Kr["Hangul Syllables"](e)||Kr.Hiragana(e)||Kr["Ideographic Description Characters"](e)||Kr.Kanbun(e)||Kr["Kangxi Radicals"](e)||Kr["Katakana Phonetic Extensions"](e)||Kr.Katakana(e)&&e!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Kr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](e)||Kr["Unified Canadian Aboriginal Syllabics Extended"](e)||Kr["Vertical Forms"](e)||Kr["Yijing Hexagram Symbols"](e)||Kr["Yi Syllables"](e)||Kr["Yi Radicals"](e))))}function Ju(e){return!(gc(e)||function(t){return!!(Kr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Kr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Kr["Letterlike Symbols"](t)||Kr["Number Forms"](t)||Kr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Kr["Control Pictures"](t)&&t!==9251||Kr["Optical Character Recognition"](t)||Kr["Enclosed Alphanumerics"](t)||Kr["Geometric Shapes"](t)||Kr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Kr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Kr["CJK Symbols and Punctuation"](t)||Kr.Katakana(t)||Kr["Private Use Area"](t)||Kr["CJK Compatibility Forms"](t)||Kr["Small Form Variants"](t)||Kr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Js(e){return e>=1424&&e<=2303||Kr["Arabic Presentation Forms-A"](e)||Kr["Arabic Presentation Forms-B"](e)}function Ms(e,t){return!(!t&&Js(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Kr.Khmer(e))}function Nc(e){for(var t=0,r=e;t<r.length;t+=1)if(Js(r[t].charCodeAt(0)))return!0;return!1}var zc=null,Gs="unavailable",Qu=null,Nl=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Gs="error"),zc&&zc(e)};function Du(){Zc.fire(new re("pluginStateChange",{pluginStatus:Gs,pluginURL:Qu}))}var Zc=new Se,yc=function(){return Gs},cu=function(){if(Gs!=="deferred"||!Qu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gs="loading",Du(),Qu&&ia({url:Qu},function(e){e?Nl(e):(Gs="loaded",Du())})},Is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Gs==="loaded"||Is.applyArabicShaping!=null},isLoading:function(){return Gs==="loading"},setState:function(e){Gs=e.pluginStatus,Qu=e.pluginURL},isParsed:function(){return Is.applyArabicShaping!=null&&Is.processBidirectionalText!=null&&Is.processStyledBidirectionalText!=null},getPluginURL:function(){return Qu}},Bi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dl,this.transition={})};Bi.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Ms(v[f].charCodeAt(0),r))return!1;return!0}(e,Is.isLoaded())},Bi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Bi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Qs=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(Pc(r))return new hl(r,f);if(wu(r)){var v=dc(r,f);if(v.result==="error")throw new Error(v.value.map(function(_){return _.key+": "+_.message}).join(", "));return v.value}var m=r;return typeof r=="string"&&f.type==="color"&&(m=Fi.parse(r)),{kind:"constant",evaluate:function(){return m}}}(t===void 0?e.specification.default:t,e.specification)};Qs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Qs.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var $o=function(e){this.property=e,this.value=new Qs(e,void 0)};$o.prototype.transitioned=function(e,t){return new vl(this.property,this.value,t,Yt({},e.transition,this.transition),e.now)},$o.prototype.untransitioned=function(){return new vl(this.property,this.value,null,{},0)};var Ao=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Ao.prototype.getValue=function(e){return Ke(this._values[e].value.value)},Ao.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new $o(this._values[e].property)),this._values[e].value=new Qs(this._values[e].property,t===null?void 0:Ke(t))},Ao.prototype.getTransition=function(e){return Ke(this._values[e].transition)},Ao.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new $o(this._values[e].property)),this._values[e].transition=Ke(t)||void 0},Ao.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var m=this.getTransition(f);m!==void 0&&(e[f+"-transition"]=m)}return e},Ao.prototype.transitioned=function(e,t){for(var r=new qu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var m=v[f];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},Ao.prototype.untransitioned=function(){for(var e=new qu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var vl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};vl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return m.possiblyEvaluate(e,t,r);var _=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(A){if(A<=0)return 0;if(A>=1)return 1;var F=A*A,Z=F*A;return 4*(A<.5?Z:3*(A-F)+Z-.75)}(_))}return v};var qu=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};qu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new zl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];f._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return f},qu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var fu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};fu.prototype.getValue=function(e){return Ke(this._values[e].value)},fu.prototype.setValue=function(e,t){this._values[e]=new Qs(this._values[e].property,t===null?void 0:Ke(t))},fu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},fu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new zl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];f._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return f};var is=function(e,t,r){this.property=e,this.value=t,this.parameters=r};is.prototype.isConstant=function(){return this.value.kind==="constant"},is.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},is.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var zl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};zl.prototype.get=function(e){return this._values[e]};var Un=function(e){this.specification=e};Un.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Un.prototype.interpolate=function(e,t,r){var f=su[this.specification.type];return f?f(e,t,r):e};var On=function(e,t){this.specification=e,this.overrides=t};On.prototype.possiblyEvaluate=function(e,t,r,f){return new is(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},On.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new is(this,{kind:"constant",value:void 0},e.parameters);var f=su[this.specification.type];return f?new is(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},On.prototype.evaluate=function(e,t,r,f,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,m)};var Zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,m){if(r.value===void 0)return new is(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var _=r.expression.evaluate(f,null,{},v,m),A=r.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,F=this._calculate(A,A,A,f);return new is(this,{kind:"constant",value:F},f)}if(r.expression.kind==="camera"){var Z=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new is(this,{kind:"constant",value:Z},f)}return new is(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,m,_,A){if(r.kind==="source"){var F=r.evaluate(f,v,m,_,A);return this._calculate(F,F,F,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,m),r.evaluate({zoom:Math.floor(f.zoom)},v,m),r.evaluate({zoom:Math.floor(f.zoom)+1},v,m),f):r.value},t.prototype._calculate=function(r,f,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(On),ps=function(e){this.specification=e};ps.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new Bi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Bi(Math.floor(t.zoom),t)),e.expression.evaluate(new Bi(Math.floor(t.zoom+1),t)),t)}},ps.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ps.prototype.interpolate=function(e){return e};var Do=function(e){this.specification=e};Do.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},Do.prototype.interpolate=function(){return!1};var zo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Qs(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new $o(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};wn("DataDrivenProperty",On),wn("DataConstantProperty",Un),wn("CrossFadedDataDrivenProperty",Zl),wn("CrossFadedProperty",ps),wn("ColorRampProperty",Do);var ku=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new fu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Ao(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zl(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(ac,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return er(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Lf,"layers."+this.id+".paint."+r,r,f,v))return!1;if(er(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var m=this._transitionablePaint._values[r],_=m.property.specification["property-type"]==="cross-faded-data-driven",A=m.value.isDataDriven(),F=m.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var Z=this._transitionablePaint._values[r].value;return Z.isDataDriven()||A||_||this._handleOverridablePaintPropertyUpdate(r,F,Z)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),xt(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,m,_){return _===void 0&&(_={}),(!_||_.validate!==!1)&&$u(this,r.call(ic,{key:f,layerType:this.type,objectKey:v,value:m,styleSpec:te,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof is&&Eu(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Se),hu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ul=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ra=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function po(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var m=hu[v.type].BYTES_PER_ELEMENT,_=r=Uc(r,Math.max(t,m)),A=v.components||1;return f=Math.max(f,m),r+=m*A,{name:v.name,type:v.type,components:A,offset:_}}),size:Uc(r,Math.max(f,t)),alignment:t}}function Uc(e,t){return Math.ceil(e/t)*t}ra.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},ra.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},ra.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ra.prototype.clear=function(){this.length=0},ra.prototype.resize=function(e){this.reserve(e),this.length=e},ra.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},ra.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.int16[m+0]=f,this.int16[m+1]=v,r},t}(ra);Fu.prototype.bytesPerElement=4,wn("StructArrayLayout2i4",Fu);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,_){var A=4*r;return this.int16[A+0]=f,this.int16[A+1]=v,this.int16[A+2]=m,this.int16[A+3]=_,r},t}(ra);_c.prototype.bytesPerElement=8,wn("StructArrayLayout4i8",_c);var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,m,_,A)},t.prototype.emplace=function(r,f,v,m,_,A,F){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=m,this.int16[Z+3]=_,this.int16[Z+4]=A,this.int16[Z+5]=F,r},t}(ra);Bu.prototype.bytesPerElement=12,wn("StructArrayLayout2i4i12",Bu);var Os=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,m,_,A)},t.prototype.emplace=function(r,f,v,m,_,A,F){var Z=4*r,K=8*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.uint8[K+4]=m,this.uint8[K+5]=_,this.uint8[K+6]=A,this.uint8[K+7]=F,r},t}(ra);Os.prototype.bytesPerElement=8,wn("StructArrayLayout2i4ub8",Os);var oc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.float32[m+0]=f,this.float32[m+1]=v,r},t}(ra);oc.prototype.bytesPerElement=8,wn("StructArrayLayout2f8",oc);var as=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A,F,Z,K,q){var ue=this.length;return this.resize(ue+1),this.emplace(ue,r,f,v,m,_,A,F,Z,K,q)},t.prototype.emplace=function(r,f,v,m,_,A,F,Z,K,q,ue){var de=10*r;return this.uint16[de+0]=f,this.uint16[de+1]=v,this.uint16[de+2]=m,this.uint16[de+3]=_,this.uint16[de+4]=A,this.uint16[de+5]=F,this.uint16[de+6]=Z,this.uint16[de+7]=K,this.uint16[de+8]=q,this.uint16[de+9]=ue,r},t}(ra);as.prototype.bytesPerElement=20,wn("StructArrayLayout10ui20",as);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A,F,Z,K,q,ue,de){var je=this.length;return this.resize(je+1),this.emplace(je,r,f,v,m,_,A,F,Z,K,q,ue,de)},t.prototype.emplace=function(r,f,v,m,_,A,F,Z,K,q,ue,de,je){var Xe=12*r;return this.int16[Xe+0]=f,this.int16[Xe+1]=v,this.int16[Xe+2]=m,this.int16[Xe+3]=_,this.uint16[Xe+4]=A,this.uint16[Xe+5]=F,this.uint16[Xe+6]=Z,this.uint16[Xe+7]=K,this.int16[Xe+8]=q,this.int16[Xe+9]=ue,this.int16[Xe+10]=de,this.int16[Xe+11]=je,r},t}(ra);xc.prototype.bytesPerElement=24,wn("StructArrayLayout4i4ui4i24",xc);var jl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var _=3*r;return this.float32[_+0]=f,this.float32[_+1]=v,this.float32[_+2]=m,r},t}(ra);jl.prototype.bytesPerElement=12,wn("StructArrayLayout3f12",jl);var sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(ra);sc.prototype.bytesPerElement=4,wn("StructArrayLayout1ul4",sc);var jc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A,F,Z,K){var q=this.length;return this.resize(q+1),this.emplace(q,r,f,v,m,_,A,F,Z,K)},t.prototype.emplace=function(r,f,v,m,_,A,F,Z,K,q){var ue=10*r,de=5*r;return this.int16[ue+0]=f,this.int16[ue+1]=v,this.int16[ue+2]=m,this.int16[ue+3]=_,this.int16[ue+4]=A,this.int16[ue+5]=F,this.uint32[de+3]=Z,this.uint16[ue+8]=K,this.uint16[ue+9]=q,r},t}(ra);jc.prototype.bytesPerElement=20,wn("StructArrayLayout6i1ul2ui20",jc);var uc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,m,_,A)},t.prototype.emplace=function(r,f,v,m,_,A,F){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=m,this.int16[Z+3]=_,this.int16[Z+4]=A,this.int16[Z+5]=F,r},t}(ra);uc.prototype.bytesPerElement=12,wn("StructArrayLayout2i2i2i12",uc);var ml=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_){var A=this.length;return this.resize(A+1),this.emplace(A,r,f,v,m,_)},t.prototype.emplace=function(r,f,v,m,_,A){var F=4*r,Z=8*r;return this.float32[F+0]=f,this.float32[F+1]=v,this.float32[F+2]=m,this.int16[Z+6]=_,this.int16[Z+7]=A,r},t}(ra);ml.prototype.bytesPerElement=16,wn("StructArrayLayout2f1f2i16",ml);var Vc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,_){var A=12*r,F=3*r;return this.uint8[A+0]=f,this.uint8[A+1]=v,this.float32[F+1]=m,this.float32[F+2]=_,r},t}(ra);Vc.prototype.bytesPerElement=12,wn("StructArrayLayout2ub2f12",Vc);var gl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var _=3*r;return this.uint16[_+0]=f,this.uint16[_+1]=v,this.uint16[_+2]=m,r},t}(ra);gl.prototype.bytesPerElement=6,wn("StructArrayLayout3ui6",gl);var yl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe,st,et,Mt){var Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe,st,et,Mt)},t.prototype.emplace=function(r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe,st,et,Mt,Gt){var ir=24*r,cr=12*r,Ar=48*r;return this.int16[ir+0]=f,this.int16[ir+1]=v,this.uint16[ir+2]=m,this.uint16[ir+3]=_,this.uint32[cr+2]=A,this.uint32[cr+3]=F,this.uint32[cr+4]=Z,this.uint16[ir+10]=K,this.uint16[ir+11]=q,this.uint16[ir+12]=ue,this.float32[cr+7]=de,this.float32[cr+8]=je,this.uint8[Ar+36]=Xe,this.uint8[Ar+37]=st,this.uint8[Ar+38]=et,this.uint32[cr+10]=Mt,this.int16[ir+22]=Gt,r},t}(ra);yl.prototype.bytesPerElement=48,wn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",yl);var _l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe,st,et,Mt,Gt,ir,cr,Ar,en,pn,Hn,En,ei,Tn,Vi){var mi=this.length;return this.resize(mi+1),this.emplace(mi,r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe,st,et,Mt,Gt,ir,cr,Ar,en,pn,Hn,En,ei,Tn,Vi)},t.prototype.emplace=function(r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe,st,et,Mt,Gt,ir,cr,Ar,en,pn,Hn,En,ei,Tn,Vi,mi){var Bn=34*r,ta=17*r;return this.int16[Bn+0]=f,this.int16[Bn+1]=v,this.int16[Bn+2]=m,this.int16[Bn+3]=_,this.int16[Bn+4]=A,this.int16[Bn+5]=F,this.int16[Bn+6]=Z,this.int16[Bn+7]=K,this.uint16[Bn+8]=q,this.uint16[Bn+9]=ue,this.uint16[Bn+10]=de,this.uint16[Bn+11]=je,this.uint16[Bn+12]=Xe,this.uint16[Bn+13]=st,this.uint16[Bn+14]=et,this.uint16[Bn+15]=Mt,this.uint16[Bn+16]=Gt,this.uint16[Bn+17]=ir,this.uint16[Bn+18]=cr,this.uint16[Bn+19]=Ar,this.uint16[Bn+20]=en,this.uint16[Bn+21]=pn,this.uint16[Bn+22]=Hn,this.uint32[ta+12]=En,this.float32[ta+13]=ei,this.float32[ta+14]=Tn,this.float32[ta+15]=Vi,this.float32[ta+16]=mi,r},t}(ra);_l.prototype.bytesPerElement=68,wn("StructArrayLayout8i15ui1ul4f68",_l);var pu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(ra);pu.prototype.bytesPerElement=4,wn("StructArrayLayout1f4",pu);var qs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var _=3*r;return this.int16[_+0]=f,this.int16[_+1]=v,this.int16[_+2]=m,r},t}(ra);qs.prototype.bytesPerElement=6,wn("StructArrayLayout3i6",qs);var Gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var _=4*r;return this.uint32[2*r+0]=f,this.uint16[_+2]=v,this.uint16[_+3]=m,r},t}(ra);Gc.prototype.bytesPerElement=8,wn("StructArrayLayout1ul2ui8",Gc);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.uint16[m+0]=f,this.uint16[m+1]=v,r},t}(ra);bc.prototype.bytesPerElement=4,wn("StructArrayLayout2ui4",bc);var sf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(ra);sf.prototype.bytesPerElement=2,wn("StructArrayLayout1ui2",sf);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,_){var A=4*r;return this.float32[A+0]=f,this.float32[A+1]=v,this.float32[A+2]=m,this.float32[A+3]=_,r},t}(ra);Sc.prototype.bytesPerElement=16,wn("StructArrayLayout4f16",Sc);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new $(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(Ul);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(jc);wn("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(Ul);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(yl);wn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(Ul);g.prototype.size=68;var S=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(_l);wn("SymbolInstanceArray",S);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(pu);wn("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(qs);wn("SymbolLineVertexArray",R);var V=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(Ul);V.prototype.size=8;var ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new V(this,r)},t}(Gc);wn("FeatureIndexArray",ee);var ve=po([{name:"a_pos",components:2,type:"Int16"}],4).members,ye=function(e){e===void 0&&(e=[]),this.segments=e};function Ee(e,t){return 256*(e=$e(Math.floor(e),0,255))+$e(Math.floor(t),0,255)}ye.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>ye.MAX_VERTEX_ARRAY_LENGTH&&Fe("Max vertices per segment is "+ye.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>ye.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},ye.prototype.get=function(){return this.segments},ye.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},ye.simpleSegment=function(e,t,r,f){return new ye([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wn("SegmentVector",ye);var Ye=po([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ge=b(function(e){e.exports=function(t,r){var f,v,m,_,A,F,Z,K;for(v=t.length-(f=3&t.length),m=r,A=3432918353,F=461845907,K=0;K<v;)Z=255&t.charCodeAt(K)|(255&t.charCodeAt(++K))<<8|(255&t.charCodeAt(++K))<<16|(255&t.charCodeAt(++K))<<24,++K,m=27492+(65535&(_=5*(65535&(m=(m^=Z=(65535&(Z=(Z=(65535&Z)*A+(((Z>>>16)*A&65535)<<16)&4294967295)<<15|Z>>>17))*F+(((Z>>>16)*F&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(Z=0,f){case 3:Z^=(255&t.charCodeAt(K+2))<<16;case 2:Z^=(255&t.charCodeAt(K+1))<<8;case 1:m^=Z=(65535&(Z=(Z=(65535&(Z^=255&t.charCodeAt(K)))*A+(((Z>>>16)*A&65535)<<16)&4294967295)<<15|Z>>>17))*F+(((Z>>>16)*F&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),nt=b(function(e){e.exports=function(t,r){for(var f,v=t.length,m=r^v,_=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(f>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++_;switch(v){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),Ne=Ge,rt=nt;Ne.murmur3=Ge,Ne.murmur2=rt;var dt=function(){this.ids=[],this.positions=[],this.indexed=!1};dt.prototype.add=function(e,t,r,f){this.ids.push(ar(e)),this.positions.push(t,r,f)},dt.prototype.getPositions=function(e){for(var t=ar(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},dt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(m,_,A,F){for(;A<F;){for(var Z=m[A+F>>1],K=A-1,q=F+1;;){do K++;while(m[K]<Z);do q--;while(m[q]>Z);if(K>=q)break;rr(m,K,q),rr(_,3*K,3*q),rr(_,3*K+1,3*q+1),rr(_,3*K+2,3*q+2)}q-A<F-q?(v(m,_,A,q),A=q+1):(v(m,_,q+1,F),F=q)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},dt.deserialize=function(e){var t=new dt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var zt=Math.pow(2,53)-1;function ar(e){var t=+e;return!isNaN(t)&&t<=zt?t:Ne(String(e))}function rr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}wn("FeaturePositionMap",dt);var or=function(e,t){this.gl=e.gl,this.location=t},Lr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(or),tn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(or),Xr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(or),yn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(or),Fn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(or),Vn=function(e){function t(r,f){e.call(this,r,f),this.current=Fi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(or),jn=new Float32Array(16),Qi=function(e){function t(r,f){e.call(this,r,f),this.current=jn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(or);function _n(e){return[Ee(255*e.r,255*e.g),Ee(255*e.b,255*e.a)]}var ci=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};ci.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},ci.prototype.getBinding=function(e,t,r){return this.type==="color"?new Vn(e,t):new tn(e,t)};var Ci=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ci.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Ci.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Ci.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new Fn(e,t):new tn(e,t)};var fi=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};fi.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.paintVertexArray.length,_=this.expression.evaluate(new Bi(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,_)},fi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},fi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=_n(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},fi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},fi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var oi=function(e,t,r,f,v,m){this.expression=e,this.uniformNames=t.map(function(_){return"u_"+_+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(_){return{name:"a_"+_,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new m};oi.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.expression.evaluate(new Bi(this.zoom),t,{},f,[],v),_=this.expression.evaluate(new Bi(this.zoom+1),t,{},f,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,m,_)},oi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),m=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,m)},oi.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=_n(r),m=_n(f),_=e;_<t;_++)this.paintVertexArray.emplace(_,v[0],v[1],m[0],m[1]);else{for(var A=e;A<t;A++)this.paintVertexArray.emplace(A,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},oi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},oi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},oi.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=$e(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},oi.prototype.getBinding=function(e,t,r){return new tn(e,t)};var Ti=function(e,t,r,f,v,m){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=m,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Ti.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},Ti.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Ti.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],m=f[r.mid],_=f[r.max];if(v&&m&&_)for(var A=e;A<t;A++)this.zoomInPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],m.pixelRatio,_.pixelRatio)}},Ti.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ye.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ye.members,this.expression.isStateDependent))},Ti.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ii=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var m=e.paint.get(v);if(m instanceof is&&Eu(m.property.specification)){var _=Po(v,e.type),A=m.value,F=m.property.specification.type,Z=m.property.useIntegerZoom,K=m.property.specification["property-type"],q=K==="cross-faded"||K==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=q?new Ci(A.value,_):new ci(A.value,_,F),f.push("/u_"+v);else if(A.kind==="source"||q){var ue=Ja(v,F,"source");this.binders[v]=q?new Ti(A,F,Z,t,ue,e.id):new fi(A,_,F,ue),f.push("/a_"+v)}else{var de=Ja(v,F,"composite");this.binders[v]=new oi(A,_,F,Z,t,de),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};ii.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof fi||t instanceof oi?t.maxValue:0},ii.prototype.populatePaintArrays=function(e,t,r,f,v){for(var m in this.binders){var _=this.binders[m];(_ instanceof fi||_ instanceof oi||_ instanceof Ti)&&_.populatePaintArray(e,t,r,f,v)}},ii.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Ci&&f.setConstantPatternPositions(e,t)}},ii.prototype.updatePaintArrays=function(e,t,r,f,v){var m=!1;for(var _ in e)for(var A=0,F=t.getPositions(_);A<F.length;A+=1){var Z=F[A],K=r.feature(Z.index);for(var q in this.binders){var ue=this.binders[q];if((ue instanceof fi||ue instanceof oi||ue instanceof Ti)&&ue.expression.isStateDependent===!0){var de=f.paint.get(q);ue.expression=de.value,ue.updatePaintArray(Z.start,Z.end,K,e[_],v),m=!0}}}return m},ii.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof ci||r instanceof Ci)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},ii.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof fi||r instanceof oi)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof Ti)for(var v=0;v<Ye.members.length;v++)e.push(Ye.members[v].name)}return e},ii.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ci||r instanceof Ci||r instanceof oi)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},ii.prototype.getPaintVertexBuffers=function(){return this._buffers},ii.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof ci||v instanceof Ci||v instanceof oi)for(var m=0,_=v.uniformNames;m<_.length;m+=1){var A=_[m];if(t[A]){var F=v.getBinding(e,t[A],A);r.push({name:A,property:f,binding:F})}}}return r},ii.prototype.setUniforms=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1){var _=m[v],A=_.name,F=_.property;this.binders[F].setUniform(_.binding,f,r.get(F),A)}},ii.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Ti){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof fi||r instanceof oi)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ii.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof fi||r instanceof oi||r instanceof Ti)&&r.upload(e)}this.updatePaintBuffers()},ii.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof fi||t instanceof oi||t instanceof Ti)&&t.destroy()}};var ri=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var m=v[f];this.programConfigurations[m.id]=new ii(m,t,r)}this.needsUpload=!1,this._featureMap=new dt,this._bufferOffset=0};function Po(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ja(e,t,r){var f={color:{source:oc,composite:Sc},number:{source:pu,composite:oc}},v=function(m){return{"line-pattern":{source:as,composite:as},"fill-pattern":{source:as,composite:as},"fill-extrusion-pattern":{source:as,composite:as}}[m]}(e);return v&&v[r]||f[t][r]}ri.prototype.populatePaintArrays=function(e,t,r,f,v,m){for(var _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,t,f,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},ri.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,m=r;v<m.length;v+=1){var _=m[v];this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,t,_,f)||this.needsUpload}},ri.prototype.get=function(e){return this.programConfigurations[e]},ri.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},ri.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},wn("ConstantBinder",ci),wn("CrossFadedConstantBinder",Ci),wn("SourceExpressionBinder",fi),wn("CrossFadedCompositeBinder",Ti),wn("CompositeExpressionBinder",oi),wn("ProgramConfiguration",ii,{omit:["_buffers"]}),wn("ProgramConfigurationSet",ri);var os=Math.pow(2,14)-1,Zo=-os-1;function Ga(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],m=0;m<v.length;m++){var _=v[m],A=Math.round(_.x*t),F=Math.round(_.y*t);_.x=$e(A,Zo,os),_.y=$e(F,Zo,os),(A<_.x||A>_.x+1||F<_.y||F>_.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function no(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ga(e):[]}}function ds(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var vs=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Fu,this.indexArray=new gl,this.segments=new ye,this.programConfigurations=new ri(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function el(e,t){for(var r=0;r<e.length;r++)if(Tu(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Tu(e,t[f]))return!0;return!!xl(e,t)}function ms(e,t,r){return!!Tu(e,t)||!!Nu(t,e,r)}function eu(e,t){if(e.length===1)return Vl(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Tu(e,f[v]))return!0;for(var m=0;m<e.length;m++)if(Vl(t,e[m]))return!0;for(var _=0;_<t.length;_++)if(xl(e,t[_]))return!0;return!1}function Ls(e,t,r){if(e.length>1){if(xl(e,t))return!0;for(var f=0;f<t.length;f++)if(Nu(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(Nu(e[v],t,r))return!0;return!1}function xl(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(bl(f,v,t[m],t[m+1]))return!0;return!1}function bl(e,t,r,f){return Pe(e,r,f)!==Pe(t,r,f)&&Pe(e,t,r)!==Pe(e,t,f)}function Nu(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(tu(e,t[v-1],t[v])<f)return!0;return!1}function tu(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Vl(e,t){for(var r,f,v,m=!1,_=0;_<e.length;_++)for(var A=0,F=(r=e[_]).length-1;A<r.length;F=A++)(f=r[A]).y>t.y!=(v=r[F]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(m=!m);return m}function Tu(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var m=e[f],_=e[v];m.y>t.y!=_.y>t.y&&t.x<(_.x-m.x)*(t.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function zu(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var m=Pe(e,t,r[0]);return m!==Pe(e,t,r[1])||m!==Pe(e,t,r[2])||m!==Pe(e,t,r[3])}function Hs(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function io(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Au(e,t,r,f,v){if(!t[0]&&!t[1])return e;var m=$.convert(t)._mult(v);r==="viewport"&&m._rotate(-f);for(var _=[],A=0;A<e.length;A++)_.push(e[A].sub(m));return _}vs.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],m=null;f.type==="circle"&&(m=f.layout.get("circle-sort-key"));for(var _=0,A=e;_<A.length;_+=1){var F=A[_],Z=F.feature,K=F.id,q=F.index,ue=F.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,je=no(Z,de);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),je,r)){var Xe=m?m.evaluate(je,{},r):void 0,st={id:K,properties:Z.properties,type:Z.type,sourceLayerIndex:ue,index:q,geometry:de?je.geometry:Ga(Z),patterns:{},sortKey:Xe};v.push(st)}}m&&v.sort(function(pn,Hn){return pn.sortKey-Hn.sortKey});for(var et=0,Mt=v;et<Mt.length;et+=1){var Gt=Mt[et],ir=Gt.geometry,cr=Gt.index,Ar=Gt.sourceLayerIndex,en=e[cr].feature;this.addFeature(Gt,ir,cr,r),t.featureIndex.insert(en,ir,cr,Ar,this.index)}},vs.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},vs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},vs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vs.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ve),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},vs.prototype.addFeature=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1)for(var _=0,A=m[v];_<A.length;_+=1){var F=A[_],Z=F.x,K=F.y;if(!(Z<0||Z>=8192||K<0||K>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ue=q.vertexLength;ds(this.layoutVertexArray,Z,K,-1,-1),ds(this.layoutVertexArray,Z,K,1,-1),ds(this.layoutVertexArray,Z,K,1,1),ds(this.layoutVertexArray,Z,K,-1,1),this.indexArray.emplaceBack(ue,ue+1,ue+2),this.indexArray.emplaceBack(ue,ue+3,ue+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},wn("CircleBucket",vs,{omit:["layers"]});var du=new zo({"circle-sort-key":new On(te.layout_circle["circle-sort-key"])}),gs={paint:new zo({"circle-radius":new On(te.paint_circle["circle-radius"]),"circle-color":new On(te.paint_circle["circle-color"]),"circle-blur":new On(te.paint_circle["circle-blur"]),"circle-opacity":new On(te.paint_circle["circle-opacity"]),"circle-translate":new Un(te.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new On(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new On(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new On(te.paint_circle["circle-stroke-opacity"])}),layout:du},qi=typeof Float32Array!="undefined"?Float32Array:Array;function ao(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ko(e,t,r){var f=t[0],v=t[1],m=t[2],_=t[3],A=t[4],F=t[5],Z=t[6],K=t[7],q=t[8],ue=t[9],de=t[10],je=t[11],Xe=t[12],st=t[13],et=t[14],Mt=t[15],Gt=r[0],ir=r[1],cr=r[2],Ar=r[3];return e[0]=Gt*f+ir*A+cr*q+Ar*Xe,e[1]=Gt*v+ir*F+cr*ue+Ar*st,e[2]=Gt*m+ir*Z+cr*de+Ar*et,e[3]=Gt*_+ir*K+cr*je+Ar*Mt,e[4]=(Gt=r[4])*f+(ir=r[5])*A+(cr=r[6])*q+(Ar=r[7])*Xe,e[5]=Gt*v+ir*F+cr*ue+Ar*st,e[6]=Gt*m+ir*Z+cr*de+Ar*et,e[7]=Gt*_+ir*K+cr*je+Ar*Mt,e[8]=(Gt=r[8])*f+(ir=r[9])*A+(cr=r[10])*q+(Ar=r[11])*Xe,e[9]=Gt*v+ir*F+cr*ue+Ar*st,e[10]=Gt*m+ir*Z+cr*de+Ar*et,e[11]=Gt*_+ir*K+cr*je+Ar*Mt,e[12]=(Gt=r[12])*f+(ir=r[13])*A+(cr=r[14])*q+(Ar=r[15])*Xe,e[13]=Gt*v+ir*F+cr*ue+Ar*st,e[14]=Gt*m+ir*Z+cr*de+Ar*et,e[15]=Gt*_+ir*K+cr*je+Ar*Mt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Rs,tl=ko;function vu(e,t,r){var f=t[0],v=t[1],m=t[2],_=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*m+r[12]*_,e[1]=r[1]*f+r[5]*v+r[9]*m+r[13]*_,e[2]=r[2]*f+r[6]*v+r[10]*m+r[14]*_,e[3]=r[3]*f+r[7]*v+r[11]*m+r[15]*_,e}Rs=new qi(3),qi!=Float32Array&&(Rs[0]=0,Rs[1]=0,Rs[2]=0),function(){var e=new qi(4);qi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var rl=(function(){var e=new qi(2);qi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,gs)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new vs(r)},t.prototype.queryRadius=function(r){var f=r;return Hs("circle-radius",this,f)+Hs("circle-stroke-width",this,f)+io(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,_,A,F,Z){for(var K=Au(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,F),q=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),ue=this.paint.get("circle-pitch-alignment")==="map",de=ue?K:function(en,pn){return en.map(function(Hn){return nl(Hn,pn)})}(K,Z),je=ue?q*F:q,Xe=0,st=m;Xe<st.length;Xe+=1)for(var et=0,Mt=st[Xe];et<Mt.length;et+=1){var Gt=Mt[et],ir=ue?Gt:nl(Gt,Z),cr=je,Ar=vu([],[Gt.x,Gt.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?cr*=Ar[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(cr*=A.cameraToCenterDistance/Ar[3]),ms(de,ir,cr))return!0}return!1},t}(ku));function nl(e,t){var r=vu([],[e.x,e.y,0,1],t);return new $(r[0]/r[3],r[1]/r[3])}var Ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(vs);function Pu(e,t,r,f){var v=t.width,m=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*m*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=f,e}function Gl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var m=Pu({},{width:f,height:v},r);wc(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=m.data}}function wc(e,t,r,f,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var _=e.data,A=t.data,F=0;F<v.height;F++)for(var Z=((r.y+F)*e.width+r.x)*m,K=((f.y+F)*t.width+f.x)*m,q=0;q<v.width*m;q++)A[K+q]=_[Z+q];return t}wn("HeatmapBucket",Ec,{omit:["layers"]});var Ws=function(e,t){Pu(this,e,1,t)};Ws.prototype.resize=function(e){Gl(this,e,1)},Ws.prototype.clone=function(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))},Ws.copy=function(e,t,r,f,v){wc(e,t,r,f,v,1)};var Uo=function(e,t){Pu(this,e,4,t)};Uo.prototype.resize=function(e){Gl(this,e,4)},Uo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Uo.prototype.clone=function(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))},Uo.copy=function(e,t,r,f,v){wc(e,t,r,f,v,4)},wn("AlphaImage",Ws),wn("RGBAImage",Uo);var Hc={paint:new zo({"heatmap-radius":new On(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new On(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Do(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(te.paint_heatmap["heatmap-opacity"])})};function Rf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Uo({width:r,height:f}),m=function(je,Xe,st){t[e.evaluationKey]=st;var et=e.expression.evaluate(t);v.data[je+Xe+0]=Math.floor(255*et.r/et.a),v.data[je+Xe+1]=Math.floor(255*et.g/et.a),v.data[je+Xe+2]=Math.floor(255*et.b/et.a),v.data[je+Xe+3]=Math.floor(255*et.a)};if(e.clips)for(var _=0,A=0;_<f;++_,A+=4*r)for(var F=0,Z=0;F<r;F++,Z+=4){var K=F/(r-1),q=e.clips[_];m(A,Z,q.start*(1-K)+q.end*K)}else for(var ue=0,de=0;ue<r;ue++,de+=4)m(0,de,ue/(r-1));return v}var Sl=function(e){function t(r){e.call(this,r,Hc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ec(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(ku),uf={paint:new zo({"hillshade-illumination-direction":new Un(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(te.paint_hillshade["hillshade-accent-color"])})},Wc=function(e){function t(r){e.call(this,r,uf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(ku),Wf=po([{name:"a_pos",components:2,type:"Int16"}],4).members,Hl=lf,ih=lf;function lf(e,t,r){r=r||2;var f,v,m,_,A,F,Z,K=t&&t.length,q=K?t[0]*r:e.length,ue=ru(e,0,q,r,!0),de=[];if(!ue||ue.next===ue.prev)return de;if(K&&(ue=function(Xe,st,et,Mt){var Gt,ir,cr,Ar=[];for(Gt=0,ir=st.length;Gt<ir;Gt++)(cr=ru(Xe,st[Gt]*Mt,Gt<ir-1?st[Gt+1]*Mt:Xe.length,Mt,!1))===cr.next&&(cr.steiner=!0),Ar.push(qr(cr));for(Ar.sort(vt),Gt=0;Gt<Ar.length;Gt++)Vt(Ar[Gt],et),et=j(et,et.next);return et}(e,t,ue,r)),e.length>80*r){f=m=e[0],v=_=e[1];for(var je=r;je<q;je+=r)(A=e[je])<f&&(f=A),(F=e[je+1])<v&&(v=F),A>m&&(m=A),F>_&&(_=F);Z=(Z=Math.max(m-f,_-v))!==0?1/Z:0}return z(ue,de,r,f,v,Z),de}function ru(e,t,r,f,v){var m,_;if(v===ca(e,t,r,f)>0)for(m=t;m<r;m+=f)_=bo(m,e[m],e[m+1],_);else for(m=r-f;m>=t;m-=f)_=bo(m,e[m],e[m+1],_);return _&&di(_,_.next)&&(So(_),_=_.next),_}function j(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!di(f,f.next)&&Mn(f.prev,f,f.next)!==0)f=f.next;else{if(So(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function z(e,t,r,f,v,m,_){if(e){!_&&m&&function(K,q,ue,de){var je=K;do je.z===null&&(je.z=Sr(je.x,je.y,q,ue,de)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next;while(je!==K);je.prevZ.nextZ=null,je.prevZ=null,function(Xe){var st,et,Mt,Gt,ir,cr,Ar,en,pn=1;do{for(et=Xe,Xe=null,ir=null,cr=0;et;){for(cr++,Mt=et,Ar=0,st=0;st<pn&&(Ar++,Mt=Mt.nextZ);st++);for(en=pn;Ar>0||en>0&&Mt;)Ar!==0&&(en===0||!Mt||et.z<=Mt.z)?(Gt=et,et=et.nextZ,Ar--):(Gt=Mt,Mt=Mt.nextZ,en--),ir?ir.nextZ=Gt:Xe=Gt,Gt.prevZ=ir,ir=Gt;et=Mt}ir.nextZ=null,pn*=2}while(cr>1)}(je)}(e,f,v,m);for(var A,F,Z=e;e.prev!==e.next;)if(A=e.prev,F=e.next,m?D(e,f,v,m):M(e))t.push(A.i/r),t.push(e.i/r),t.push(F.i/r),So(e),e=F.next,Z=F.next;else if((e=F)===Z){_?_===1?z(e=ne(j(e),t,r),t,r,f,v,m,2):_===2&&_e(e,t,r,f,v,m):z(j(e),t,r,f,v,m,1);break}}}function M(e){var t=e.prev,r=e,f=e.next;if(Mn(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Rn(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&Mn(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function D(e,t,r,f){var v=e.prev,m=e,_=e.next;if(Mn(v,m,_)>=0)return!1;for(var A=v.x>m.x?v.x>_.x?v.x:_.x:m.x>_.x?m.x:_.x,F=v.y>m.y?v.y>_.y?v.y:_.y:m.y>_.y?m.y:_.y,Z=Sr(v.x<m.x?v.x<_.x?v.x:_.x:m.x<_.x?m.x:_.x,v.y<m.y?v.y<_.y?v.y:_.y:m.y<_.y?m.y:_.y,t,r,f),K=Sr(A,F,t,r,f),q=e.prevZ,ue=e.nextZ;q&&q.z>=Z&&ue&&ue.z<=K;){if(q!==e.prev&&q!==e.next&&Rn(v.x,v.y,m.x,m.y,_.x,_.y,q.x,q.y)&&Mn(q.prev,q,q.next)>=0||(q=q.prevZ,ue!==e.prev&&ue!==e.next&&Rn(v.x,v.y,m.x,m.y,_.x,_.y,ue.x,ue.y)&&Mn(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;q&&q.z>=Z;){if(q!==e.prev&&q!==e.next&&Rn(v.x,v.y,m.x,m.y,_.x,_.y,q.x,q.y)&&Mn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;ue&&ue.z<=K;){if(ue!==e.prev&&ue!==e.next&&Rn(v.x,v.y,m.x,m.y,_.x,_.y,ue.x,ue.y)&&Mn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function ne(e,t,r){var f=e;do{var v=f.prev,m=f.next.next;!di(v,m)&&yi(v,f,f.next,m)&&Ha(v,m)&&Ha(m,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(m.i/r),So(f),So(f.next),f=e=m),f=f.next}while(f!==e);return j(f)}function _e(e,t,r,f,v,m){var _=e;do{for(var A=_.next.next;A!==_.prev;){if(_.i!==A.i&&Gn(_,A)){var F=Mo(_,A);return _=j(_,_.next),F=j(F,F.next),z(_,t,r,f,v,m),void z(F,t,r,f,v,m)}A=A.next}_=_.next}while(_!==e)}function vt(e,t){return e.x-t.x}function Vt(e,t){if(t=function(f,v){var m,_=v,A=f.x,F=f.y,Z=-1/0;do{if(F<=_.y&&F>=_.next.y&&_.next.y!==_.y){var K=_.x+(F-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(K<=A&&K>Z){if(Z=K,K===A){if(F===_.y)return _;if(F===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==v);if(!m)return null;if(A===Z)return m;var q,ue=m,de=m.x,je=m.y,Xe=1/0;_=m;do A>=_.x&&_.x>=de&&A!==_.x&&Rn(F<je?A:Z,F,de,je,F<je?Z:A,F,_.x,_.y)&&(q=Math.abs(F-_.y)/(A-_.x),Ha(_,f)&&(q<Xe||q===Xe&&(_.x>m.x||_.x===m.x&&Bt(m,_)))&&(m=_,Xe=q)),_=_.next;while(_!==ue);return m}(e,t)){var r=Mo(t,e);j(t,t.next),j(r,r.next)}}function Bt(e,t){return Mn(e.prev,e,t.prev)<0&&Mn(t.next,e,e.next)<0}function Sr(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function qr(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Rn(e,t,r,f,v,m,_,A){return(v-_)*(t-A)-(e-_)*(m-A)>=0&&(e-_)*(f-A)-(r-_)*(t-A)>=0&&(r-_)*(m-A)-(v-_)*(f-A)>=0}function Gn(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&yi(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Ha(e,t)&&Ha(t,e)&&function(r,f){var v=r,m=!1,_=(r.x+f.x)/2,A=(r.y+f.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&_<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(Mn(e.prev,e,t.prev)||Mn(e,t.prev,t))||di(e,t)&&Mn(e.prev,e,e.next)>0&&Mn(t.prev,t,t.next)>0)}function Mn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function di(e,t){return e.x===t.x&&e.y===t.y}function yi(e,t,r,f){var v=Mi(Mn(e,t,r)),m=Mi(Mn(e,t,f)),_=Mi(Mn(r,f,e)),A=Mi(Mn(r,f,t));return v!==m&&_!==A||!(v!==0||!aa(e,r,t))||!(m!==0||!aa(e,f,t))||!(_!==0||!aa(r,e,f))||!(A!==0||!aa(r,t,f))}function aa(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Mi(e){return e>0?1:e<0?-1:0}function Ha(e,t){return Mn(e.prev,e,e.next)<0?Mn(e,t,e.next)>=0&&Mn(e,e.prev,t)>=0:Mn(e,t,e.prev)<0||Mn(e,e.next,t)<0}function Mo(e,t){var r=new Qa(e.i,e.x,e.y),f=new Qa(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,m.next=f,f.prev=m,f}function bo(e,t,r,f){var v=new Qa(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function So(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Qa(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ca(e,t,r,f){for(var v=0,m=t,_=r-f;m<r;m+=f)v+=(e[_]-e[m])*(e[m+1]+e[_+1]),_=m;return v}function Wa(e,t,r,f,v){(function m(_,A,F,Z,K){for(;Z>F;){if(Z-F>600){var q=Z-F+1,ue=A-F+1,de=Math.log(q),je=.5*Math.exp(2*de/3),Xe=.5*Math.sqrt(de*je*(q-je)/q)*(ue-q/2<0?-1:1);m(_,A,Math.max(F,Math.floor(A-ue*je/q+Xe)),Math.min(Z,Math.floor(A+(q-ue)*je/q+Xe)),K)}var st=_[A],et=F,Mt=Z;for(Eo(_,F,A),K(_[Z],st)>0&&Eo(_,F,Z);et<Mt;){for(Eo(_,et,Mt),et++,Mt--;K(_[et],st)<0;)et++;for(;K(_[Mt],st)>0;)Mt--}K(_[F],st)===0?Eo(_,F,Mt):Eo(_,++Mt,Z),Mt<=A&&(F=Mt+1),A<=Mt&&(Z=Mt-1)}})(e,t,r||0,f||e.length-1,v||oo)}function Eo(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function oo(e,t){return e<t?-1:e>t?1:0}function wo(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,m=[],_=0;_<r;_++){var A=Ve(e[_]);A!==0&&(e[_].area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(f&&m.push(f),f=[e[_]]):f.push(e[_]))}if(f&&m.push(f),t>1)for(var F=0;F<m.length;F++)m[F].length<=t||(Wa(m[F],t,1,m[F].length-1,Ds),m[F]=m[F].slice(0,t));return m}function Ds(e,t){return t.area-e.area}function mu(e,t,r){for(var f=r.patternDependencies,v=!1,m=0,_=t;m<_.length;m+=1){var A=_[m].paint.get(e+"-pattern");A.isConstant()||(v=!0);var F=A.constantOr(null);F&&(v=!0,f[F.to]=!0,f[F.from]=!0)}return v}function Zu(e,t,r,f,v){for(var m=v.patternDependencies,_=0,A=t;_<A.length;_+=1){var F=A[_],Z=F.paint.get(e+"-pattern").value;if(Z.kind!=="constant"){var K=Z.evaluate({zoom:f-1},r,{},v.availableImages),q=Z.evaluate({zoom:f},r,{},v.availableImages),ue=Z.evaluate({zoom:f+1},r,{},v.availableImages);q=q&&q.name?q.name:q,ue=ue&&ue.name?ue.name:ue,m[K=K&&K.name?K.name:K]=!0,m[q]=!0,m[ue]=!0,r.patterns[F.id]={min:K,mid:q,max:ue}}}return r}lf.deviation=function(e,t,r,f){var v=t&&t.length,m=Math.abs(ca(e,0,v?t[0]*r:e.length,r));if(v)for(var _=0,A=t.length;_<A;_++)m-=Math.abs(ca(e,t[_]*r,_<A-1?t[_+1]*r:e.length,r));var F=0;for(_=0;_<f.length;_+=3){var Z=f[_]*r,K=f[_+1]*r,q=f[_+2]*r;F+=Math.abs((e[Z]-e[q])*(e[K+1]-e[Z+1])-(e[Z]-e[K])*(e[q+1]-e[Z+1]))}return m===0&&F===0?0:Math.abs((F-m)/m)},lf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var _=0;_<t;_++)r.vertices.push(e[v][m][_]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Hl.default=ih;var Ss=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fu,this.indexArray=new gl,this.indexArray2=new bc,this.programConfigurations=new ri(e.layers,e.zoom),this.segments=new ye,this.segments2=new ye,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Ss.prototype.populate=function(e,t,r){this.hasPattern=mu("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var A=_[m],F=A.feature,Z=A.id,K=A.index,q=A.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=no(F,ue);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),de,r)){var je=f?f.evaluate(de,{},r,t.availableImages):void 0,Xe={id:Z,properties:F.properties,type:F.type,sourceLayerIndex:q,index:K,geometry:ue?de.geometry:Ga(F),patterns:{},sortKey:je};v.push(Xe)}}f&&v.sort(function(en,pn){return en.sortKey-pn.sortKey});for(var st=0,et=v;st<et.length;st+=1){var Mt=et[st],Gt=Mt.geometry,ir=Mt.index,cr=Mt.sourceLayerIndex;if(this.hasPattern){var Ar=Zu("fill",this.layers,Mt,this.zoom,t);this.patternFeatures.push(Ar)}else this.addFeature(Mt,Gt,ir,r,{});t.featureIndex.insert(e[ir].feature,Gt,ir,cr,this.index)}},Ss.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Ss.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},Ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ss.prototype.addFeature=function(e,t,r,f,v){for(var m=0,_=wo(t,500);m<_.length;m+=1){for(var A=_[m],F=0,Z=0,K=A;Z<K.length;Z+=1)F+=K[Z].length;for(var q=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),ue=q.vertexLength,de=[],je=[],Xe=0,st=A;Xe<st.length;Xe+=1){var et=st[Xe];if(et.length!==0){et!==A[0]&&je.push(de.length/2);var Mt=this.segments2.prepareSegment(et.length,this.layoutVertexArray,this.indexArray2),Gt=Mt.vertexLength;this.layoutVertexArray.emplaceBack(et[0].x,et[0].y),this.indexArray2.emplaceBack(Gt+et.length-1,Gt),de.push(et[0].x),de.push(et[0].y);for(var ir=1;ir<et.length;ir++)this.layoutVertexArray.emplaceBack(et[ir].x,et[ir].y),this.indexArray2.emplaceBack(Gt+ir-1,Gt+ir),de.push(et[ir].x),de.push(et[ir].y);Mt.vertexLength+=et.length,Mt.primitiveLength+=et.length}}for(var cr=Hl(de,je),Ar=0;Ar<cr.length;Ar+=3)this.indexArray.emplaceBack(ue+cr[Ar],ue+cr[Ar+1],ue+cr[Ar+2]);q.vertexLength+=F,q.primitiveLength+=cr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},wn("FillBucket",Ss,{omit:["layers","patternFeatures"]});var Xc=new zo({"fill-sort-key":new On(te.layout_fill["fill-sort-key"])}),cf={paint:new zo({"fill-antialias":new Un(te.paint_fill["fill-antialias"]),"fill-opacity":new On(te.paint_fill["fill-opacity"]),"fill-color":new On(te.paint_fill["fill-color"]),"fill-outline-color":new On(te.paint_fill["fill-outline-color"]),"fill-translate":new Un(te.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zl(te.paint_fill["fill-pattern"])}),layout:Xc},jp=function(e){function t(r){e.call(this,r,cf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Ss(r)},t.prototype.queryRadius=function(){return io(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,_,A,F){return eu(Au(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,F),m)},t.prototype.isTileClipped=function(){return!0},t}(ku),Xf=po([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Yc=ff;function ff(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(fp,this,t)}function fp(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var m=f.readVarint()+f.pos;f.pos<m;){var _=v._keys[f.readVarint()],A=v._values[f.readVarint()];v.properties[_]=A}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Mh(e){for(var t,r,f=0,v=0,m=e.length,_=m-1;v<m;_=v++)f+=((r=e[_]).x-(t=e[v]).x)*(t.y+r.y);return f}ff.types=["Unknown","Point","LineString","Polygon"],ff.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,m=0,_=0,A=[];e.pos<r;){if(v<=0){var F=e.readVarint();f=7&F,v=F>>3}if(v--,f===1||f===2)m+=e.readSVarint(),_+=e.readSVarint(),f===1&&(t&&A.push(t),t=[]),t.push(new $(m,_));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&A.push(t),A},ff.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,m=0,_=1/0,A=-1/0,F=1/0,Z=-1/0;e.pos<t;){if(f<=0){var K=e.readVarint();r=7&K,f=K>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<_&&(_=v),v>A&&(A=v),(m+=e.readSVarint())<F&&(F=m),m>Z&&(Z=m);else if(r!==7)throw new Error("unknown command "+r)}return[_,F,A,Z]},ff.prototype.toGeoJSON=function(e,t,r){var f,v,m=this.extent*Math.pow(2,r),_=this.extent*e,A=this.extent*t,F=this.loadGeometry(),Z=ff.types[this.type];function K(de){for(var je=0;je<de.length;je++){var Xe=de[je];de[je]=[360*(Xe.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(Xe.y+A)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(f=0;f<F.length;f++)q[f]=F[f][0];K(F=q);break;case 2:for(f=0;f<F.length;f++)K(F[f]);break;case 3:for(F=function(de){var je=de.length;if(je<=1)return[de];for(var Xe,st,et=[],Mt=0;Mt<je;Mt++){var Gt=Mh(de[Mt]);Gt!==0&&(st===void 0&&(st=Gt<0),st===Gt<0?(Xe&&et.push(Xe),Xe=[de[Mt]]):Xe.push(de[Mt]))}return Xe&&et.push(Xe),et}(F),f=0;f<F.length;f++)for(v=0;v<F[f].length;v++)K(F[f][v])}F.length===1?F=F[0]:Z="Multi"+Z;var ue={type:"Feature",geometry:{type:Z,coordinates:F},properties:this.properties};return"id"in this&&(ue.id=this.id),ue};var hp=Ih;function Ih(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Vp,this,t),this.length=this._features.length}function Vp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,m=f.readVarint()+f.pos;f.pos<m;){var _=f.readVarint()>>3;v=_===1?f.readString():_===2?f.readFloat():_===3?f.readDouble():_===4?f.readVarint64():_===5?f.readVarint():_===6?f.readSVarint():_===7?f.readBoolean():null}return v}(r))}function Wl(e,t,r){if(e===3){var f=new hp(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}Ih.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Yc(this._pbf,t,this.extent,this._keys,this._values)};var Kc={VectorTile:function(e,t){this.layers=e.readFields(Wl,{},t)},VectorTileFeature:Yc,VectorTileLayer:hp},wf=Kc.VectorTileFeature.types,Xl=Math.pow(2,13);function Cf(e,t,r,f,v,m,_,A){e.emplaceBack(t,r,2*Math.floor(f*Xl)+_,v*Xl*2,m*Xl*2,Math.round(A))}var il=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Bu,this.indexArray=new gl,this.programConfigurations=new ri(e.layers,e.zoom),this.segments=new ye,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Yf(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}il.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=mu("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var m=v[f],_=m.feature,A=m.id,F=m.index,Z=m.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,q=no(_,K);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),q,r)){var ue={id:A,sourceLayerIndex:Z,index:F,geometry:K?q.geometry:Ga(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Zu("fill-extrusion",this.layers,ue,this.zoom,t)):this.addFeature(ue,ue.geometry,F,r,{}),t.featureIndex.insert(_,ue.geometry,F,Z,this.index,!0)}}},il.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},il.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},il.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},il.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},il.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},il.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},il.prototype.addFeature=function(e,t,r,f,v){for(var m=0,_=wo(t,500);m<_.length;m+=1){for(var A=_[m],F=0,Z=0,K=A;Z<K.length;Z+=1)F+=K[Z].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ue=0,de=A;ue<de.length;ue+=1){var je=de[ue];if(je.length!==0&&!((ta=je).every(function(Li){return Li.x<0})||ta.every(function(Li){return Li.x>8192})||ta.every(function(Li){return Li.y<0})||ta.every(function(Li){return Li.y>8192})))for(var Xe=0,st=0;st<je.length;st++){var et=je[st];if(st>=1){var Mt=je[st-1];if(!Yf(et,Mt)){q.vertexLength+4>ye.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Gt=et.sub(Mt)._perp()._unit(),ir=Mt.dist(et);Xe+ir>32768&&(Xe=0),Cf(this.layoutVertexArray,et.x,et.y,Gt.x,Gt.y,0,0,Xe),Cf(this.layoutVertexArray,et.x,et.y,Gt.x,Gt.y,0,1,Xe),Cf(this.layoutVertexArray,Mt.x,Mt.y,Gt.x,Gt.y,0,0,Xe+=ir),Cf(this.layoutVertexArray,Mt.x,Mt.y,Gt.x,Gt.y,0,1,Xe);var cr=q.vertexLength;this.indexArray.emplaceBack(cr,cr+2,cr+1),this.indexArray.emplaceBack(cr+1,cr+2,cr+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+F>ye.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),wf[e.type]==="Polygon"){for(var Ar=[],en=[],pn=q.vertexLength,Hn=0,En=A;Hn<En.length;Hn+=1){var ei=En[Hn];if(ei.length!==0){ei!==A[0]&&en.push(Ar.length/2);for(var Tn=0;Tn<ei.length;Tn++){var Vi=ei[Tn];Cf(this.layoutVertexArray,Vi.x,Vi.y,0,0,1,1,0),Ar.push(Vi.x),Ar.push(Vi.y)}}}for(var mi=Hl(Ar,en),Bn=0;Bn<mi.length;Bn+=3)this.indexArray.emplaceBack(pn+mi[Bn],pn+mi[Bn+2],pn+mi[Bn+1]);q.primitiveLength+=mi.length/3,q.vertexLength+=F}}var ta;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},wn("FillExtrusionBucket",il,{omit:["layers","features"]});var Oh={paint:new zo({"fill-extrusion-opacity":new Un(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new On(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zl(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new On(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new On(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},gu=function(e){function t(r){e.call(this,r,Oh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new il(r)},t.prototype.queryRadius=function(){return io(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,m,_,A,F,Z){var K=Au(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,F),q=this.paint.get("fill-extrusion-height").evaluate(f,v),ue=this.paint.get("fill-extrusion-base").evaluate(f,v),de=function(Xe,st,et,Mt){for(var Gt=[],ir=0,cr=Xe;ir<cr.length;ir+=1){var Ar=cr[ir],en=[Ar.x,Ar.y,0,1];vu(en,en,st),Gt.push(new $(en[0]/en[3],en[1]/en[3]))}return Gt}(K,Z),je=function(Xe,st,et,Mt){for(var Gt=[],ir=[],cr=Mt[8]*st,Ar=Mt[9]*st,en=Mt[10]*st,pn=Mt[11]*st,Hn=Mt[8]*et,En=Mt[9]*et,ei=Mt[10]*et,Tn=Mt[11]*et,Vi=0,mi=Xe;Vi<mi.length;Vi+=1){for(var Bn=[],ta=[],Li=0,la=mi[Vi];Li<la.length;Li+=1){var Jn=la[Li],zi=Jn.x,uo=Jn.y,lo=Mt[0]*zi+Mt[4]*uo+Mt[12],Go=Mt[1]*zi+Mt[5]*uo+Mt[13],go=Mt[2]*zi+Mt[6]*uo+Mt[14],Ho=Mt[3]*zi+Mt[7]*uo+Mt[15],Bs=go+en,ts=Ho+pn,Cs=lo+Hn,Ts=Go+En,iu=go+ei,Wo=Ho+Tn,Bo=new $((lo+cr)/ts,(Go+Ar)/ts);Bo.z=Bs/ts,Bn.push(Bo);var na=new $(Cs/Wo,Ts/Wo);na.z=iu/Wo,ta.push(na)}Gt.push(Bn),ir.push(ta)}return[Gt,ir]}(m,ue,q,Z);return function(Xe,st,et){var Mt=1/0;eu(et,st)&&(Mt=jo(et,st[0]));for(var Gt=0;Gt<st.length;Gt++)for(var ir=st[Gt],cr=Xe[Gt],Ar=0;Ar<ir.length-1;Ar++){var en=ir[Ar],pn=[en,ir[Ar+1],cr[Ar+1],cr[Ar],en];el(et,pn)&&(Mt=Math.min(Mt,jo(et,pn)))}return Mt!==1/0&&Mt}(je[0],je[1],de)},t}(ku);function al(e,t){return e.x*t.x+e.y*t.y}function jo(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var m=t[f],_=e[0],A=r.sub(v),F=m.sub(v),Z=_.sub(v),K=al(A,A),q=al(A,F),ue=al(F,F),de=al(Z,A),je=al(Z,F),Xe=K*ue-q*q,st=(ue*de-q*je)/Xe,et=(K*je-q*de)/Xe,Mt=v.z*(1-st-et)+r.z*st+m.z*et;if(isFinite(Mt))return Mt}return 1/0}for(var Gt=1/0,ir=0,cr=t;ir<cr.length;ir+=1)Gt=Math.min(Gt,cr[ir].z);return Gt}var Uu=po([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Lh=po([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,pp=Kc.VectorTileFeature.types,Rh=Math.cos(Math.PI/180*37.5),Dh=Math.pow(2,14)/.5,nu=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Os,this.layoutVertexArray2=new oc,this.indexArray=new gl,this.programConfigurations=new ri(e.layers,e.zoom),this.segments=new ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};nu.prototype.populate=function(e,t,r){this.hasPattern=mu("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var A=_[m],F=A.feature,Z=A.id,K=A.index,q=A.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=no(F,ue);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),de,r)){var je=f?f.evaluate(de,{},r):void 0,Xe={id:Z,properties:F.properties,type:F.type,sourceLayerIndex:q,index:K,geometry:ue?de.geometry:Ga(F),patterns:{},sortKey:je};v.push(Xe)}}f&&v.sort(function(en,pn){return en.sortKey-pn.sortKey});for(var st=0,et=v;st<et.length;st+=1){var Mt=et[st],Gt=Mt.geometry,ir=Mt.index,cr=Mt.sourceLayerIndex;if(this.hasPattern){var Ar=Zu("line",this.layers,Mt,this.zoom,t);this.patternFeatures.push(Ar)}else this.addFeature(Mt,Gt,ir,r,{});t.featureIndex.insert(e[ir].feature,Gt,ir,cr,this.index)}},nu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},nu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},nu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},nu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},nu.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Uu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},nu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},nu.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},nu.prototype.addFeature=function(e,t,r,f,v){var m=this.layers[0].layout,_=m.get("line-join").evaluate(e,{}),A=m.get("line-cap"),F=m.get("line-miter-limit"),Z=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var K=0,q=t;K<q.length;K+=1)this.addLine(q[K],e,_,A,F,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},nu.prototype.addLine=function(e,t,r,f,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var _=0;_<e.length-1;_++)this.totalDistance+=e[_].dist(e[_+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var A=pp[t.type]==="Polygon",F=e.length;F>=2&&e[F-1].equals(e[F-2]);)F--;for(var Z=0;Z<F-1&&e[Z].equals(e[Z+1]);)Z++;if(!(F<(A?3:2))){r==="bevel"&&(v=1.05);var K,q=this.overscaling<=16?122880/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),de=void 0,je=void 0,Xe=void 0,st=void 0;this.e1=this.e2=-1,A&&(st=e[Z].sub(K=e[F-2])._unit()._perp());for(var et=Z;et<F;et++)if(!(je=et===F-1?A?e[Z+1]:void 0:e[et+1])||!e[et].equals(je)){st&&(Xe=st),K&&(de=K),K=e[et],st=je?je.sub(K)._unit()._perp():Xe;var Mt=(Xe=Xe||st).add(st);Mt.x===0&&Mt.y===0||Mt._unit();var Gt=Xe.x*st.x+Xe.y*st.y,ir=Mt.x*st.x+Mt.y*st.y,cr=ir!==0?1/ir:1/0,Ar=2*Math.sqrt(2-2*ir),en=ir<Rh&&de&&je,pn=Xe.x*st.y-Xe.y*st.x>0;if(en&&et>Z){var Hn=K.dist(de);if(Hn>2*q){var En=K.sub(K.sub(de)._mult(q/Hn)._round());this.updateDistance(de,En),this.addCurrentVertex(En,Xe,0,0,ue),de=En}}var ei=de&&je,Tn=ei?r:A?"butt":f;if(ei&&Tn==="round"&&(cr<m?Tn="miter":cr<=2&&(Tn="fakeround")),Tn==="miter"&&cr>v&&(Tn="bevel"),Tn==="bevel"&&(cr>2&&(Tn="flipbevel"),cr<v&&(Tn="miter")),de&&this.updateDistance(de,K),Tn==="miter")Mt._mult(cr),this.addCurrentVertex(K,Mt,0,0,ue);else if(Tn==="flipbevel"){if(cr>100)Mt=st.mult(-1);else{var Vi=cr*Xe.add(st).mag()/Xe.sub(st).mag();Mt._perp()._mult(Vi*(pn?-1:1))}this.addCurrentVertex(K,Mt,0,0,ue),this.addCurrentVertex(K,Mt.mult(-1),0,0,ue)}else if(Tn==="bevel"||Tn==="fakeround"){var mi=-Math.sqrt(cr*cr-1),Bn=pn?mi:0,ta=pn?0:mi;if(de&&this.addCurrentVertex(K,Xe,Bn,ta,ue),Tn==="fakeround")for(var Li=Math.round(180*Ar/Math.PI/20),la=1;la<Li;la++){var Jn=la/Li;if(Jn!==.5){var zi=Jn-.5;Jn+=Jn*zi*(Jn-1)*((1.0904+Gt*(Gt*(3.55645-1.43519*Gt)-3.2452))*zi*zi+(.848013+Gt*(.215638*Gt-1.06021)))}var uo=st.sub(Xe)._mult(Jn)._add(Xe)._unit()._mult(pn?-1:1);this.addHalfVertex(K,uo.x,uo.y,!1,pn,0,ue)}je&&this.addCurrentVertex(K,st,-Bn,-ta,ue)}else if(Tn==="butt")this.addCurrentVertex(K,Mt,0,0,ue);else if(Tn==="square"){var lo=de?1:-1;this.addCurrentVertex(K,Mt,lo,lo,ue)}else Tn==="round"&&(de&&(this.addCurrentVertex(K,Xe,0,0,ue),this.addCurrentVertex(K,Xe,1,1,ue,!0)),je&&(this.addCurrentVertex(K,st,-1,-1,ue,!0),this.addCurrentVertex(K,st,0,0,ue)));if(en&&et<F-1){var Go=K.dist(je);if(Go>2*q){var go=K.add(je.sub(K)._mult(q/Go)._round());this.updateDistance(K,go),this.addCurrentVertex(go,st,0,0,ue),K=go}}}}},nu.prototype.addCurrentVertex=function(e,t,r,f,v,m){m===void 0&&(m=!1);var _=t.y*f-t.x,A=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,_,A,m,!0,-f,v),this.distance>Dh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,m))},nu.prototype.addHalfVertex=function(e,t,r,f,v,m,_){var A=.5*(this.lineClips?this.scaledDistance*(Dh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),_.primitiveLength++),v?this.e2=F:this.e1=F},nu.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},nu.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},wn("LineBucket",nu,{omit:["layers","patternFeatures"]});var kh=new zo({"line-cap":new Un(te.layout_line["line-cap"]),"line-join":new On(te.layout_line["line-join"]),"line-miter-limit":new Un(te.layout_line["line-miter-limit"]),"line-round-limit":new Un(te.layout_line["line-round-limit"]),"line-sort-key":new On(te.layout_line["line-sort-key"])}),ah={paint:new zo({"line-opacity":new On(te.paint_line["line-opacity"]),"line-color":new On(te.paint_line["line-color"]),"line-translate":new Un(te.paint_line["line-translate"]),"line-translate-anchor":new Un(te.paint_line["line-translate-anchor"]),"line-width":new On(te.paint_line["line-width"]),"line-gap-width":new On(te.paint_line["line-gap-width"]),"line-offset":new On(te.paint_line["line-offset"]),"line-blur":new On(te.paint_line["line-blur"]),"line-dasharray":new ps(te.paint_line["line-dasharray"]),"line-pattern":new Zl(te.paint_line["line-pattern"]),"line-gradient":new Do(te.paint_line["line-gradient"])}),layout:kh},oh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new Bi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,m){return f=Yt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,m)},t}(On))(ah.paint.properties["line-width"].specification);oh.useIntegerZoom=!0;var dp=function(e){function t(r){e.call(this,r,ah),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ti,this.gradientVersion=(this.gradientVersion+1)%we)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=oh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new nu(r)},t.prototype.queryRadius=function(r){var f=r,v=Fh(Hs("line-width",this,f),Hs("line-gap-width",this,f)),m=Hs("line-offset",this,f);return v/2+Math.abs(m)+io(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,_,A,F){var Z=Au(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,F),K=F/2*Fh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),q=this.paint.get("line-offset").evaluate(f,v);return q&&(m=function(ue,de){for(var je=[],Xe=new $(0,0),st=0;st<ue.length;st++){for(var et=ue[st],Mt=[],Gt=0;Gt<et.length;Gt++){var ir=et[Gt],cr=et[Gt+1],Ar=Gt===0?Xe:ir.sub(et[Gt-1])._unit()._perp(),en=Gt===et.length-1?Xe:cr.sub(ir)._unit()._perp(),pn=Ar._add(en)._unit();pn._mult(1/(pn.x*en.x+pn.y*en.y)),Mt.push(pn._mult(de)._add(ir))}je.push(Mt)}return je}(m,q*F)),function(ue,de,je){for(var Xe=0;Xe<de.length;Xe++){var st=de[Xe];if(ue.length>=3){for(var et=0;et<st.length;et++)if(Tu(ue,st[et]))return!0}if(Ls(ue,st,je))return!0}return!1}(Z,m,K)},t.prototype.isTileClipped=function(){return!0},t}(ku);function Fh(e,t){return t>0?t+2*e:e}var vp=po([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bh=po([{name:"a_projected_pos",components:3,type:"Float32"}],4),Nh=(po([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),po([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Kf=(po([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),po([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),mp=po([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zh(e,t,r){return e.sections.forEach(function(f){f.text=function(v,m,_){var A=m.layout.get("text-transform").evaluate(_,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),Is.applyArabicShaping&&(v=Is.applyArabicShaping(v)),v}(f.text,t,r)}),e}po([{name:"triangle",components:3,type:"Uint16"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),po([{type:"Float32",name:"offsetX"}]),po([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var $c={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Zh=function(e,t,r,f,v){var m,_,A=8*v-f-1,F=(1<<A)-1,Z=F>>1,K=-7,q=r?v-1:0,ue=r?-1:1,de=e[t+q];for(q+=ue,m=de&(1<<-K)-1,de>>=-K,K+=A;K>0;m=256*m+e[t+q],q+=ue,K-=8);for(_=m&(1<<-K)-1,m>>=-K,K+=f;K>0;_=256*_+e[t+q],q+=ue,K-=8);if(m===0)m=1-Z;else{if(m===F)return _?NaN:1/0*(de?-1:1);_+=Math.pow(2,f),m-=Z}return(de?-1:1)*_*Math.pow(2,m-f)},U=function(e,t,r,f,v,m){var _,A,F,Z=8*m-v-1,K=(1<<Z)-1,q=K>>1,ue=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=f?0:m-1,je=f?1:-1,Xe=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(A=isNaN(t)?1:0,_=K):(_=Math.floor(Math.log(t)/Math.LN2),t*(F=Math.pow(2,-_))<1&&(_--,F*=2),(t+=_+q>=1?ue/F:ue*Math.pow(2,1-q))*F>=2&&(_++,F/=2),_+q>=K?(A=0,_=K):_+q>=1?(A=(t*F-1)*Math.pow(2,v),_+=q):(A=t*Math.pow(2,q-1)*Math.pow(2,v),_=0));v>=8;e[r+de]=255&A,de+=je,A/=256,v-=8);for(_=_<<v|A,Z+=v;Z>0;e[r+de]=255&_,de+=je,_/=256,Z-=8);e[r+de-je]|=128*Xe},Te=ze;function ze(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ze.Varint=0,ze.Fixed64=1,ze.Bytes=2,ze.Fixed32=5;var qt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wr(e){return e.type===ze.Bytes?e.readVarint()+e.pos:e.pos+1}function Ht(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dr(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function Ur(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Hr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Jr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Gr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function rn(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function fn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function jr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function an(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Nt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function lr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Vr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Fr(e,t,r){e===1&&r.readMessage(Sn,t)}function Sn(e,t,r){if(e===3){var f=r.readMessage(zr,{}),v=f.width,m=f.height,_=f.left,A=f.top,F=f.advance;t.push({id:f.id,bitmap:new Ws({width:v+6,height:m+6},f.bitmap),metrics:{width:v,height:m,left:_,top:A,advance:F}})}}function zr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function sn(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var m=v[f];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(Xe,st){return st.h-Xe.h});for(var _=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],A=0,F=0,Z=0,K=e;Z<K.length;Z+=1)for(var q=K[Z],ue=_.length-1;ue>=0;ue--){var de=_[ue];if(!(q.w>de.w||q.h>de.h)){if(q.x=de.x,q.y=de.y,F=Math.max(F,q.y+q.h),A=Math.max(A,q.x+q.w),q.w===de.w&&q.h===de.h){var je=_.pop();ue<_.length&&(_[ue]=je)}else q.h===de.h?(de.x+=q.w,de.w-=q.w):q.w===de.w?(de.y+=q.h,de.h-=q.h):(_.push({x:de.x+q.w,y:de.y,w:de.w-q.w,h:q.h}),de.y+=q.h,de.h-=q.h);break}}return{w:A,h:F,fill:t/(A*F)||0}}ze.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,m=this.pos;this.type=7&f,e(v,t,this),this.pos===m&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=lr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=lr(this.buf,this.pos)+4294967296*lr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=lr(this.buf,this.pos)+4294967296*mn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Zh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,m,_){var A,F,Z=_.buf;if(A=(112&(F=Z[_.pos++]))>>4,F<128||(A|=(127&(F=Z[_.pos++]))<<3,F<128)||(A|=(127&(F=Z[_.pos++]))<<10,F<128)||(A|=(127&(F=Z[_.pos++]))<<17,F<128)||(A|=(127&(F=Z[_.pos++]))<<24,F<128)||(A|=(1&(F=Z[_.pos++]))<<31,F<128))return Ht(v,A,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&qt?function(r,f,v){return qt.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var m="",_=f;_<v;){var A,F,Z,K=r[_],q=null,ue=K>239?4:K>223?3:K>191?2:1;if(_+ue>v)break;ue===1?K<128&&(q=K):ue===2?(192&(A=r[_+1]))==128&&(q=(31&K)<<6|63&A)<=127&&(q=null):ue===3?(F=r[_+2],(192&(A=r[_+1]))==128&&(192&F)==128&&((q=(15&K)<<12|(63&A)<<6|63&F)<=2047||q>=55296&&q<=57343)&&(q=null)):ue===4&&(F=r[_+2],Z=r[_+3],(192&(A=r[_+1]))==128&&(192&F)==128&&(192&Z)==128&&((q=(15&K)<<18|(63&A)<<12|(63&F)<<6|63&Z)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,ue=1):q>65535&&(q-=65536,m+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),m+=String.fromCharCode(q),_+=ue}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ze.Bytes)return e.push(this.readVarint(t));var r=wr(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ze.Bytes)return e.push(this.readSVarint());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ze.Bytes)return e.push(this.readBoolean());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ze.Bytes)return e.push(this.readFloat());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ze.Bytes)return e.push(this.readDouble());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ze.Varint)for(;this.buf[this.pos++]>127;);else if(t===ze.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ze.Fixed32)this.pos+=4;else{if(t!==ze.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Vr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Vr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Vr(this.buf,-1&e,this.pos),Vr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Vr(this.buf,-1&e,this.pos),Vr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,_,A){A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,A.buf[A.pos]=127&(m>>>=7)}(f,0,r),function(m,_){var A=(7&m)<<4;_.buf[_.pos++]|=A|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,m){for(var _,A,F=0;F<v.length;F++){if((_=v.charCodeAt(F))>55295&&_<57344){if(!A){_>56319||F+1===v.length?(f[m++]=239,f[m++]=191,f[m++]=189):A=_;continue}if(_<56320){f[m++]=239,f[m++]=191,f[m++]=189,A=_;continue}_=A-55296<<10|_-56320|65536,A=null}else A&&(f[m++]=239,f[m++]=191,f[m++]=189,A=null);_<128?f[m++]=_:(_<2048?f[m++]=_>>6|192:(_<65536?f[m++]=_>>12|224:(f[m++]=_>>18|240,f[m++]=_>>12&63|128),f[m++]=_>>6&63|128),f[m++]=63&_|128)}return m}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dr(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),U(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),U(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&dr(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,ze.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ur,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Hr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,rn,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Jr,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Gr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,fn,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,an,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Nt,t)},writeBytesField:function(e,t){this.writeTag(e,ze.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ze.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ze.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Rr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,m=t.stretchY,_=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=m,this.content=_,this.version=f},nn={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};nn.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},nn.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},nn.tlbr.get=function(){return this.tl.concat(this.br)},nn.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Rr.prototype,nn);var Xn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var m=sn(v),_=new Uo({width:m.w||1,height:m.h||1});for(var A in e){var F=e[A],Z=r[A].paddedRect;Uo.copy(F.data,_,{x:0,y:0},{x:Z.x+1,y:Z.y+1},F.data)}for(var K in t){var q=t[K],ue=f[K].paddedRect,de=ue.x+1,je=ue.y+1,Xe=q.data.width,st=q.data.height;Uo.copy(q.data,_,{x:0,y:0},{x:de,y:je},q.data),Uo.copy(q.data,_,{x:0,y:st-1},{x:de,y:je-1},{width:Xe,height:1}),Uo.copy(q.data,_,{x:0,y:0},{x:de,y:je+st},{width:Xe,height:1}),Uo.copy(q.data,_,{x:Xe-1,y:0},{x:de-1,y:je},{width:1,height:st}),Uo.copy(q.data,_,{x:0,y:0},{x:de+Xe,y:je},{width:1,height:st})}this.image=_,this.iconPositions=r,this.patternPositions=f};Xn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[f]=new Rr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Xn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Xn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},wn("ImagePosition",Rr),wn("ImageAtlas",Xn);var Kn={horizontal:1,vertical:2,horizontalOnly:3},on=function(){this.scale=1,this.fontStack="",this.imageName=null};on.forText=function(e,t){var r=new on;return r.scale=e||1,r.fontStack=t,r},on.forImage=function(e){var t=new on;return t.imageName=e,t};var Nr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Mr(e,t,r,f,v,m,_,A,F,Z,K,q,ue,de,je,Xe){var st,et=Nr.fromFeature(e,v);q===Kn.vertical&&et.verticalizePunctuation();var Mt=Is.processBidirectionalText,Gt=Is.processStyledBidirectionalText;if(Mt&&et.sections.length===1){st=[];for(var ir=0,cr=Mt(et.toString(),fa(et,Z,m,t,f,de,je));ir<cr.length;ir+=1){var Ar=cr[ir],en=new Nr;en.text=Ar,en.sections=et.sections;for(var pn=0;pn<Ar.length;pn++)en.sectionIndex.push(0);st.push(en)}}else if(Gt){st=[];for(var Hn=0,En=Gt(et.text,et.sectionIndex,fa(et,Z,m,t,f,de,je));Hn<En.length;Hn+=1){var ei=En[Hn],Tn=new Nr;Tn.text=ei[0],Tn.sectionIndex=ei[1],Tn.sections=et.sections,st.push(Tn)}}else st=function(Bn,ta){for(var Li=[],la=Bn.text,Jn=0,zi=0,uo=ta;zi<uo.length;zi+=1){var lo=uo[zi];Li.push(Bn.substring(Jn,lo)),Jn=lo}return Jn<la.length&&Li.push(Bn.substring(Jn,la.length)),Li}(et,fa(et,Z,m,t,f,de,je));var Vi=[],mi={positionedLines:Vi,text:et.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Bn,ta,Li,la,Jn,zi,uo,lo,Go,go,Ho,Bs){for(var ts=0,Cs=-17,Ts=0,iu=0,Wo=lo==="right"?1:lo==="left"?0:.5,Bo=0,na=0,Ia=Jn;na<Ia.length;na+=1){var Da=Ia[na];Da.trim();var pa=Da.getMaxScale(),As=24*(pa-1),au={positionedGlyphs:[],lineOffset:0};Bn.positionedLines[Bo]=au;var yo=au.positionedGlyphs,xs=0;if(Da.length()){for(var _u=0;_u<Da.length();_u++){var Ea=Da.getSection(_u),mf=Da.getSectionIndex(_u),Kl=Da.getCharCode(_u),gf=0,us=null,Cc=null,Al=null,ch=24,Tf=!(Go===Kn.horizontal||!Ho&&!gc(Kl)||Ho&&(si[Kl]||(lc=Kl,Kr.Arabic(lc)||Kr["Arabic Supplement"](lc)||Kr["Arabic Extended-A"](lc)||Kr["Arabic Presentation Forms-A"](lc)||Kr["Arabic Presentation Forms-B"](lc))));if(Ea.imageName){var $f=la[Ea.imageName];if(!$f)continue;Al=Ea.imageName,Bn.iconsInText=Bn.iconsInText||!0,Cc=$f.paddedRect;var Af=$f.displaySize;Ea.scale=24*Ea.scale/Bs,gf=As+(24-Af[1]*Ea.scale),ch=(us={width:Af[0],height:Af[1],left:1,top:-3,advance:Tf?Af[1]:Af[0]}).advance;var zf=Tf?Af[0]*Ea.scale-24*pa:Af[1]*Ea.scale-24*pa;zf>0&&zf>xs&&(xs=zf)}else{var Gh=Li[Ea.fontStack],fh=Gh&&Gh[Kl];if(fh&&fh.rect)Cc=fh.rect,us=fh.metrics;else{var Jf=ta[Ea.fontStack],Hh=Jf&&Jf[Kl];if(!Hh)continue;us=Hh.metrics}gf=24*(pa-Ea.scale)}Tf?(Bn.verticalizable=!0,yo.push({glyph:Kl,imageName:Al,x:ts,y:Cs+gf,vertical:Tf,scale:Ea.scale,fontStack:Ea.fontStack,sectionIndex:mf,metrics:us,rect:Cc}),ts+=ch*Ea.scale+go):(yo.push({glyph:Kl,imageName:Al,x:ts,y:Cs+gf,vertical:Tf,scale:Ea.scale,fontStack:Ea.fontStack,sectionIndex:mf,metrics:us,rect:Cc}),ts+=us.advance*Ea.scale+go)}yo.length!==0&&(Ts=Math.max(ts-go,Ts),ss(yo,0,yo.length-1,Wo,xs)),ts=0;var Sp=zi*pa+xs;au.lineOffset=Math.max(xs,As),Cs+=Sp,iu=Math.max(Sp,iu),++Bo}else Cs+=zi,++Bo}var lc,hh=Cs- -17,ph=Jo(uo),Pl=ph.horizontalAlign,Zf=ph.verticalAlign;(function(Uf,Wh,dh,qc,Xh,vh,Yh,Kh,Ep){var mh,wp=(Wh-dh)*Xh;mh=vh!==Yh?-Kh*qc- -17:(-qc*Ep+.5)*Yh;for(var gh=0,$h=Uf;gh<$h.length;gh+=1)for(var Pf=0,Qf=$h[gh].positionedGlyphs;Pf<Qf.length;Pf+=1){var yh=Qf[Pf];yh.x+=wp,yh.y+=mh}})(Bn.positionedLines,Wo,Pl,Zf,Ts,iu,zi,hh,Jn.length),Bn.top+=-Zf*hh,Bn.bottom=Bn.top+hh,Bn.left+=-Pl*Ts,Bn.right=Bn.left+Ts}(mi,t,r,f,st,_,A,F,q,Z,ue,Xe),!function(Bn){for(var ta=0,Li=Bn;ta<Li.length;ta+=1)if(Li[ta].positionedGlyphs.length!==0)return!1;return!0}(Vi)&&mi}Nr.fromFeature=function(e,t){for(var r=new Nr,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},Nr.prototype.length=function(){return this.text.length},Nr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Nr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Nr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Nr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Ju(f)&&!$c[e[r+1]]||v&&Ju(v)&&!$c[e[r-1]]||!$c[e[r]]?e[r]:$c[e[r]]}return t}(this.text)},Nr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&si[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&si[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},Nr.prototype.substring=function(e,t){var r=new Nr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},Nr.prototype.toString=function(){return this.text},Nr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},Nr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(on.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},Nr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(on.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}else Fe("Can't add FormattedSection with an empty image.")},Nr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var si={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ui={};function kn(e,t,r,f,v,m){if(t.imageName){var _=f[t.imageName];return _?_.displaySize[0]*t.scale*24/m+v:0}var A=r[t.fontStack],F=A&&A[e];return F?F.metrics.advance*t.scale+v:0}function ea(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function Pi(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function ji(e,t,r,f,v,m){for(var _=null,A=ea(t,r,v,m),F=0,Z=f;F<Z.length;F+=1){var K=Z[F],q=ea(t-K.x,r,v,m)+K.badness;q<=A&&(_=K,A=q)}return{index:e,x:t,priorBreak:_,badness:A}}function fa(e,t,r,f,v,m,_){if(m!=="point")return[];if(!e)return[];for(var A,F=[],Z=function(st,et,Mt,Gt,ir,cr){for(var Ar=0,en=0;en<st.length();en++){var pn=st.getSection(en);Ar+=kn(st.getCharCode(en),pn,Gt,ir,et,cr)}return Ar/Math.max(1,Math.ceil(Ar/Mt))}(e,t,r,f,v,_),K=e.text.indexOf("\u200B")>=0,q=0,ue=0;ue<e.length();ue++){var de=e.getSection(ue),je=e.getCharCode(ue);if(si[je]||(q+=kn(je,de,f,v,t,_)),ue<e.length()-1){var Xe=!((A=je)<11904||!(Kr["Bopomofo Extended"](A)||Kr.Bopomofo(A)||Kr["CJK Compatibility Forms"](A)||Kr["CJK Compatibility Ideographs"](A)||Kr["CJK Compatibility"](A)||Kr["CJK Radicals Supplement"](A)||Kr["CJK Strokes"](A)||Kr["CJK Symbols and Punctuation"](A)||Kr["CJK Unified Ideographs Extension A"](A)||Kr["CJK Unified Ideographs"](A)||Kr["Enclosed CJK Letters and Months"](A)||Kr["Halfwidth and Fullwidth Forms"](A)||Kr.Hiragana(A)||Kr["Ideographic Description Characters"](A)||Kr["Kangxi Radicals"](A)||Kr["Katakana Phonetic Extensions"](A)||Kr.Katakana(A)||Kr["Vertical Forms"](A)||Kr["Yi Radicals"](A)||Kr["Yi Syllables"](A)));(ui[je]||Xe||de.imageName)&&F.push(ji(ue+1,q,Z,F,Pi(je,e.getCharCode(ue+1),Xe&&K),!1))}}return function st(et){return et?st(et.priorBreak).concat(et.index):[]}(ji(e.length(),q,Z,F,0,!0))}function Jo(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ss(e,t,r,f,v){if(f||v)for(var m=e[r],_=(e[r].x+m.metrics.advance*m.scale)*f,A=t;A<=r;A++)e[A].x-=_,e[A].y+=v}function $i(e,t,r,f,v,m){var _,A=e.image;if(A.content){var F=A.content,Z=A.pixelRatio||1;_=[F[0]/Z,F[1]/Z,A.displaySize[0]-F[2]/Z,A.displaySize[1]-F[3]/Z]}var K,q,ue,de,je=t.left*m,Xe=t.right*m;r==="width"||r==="both"?(de=v[0]+je-f[3],q=v[0]+Xe+f[1]):q=(de=v[0]+(je+Xe-A.displaySize[0])/2)+A.displaySize[0];var st=t.top*m,et=t.bottom*m;return r==="height"||r==="both"?(K=v[1]+st-f[0],ue=v[1]+et+f[2]):ue=(K=v[1]+(st+et-A.displaySize[1])/2)+A.displaySize[1],{image:A,top:K,right:q,bottom:ue,left:de,collisionPadding:_}}ui[10]=!0,ui[32]=!0,ui[38]=!0,ui[40]=!0,ui[41]=!0,ui[43]=!0,ui[45]=!0,ui[47]=!0,ui[173]=!0,ui[183]=!0,ui[8203]=!0,ui[8208]=!0,ui[8211]=!0,ui[8231]=!0;var vo=function(e){function t(r,f,v,m){e.call(this,r,f),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}($);function so(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Bi(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,m=0;m<f.length&&f[m]<=e;)m++;for(var _=m=Math.max(0,m-1);_<f.length&&f[_]<e+1;)_++;_=Math.min(f.length-1,_);var A=f[m],F=f[_];return r.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:F,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:F,minSize:r.evaluate(new Bi(A)),maxSize:r.evaluate(new Bi(F)),interpolationType:v}}function Qo(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?ho(v/128,r.upperSize/128,t.uSizeT):f}function ys(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?$e(ba.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=ho(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:f}}wn("Anchor",vo);var Es=Object.freeze({__proto__:null,getSizeData:so,evaluateSizeForFeature:Qo,evaluateSizeForZoom:ys,SIZE_PACK_FACTOR:128});function ks(e,t,r,f,v){if(t.segment===void 0)return!0;for(var m=t,_=t.segment+1,A=0;A>-r/2;){if(--_<0)return!1;A-=e[_].dist(m),m=e[_]}A+=e[_].dist(e[_+1]),_++;for(var F=[],Z=0;A<r/2;){var K=e[_],q=e[_+1];if(!q)return!1;var ue=e[_-1].angleTo(K)-K.angleTo(q);for(ue=Math.abs((ue+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:A,angleDelta:ue}),Z+=ue;A-F[0].distance>f;)Z-=F.shift().angleDelta;if(Z>v)return!1;_++,A+=K.dist(q)}return!0}function _s(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Fo(e,t,r){return e?.6*t*r:0}function Ni(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Fs(e,t,r,f,v,m){for(var _=Fo(r,v,m),A=Ni(r,f)*m,F=0,Z=_s(e)/2,K=0;K<e.length-1;K++){var q=e[K],ue=e[K+1],de=q.dist(ue);if(F+de>Z){var je=(Z-F)/de,Xe=ho(q.x,ue.x,je),st=ho(q.y,ue.y,je),et=new vo(Xe,st,ue.angleTo(q),K);return et._round(),!_||ks(e,et,A,_,t)?et:void 0}F+=de}}function Sa(e,t,r,f,v,m,_,A,F){var Z=Fo(f,m,_),K=Ni(f,v),q=K*_,ue=e[0].x===0||e[0].x===F||e[0].y===0||e[0].y===F;return t-q<t/4&&(t=q+t/4),function de(je,Xe,st,et,Mt,Gt,ir,cr,Ar){for(var en=Gt/2,pn=_s(je),Hn=0,En=Xe-st,ei=[],Tn=0;Tn<je.length-1;Tn++){for(var Vi=je[Tn],mi=je[Tn+1],Bn=Vi.dist(mi),ta=mi.angleTo(Vi);En+st<Hn+Bn;){var Li=((En+=st)-Hn)/Bn,la=ho(Vi.x,mi.x,Li),Jn=ho(Vi.y,mi.y,Li);if(la>=0&&la<Ar&&Jn>=0&&Jn<Ar&&En-en>=0&&En+en<=pn){var zi=new vo(la,Jn,ta,Tn);zi._round(),et&&!ks(je,zi,Gt,et,Mt)||ei.push(zi)}}Hn+=Bn}return cr||ei.length||ir||(ei=de(je,Hn/2,st,et,Mt,Gt,ir,!0,Ar)),ei}(e,ue?t/2*A%t:(K/2+2*m)*_*A%t,t,Z,r,q,ue,!1,F)}function li(e,t,r,f,v){for(var m=[],_=0;_<e.length;_++)for(var A=e[_],F=void 0,Z=0;Z<A.length-1;Z++){var K=A[Z],q=A[Z+1];K.x<t&&q.x<t||(K.x<t?K=new $(t,K.y+(t-K.x)/(q.x-K.x)*(q.y-K.y))._round():q.x<t&&(q=new $(t,K.y+(t-K.x)/(q.x-K.x)*(q.y-K.y))._round()),K.y<r&&q.y<r||(K.y<r?K=new $(K.x+(r-K.y)/(q.y-K.y)*(q.x-K.x),r)._round():q.y<r&&(q=new $(K.x+(r-K.y)/(q.y-K.y)*(q.x-K.x),r)._round()),K.x>=f&&q.x>=f||(K.x>=f?K=new $(f,K.y+(f-K.x)/(q.x-K.x)*(q.y-K.y))._round():q.x>=f&&(q=new $(f,K.y+(f-K.x)/(q.x-K.x)*(q.y-K.y))._round()),K.y>=v&&q.y>=v||(K.y>=v?K=new $(K.x+(v-K.y)/(q.y-K.y)*(q.x-K.x),v)._round():q.y>=v&&(q=new $(K.x+(v-K.y)/(q.y-K.y)*(q.x-K.x),v)._round()),F&&K.equals(F[F.length-1])||m.push(F=[K]),F.push(q)))))}return m}function Wi(e,t,r,f){var v=[],m=e.image,_=m.pixelRatio,A=m.paddedRect.w-2,F=m.paddedRect.h-2,Z=e.right-e.left,K=e.bottom-e.top,q=m.stretchX||[[0,A]],ue=m.stretchY||[[0,F]],de=function(la,Jn){return la+Jn[1]-Jn[0]},je=q.reduce(de,0),Xe=ue.reduce(de,0),st=A-je,et=F-Xe,Mt=0,Gt=je,ir=0,cr=Xe,Ar=0,en=st,pn=0,Hn=et;if(m.content&&f){var En=m.content;Mt=oa(q,0,En[0]),ir=oa(ue,0,En[1]),Gt=oa(q,En[0],En[2]),cr=oa(ue,En[1],En[3]),Ar=En[0]-Mt,pn=En[1]-ir,en=En[2]-En[0]-Gt,Hn=En[3]-En[1]-cr}var ei=function(la,Jn,zi,uo){var lo=El(la.stretch-Mt,Gt,Z,e.left),Go=wl(la.fixed-Ar,en,la.stretch,je),go=El(Jn.stretch-ir,cr,K,e.top),Ho=wl(Jn.fixed-pn,Hn,Jn.stretch,Xe),Bs=El(zi.stretch-Mt,Gt,Z,e.left),ts=wl(zi.fixed-Ar,en,zi.stretch,je),Cs=El(uo.stretch-ir,cr,K,e.top),Ts=wl(uo.fixed-pn,Hn,uo.stretch,Xe),iu=new $(lo,go),Wo=new $(Bs,go),Bo=new $(Bs,Cs),na=new $(lo,Cs),Ia=new $(Go/_,Ho/_),Da=new $(ts/_,Ts/_),pa=t*Math.PI/180;if(pa){var As=Math.sin(pa),au=Math.cos(pa),yo=[au,-As,As,au];iu._matMult(yo),Wo._matMult(yo),na._matMult(yo),Bo._matMult(yo)}var xs=la.stretch+la.fixed,_u=Jn.stretch+Jn.fixed;return{tl:iu,tr:Wo,bl:na,br:Bo,tex:{x:m.paddedRect.x+1+xs,y:m.paddedRect.y+1+_u,w:zi.stretch+zi.fixed-xs,h:uo.stretch+uo.fixed-_u},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ia,pixelOffsetBR:Da,minFontScaleX:en/_/Z,minFontScaleY:Hn/_/K,isSDF:r}};if(f&&(m.stretchX||m.stretchY))for(var Tn=qo(q,st,je),Vi=qo(ue,et,Xe),mi=0;mi<Tn.length-1;mi++)for(var Bn=Tn[mi],ta=Tn[mi+1],Li=0;Li<Vi.length-1;Li++)v.push(ei(Bn,Vi[Li],ta,Vi[Li+1]));else v.push(ei({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:F+1}));return v}function oa(e,t,r){for(var f=0,v=0,m=e;v<m.length;v+=1){var _=m[v];f+=Math.max(t,Math.min(r,_[1]))-Math.max(t,Math.min(r,_[0]))}return f}function qo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var _=m[v],A=_[0],F=_[1],Z=f[f.length-1];f.push({fixed:A-Z.stretch,stretch:Z.stretch}),f.push({fixed:A-Z.stretch,stretch:Z.stretch+(F-A)})}return f.push({fixed:t+1,stretch:r}),f}function El(e,t,r,f){return e/t*r+f}function wl(e,t,r,f){return e-t*r/f}var Ue=function(e,t,r,f,v,m,_,A,F,Z){if(this.boxStartIndex=e.length,F){var K=m.top,q=m.bottom,ue=m.collisionPadding;ue&&(K-=ue[1],q+=ue[3]);var de=q-K;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var je=m.top*_-A,Xe=m.bottom*_+A,st=m.left*_-A,et=m.right*_+A,Mt=m.collisionPadding;if(Mt&&(st-=Mt[0]*_,je-=Mt[1]*_,et+=Mt[2]*_,Xe+=Mt[3]*_),Z){var Gt=new $(st,je),ir=new $(et,je),cr=new $(st,Xe),Ar=new $(et,Xe),en=Z*Math.PI/180;Gt._rotate(en),ir._rotate(en),cr._rotate(en),Ar._rotate(en),st=Math.min(Gt.x,ir.x,cr.x,Ar.x),et=Math.max(Gt.x,ir.x,cr.x,Ar.x),je=Math.min(Gt.y,ir.y,cr.y,Ar.y),Xe=Math.max(Gt.y,ir.y,cr.y,Ar.y)}e.emplaceBack(t.x,t.y,st,je,et,Xe,r,f,v)}this.boxEndIndex=e.length},$t=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Wt),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Wt(e,t){return e<t?-1:e>t?1:0}function Cn(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,m=-1/0,_=-1/0,A=e[0],F=0;F<A.length;F++){var Z=A[F];(!F||Z.x<f)&&(f=Z.x),(!F||Z.y<v)&&(v=Z.y),(!F||Z.x>m)&&(m=Z.x),(!F||Z.y>_)&&(_=Z.y)}var K=Math.min(m-f,_-v),q=K/2,ue=new $t([],Xi);if(K===0)return new $(f,v);for(var de=f;de<m;de+=K)for(var je=v;je<_;je+=K)ue.push(new Le(de+q,je+q,q,e));for(var Xe=function(Mt){for(var Gt=0,ir=0,cr=0,Ar=Mt[0],en=0,pn=Ar.length,Hn=pn-1;en<pn;Hn=en++){var En=Ar[en],ei=Ar[Hn],Tn=En.x*ei.y-ei.x*En.y;ir+=(En.x+ei.x)*Tn,cr+=(En.y+ei.y)*Tn,Gt+=3*Tn}return new Le(ir/Gt,cr/Gt,0,Mt)}(e),st=ue.length;ue.length;){var et=ue.pop();(et.d>Xe.d||!Xe.d)&&(Xe=et,r&&console.log("found best %d after %d probes",Math.round(1e4*et.d)/1e4,st)),et.max-Xe.d<=t||(ue.push(new Le(et.p.x-(q=et.h/2),et.p.y-q,q,e)),ue.push(new Le(et.p.x+q,et.p.y-q,q,e)),ue.push(new Le(et.p.x-q,et.p.y+q,q,e)),ue.push(new Le(et.p.x+q,et.p.y+q,q,e)),st+=4)}return r&&(console.log("num probes: "+st),console.log("best distance: "+Xe.d)),Xe.p}function Xi(e,t){return t.max-e.max}function Le(e,t,r,f){this.p=new $(e,t),this.h=r,this.d=function(v,m){for(var _=!1,A=1/0,F=0;F<m.length;F++)for(var Z=m[F],K=0,q=Z.length,ue=q-1;K<q;ue=K++){var de=Z[K],je=Z[ue];de.y>v.y!=je.y>v.y&&v.x<(je.x-de.x)*(v.y-de.y)/(je.y-de.y)+de.x&&(_=!_),A=Math.min(A,tu(v,de,je))}return(_?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}$t.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},$t.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},$t.prototype.peek=function(){return this.data[0]},$t.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(f,m)>=0)break;t[e]=m,e=v}t[e]=f},$t.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var m=1+(e<<1),_=t[m],A=m+1;if(A<this.length&&r(t[A],_)<0&&(m=A,_=t[A]),r(_,v)>=0)break;t[e]=_,e=m}t[e]=v};var xe=Number.POSITIVE_INFINITY;function it(e,t){return t[1]!==xe?function(r,f,v){var m=0,_=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":_=v-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-f;break;case"top-left":case"bottom-left":case"left":m=f}return[m,_]}(e,t[0],t[1]):function(r,f){var v=0,m=0;f<0&&(f=0);var _=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-f;break;case"top":m=f-7}switch(r){case"top-right":case"bottom-right":v=-_;break;case"top-left":case"bottom-left":v=_;break;case"left":v=f;break;case"right":v=-f}return[v,m]}(e,t[0])}function Ot(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function At(e,t,r,f,v,m,_,A,F,Z,K,q,ue,de,je){var Xe=function(ir,cr,Ar,en,pn,Hn,En,ei){for(var Tn=en.layout.get("text-rotate").evaluate(Hn,{})*Math.PI/180,Vi=[],mi=0,Bn=cr.positionedLines;mi<Bn.length;mi+=1)for(var ta=Bn[mi],Li=0,la=ta.positionedGlyphs;Li<la.length;Li+=1){var Jn=la[Li];if(Jn.rect){var zi=Jn.rect||{},uo=4,lo=!0,Go=1,go=0,Ho=(pn||ei)&&Jn.vertical,Bs=Jn.metrics.advance*Jn.scale/2;if(ei&&cr.verticalizable&&(go=ta.lineOffset/2-(Jn.imageName?-(24-Jn.metrics.width*Jn.scale)/2:24*(Jn.scale-1))),Jn.imageName){var ts=En[Jn.imageName];lo=ts.sdf,uo=1/(Go=ts.pixelRatio)}var Cs=pn?[Jn.x+Bs,Jn.y]:[0,0],Ts=pn?[0,0]:[Jn.x+Bs+Ar[0],Jn.y+Ar[1]-go],iu=[0,0];Ho&&(iu=Ts,Ts=[0,0]);var Wo=(Jn.metrics.left-uo)*Jn.scale-Bs+Ts[0],Bo=(-Jn.metrics.top-uo)*Jn.scale+Ts[1],na=Wo+zi.w*Jn.scale/Go,Ia=Bo+zi.h*Jn.scale/Go,Da=new $(Wo,Bo),pa=new $(na,Bo),As=new $(Wo,Ia),au=new $(na,Ia);if(Ho){var yo=new $(-Bs,Bs- -17),xs=-Math.PI/2,_u=12-Bs,Ea=new $(22-_u,-(Jn.imageName?_u:0)),mf=new(Function.prototype.bind.apply($,[null].concat(iu)));Da._rotateAround(xs,yo)._add(Ea)._add(mf),pa._rotateAround(xs,yo)._add(Ea)._add(mf),As._rotateAround(xs,yo)._add(Ea)._add(mf),au._rotateAround(xs,yo)._add(Ea)._add(mf)}if(Tn){var Kl=Math.sin(Tn),gf=Math.cos(Tn),us=[gf,-Kl,Kl,gf];Da._matMult(us),pa._matMult(us),As._matMult(us),au._matMult(us)}var Cc=new $(0,0),Al=new $(0,0);Vi.push({tl:Da,tr:pa,bl:As,br:au,tex:zi,writingMode:cr.writingMode,glyphOffset:Cs,sectionIndex:Jn.sectionIndex,isSDF:lo,pixelOffsetTL:Cc,pixelOffsetBR:Al,minFontScaleX:0,minFontScaleY:0})}}return Vi}(0,r,A,v,m,_,f,e.allowVerticalPlacement),st=e.textSizeData,et=null;st.kind==="source"?(et=[128*v.layout.get("text-size").evaluate(_,{})])[0]>32640&&Fe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):st.kind==="composite"&&((et=[128*de.compositeTextSizes[0].evaluate(_,{},je),128*de.compositeTextSizes[1].evaluate(_,{},je)])[0]>32640||et[1]>32640)&&Fe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Xe,et,A,m,_,Z,t,F.lineStartIndex,F.lineLength,ue,je);for(var Mt=0,Gt=K;Mt<Gt.length;Mt+=1)q[Gt[Mt]]=e.text.placedSymbolArray.length-1;return 4*Xe.length}function ut(e){for(var t in e)return e[t];return null}function at(e,t,r,f){var v=e.compareText;if(t in v){for(var m=v[t],_=m.length-1;_>=0;_--)if(f.dist(m[_])<r)return!0}else v[t]=[];return v[t].push(f),!1}var St=Kc.VectorTileFeature.types,De=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tt(e,t,r,f,v,m,_,A,F,Z,K,q,ue){var de=A?Math.min(32640,Math.round(A[0])):0,je=A?Math.min(32640,Math.round(A[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),m,_,(de<<1)+(F?1:0),je,16*Z,16*K,256*q,256*ue)}function Ie(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function wt(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Nc(r[t].text))return!0;return!1}var Zt=function(e){this.layoutVertexArray=new xc,this.indexArray=new gl,this.programConfigurations=e,this.segments=new ye,this.dynamicLayoutVertexArray=new jl,this.opacityVertexArray=new sc,this.placedSymbolArray=new h};Zt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Zt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,De,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},Zt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},wn("SymbolBuffers",Zt);var Er=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new ye,this.collisionVertexArray=new Vc};Er.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Nh.members,!0)},Er.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},wn("CollisionBuffers",Er);var Xt=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ao([]),this.placementViewportMatrix=ao([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=so(this.zoom,t["text-size"]),this.iconSizeData=so(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(m){return Kn[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=e.sourceID};Xt.prototype.createArrays=function(){this.text=new Zt(new ri(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Zt(new ri(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new S},Xt.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||f)&&v){var _=$c[e.charAt(m)];_&&(t[_.charCodeAt(0)]=!0)}},Xt.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,m=v.get("text-font"),_=v.get("text-field"),A=v.get("icon-image"),F=(_.value.kind!=="constant"||_.value.value instanceof _a&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),Z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,K=v.get("symbol-sort-key");if(this.features=[],F||Z){for(var q=t.iconDependencies,ue=t.glyphDependencies,de=t.availableImages,je=new Bi(this.zoom),Xe=0,st=e;Xe<st.length;Xe+=1){var et=st[Xe],Mt=et.feature,Gt=et.id,ir=et.index,cr=et.sourceLayerIndex,Ar=f._featureFilter.needGeometry,en=no(Mt,Ar);if(f._featureFilter.filter(je,en,r)){Ar||(en.geometry=Ga(Mt));var pn=void 0;if(F){var Hn=f.getValueAndResolveTokens("text-field",en,r,de),En=_a.factory(Hn);wt(En)&&(this.hasRTLText=!0),(!this.hasRTLText||yc()==="unavailable"||this.hasRTLText&&Is.isParsed())&&(pn=zh(En,f,en))}var ei=void 0;if(Z){var Tn=f.getValueAndResolveTokens("icon-image",en,r,de);ei=Tn instanceof da?Tn:da.fromString(Tn)}if(pn||ei){var Vi=this.sortFeaturesByKey?K.evaluate(en,{},r):void 0;if(this.features.push({id:Gt,text:pn,icon:ei,index:ir,sourceLayerIndex:cr,geometry:en.geometry,properties:Mt.properties,type:St[Mt.type],sortKey:Vi}),ei&&(q[ei.name]=!0),pn){var mi=m.evaluate(en,{},r).join(","),Bn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Kn.vertical)>=0;for(var ta=0,Li=pn.sections;ta<Li.length;ta+=1){var la=Li[ta];if(la.image)q[la.image.name]=!0;else{var Jn=Bc(pn.toString()),zi=la.fontStack||mi,uo=ue[zi]=ue[zi]||{};this.calculateGlyphDependencies(la.text,uo,Bn,this.allowVerticalPlacement,Jn)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(lo){var Go={},go={},Ho=[],Bs=0;function ts(yo){Ho.push(lo[yo]),Bs++}function Cs(yo,xs,_u){var Ea=go[yo];return delete go[yo],go[xs]=Ea,Ho[Ea].geometry[0].pop(),Ho[Ea].geometry[0]=Ho[Ea].geometry[0].concat(_u[0]),Ea}function Ts(yo,xs,_u){var Ea=Go[xs];return delete Go[xs],Go[yo]=Ea,Ho[Ea].geometry[0].shift(),Ho[Ea].geometry[0]=_u[0].concat(Ho[Ea].geometry[0]),Ea}function iu(yo,xs,_u){var Ea=_u?xs[0][xs[0].length-1]:xs[0][0];return yo+":"+Ea.x+":"+Ea.y}for(var Wo=0;Wo<lo.length;Wo++){var Bo=lo[Wo],na=Bo.geometry,Ia=Bo.text?Bo.text.toString():null;if(Ia){var Da=iu(Ia,na),pa=iu(Ia,na,!0);if(Da in go&&pa in Go&&go[Da]!==Go[pa]){var As=Ts(Da,pa,na),au=Cs(Da,pa,Ho[As].geometry);delete Go[Da],delete go[pa],go[iu(Ia,Ho[au].geometry,!0)]=au,Ho[As].geometry=null}else Da in go?Cs(Da,pa,na):pa in Go?Ts(Da,pa,na):(ts(Wo),Go[Da]=Bs-1,go[pa]=Bs-1)}else ts(Wo)}return Ho.filter(function(yo){return yo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(lo,Go){return lo.sortKey-Go.sortKey})}},Xt.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},Xt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Xt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Xt.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Xt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Xt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Xt.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},_=e.segment+1;_<t.length;_++)m[_]={x:t[_].x,y:t[_].y,tileUnitDistanceFromAnchor:f},_<t.length-1&&(f+=t[_+1].dist(t[_]));for(var A=e.segment||0;A>=0;A--)m[A]={x:t[A].x,y:t[A].y,tileUnitDistanceFromAnchor:v},A>0&&(v+=t[A-1].dist(t[A]));for(var F=0;F<t.length;F++){var Z=m[F];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Xt.prototype.addSymbols=function(e,t,r,f,v,m,_,A,F,Z,K,q){for(var ue=e.indexArray,de=e.layoutVertexArray,je=e.segments.prepareSegment(4*t.length,de,ue,this.canOverlap?m.sortKey:void 0),Xe=this.glyphOffsetArray.length,st=je.vertexLength,et=this.allowVerticalPlacement&&_===Kn.vertical?Math.PI/2:0,Mt=m.text&&m.text.sections,Gt=0;Gt<t.length;Gt++){var ir=t[Gt],cr=ir.tl,Ar=ir.tr,en=ir.bl,pn=ir.br,Hn=ir.tex,En=ir.pixelOffsetTL,ei=ir.pixelOffsetBR,Tn=ir.minFontScaleX,Vi=ir.minFontScaleY,mi=ir.glyphOffset,Bn=ir.isSDF,ta=ir.sectionIndex,Li=je.vertexLength,la=mi[1];tt(de,A.x,A.y,cr.x,la+cr.y,Hn.x,Hn.y,r,Bn,En.x,En.y,Tn,Vi),tt(de,A.x,A.y,Ar.x,la+Ar.y,Hn.x+Hn.w,Hn.y,r,Bn,ei.x,En.y,Tn,Vi),tt(de,A.x,A.y,en.x,la+en.y,Hn.x,Hn.y+Hn.h,r,Bn,En.x,ei.y,Tn,Vi),tt(de,A.x,A.y,pn.x,la+pn.y,Hn.x+Hn.w,Hn.y+Hn.h,r,Bn,ei.x,ei.y,Tn,Vi),Ie(e.dynamicLayoutVertexArray,A,et),ue.emplaceBack(Li,Li+1,Li+2),ue.emplaceBack(Li+1,Li+2,Li+3),je.vertexLength+=4,je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mi[0]),Gt!==t.length-1&&ta===t[Gt+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,m,m.index,{},q,Mt&&Mt[ta])}e.placedSymbolArray.emplaceBack(A.x,A.y,Xe,this.glyphOffsetArray.length-Xe,st,F,Z,A.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],_,0,!1,0,K)},Xt.prototype._addCollisionDebugVertex=function(e,t,r,f,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(m.x),Math.round(m.y))},Xt.prototype.addCollisionDebugVertices=function(e,t,r,f,v,m,_){var A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),F=A.vertexLength,Z=v.layoutVertexArray,K=v.collisionVertexArray,q=_.anchorX,ue=_.anchorY;this._addCollisionDebugVertex(Z,K,m,q,ue,new $(e,t)),this._addCollisionDebugVertex(Z,K,m,q,ue,new $(r,t)),this._addCollisionDebugVertex(Z,K,m,q,ue,new $(r,f)),this._addCollisionDebugVertex(Z,K,m,q,ue,new $(e,f)),A.vertexLength+=4;var de=v.indexArray;de.emplaceBack(F,F+1),de.emplaceBack(F+1,F+2),de.emplaceBack(F+2,F+3),de.emplaceBack(F+3,F),A.primitiveLength+=4},Xt.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,f?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},Xt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Er(uc,Kf.members,bc),this.iconCollisionBox=new Er(uc,Kf.members,bc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},Xt.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,m,_,A,F){for(var Z={},K=t;K<r;K++){var q=e.get(K);Z.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},Z.textFeatureIndex=q.featureIndex;break}for(var ue=f;ue<v;ue++){var de=e.get(ue);Z.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},Z.verticalTextFeatureIndex=de.featureIndex;break}for(var je=m;je<_;je++){var Xe=e.get(je);Z.iconBox={x1:Xe.x1,y1:Xe.y1,x2:Xe.x2,y2:Xe.y2,anchorPointX:Xe.anchorPointX,anchorPointY:Xe.anchorPointY},Z.iconFeatureIndex=Xe.featureIndex;break}for(var st=A;st<F;st++){var et=e.get(st);Z.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},Z.verticalIconFeatureIndex=et.featureIndex;break}return Z},Xt.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},Xt.prototype.hasTextData=function(){return this.text.segments.get().length>0},Xt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Xt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Xt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Xt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Xt.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},Xt.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],m=[],_=0;_<this.symbolInstances.length;++_){m.push(_);var A=this.symbolInstances.get(_);f.push(0|Math.round(t*A.anchorX+r*A.anchorY)),v.push(A.featureIndex)}return m.sort(function(F,Z){return f[F]-f[Z]||v[Z]-v[F]}),m},Xt.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Xt.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,_,A){m>=0&&A.indexOf(m)===_&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},wn("SymbolBucket",Xt,{omit:["layers","collisionBoxArray","features","compareText"]}),Xt.MAX_GLYPHS=65535,Xt.addDynamicAttributes=Ie;var xr=new zo({"symbol-placement":new Un(te.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new On(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new On(te.layout_symbol["icon-size"]),"icon-text-fit":new Un(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new On(te.layout_symbol["icon-image"]),"icon-rotate":new On(te.layout_symbol["icon-rotate"]),"icon-padding":new Un(te.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(te.layout_symbol["icon-keep-upright"]),"icon-offset":new On(te.layout_symbol["icon-offset"]),"icon-anchor":new On(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(te.layout_symbol["text-rotation-alignment"]),"text-field":new On(te.layout_symbol["text-field"]),"text-font":new On(te.layout_symbol["text-font"]),"text-size":new On(te.layout_symbol["text-size"]),"text-max-width":new On(te.layout_symbol["text-max-width"]),"text-line-height":new Un(te.layout_symbol["text-line-height"]),"text-letter-spacing":new On(te.layout_symbol["text-letter-spacing"]),"text-justify":new On(te.layout_symbol["text-justify"]),"text-radial-offset":new On(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(te.layout_symbol["text-variable-anchor"]),"text-anchor":new On(te.layout_symbol["text-anchor"]),"text-max-angle":new Un(te.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(te.layout_symbol["text-writing-mode"]),"text-rotate":new On(te.layout_symbol["text-rotate"]),"text-padding":new Un(te.layout_symbol["text-padding"]),"text-keep-upright":new Un(te.layout_symbol["text-keep-upright"]),"text-transform":new On(te.layout_symbol["text-transform"]),"text-offset":new On(te.layout_symbol["text-offset"]),"text-allow-overlap":new Un(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(te.layout_symbol["text-ignore-placement"]),"text-optional":new Un(te.layout_symbol["text-optional"])}),Yr={paint:new zo({"icon-opacity":new On(te.paint_symbol["icon-opacity"]),"icon-color":new On(te.paint_symbol["icon-color"]),"icon-halo-color":new On(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new On(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new On(te.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new On(te.paint_symbol["text-opacity"]),"text-color":new On(te.paint_symbol["text-color"],{runtimeType:ln,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new On(te.paint_symbol["text-halo-color"]),"text-halo-width":new On(te.paint_symbol["text-halo-width"]),"text-halo-blur":new On(te.paint_symbol["text-halo-blur"]),"text-translate":new Un(te.paint_symbol["text-translate"]),"text-translate-anchor":new Un(te.paint_symbol["text-translate-anchor"])}),layout:xr},zn=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e};zn.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},zn.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},zn.prototype.outputDefined=function(){return!1},zn.prototype.serialize=function(){return null},wn("FormatSectionOverride",zn,{omit:["defaultValue"]});var Ii=function(e){function t(r){e.call(this,r,Yr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],_=0,A=v;_<A.length;_+=1){var F=A[_];m.indexOf(F)<0&&m.push(F)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,m){var _=this.layout.get(r).evaluate(f,{},v,m),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||wu(A.value)||!_?_:function(F,Z){return Z.replace(/{([^{}]+)}/g,function(K,q){return q in F?String(F[q]):""})}(f.properties,_)},t.prototype.createBucket=function(r){return new Xt(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=Yr.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var m,_=this.paint.get(v),A=new zn(_),F=new cl(A,_.property.specification);m=_.value.kind==="constant"||_.value.kind==="source"?new fl("source",F):new uu("composite",F,_.value.zoomStops,_.value._interpolationType),this.paint._values[v]=new is(_.property,m,_.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),m=Yr.paint.properties[f],_=!1,A=function(K){for(var q=0,ue=K;q<ue.length;q+=1)if(m.overrides&&m.overrides.hasOverride(ue[q]))return void(_=!0)};if(v.value.kind==="constant"&&v.value.value instanceof _a)A(v.value.value.sections);else if(v.value.kind==="source"){var F=function(K){_||(K instanceof Ka&&gi(K.value)===Yi?A(K.value.sections):K instanceof Oo?A(K.sections):K.eachChild(F))},Z=v.value;Z._styleExpression&&F(Z._styleExpression.expression)}return _},t}(ku),In={paint:new zo({"background-color":new Un(te.paint_background["background-color"]),"background-pattern":new ps(te.paint_background["background-pattern"]),"background-opacity":new Un(te.paint_background["background-opacity"])})},$n=function(e){function t(r){e.call(this,r,In)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ku),Oi={paint:new zo({"raster-opacity":new Un(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(te.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(te.paint_raster["raster-saturation"]),"raster-contrast":new Un(te.paint_raster["raster-contrast"]),"raster-resampling":new Un(te.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(te.paint_raster["raster-fade-duration"])})},ha=function(e){function t(r){e.call(this,r,Oi)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ku),Co=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(ku),yu={circle:rl,heatmap:Sl,hillshade:Wc,fill:jp,"fill-extrusion":gu,line:dp,symbol:Ii,background:$n,raster:ha},Df=k.HTMLImageElement,Cl=k.HTMLCanvasElement,sh=k.HTMLVideoElement,Tl=k.ImageData,kf=k.ImageBitmap,Ff=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};Ff.prototype.update=function(e,t,r){var f=e.width,v=e.height,m=!(this.size&&this.size[0]===f&&this.size[1]===v||r),_=this.context,A=_.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[f,v],e instanceof Df||e instanceof Cl||e instanceof sh||e instanceof Tl||kf&&e instanceof kf?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,e):A.texImage2D(A.TEXTURE_2D,0,this.format,f,v,0,this.format,A.UNSIGNED_BYTE,e.data);else{var F=r||{x:0,y:0},Z=F.x,K=F.y;e instanceof Df||e instanceof Cl||e instanceof sh||e instanceof Tl||kf&&e instanceof kf?A.texSubImage2D(A.TEXTURE_2D,0,Z,K,A.RGBA,A.UNSIGNED_BYTE,e):A.texSubImage2D(A.TEXTURE_2D,0,Z,K,f,v,A.RGBA,A.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)},Ff.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},Ff.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ff.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var uh=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};uh.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},uh.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Bf=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ir(["receive","process"],this),this.invoker=new uh(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Et()?e:k};function Yl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Bf.prototype.send=function(e,t,r,f,v){var m=this;v===void 0&&(v=!1);var _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);var A=Ae(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:lu(t,A)},A),{cancel:function(){r&&delete m.callbacks[_],m.target.postMessage({id:_,type:"<cancel>",targetMapId:f,sourceMapId:m.mapId})}}},Bf.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else Et()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Bf.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Bf.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Vs(t.error)):f(null,Vs(t.data)))}else{var v=!1,m=Ae(this.globalScope)?void 0:[],_=t.hasCallback?function(K,q){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:K?lu(K):null,data:lu(q,m)},m)}:function(K){v=!0},A=null,F=Vs(t.data);if(this.parent[t.type])A=this.parent[t.type](t.sourceMapId,F,_);else if(this.parent.getWorkerSource){var Z=t.type.split(".");A=this.parent.getWorkerSource(t.sourceMapId,Z[0],F.source)[Z[1]](F,_)}else _(new Error("Could not find function "+t.type));!v&&A&&A.cancel&&(this.cancelCallbacks[e]=A.cancel)}},Bf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var es=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};es.prototype.setNorthEast=function(e){return this._ne=e instanceof mo?new mo(e.lng,e.lat):mo.convert(e),this},es.prototype.setSouthWest=function(e){return this._sw=e instanceof mo?new mo(e.lng,e.lat):mo.convert(e),this},es.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof mo)t=e,r=e;else{if(!(e instanceof es))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(es.convert(e)):this.extend(mo.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new mo(t.lng,t.lat),this._ne=new mo(r.lng,r.lat)),this},es.prototype.getCenter=function(){return new mo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},es.prototype.getSouthWest=function(){return this._sw},es.prototype.getNorthEast=function(){return this._ne},es.prototype.getNorthWest=function(){return new mo(this.getWest(),this.getNorth())},es.prototype.getSouthEast=function(){return new mo(this.getEast(),this.getSouth())},es.prototype.getWest=function(){return this._sw.lng},es.prototype.getSouth=function(){return this._sw.lat},es.prototype.getEast=function(){return this._ne.lng},es.prototype.getNorth=function(){return this._ne.lat},es.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},es.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},es.prototype.isEmpty=function(){return!(this._sw&&this._ne)},es.prototype.contains=function(e){var t=mo.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},es.convert=function(e){return!e||e instanceof es?e:new es(e)};var mo=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};mo.prototype.wrap=function(){return new mo(Ut(this.lng,-180,180),this.lat)},mo.prototype.toArray=function(){return[this.lng,this.lat]},mo.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},mo.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},mo.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new es(new mo(this.lng-r,this.lat-t),new mo(this.lng+r,this.lat+t))},mo.convert=function(e){if(e instanceof mo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Gp=2*Math.PI*63710088e-1;function Hp(e){return Gp*Math.cos(e*Math.PI/180)}function lh(e){return(180+e)/360}function Uh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function gp(e,t){return e/Hp(t)}function yp(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Jc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Jc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=mo.convert(e);return new Jc(lh(r.lng),Uh(r.lat),gp(t,r.lat))},Jc.prototype.toLngLat=function(){return new mo(360*this.x-180,yp(this.y))},Jc.prototype.toAltitude=function(){return this.z*Hp(yp(this.y))},Jc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Gp*(e=yp(this.y),1/Math.cos(e*Math.PI/180));var e};var hf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Qc(0,e,e,t,r)};hf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},hf.prototype.url=function(e,t){var r,f,v,m,_,A=(f=this.y,v=this.z,m=Yl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),_=Yl(256*(r+1),256*(f+1),v),m[0]+","+m[1]+","+_[0]+","+_[1]),F=function(Z,K,q){for(var ue,de="",je=Z;je>0;je--)de+=(K&(ue=1<<je-1)?1:0)+(q&ue?2:0);return de}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",A)},hf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new $(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},hf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Wp=function(e,t){this.wrap=e,this.canonical=t,this.key=Qc(e,t.z,t.z,t.x,t.y)},Vo=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new hf(r,+f,+v),this.key=Qc(t,e,r,f,v)};function Qc(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+f).toString(36)+r.toString(36)+t.toString(36)}Vo.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},Vo.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new Vo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vo(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},Vo.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Qc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Qc(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},Vo.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},Vo.prototype.children=function(e){if(this.overscaledZ>=e)return[new Vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new Vo(t,this.wrap,t,r,f),new Vo(t,this.wrap,t,r+1,f),new Vo(t,this.wrap,t,r,f+1),new Vo(t,this.wrap,t,r+1,f+1)]},Vo.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},Vo.prototype.wrapped=function(){return new Vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Vo.prototype.unwrapTo=function(e){return new Vo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},Vo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Vo.prototype.toUnwrapped=function(){return new Wp(this.wrap,this.canonical)},Vo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Vo.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Jc(e.x-this.wrap,e.y))},wn("CanonicalTileID",hf),wn("OverscaledTileID",Vo,{omit:["posMatrix"]});var pf=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Fe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};pf.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},pf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},pf.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},pf.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},pf.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},pf.prototype.getPixels=function(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},pf.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,_=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:m=_-1;break;case 1:_=m+1}for(var A=-t*this.dim,F=-r*this.dim,Z=m;Z<_;Z++)for(var K=f;K<v;K++)this.data[this._idx(K,Z)]=e.data[this._idx(K+A,Z+F)]},wn("DEMData",pf);var jh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};jh.prototype.encode=function(e){return this._stringToNumber[e]},jh.prototype.decode=function(e){return this._numberToString[e]};var Vh=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},_p={geometry:{configurable:!0}};_p.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},_p.geometry.set=function(e){this._geometry=e},Vh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Vh.prototype,_p);var Nf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Nf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Yt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var m in this.deletedStates[e][f]={},this.state[e][f])r[m]||(this.deletedStates[e][f][m]=null);else for(var _ in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][_]===null&&delete this.deletedStates[e][f][_]},Nf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Nf.prototype.getState=function(e,t){var r=String(t),f=Yt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete f[m]}return f},Nf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Nf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var m in this.stateChanges[f])this.state[f][m]||(this.state[f][m]={}),Yt(this.state[f][m],this.stateChanges[f][m]),v[m]=this.state[f][m];r[f]=v}for(var _ in this.deletedStates){this.state[_]=this.state[_]||{};var A={};if(this.deletedStates[_]===null)for(var F in this.state[_])A[F]={},this.state[_][F]={};else for(var Z in this.deletedStates[_]){if(this.deletedStates[_][Z]===null)this.state[_][Z]={};else for(var K=0,q=Object.keys(this.deletedStates[_][Z]);K<q.length;K+=1)delete this.state[_][Z][q[K]];A[Z]=this.state[_][Z]}r[_]=r[_]||{},Yt(r[_],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var ue in e)e[ue].setFeatureState(r,t)};var df=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ru(8192,16,0),this.grid3D=new Ru(8192,16,0),this.featureIndexArray=new ee,this.promoteId=t};function xp(e,t,r,f,v){return nr(e,function(m,_){var A=t instanceof zl?t.get(_):null;return A&&A.evaluate?A.evaluate(r,f,v):A})}function bp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,m=0,_=e;m<_.length;m+=1){var A=_[m];t=Math.min(t,A.x),r=Math.min(r,A.y),f=Math.max(f,A.x),v=Math.max(v,A.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Xp(e,t){return t-e}df.prototype.insert=function(e,t,r,f,v,m){var _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var A=m?this.grid3D:this.grid,F=0;F<t.length;F++){for(var Z=t[F],K=[1/0,1/0,-1/0,-1/0],q=0;q<Z.length;q++){var ue=Z[q];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}K[0]<8192&&K[1]<8192&&K[2]>=0&&K[3]>=0&&A.insert(_,K[0],K[1],K[2],K[3])}},df.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Kc.VectorTile(new Te(this.rawTileData)).layers,this.sourceLayerCoder=new jh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},df.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var m=e.params||{},_=8192/e.tileSize/e.scale,A=kl(m.filter),F=e.queryGeometry,Z=e.queryPadding*_,K=bp(F),q=this.grid.query(K.minX-Z,K.minY-Z,K.maxX+Z,K.maxY+Z),ue=bp(e.cameraQueryGeometry),de=this.grid3D.query(ue.minX-Z,ue.minY-Z,ue.maxX+Z,ue.maxY+Z,function(ir,cr,Ar,en){return function(pn,Hn,En,ei,Tn){for(var Vi=0,mi=pn;Vi<mi.length;Vi+=1){var Bn=mi[Vi];if(Hn<=Bn.x&&En<=Bn.y&&ei>=Bn.x&&Tn>=Bn.y)return!0}var ta=[new $(Hn,En),new $(Hn,Tn),new $(ei,Tn),new $(ei,En)];if(pn.length>2){for(var Li=0,la=ta;Li<la.length;Li+=1)if(Tu(pn,la[Li]))return!0}for(var Jn=0;Jn<pn.length-1;Jn++)if(zu(pn[Jn],pn[Jn+1],ta))return!0;return!1}(e.cameraQueryGeometry,ir-Z,cr-Z,Ar+Z,en+Z)}),je=0,Xe=de;je<Xe.length;je+=1)q.push(Xe[je]);q.sort(Xp);for(var st,et={},Mt=function(ir){var cr=q[ir];if(cr!==st){st=cr;var Ar=v.featureIndexArray.get(cr),en=null;v.loadMatchingFeature(et,Ar.bucketIndex,Ar.sourceLayerIndex,Ar.featureIndex,A,m.layers,m.availableImages,t,r,f,function(pn,Hn,En){return en||(en=Ga(pn)),Hn.queryIntersectsFeature(F,pn,En,en,v.z,e.transform,_,e.pixelPosMatrix)})}},Gt=0;Gt<q.length;Gt++)Mt(Gt);return et},df.prototype.loadMatchingFeature=function(e,t,r,f,v,m,_,A,F,Z,K){var q=this.bucketLayerIDs[t];if(!m||function(pn,Hn){for(var En=0;En<pn.length;En++)if(Hn.indexOf(pn[En])>=0)return!0;return!1}(m,q)){var ue=this.sourceLayerCoder.decode(r),de=this.vtLayers[ue].feature(f);if(v.needGeometry){var je=no(de,!0);if(!v.filter(new Bi(this.tileID.overscaledZ),je,this.tileID.canonical))return}else if(!v.filter(new Bi(this.tileID.overscaledZ),de))return;for(var Xe=this.getId(de,ue),st=0;st<q.length;st++){var et=q[st];if(!(m&&m.indexOf(et)<0)){var Mt=A[et];if(Mt){var Gt={};Xe!==void 0&&Z&&(Gt=Z.getState(Mt.sourceLayer||"_geojsonTileLayer",Xe));var ir=Yt({},F[et]);ir.paint=xp(ir.paint,Mt.paint,de,Gt,_),ir.layout=xp(ir.layout,Mt.layout,de,Gt,_);var cr=!K||K(de,Mt,Gt);if(cr){var Ar=new Vh(de,this.z,this.x,this.y,Xe);Ar.layer=ir;var en=e[et];en===void 0&&(en=e[et]=[]),en.push({featureIndex:f,feature:Ar,intersectionZ:cr})}}}}}},df.prototype.lookupSymbolFeatures=function(e,t,r,f,v,m,_,A){var F={};this.loadVTLayers();for(var Z=kl(v),K=0,q=e;K<q.length;K+=1)this.loadMatchingFeature(F,r,f,q[K],Z,m,_,A,t);return F},df.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},df.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},wn("FeatureIndex",df,{omit:["rawTileData","sourceLayerCoder"]});var ws=function(e,t){this.tileID=e,this.uid=Lt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ws.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<un.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},ws.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ws.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Z,K){var q={};if(!K)return q;for(var ue=function(){var Xe=je[de],st=Xe.layerIds.map(function(Gt){return K.getLayer(Gt)}).filter(Boolean);if(st.length!==0){Xe.layers=st,Xe.stateDependentLayerIds&&(Xe.stateDependentLayers=Xe.stateDependentLayerIds.map(function(Gt){return st.filter(function(ir){return ir.id===Gt})[0]}));for(var et=0,Mt=st;et<Mt.length;et+=1)q[Mt[et].id]=Xe}},de=0,je=Z;de<je.length;de+=1)ue();return q}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof Xt){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var _=this.buckets[m];if(_ instanceof Xt&&_.hasRTLText){this.hasRTLText=!0,Is.isLoading()||Is.isLoaded()||yc()!=="deferred"||cu();break}}for(var A in this.queryPadding=0,this.buckets){var F=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(A).queryRadius(F))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},ws.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ws.prototype.getBucket=function(e){return this.buckets[e.id]},ws.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ff(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ff(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},ws.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},ws.prototype.queryRenderedFeatures=function(e,t,r,f,v,m,_,A,F,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:Z,transform:A,params:_,queryPadding:this.queryPadding*F},e,t,r):{}},ws.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",m=f._geojsonTileLayer||f[v];if(m)for(var _=kl(t&&t.filter),A=this.tileID.canonical,F=A.z,Z=A.x,K=A.y,q={z:F,x:Z,y:K},ue=0;ue<m.length;ue++){var de=m.feature(ue);if(_.needGeometry){var je=no(de,!0);if(!_.filter(new Bi(this.tileID.overscaledZ),je,this.tileID.canonical))continue}else if(!_.filter(new Bi(this.tileID.overscaledZ),de))continue;var Xe=r.getId(de,v),st=new Vh(de,F,Z,K,Xe);st.tile=q,e.push(st)}}},ws.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ws.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ws.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=gr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=f+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ws.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ws.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],m=v.layers[0].sourceLayer||"_geojsonTileLayer",_=r[m],A=e[m];if(_&&A&&Object.keys(A).length!==0){v.update(A,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=t&&t.style&&t.style.getLayer(f);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}}},ws.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ws.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<un.now()},ws.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ws.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=un.now()+e},ws.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},ws.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var m=0,_=t;m<_.length;m+=1)if(v[_[m]])return!0}}return!1};var vf=k.performance,Yp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},vf.mark(this._marks.start)};Yp.prototype.finish=function(){vf.mark(this._marks.end);var e=vf.getEntriesByName(this._marks.measure);return e.length===0&&(vf.measure(this._marks.measure,this._marks.start,this._marks.end),e=vf.getEntriesByName(this._marks.measure),vf.clearMarks(this._marks.start),vf.clearMarks(this._marks.end),vf.clearMeasures(this._marks.measure)),e},d.Actor=Bf,d.AlphaImage=Ws,d.CanonicalTileID=hf,d.CollisionBoxArray=u,d.Color=Fi,d.DEMData=pf,d.DataConstantProperty=Un,d.DictionaryCoder=jh,d.EXTENT=8192,d.ErrorEvent=fe,d.EvaluationParameters=Bi,d.Event=re,d.Evented=Se,d.FeatureIndex=df,d.FillBucket=Ss,d.FillExtrusionBucket=il,d.ImageAtlas=Xn,d.ImagePosition=Rr,d.LineBucket=nu,d.LngLat=mo,d.LngLatBounds=es,d.MercatorCoordinate=Jc,d.ONE_EM=24,d.OverscaledTileID=Vo,d.Point=$,d.Point$1=$,d.Properties=zo,d.Protobuf=Te,d.RGBAImage=Uo,d.RequestManager=Dt,d.RequestPerformance=Yp,d.ResourceType=pr,d.SegmentVector=ye,d.SourceFeatureState=Nf,d.StructArrayLayout1ui2=sf,d.StructArrayLayout2f1f2i16=ml,d.StructArrayLayout2i4=Fu,d.StructArrayLayout3ui6=gl,d.StructArrayLayout4i8=_c,d.SymbolBucket=Xt,d.Texture=Ff,d.Tile=ws,d.Transitionable=Ao,d.Uniform1f=tn,d.Uniform1i=Lr,d.Uniform2f=Xr,d.Uniform3f=yn,d.Uniform4f=Fn,d.UniformColor=Vn,d.UniformMatrix4f=Qi,d.UnwrappedTileID=Wp,d.ValidationError=me,d.WritingMode=Kn,d.ZoomHistory=dl,d.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},d.addDynamicAttributes=Ie,d.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),m=null;e.forEach(function(_,A){t(_,function(F,Z){F&&(m=F),v[A]=Z,--f==0&&r(m,v)})})},d.bezier=Be,d.bindAll=Ir,d.browser=un,d.cacheEntryPossiblyAdded=function(e){++Rt>ht&&(e.getActor().send("enforceCacheSizeLimit",yt),Rt=0)},d.clamp=$e,d.clearTileCache=function(e){var t=k.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},d.clipLine=li,d.clone=function(e){var t=new qi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},d.clone$1=Ke,d.clone$2=function(e){var t=new qi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},d.collisionCircleLayout=mp,d.config=tr,d.create=function(){var e=new qi(16);return qi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},d.create$1=function(){var e=new qi(9);return qi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},d.create$2=function(){var e=new qi(4);return qi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},d.createCommonjsModule=b,d.createExpression=ec,d.createLayout=po,d.createStyleLayer=function(e){return e.type==="custom"?new Co(e):new yu[e.type](e)},d.cross=function(e,t,r){var f=t[0],v=t[1],m=t[2],_=r[0],A=r[1],F=r[2];return e[0]=v*F-m*A,e[1]=m*_-f*F,e[2]=f*A-v*_,e},d.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},d.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},d.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},d.ease=We,d.emitValidationErrors=$u,d.endsWith=er,d.enforceCacheSizeLimit=function(e){fr(),Kt&&Kt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},d.evaluateSizeForFeature=Qo,d.evaluateSizeForZoom=ys,d.evaluateVariableOffset=it,d.evented=Zc,d.extend=Yt,d.featureFilter=kl,d.filterObject=xt,d.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},d.getAnchorAlignment=Jo,d.getAnchorJustification=Ot,d.getArrayBuffer=ia,d.getImage=ie,d.getJSON=function(e,t){return Ri(Yt(e,{type:"json"}),t)},d.getRTLTextPluginStatus=yc,d.getReferrer=Pn,d.getVideo=function(e,t){var r,f,v=k.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var _=k.document.createElement("source");r=e[m],f=void 0,(f=k.document.createElement("a")).href=r,(f.protocol!==k.document.location.protocol||f.host!==k.document.location.host)&&(v.crossOrigin="Anonymous"),_.src=e[m],v.appendChild(_)}return{cancel:function(){}}},d.identity=ao,d.invert=function(e,t){var r=t[0],f=t[1],v=t[2],m=t[3],_=t[4],A=t[5],F=t[6],Z=t[7],K=t[8],q=t[9],ue=t[10],de=t[11],je=t[12],Xe=t[13],st=t[14],et=t[15],Mt=r*A-f*_,Gt=r*F-v*_,ir=r*Z-m*_,cr=f*F-v*A,Ar=f*Z-m*A,en=v*Z-m*F,pn=K*Xe-q*je,Hn=K*st-ue*je,En=K*et-de*je,ei=q*st-ue*Xe,Tn=q*et-de*Xe,Vi=ue*et-de*st,mi=Mt*Vi-Gt*Tn+ir*ei+cr*En-Ar*Hn+en*pn;return mi?(e[0]=(A*Vi-F*Tn+Z*ei)*(mi=1/mi),e[1]=(v*Tn-f*Vi-m*ei)*mi,e[2]=(Xe*en-st*Ar+et*cr)*mi,e[3]=(ue*Ar-q*en-de*cr)*mi,e[4]=(F*En-_*Vi-Z*Hn)*mi,e[5]=(r*Vi-v*En+m*Hn)*mi,e[6]=(st*ir-je*en-et*Gt)*mi,e[7]=(K*en-ue*ir+de*Gt)*mi,e[8]=(_*Tn-A*En+Z*pn)*mi,e[9]=(f*En-r*Tn-m*pn)*mi,e[10]=(je*Ar-Xe*ir+et*Mt)*mi,e[11]=(q*ir-K*Ar-de*Mt)*mi,e[12]=(A*Hn-_*ei-F*pn)*mi,e[13]=(r*ei-f*Hn+v*pn)*mi,e[14]=(Xe*Gt-je*cr-st*Mt)*mi,e[15]=(K*cr-q*Gt+ue*Mt)*mi,e):null},d.isChar=Kr,d.isMapboxURL=E,d.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},d.makeRequest=Ri,d.mapObject=nr,d.mercatorXfromLng=lh,d.mercatorYfromLat=Uh,d.mercatorZfromAltitude=gp,d.mul=tl,d.multiply=ko,d.mvt=Kc,d.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},d.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],m=r*r+f*f+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},d.number=ho,d.offscreenCanvasSupported=Qt,d.ortho=function(e,t,r,f,v,m,_){var A=1/(t-r),F=1/(f-v),Z=1/(m-_);return e[0]=-2*A,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*F,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Z,e[11]=0,e[12]=(t+r)*A,e[13]=(v+f)*F,e[14]=(_+m)*Z,e[15]=1,e},d.parseGlyphPBF=function(e){return new Te(e).readFields(Fr,[])},d.pbf=Te,d.performSymbolLayout=function(e,t,r,f,v,m,_){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var A=e.layers[0].layout,F=e.layers[0]._unevaluatedLayout._values,Z={};if(e.textSizeData.kind==="composite"){var K=e.textSizeData,q=K.maxZoom;Z.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Bi(K.minZoom),_),F["text-size"].possiblyEvaluate(new Bi(q),_)]}if(e.iconSizeData.kind==="composite"){var ue=e.iconSizeData,de=ue.maxZoom;Z.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Bi(ue.minZoom),_),F["icon-size"].possiblyEvaluate(new Bi(de),_)]}Z.layoutTextSize=F["text-size"].possiblyEvaluate(new Bi(e.zoom+1),_),Z.layoutIconSize=F["icon-size"].possiblyEvaluate(new Bi(e.zoom+1),_),Z.textMaxSize=F["text-size"].possiblyEvaluate(new Bi(18));for(var je=24*A.get("text-line-height"),Xe=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",st=A.get("text-keep-upright"),et=A.get("text-size"),Mt=function(){var cr=ir[Gt],Ar=A.get("text-font").evaluate(cr,{},_).join(","),en=et.evaluate(cr,{},_),pn=Z.layoutTextSize.evaluate(cr,{},_),Hn=Z.layoutIconSize.evaluate(cr,{},_),En={horizontal:{},vertical:void 0},ei=cr.text,Tn=[0,0];if(ei){var Vi=ei.toString(),mi=24*A.get("text-letter-spacing").evaluate(cr,{},_),Bn=function(na){for(var Ia=0,Da=na;Ia<Da.length;Ia+=1)if(pa=Da[Ia].charCodeAt(0),Kr.Arabic(pa)||Kr["Arabic Supplement"](pa)||Kr["Arabic Extended-A"](pa)||Kr["Arabic Presentation Forms-A"](pa)||Kr["Arabic Presentation Forms-B"](pa))return!1;var pa;return!0}(Vi)?mi:0,ta=A.get("text-anchor").evaluate(cr,{},_),Li=A.get("text-variable-anchor");if(!Li){var la=A.get("text-radial-offset").evaluate(cr,{},_);Tn=la?it(ta,[24*la,xe]):A.get("text-offset").evaluate(cr,{},_).map(function(na){return 24*na})}var Jn=Xe?"center":A.get("text-justify").evaluate(cr,{},_),zi=A.get("symbol-placement"),uo=zi==="point"?24*A.get("text-max-width").evaluate(cr,{},_):0,lo=function(){e.allowVerticalPlacement&&Bc(Vi)&&(En.vertical=Mr(ei,t,r,v,Ar,uo,je,ta,"left",Bn,Tn,Kn.vertical,!0,zi,pn,en))};if(!Xe&&Li){for(var Go=Jn==="auto"?Li.map(function(na){return Ot(na)}):[Jn],go=!1,Ho=0;Ho<Go.length;Ho++){var Bs=Go[Ho];if(!En.horizontal[Bs])if(go)En.horizontal[Bs]=En.horizontal[0];else{var ts=Mr(ei,t,r,v,Ar,uo,je,"center",Bs,Bn,Tn,Kn.horizontal,!1,zi,pn,en);ts&&(En.horizontal[Bs]=ts,go=ts.positionedLines.length===1)}}lo()}else{Jn==="auto"&&(Jn=Ot(ta));var Cs=Mr(ei,t,r,v,Ar,uo,je,ta,Jn,Bn,Tn,Kn.horizontal,!1,zi,pn,en);Cs&&(En.horizontal[Jn]=Cs),lo(),Bc(Vi)&&Xe&&st&&(En.vertical=Mr(ei,t,r,v,Ar,uo,je,ta,Jn,Bn,Tn,Kn.vertical,!1,zi,pn,en))}}var Ts=void 0,iu=!1;if(cr.icon&&cr.icon.name){var Wo=f[cr.icon.name];Wo&&(Ts=function(na,Ia,Da){var pa=Jo(Da),As=Ia[0]-na.displaySize[0]*pa.horizontalAlign,au=Ia[1]-na.displaySize[1]*pa.verticalAlign;return{image:na,top:au,bottom:au+na.displaySize[1],left:As,right:As+na.displaySize[0]}}(v[cr.icon.name],A.get("icon-offset").evaluate(cr,{},_),A.get("icon-anchor").evaluate(cr,{},_)),iu=Wo.sdf,e.sdfIcons===void 0?e.sdfIcons=Wo.sdf:e.sdfIcons!==Wo.sdf&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wo.pixelRatio!==e.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Bo=ut(En.horizontal)||En.vertical;e.iconsInText=!!Bo&&Bo.iconsInText,(Bo||Ts)&&function(na,Ia,Da,pa,As,au,yo,xs,_u,Ea,mf){var Kl=au.textMaxSize.evaluate(Ia,{});Kl===void 0&&(Kl=yo);var gf,us=na.layers[0].layout,Cc=us.get("icon-offset").evaluate(Ia,{},mf),Al=ut(Da.horizontal),ch=yo/24,Tf=na.tilePixelRatio*ch,$f=na.tilePixelRatio*Kl/24,Af=na.tilePixelRatio*xs,zf=na.tilePixelRatio*us.get("symbol-spacing"),Gh=us.get("text-padding")*na.tilePixelRatio,fh=us.get("icon-padding")*na.tilePixelRatio,Jf=us.get("text-max-angle")/180*Math.PI,Hh=us.get("text-rotation-alignment")==="map"&&us.get("symbol-placement")!=="point",Sp=us.get("icon-rotation-alignment")==="map"&&us.get("symbol-placement")!=="point",lc=us.get("symbol-placement"),hh=zf/2,ph=us.get("icon-text-fit");pa&&ph!=="none"&&(na.allowVerticalPlacement&&Da.vertical&&(gf=$i(pa,Da.vertical,ph,us.get("icon-text-fit-padding"),Cc,ch)),Al&&(pa=$i(pa,Al,ph,us.get("icon-text-fit-padding"),Cc,ch)));var Pl=function(bh,Sh){Sh.x<0||Sh.x>=8192||Sh.y<0||Sh.y>=8192||function(Xo,Io,Id,Mf,Ba,$p,If,Ml,Qh,Eh,qh,ep,Cp,Tp,eh,Jp,Qp,qp,Ap,ed,ol,tp,td,ef,Od){var rd,jf,th,Vf,rh,nh=Xo.addToLineVertexArray(Io,Id),nd=0,Pp=0,id=0,ad=0,Mp=-1,Ip=-1,yf={},od=Ne(""),rp=0,Op=0;if(Ml._unevaluatedLayout.getValue("text-radial-offset")===void 0?(rp=(rd=Ml.layout.get("text-offset").evaluate(ol,{},ef).map(function(Ch){return 24*Ch}))[0],Op=rd[1]):(rp=24*Ml.layout.get("text-radial-offset").evaluate(ol,{},ef),Op=xe),Xo.allowVerticalPlacement&&Mf.vertical){var sd=Ml.layout.get("text-rotate").evaluate(ol,{},ef)+90;Vf=new Ue(Qh,Io,Eh,qh,ep,Mf.vertical,Cp,Tp,eh,sd),If&&(rh=new Ue(Qh,Io,Eh,qh,ep,If,Qp,qp,eh,sd))}if(Ba){var Lp=Ml.layout.get("icon-rotate").evaluate(ol,{}),ud=Ml.layout.get("icon-text-fit")!=="none",ld=Wi(Ba,Lp,td,ud),Rp=If?Wi(If,Lp,td,ud):void 0;th=new Ue(Qh,Io,Eh,qh,ep,Ba,Qp,qp,!1,Lp),nd=4*ld.length;var cd=Xo.iconSizeData,wh=null;cd.kind==="source"?(wh=[128*Ml.layout.get("icon-size").evaluate(ol,{})])[0]>32640&&Fe(Xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cd.kind==="composite"&&((wh=[128*tp.compositeIconSizes[0].evaluate(ol,{},ef),128*tp.compositeIconSizes[1].evaluate(ol,{},ef)])[0]>32640||wh[1]>32640)&&Fe(Xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Xo.addSymbols(Xo.icon,ld,wh,ed,Ap,ol,!1,Io,nh.lineStartIndex,nh.lineLength,-1,ef),Mp=Xo.icon.placedSymbolArray.length-1,Rp&&(Pp=4*Rp.length,Xo.addSymbols(Xo.icon,Rp,wh,ed,Ap,ol,Kn.vertical,Io,nh.lineStartIndex,nh.lineLength,-1,ef),Ip=Xo.icon.placedSymbolArray.length-1)}for(var Dp in Mf.horizontal){var np=Mf.horizontal[Dp];if(!jf){od=Ne(np.text);var Ld=Ml.layout.get("text-rotate").evaluate(ol,{},ef);jf=new Ue(Qh,Io,Eh,qh,ep,np,Cp,Tp,eh,Ld)}var fd=np.positionedLines.length===1;if(id+=At(Xo,Io,np,$p,Ml,eh,ol,Jp,nh,Mf.vertical?Kn.horizontal:Kn.horizontalOnly,fd?Object.keys(Mf.horizontal):[Dp],yf,Mp,tp,ef),fd)break}Mf.vertical&&(ad+=At(Xo,Io,Mf.vertical,$p,Ml,eh,ol,Jp,nh,Kn.vertical,["vertical"],yf,Ip,tp,ef));var hd=jf?jf.boxStartIndex:Xo.collisionBoxArray.length,Rd=jf?jf.boxEndIndex:Xo.collisionBoxArray.length,Dd=Vf?Vf.boxStartIndex:Xo.collisionBoxArray.length,kd=Vf?Vf.boxEndIndex:Xo.collisionBoxArray.length,Fd=th?th.boxStartIndex:Xo.collisionBoxArray.length,Bd=th?th.boxEndIndex:Xo.collisionBoxArray.length,Nd=rh?rh.boxStartIndex:Xo.collisionBoxArray.length,pd=rh?rh.boxEndIndex:Xo.collisionBoxArray.length,tf=-1,ip=function(Ch,vd){return Ch&&Ch.circleDiameter?Math.max(Ch.circleDiameter,vd):vd};tf=ip(jf,tf),tf=ip(Vf,tf),tf=ip(th,tf);var dd=(tf=ip(rh,tf))>-1?1:0;dd&&(tf*=Od/24),Xo.glyphOffsetArray.length>=Xt.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ol.sortKey!==void 0&&Xo.addToSortKeyRanges(Xo.symbolInstances.length,ol.sortKey),Xo.symbolInstances.emplaceBack(Io.x,Io.y,yf.right>=0?yf.right:-1,yf.center>=0?yf.center:-1,yf.left>=0?yf.left:-1,yf.vertical||-1,Mp,Ip,od,hd,Rd,Dd,kd,Fd,Bd,Nd,pd,Eh,id,ad,nd,Pp,dd,0,Cp,rp,Op,tf)}(na,Sh,bh,Da,pa,As,gf,na.layers[0],na.collisionBoxArray,Ia.index,Ia.sourceLayerIndex,na.index,Tf,Gh,Hh,_u,Af,fh,Sp,Cc,Ia,au,Ea,mf,yo)};if(lc==="line")for(var Zf=0,Uf=li(Ia.geometry,0,0,8192,8192);Zf<Uf.length;Zf+=1)for(var Wh=Uf[Zf],dh=0,qc=Sa(Wh,zf,Jf,Da.vertical||Al,pa,24,$f,na.overscaling,8192);dh<qc.length;dh+=1){var Xh=qc[dh];Al&&at(na,Al.text,hh,Xh)||Pl(Wh,Xh)}else if(lc==="line-center")for(var vh=0,Yh=Ia.geometry;vh<Yh.length;vh+=1){var Kh=Yh[vh];if(Kh.length>1){var Ep=Fs(Kh,Jf,Da.vertical||Al,pa,24,$f);Ep&&Pl(Kh,Ep)}}else if(Ia.type==="Polygon")for(var mh=0,wp=wo(Ia.geometry,0);mh<wp.length;mh+=1){var gh=wp[mh],$h=Cn(gh,16);Pl(gh[0],new vo($h.x,$h.y,0))}else if(Ia.type==="LineString")for(var Pf=0,Qf=Ia.geometry;Pf<Qf.length;Pf+=1){var yh=Qf[Pf];Pl(yh,new vo(yh[0].x,yh[0].y,0))}else if(Ia.type==="Point")for(var _h=0,qf=Ia.geometry;_h<qf.length;_h+=1)for(var Kp=0,Jh=qf[_h];Kp<Jh.length;Kp+=1){var xh=Jh[Kp];Pl([xh],new vo(xh.x,xh.y,0))}}(e,cr,En,Ts,f,Z,pn,Hn,Tn,iu,_)},Gt=0,ir=e.features;Gt<ir.length;Gt+=1)Mt();m&&e.generateCollisionDebugBuffers()},d.perspective=function(e,t,r,f,v){var m,_=1/Math.tan(t/2);return e[0]=_/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(m=1/(f-v)),e[14]=2*v*f*m):(e[10]=-1,e[14]=-2*f),e},d.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},d.plugin=Is,d.polygonIntersectsPolygon=el,d.postMapLoadEvent=Je,d.postTurnstileEvent=Tr,d.potpack=sn,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.register=wn,d.registerForPluginStateChange=function(e){return e({pluginStatus:Gs,pluginURL:Qu}),Zc.on("pluginStateChange",e),e},d.renderColorRamp=Rf,d.rotate=function(e,t,r){var f=t[0],v=t[1],m=t[2],_=t[3],A=Math.sin(r),F=Math.cos(r);return e[0]=f*F+m*A,e[1]=v*F+_*A,e[2]=f*-A+m*F,e[3]=v*-A+_*F,e},d.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[4],_=t[5],A=t[6],F=t[7],Z=t[8],K=t[9],q=t[10],ue=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+Z*f,e[5]=_*v+K*f,e[6]=A*v+q*f,e[7]=F*v+ue*f,e[8]=Z*v-m*f,e[9]=K*v-_*f,e[10]=q*v-A*f,e[11]=ue*v-F*f,e},d.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[0],_=t[1],A=t[2],F=t[3],Z=t[4],K=t[5],q=t[6],ue=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+Z*f,e[1]=_*v+K*f,e[2]=A*v+q*f,e[3]=F*v+ue*f,e[4]=Z*v-m*f,e[5]=K*v-_*f,e[6]=q*v-A*f,e[7]=ue*v-F*f,e},d.scale=function(e,t,r){var f=r[0],v=r[1],m=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},d.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},d.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},d.setCacheLimits=function(e,t){yt=e,ht=t},d.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Gs==="deferred"||Gs==="loading"||Gs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Qu=un.resolveURL(e),Gs="deferred",zc=t,Du(),r||cu()},d.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},d.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},d.styleSpec=te,d.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},d.symbolSize=Es,d.transformMat3=function(e,t,r){var f=t[0],v=t[1],m=t[2];return e[0]=f*r[0]+v*r[3]+m*r[6],e[1]=f*r[1]+v*r[4]+m*r[7],e[2]=f*r[2]+v*r[5]+m*r[8],e},d.transformMat4=vu,d.translate=function(e,t,r){var f,v,m,_,A,F,Z,K,q,ue,de,je,Xe=r[0],st=r[1],et=r[2];return t===e?(e[12]=t[0]*Xe+t[4]*st+t[8]*et+t[12],e[13]=t[1]*Xe+t[5]*st+t[9]*et+t[13],e[14]=t[2]*Xe+t[6]*st+t[10]*et+t[14],e[15]=t[3]*Xe+t[7]*st+t[11]*et+t[15]):(v=t[1],m=t[2],_=t[3],A=t[4],F=t[5],Z=t[6],K=t[7],q=t[8],ue=t[9],de=t[10],je=t[11],e[0]=f=t[0],e[1]=v,e[2]=m,e[3]=_,e[4]=A,e[5]=F,e[6]=Z,e[7]=K,e[8]=q,e[9]=ue,e[10]=de,e[11]=je,e[12]=f*Xe+A*st+q*et+t[12],e[13]=v*Xe+F*st+ue*et+t[13],e[14]=m*Xe+Z*st+de*et+t[14],e[15]=_*Xe+K*st+je*et+t[15]),e},d.triggerPluginCompletionEvent=Nl,d.uniqueId=Lt,d.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},d.validateLight=Of,d.validateStyle=ic,d.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},d.vectorTile=Kc,d.version="1.13.1",d.warnOnce=Fe,d.webpSupported=se,d.window=k,d.wrap=Ut}),w(["./shared"],function(d){"use strict";function b(G){var ie=typeof G;if(ie==="number"||ie==="boolean"||ie==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var ce="[",B=0,re=G;B<re.length;B+=1)ce+=b(re[B])+",";return ce+"]"}for(var fe=Object.keys(G).sort(),Se="{",te=0;te<fe.length;te++)Se+=JSON.stringify(fe[te])+":"+b(G[fe[te]])+",";return Se+"}"}function Y(G){for(var ie="",ce=0,B=d.refProperties;ce<B.length;ce+=1)ie+="/"+b(G[B[ce]]);return ie}var W=function(G){this.keyCache={},G&&this.replace(G)};W.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},W.prototype.update=function(G,ie){for(var ce=this,B=0,re=G;B<re.length;B+=1){var fe=re[B];this._layerConfigs[fe.id]=fe;var Se=this._layers[fe.id]=d.createStyleLayer(fe);Se._featureFilter=d.featureFilter(Se.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(var te=0,me=ie;te<me.length;te+=1){var ct=me[te];delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct]}this.familiesBySource={};for(var yr=0,Or=function(Wr,ln){for(var Ei={},hn=0;hn<Wr.length;hn++){var wi=ln&&ln[Wr[hn].id]||Y(Wr[hn]);ln&&(ln[Wr[hn].id]=wi);var Yi=Ei[wi];Yi||(Yi=Ei[wi]=[]),Yi.push(Wr[hn])}var Yn=[];for(var Di in Ei)Yn.push(Ei[Di]);return Yn}(d.values(this._layerConfigs),this.keyCache);yr<Or.length;yr+=1){var Ft=Or[yr].map(function(Wr){return ce._layers[Wr.id]}),kr=Ft[0];if(kr.visibility!=="none"){var bn=kr.source||"",gn=this.familiesBySource[bn];gn||(gn=this.familiesBySource[bn]={});var mr=kr.sourceLayer||"_geojsonTileLayer",dn=gn[mr];dn||(dn=gn[mr]=[]),dn.push(Ft)}}};var $=function(G){var ie={},ce=[];for(var B in G){var re=G[B],fe=ie[B]={};for(var Se in re){var te=re[+Se];if(te&&te.bitmap.width!==0&&te.bitmap.height!==0){var me={x:0,y:0,w:te.bitmap.width+2,h:te.bitmap.height+2};ce.push(me),fe[Se]={rect:me,metrics:te.metrics}}}}var ct=d.potpack(ce),yr=new d.AlphaImage({width:ct.w||1,height:ct.h||1});for(var Or in G){var Ft=G[Or];for(var kr in Ft){var bn=Ft[+kr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var gn=ie[Or][kr].rect;d.AlphaImage.copy(bn.bitmap,yr,{x:0,y:0},{x:gn.x+1,y:gn.y+1},bn.bitmap)}}}this.image=yr,this.positions=ie};d.register("GlyphAtlas",$);var I=function(G){this.tileID=new d.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function k(G,ie,ce){for(var B=new d.EvaluationParameters(ie),re=0,fe=G;re<fe.length;re+=1)fe[re].recalculate(B,ce)}function we(G,ie){var ce=d.getArrayBuffer(G.request,function(B,re,fe,Se){B?ie(B):re&&ie(null,{vectorTile:new d.vectorTile.VectorTile(new d.pbf(re)),rawData:re,cacheControl:fe,expires:Se})});return function(){ce.cancel(),ie()}}I.prototype.parse=function(G,ie,ce,B,re){var fe=this;this.status="parsing",this.data=G,this.collisionBoxArray=new d.CollisionBoxArray;var Se=new d.DictionaryCoder(Object.keys(G.layers).sort()),te=new d.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];var me,ct,yr,Or,Ft={},kr={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},bn=ie.familiesBySource[this.source];for(var gn in bn){var mr=G.layers[gn];if(mr){mr.version===1&&d.warnOnce('Vector tile source "'+this.source+'" layer "'+gn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var dn=Se.encode(gn),Wr=[],ln=0;ln<mr.length;ln++){var Ei=mr.feature(ln),hn=te.getId(Ei,gn);Wr.push({feature:Ei,id:hn,index:ln,sourceLayerIndex:dn})}for(var wi=0,Yi=bn[gn];wi<Yi.length;wi+=1){var Yn=Yi[wi],Di=Yn[0];Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(k(Yn,this.zoom,ce),(Ft[Di.id]=Di.createBucket({index:te.bucketLayerIDs.length,layers:Yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dn,sourceID:this.source})).populate(Wr,kr,this.tileID.canonical),te.bucketLayerIDs.push(Yn.map(function(Ai){return Ai.id})))}}}var ki=d.mapObject(kr.glyphDependencies,function(Ai){return Object.keys(Ai).map(Number)});Object.keys(ki).length?B.send("getGlyphs",{uid:this.uid,stacks:ki},function(Ai,Qn){me||(me=Ai,ct=Qn,ai.call(fe))}):ct={};var za=Object.keys(kr.iconDependencies);za.length?B.send("getImages",{icons:za,source:this.source,tileID:this.tileID,type:"icons"},function(Ai,Qn){me||(me=Ai,yr=Qn,ai.call(fe))}):yr={};var Wn=Object.keys(kr.patternDependencies);function ai(){if(me)return re(me);if(ct&&yr&&Or){var Ai=new $(ct),Qn=new d.ImageAtlas(yr,Or);for(var Fi in Ft){var ya=Ft[Fi];ya instanceof d.SymbolBucket?(k(ya.layers,this.zoom,ce),d.performSymbolLayout(ya,ct,Ai.positions,yr,Qn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ya.hasPattern&&(ya instanceof d.LineBucket||ya instanceof d.FillBucket||ya instanceof d.FillExtrusionBucket)&&(k(ya.layers,this.zoom,ce),ya.addFeatures(kr,this.tileID.canonical,Qn.patternPositions))}this.status="done",re(null,{buckets:d.values(Ft).filter(function(Xa){return!Xa.isEmpty()}),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ai.image,imageAtlas:Qn,glyphMap:this.returnDependencies?ct:null,iconMap:this.returnDependencies?yr:null,glyphPositions:this.returnDependencies?Ai.positions:null})}}Wn.length?B.send("getImages",{icons:Wn,source:this.source,tileID:this.tileID,type:"patterns"},function(Ai,Qn){me||(me=Ai,Or=Qn,ai.call(fe))}):Or={},ai.call(this)};var Be=function(G,ie,ce,B){this.actor=G,this.layerIndex=ie,this.availableImages=ce,this.loadVectorData=B||we,this.loading={},this.loaded={}};Be.prototype.loadTile=function(G,ie){var ce=this,B=G.uid;this.loading||(this.loading={});var re=!!(G&&G.request&&G.request.collectResourceTiming)&&new d.RequestPerformance(G.request),fe=this.loading[B]=new I(G);fe.abort=this.loadVectorData(G,function(Se,te){if(delete ce.loading[B],Se||!te)return fe.status="done",ce.loaded[B]=fe,ie(Se);var me=te.rawData,ct={};te.expires&&(ct.expires=te.expires),te.cacheControl&&(ct.cacheControl=te.cacheControl);var yr={};if(re){var Or=re.finish();Or&&(yr.resourceTiming=JSON.parse(JSON.stringify(Or)))}fe.vectorTile=te.vectorTile,fe.parse(te.vectorTile,ce.layerIndex,ce.availableImages,ce.actor,function(Ft,kr){if(Ft||!kr)return ie(Ft);ie(null,d.extend({rawTileData:me.slice(0)},kr,ct,yr))}),ce.loaded=ce.loaded||{},ce.loaded[B]=fe})},Be.prototype.reloadTile=function(G,ie){var ce=this,B=this.loaded,re=G.uid,fe=this;if(B&&B[re]){var Se=B[re];Se.showCollisionBoxes=G.showCollisionBoxes;var te=function(me,ct){var yr=Se.reloadCallback;yr&&(delete Se.reloadCallback,Se.parse(Se.vectorTile,fe.layerIndex,ce.availableImages,fe.actor,yr)),ie(me,ct)};Se.status==="parsing"?Se.reloadCallback=te:Se.status==="done"&&(Se.vectorTile?Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}},Be.prototype.abortTile=function(G,ie){var ce=this.loading,B=G.uid;ce&&ce[B]&&ce[B].abort&&(ce[B].abort(),delete ce[B]),ie()},Be.prototype.removeTile=function(G,ie){var ce=this.loaded,B=G.uid;ce&&ce[B]&&delete ce[B],ie()};var We=d.window.ImageBitmap,$e=function(){this.loaded={}};function Ut(G,ie){if(G.length!==0){Yt(G[0],ie);for(var ce=1;ce<G.length;ce++)Yt(G[ce],!ie)}}function Yt(G,ie){for(var ce=0,B=0,re=G.length,fe=re-1;B<re;fe=B++)ce+=(G[B][0]-G[fe][0])*(G[fe][1]+G[B][1]);ce>=0!=!!ie&&G.reverse()}$e.prototype.loadTile=function(G,ie){var ce=G.uid,B=G.encoding,re=G.rawImageData,fe=We&&re instanceof We?this.getImageData(re):re,Se=new d.DEMData(ce,fe,B);this.loaded=this.loaded||{},this.loaded[ce]=Se,ie(null,Se)},$e.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:ie.width,height:ie.height},ie.data)},$e.prototype.removeTile=function(G){var ie=this.loaded,ce=G.uid;ie&&ie[ce]&&delete ie[ce]};var kt=d.vectorTile.VectorTileFeature.prototype.toGeoJSON,Lt=function(G){this._feature=G,this.extent=d.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};Lt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],ie=0,ce=this._feature.geometry;ie<ce.length;ie+=1){var B=ce[ie];G.push([new d.Point$1(B[0],B[1])])}return G}for(var re=[],fe=0,Se=this._feature.geometry;fe<Se.length;fe+=1){for(var te=[],me=0,ct=Se[fe];me<ct.length;me+=1){var yr=ct[me];te.push(new d.Point$1(yr[0],yr[1]))}re.push(te)}return re},Lt.prototype.toGeoJSON=function(G,ie,ce){return kt.call(this,G,ie,ce)};var bt=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=G.length,this._features=G};bt.prototype.feature=function(G){return new Lt(this._features[G])};var pt=d.vectorTile.VectorTileFeature,Ir=er;function er(G,ie){this.options=ie||{},this.features=G,this.length=G.length}function nr(G,ie){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=ie||4096}er.prototype.feature=function(G){return new nr(this.features[G],this.options.extent)},nr.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var ie=0;ie<G.length;ie++){for(var ce=G[ie],B=[],re=0;re<ce.length;re++)B.push(new d.Point$1(ce[re][0],ce[re][1]));this.geometry.push(B)}return this.geometry},nr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,ie=1/0,ce=-1/0,B=1/0,re=-1/0,fe=0;fe<G.length;fe++)for(var Se=G[fe],te=0;te<Se.length;te++){var me=Se[te];ie=Math.min(ie,me.x),ce=Math.max(ce,me.x),B=Math.min(B,me.y),re=Math.max(re,me.y)}return[ie,B,ce,re]},nr.prototype.toGeoJSON=pt.prototype.toGeoJSON;var xt=_t,Ke=Ir;function _t(G){var ie=new d.pbf;return function(ce,B){for(var re in ce.layers)B.writeMessage(3,Fe,ce.layers[re])}(G,ie),ie.finish()}function Fe(G,ie){var ce;ie.writeVarintField(15,G.version||1),ie.writeStringField(1,G.name||""),ie.writeVarintField(5,G.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<G.length;ce++)B.feature=G.feature(ce),ie.writeMessage(2,Pe,B);var re=B.keys;for(ce=0;ce<re.length;ce++)ie.writeStringField(3,re[ce]);var fe=B.values;for(ce=0;ce<fe.length;ce++)ie.writeMessage(4,Ae,fe[ce])}function Pe(G,ie){var ce=G.feature;ce.id!==void 0&&ie.writeVarintField(1,ce.id),ie.writeMessage(2,Ve,G),ie.writeVarintField(3,ce.type),ie.writeMessage(4,ae,ce)}function Ve(G,ie){var ce=G.feature,B=G.keys,re=G.values,fe=G.keycache,Se=G.valuecache;for(var te in ce.properties){var me=fe[te];me===void 0&&(B.push(te),fe[te]=me=B.length-1),ie.writeVarint(me);var ct=ce.properties[te],yr=typeof ct;yr!=="string"&&yr!=="boolean"&&yr!=="number"&&(ct=JSON.stringify(ct));var Or=yr+":"+ct,Ft=Se[Or];Ft===void 0&&(re.push(ct),Se[Or]=Ft=re.length-1),ie.writeVarint(Ft)}}function Et(G,ie){return(ie<<3)+(7&G)}function gr(G){return G<<1^G>>31}function ae(G,ie){for(var ce=G.loadGeometry(),B=G.type,re=0,fe=0,Se=ce.length,te=0;te<Se;te++){var me=ce[te],ct=1;B===1&&(ct=me.length),ie.writeVarint(Et(1,ct));for(var yr=B===3?me.length-1:me.length,Or=0;Or<yr;Or++){Or===1&&B!==1&&ie.writeVarint(Et(2,yr-1));var Ft=me[Or].x-re,kr=me[Or].y-fe;ie.writeVarint(gr(Ft)),ie.writeVarint(gr(kr)),re+=Ft,fe+=kr}B===3&&ie.writeVarint(Et(7,1))}}function Ae(G,ie){var ce=typeof G;ce==="string"?ie.writeStringField(1,G):ce==="boolean"?ie.writeBooleanField(7,G):ce==="number"&&(G%1!=0?ie.writeDoubleField(3,G):G<0?ie.writeSVarintField(6,G):ie.writeVarintField(5,G))}function oe(G,ie,ce,B){ge(G,ce,B),ge(ie,2*ce,2*B),ge(ie,2*ce+1,2*B+1)}function ge(G,ie,ce){var B=G[ie];G[ie]=G[ce],G[ce]=B}function Me(G,ie,ce,B){var re=G-ce,fe=ie-B;return re*re+fe*fe}xt.fromVectorTileJs=_t,xt.fromGeojsonVt=function(G,ie){ie=ie||{};var ce={};for(var B in G)ce[B]=new Ir(G[B].features,ie),ce[B].name=B,ce[B].version=ie.version,ce[B].extent=ie.extent;return _t({layers:ce})},xt.GeoJSONWrapper=Ke;var Qe=function(G){return G[0]},gt=function(G){return G[1]},Jt=function(G,ie,ce,B,re){ie===void 0&&(ie=Qe),ce===void 0&&(ce=gt),B===void 0&&(B=64),re===void 0&&(re=Float64Array),this.nodeSize=B,this.points=G;for(var fe=G.length<65536?Uint16Array:Uint32Array,Se=this.ids=new fe(G.length),te=this.coords=new re(2*G.length),me=0;me<G.length;me++)Se[me]=me,te[2*me]=ie(G[me]),te[2*me+1]=ce(G[me]);(function ct(yr,Or,Ft,kr,bn,gn){if(!(bn-kr<=Ft)){var mr=kr+bn>>1;(function dn(Wr,ln,Ei,hn,wi,Yi){for(;wi>hn;){if(wi-hn>600){var Yn=wi-hn+1,Di=Ei-hn+1,ki=Math.log(Yn),za=.5*Math.exp(2*ki/3),Wn=.5*Math.sqrt(ki*za*(Yn-za)/Yn)*(Di-Yn/2<0?-1:1);dn(Wr,ln,Ei,Math.max(hn,Math.floor(Ei-Di*za/Yn+Wn)),Math.min(wi,Math.floor(Ei+(Yn-Di)*za/Yn+Wn)),Yi)}var ai=ln[2*Ei+Yi],Ai=hn,Qn=wi;for(oe(Wr,ln,hn,Ei),ln[2*wi+Yi]>ai&&oe(Wr,ln,hn,wi);Ai<Qn;){for(oe(Wr,ln,Ai,Qn),Ai++,Qn--;ln[2*Ai+Yi]<ai;)Ai++;for(;ln[2*Qn+Yi]>ai;)Qn--}ln[2*hn+Yi]===ai?oe(Wr,ln,hn,Qn):oe(Wr,ln,++Qn,wi),Qn<=Ei&&(hn=Qn+1),Ei<=Qn&&(wi=Qn-1)}})(yr,Or,mr,kr,bn,gn%2),ct(yr,Or,Ft,kr,mr-1,gn+1),ct(yr,Or,Ft,mr+1,bn,gn+1)}})(Se,te,B,0,Se.length-1,0)};Jt.prototype.range=function(G,ie,ce,B){return function(re,fe,Se,te,me,ct,yr){for(var Or,Ft,kr=[0,re.length-1,0],bn=[];kr.length;){var gn=kr.pop(),mr=kr.pop(),dn=kr.pop();if(mr-dn<=yr)for(var Wr=dn;Wr<=mr;Wr++)Ft=fe[2*Wr+1],(Or=fe[2*Wr])>=Se&&Or<=me&&Ft>=te&&Ft<=ct&&bn.push(re[Wr]);else{var ln=Math.floor((dn+mr)/2);Ft=fe[2*ln+1],(Or=fe[2*ln])>=Se&&Or<=me&&Ft>=te&&Ft<=ct&&bn.push(re[ln]);var Ei=(gn+1)%2;(gn===0?Se<=Or:te<=Ft)&&(kr.push(dn),kr.push(ln-1),kr.push(Ei)),(gn===0?me>=Or:ct>=Ft)&&(kr.push(ln+1),kr.push(mr),kr.push(Ei))}}return bn}(this.ids,this.coords,G,ie,ce,B,this.nodeSize)},Jt.prototype.within=function(G,ie,ce){return function(B,re,fe,Se,te,me){for(var ct=[0,B.length-1,0],yr=[],Or=te*te;ct.length;){var Ft=ct.pop(),kr=ct.pop(),bn=ct.pop();if(kr-bn<=me)for(var gn=bn;gn<=kr;gn++)Me(re[2*gn],re[2*gn+1],fe,Se)<=Or&&yr.push(B[gn]);else{var mr=Math.floor((bn+kr)/2),dn=re[2*mr],Wr=re[2*mr+1];Me(dn,Wr,fe,Se)<=Or&&yr.push(B[mr]);var ln=(Ft+1)%2;(Ft===0?fe-te<=dn:Se-te<=Wr)&&(ct.push(bn),ct.push(mr-1),ct.push(ln)),(Ft===0?fe+te>=dn:Se+te>=Wr)&&(ct.push(mr+1),ct.push(kr),ct.push(ln))}}return yr}(this.ids,this.coords,G,ie,ce,this.nodeSize)};var Dr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},Br=function(G){this.options=Pt(Object.create(Dr),G),this.trees=new Array(this.options.maxZoom+1)};function un(G,ie,ce,B,re){return{x:G,y:ie,zoom:1/0,id:ce,parentId:-1,numPoints:B,properties:re}}function tr(G,ie){var ce=G.geometry.coordinates,B=ce[1];return{x:ke(ce[0]),y:Ce(B),zoom:1/0,index:ie,parentId:-1}}function se(G){return{type:"Feature",id:G.id,properties:be(G),geometry:{type:"Point",coordinates:[(B=G.x,360*(B-.5)),(ie=G.y,ce=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(ce))/Math.PI-90)]}};var ie,ce,B}function be(G){var ie=G.numPoints,ce=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Pt(Pt({},G.properties),{cluster:!0,cluster_id:G.id,point_count:ie,point_count_abbreviated:ce})}function ke(G){return G/360+.5}function Ce(G){var ie=Math.sin(G*Math.PI/180),ce=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ce<0?0:ce>1?1:ce}function Pt(G,ie){for(var ce in ie)G[ce]=ie[ce];return G}function Dt(G){return G.x}function E(G){return G.y}function N(G,ie,ce,B,re,fe){var Se=re-ce,te=fe-B;if(Se!==0||te!==0){var me=((G-ce)*Se+(ie-B)*te)/(Se*Se+te*te);me>1?(ce=re,B=fe):me>0&&(ce+=Se*me,B+=te*me)}return(Se=G-ce)*Se+(te=ie-B)*te}function he(G,ie,ce,B){var re={id:G===void 0?null:G,type:ie,geometry:ce,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var Se=fe.geometry,te=fe.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")Ze(fe,Se);else if(te==="Polygon"||te==="MultiLineString")for(var me=0;me<Se.length;me++)Ze(fe,Se[me]);else if(te==="MultiPolygon")for(me=0;me<Se.length;me++)for(var ct=0;ct<Se[me].length;ct++)Ze(fe,Se[me][ct])}(re),re}function Ze(G,ie){for(var ce=0;ce<ie.length;ce+=3)G.minX=Math.min(G.minX,ie[ce]),G.minY=Math.min(G.minY,ie[ce+1]),G.maxX=Math.max(G.maxX,ie[ce]),G.maxY=Math.max(G.maxY,ie[ce+1])}function qe(G,ie,ce,B){if(ie.geometry){var re=ie.geometry.coordinates,fe=ie.geometry.type,Se=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),te=[],me=ie.id;if(ce.promoteId?me=ie.properties[ce.promoteId]:ce.generateId&&(me=B||0),fe==="Point")mt(re,te);else if(fe==="MultiPoint")for(var ct=0;ct<re.length;ct++)mt(re[ct],te);else if(fe==="LineString")Ct(re,te,Se,!1);else if(fe==="MultiLineString"){if(ce.lineMetrics){for(ct=0;ct<re.length;ct++)Ct(re[ct],te=[],Se,!1),G.push(he(me,"LineString",te,ie.properties));return}H(re,te,Se,!1)}else if(fe==="Polygon")H(re,te,Se,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(ct=0;ct<ie.geometry.geometries.length;ct++)qe(G,{id:me,geometry:ie.geometry.geometries[ct],properties:ie.properties},ce,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<re.length;ct++){var yr=[];H(re[ct],yr,Se,!0),te.push(yr)}}G.push(he(me,fe,te,ie.properties))}}function mt(G,ie){ie.push(Kt(G[0])),ie.push(jt(G[1])),ie.push(0)}function Ct(G,ie,ce,B){for(var re,fe,Se=0,te=0;te<G.length;te++){var me=Kt(G[te][0]),ct=jt(G[te][1]);ie.push(me),ie.push(ct),ie.push(0),te>0&&(Se+=B?(re*ct-me*fe)/2:Math.sqrt(Math.pow(me-re,2)+Math.pow(ct-fe,2))),re=me,fe=ct}var yr=ie.length-3;ie[2]=1,function Or(Ft,kr,bn,gn){for(var mr,dn=gn,Wr=bn-kr>>1,ln=bn-kr,Ei=Ft[kr],hn=Ft[kr+1],wi=Ft[bn],Yi=Ft[bn+1],Yn=kr+3;Yn<bn;Yn+=3){var Di=N(Ft[Yn],Ft[Yn+1],Ei,hn,wi,Yi);if(Di>dn)mr=Yn,dn=Di;else if(Di===dn){var ki=Math.abs(Yn-Wr);ki<ln&&(mr=Yn,ln=ki)}}dn>gn&&(mr-kr>3&&Or(Ft,kr,mr,gn),Ft[mr+2]=dn,bn-mr>3&&Or(Ft,mr,bn,gn))}(ie,0,yr,ce),ie[yr+2]=1,ie.size=Math.abs(Se),ie.start=0,ie.end=ie.size}function H(G,ie,ce,B){for(var re=0;re<G.length;re++){var fe=[];Ct(G[re],fe,ce,B),ie.push(fe)}}function Kt(G){return G/360+.5}function jt(G){var ie=Math.sin(G*Math.PI/180),ce=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ce<0?0:ce>1?1:ce}function hr(G,ie,ce,B,re,fe,Se,te){if(B/=ie,fe>=(ce/=ie)&&Se<B)return G;if(Se<ce||fe>=B)return null;for(var me=[],ct=0;ct<G.length;ct++){var yr=G[ct],Or=yr.geometry,Ft=yr.type,kr=re===0?yr.minX:yr.minY,bn=re===0?yr.maxX:yr.maxY;if(kr>=ce&&bn<B)me.push(yr);else if(!(bn<ce||kr>=B)){var gn=[];if(Ft==="Point"||Ft==="MultiPoint")Cr(Or,gn,ce,B,re);else if(Ft==="LineString")Tr(Or,gn,ce,B,re,!1,te.lineMetrics);else if(Ft==="MultiLineString")Je(Or,gn,ce,B,re,!1);else if(Ft==="Polygon")Je(Or,gn,ce,B,re,!0);else if(Ft==="MultiPolygon")for(var mr=0;mr<Or.length;mr++){var dn=[];Je(Or[mr],dn,ce,B,re,!0),dn.length&&gn.push(dn)}if(gn.length){if(te.lineMetrics&&Ft==="LineString"){for(mr=0;mr<gn.length;mr++)me.push(he(yr.id,Ft,gn[mr],yr.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(gn.length===1?(Ft="LineString",gn=gn[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=gn.length===3?"Point":"MultiPoint"),me.push(he(yr.id,Ft,gn,yr.tags))}}}return me.length?me:null}function Cr(G,ie,ce,B,re){for(var fe=0;fe<G.length;fe+=3){var Se=G[fe+re];Se>=ce&&Se<=B&&(ie.push(G[fe]),ie.push(G[fe+1]),ie.push(G[fe+2]))}}function Tr(G,ie,ce,B,re,fe,Se){for(var te,me,ct=Pr(G),yr=re===0?ht:fr,Or=G.start,Ft=0;Ft<G.length-3;Ft+=3){var kr=G[Ft],bn=G[Ft+1],gn=G[Ft+2],mr=G[Ft+3],dn=G[Ft+4],Wr=re===0?kr:bn,ln=re===0?mr:dn,Ei=!1;Se&&(te=Math.sqrt(Math.pow(kr-mr,2)+Math.pow(bn-dn,2))),Wr<ce?ln>ce&&(me=yr(ct,kr,bn,mr,dn,ce),Se&&(ct.start=Or+te*me)):Wr>B?ln<B&&(me=yr(ct,kr,bn,mr,dn,B),Se&&(ct.start=Or+te*me)):yt(ct,kr,bn,gn),ln<ce&&Wr>=ce&&(me=yr(ct,kr,bn,mr,dn,ce),Ei=!0),ln>B&&Wr<=B&&(me=yr(ct,kr,bn,mr,dn,B),Ei=!0),!fe&&Ei&&(Se&&(ct.end=Or+te*me),ie.push(ct),ct=Pr(G)),Se&&(Or+=te)}var hn=G.length-3;kr=G[hn],bn=G[hn+1],gn=G[hn+2],(Wr=re===0?kr:bn)>=ce&&Wr<=B&&yt(ct,kr,bn,gn),hn=ct.length-3,fe&&hn>=3&&(ct[hn]!==ct[0]||ct[hn+1]!==ct[1])&&yt(ct,ct[0],ct[1],ct[2]),ct.length&&ie.push(ct)}function Pr(G){var ie=[];return ie.size=G.size,ie.start=G.start,ie.end=G.end,ie}function Je(G,ie,ce,B,re,fe){for(var Se=0;Se<G.length;Se++)Tr(G[Se],ie,ce,B,re,fe,!1)}function yt(G,ie,ce,B){G.push(ie),G.push(ce),G.push(B)}function ht(G,ie,ce,B,re,fe){var Se=(fe-ie)/(B-ie);return G.push(fe),G.push(ce+(re-ce)*Se),G.push(1),Se}function fr(G,ie,ce,B,re,fe){var Se=(fe-ce)/(re-ce);return G.push(ie+(B-ie)*Se),G.push(fe),G.push(1),Se}function $r(G,ie){for(var ce=[],B=0;B<G.length;B++){var re,fe=G[B],Se=fe.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")re=lt(fe.geometry,ie);else if(Se==="MultiLineString"||Se==="Polygon"){re=[];for(var te=0;te<fe.geometry.length;te++)re.push(lt(fe.geometry[te],ie))}else if(Se==="MultiPolygon")for(re=[],te=0;te<fe.geometry.length;te++){for(var me=[],ct=0;ct<fe.geometry[te].length;ct++)me.push(lt(fe.geometry[te][ct],ie));re.push(me)}ce.push(he(fe.id,Se,re,fe.tags))}return ce}function lt(G,ie){var ce=[];ce.size=G.size,G.start!==void 0&&(ce.start=G.start,ce.end=G.end);for(var B=0;B<G.length;B+=3)ce.push(G[B]+ie,G[B+1],G[B+2]);return ce}function Rt(G,ie){if(G.transformed)return G;var ce,B,re,fe=1<<G.z,Se=G.x,te=G.y;for(ce=0;ce<G.features.length;ce++){var me=G.features[ce],ct=me.geometry,yr=me.type;if(me.geometry=[],yr===1)for(B=0;B<ct.length;B+=2)me.geometry.push(Qt(ct[B],ct[B+1],ie,fe,Se,te));else for(B=0;B<ct.length;B++){var Or=[];for(re=0;re<ct[B].length;re+=2)Or.push(Qt(ct[B][re],ct[B][re+1],ie,fe,Se,te));me.geometry.push(Or)}}return G.transformed=!0,G}function Qt(G,ie,ce,B,re,fe){return[Math.round(ce*(G*B-re)),Math.round(ce*(ie*B-fe))]}function pr(G,ie,ce,B,re){for(var fe=ie===re.maxZoom?0:re.tolerance/((1<<ie)*re.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:B,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<G.length;te++){Se.numFeatures++,vn(Se,G[te],fe,re);var me=G[te].minX,ct=G[te].minY,yr=G[te].maxX,Or=G[te].maxY;me<Se.minX&&(Se.minX=me),ct<Se.minY&&(Se.minY=ct),yr>Se.maxX&&(Se.maxX=yr),Or>Se.maxY&&(Se.maxY=Or)}return Se}function vn(G,ie,ce,B){var re=ie.geometry,fe=ie.type,Se=[];if(fe==="Point"||fe==="MultiPoint")for(var te=0;te<re.length;te+=3)Se.push(re[te]),Se.push(re[te+1]),G.numPoints++,G.numSimplified++;else if(fe==="LineString")Pn(Se,re,G,ce,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(te=0;te<re.length;te++)Pn(Se,re[te],G,ce,fe==="Polygon",te===0);else if(fe==="MultiPolygon")for(var me=0;me<re.length;me++){var ct=re[me];for(te=0;te<ct.length;te++)Pn(Se,ct[te],G,ce,!0,te===0)}if(Se.length){var yr=ie.tags||null;if(fe==="LineString"&&B.lineMetrics){for(var Or in yr={},ie.tags)yr[Or]=ie.tags[Or];yr.mapbox_clip_start=re.start/re.size,yr.mapbox_clip_end=re.end/re.size}var Ft={geometry:Se,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:yr};ie.id!==null&&(Ft.id=ie.id),G.features.push(Ft)}}function Pn(G,ie,ce,B,re,fe){var Se=B*B;if(B>0&&ie.size<(re?Se:B))ce.numPoints+=ie.length/3;else{for(var te=[],me=0;me<ie.length;me+=3)(B===0||ie[me+2]>Se)&&(ce.numSimplified++,te.push(ie[me]),te.push(ie[me+1])),ce.numPoints++;re&&function(ct,yr){for(var Or=0,Ft=0,kr=ct.length,bn=kr-2;Ft<kr;bn=Ft,Ft+=2)Or+=(ct[Ft]-ct[bn])*(ct[Ft+1]+ct[bn+1]);if(Or>0===yr)for(Ft=0,kr=ct.length;Ft<kr/2;Ft+=2){var gn=ct[Ft],mr=ct[Ft+1];ct[Ft]=ct[kr-2-Ft],ct[Ft+1]=ct[kr-1-Ft],ct[kr-2-Ft]=gn,ct[kr-1-Ft]=mr}}(te,fe),G.push(te)}}function bi(G,ie){var ce=(ie=this.options=function(re,fe){for(var Se in fe)re[Se]=fe[Se];return re}(Object.create(this.options),ie)).debug;if(ce&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(re,fe){var Se=[];if(re.type==="FeatureCollection")for(var te=0;te<re.features.length;te++)qe(Se,re.features[te],fe,te);else qe(Se,re.type==="Feature"?re:{geometry:re},fe);return Se}(G,ie);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(B=function(re,fe){var Se=fe.buffer/fe.extent,te=re,me=hr(re,1,-1-Se,Se,0,-1,2,fe),ct=hr(re,1,1-Se,2+Se,0,-1,2,fe);return(me||ct)&&(te=hr(re,1,-Se,1+Se,0,-1,2,fe)||[],me&&(te=$r(me,1).concat(te)),ct&&(te=te.concat($r(ct,-1)))),te}(B,ie)).length&&this.splitTile(B,0,0,0),ce&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Si(G,ie,ce){return 32*((1<<G)*ce+ie)+G}function Ri(G,ie){var ce=G.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var B=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!B)return ie(null,null);var re=new bt(B.features),fe=xt(re);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),ie(null,{vectorTile:re,rawData:fe.buffer})}Br.prototype.load=function(G){var ie=this.options,ce=ie.log,B=ie.minZoom,re=ie.maxZoom,fe=ie.nodeSize;ce&&console.time("total time");var Se="prepare "+G.length+" points";ce&&console.time(Se),this.points=G;for(var te=[],me=0;me<G.length;me++)G[me].geometry&&te.push(tr(G[me],me));this.trees[re+1]=new Jt(te,Dt,E,fe,Float32Array),ce&&console.timeEnd(Se);for(var ct=re;ct>=B;ct--){var yr=+Date.now();te=this._cluster(te,ct),this.trees[ct]=new Jt(te,Dt,E,fe,Float32Array),ce&&console.log("z%d: %d clusters in %dms",ct,te.length,+Date.now()-yr)}return ce&&console.timeEnd("total time"),this},Br.prototype.getClusters=function(G,ie){var ce=((G[0]+180)%360+360)%360-180,B=Math.max(-90,Math.min(90,G[1])),re=G[2]===180?180:((G[2]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ce=-180,re=180;else if(ce>re){var Se=this.getClusters([ce,B,180,fe],ie),te=this.getClusters([-180,B,re,fe],ie);return Se.concat(te)}for(var me=this.trees[this._limitZoom(ie)],ct=[],yr=0,Or=me.range(ke(ce),Ce(fe),ke(re),Ce(B));yr<Or.length;yr+=1){var Ft=me.points[Or[yr]];ct.push(Ft.numPoints?se(Ft):this.points[Ft.index])}return ct},Br.prototype.getChildren=function(G){var ie=this._getOriginId(G),ce=this._getOriginZoom(G),B="No cluster with the specified id.",re=this.trees[ce];if(!re)throw new Error(B);var fe=re.points[ie];if(!fe)throw new Error(B);for(var Se=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),te=[],me=0,ct=re.within(fe.x,fe.y,Se);me<ct.length;me+=1){var yr=re.points[ct[me]];yr.parentId===G&&te.push(yr.numPoints?se(yr):this.points[yr.index])}if(te.length===0)throw new Error(B);return te},Br.prototype.getLeaves=function(G,ie,ce){var B=[];return this._appendLeaves(B,G,ie=ie||10,ce=ce||0,0),B},Br.prototype.getTile=function(G,ie,ce){var B=this.trees[this._limitZoom(G)],re=Math.pow(2,G),fe=this.options,Se=fe.radius/fe.extent,te=(ce-Se)/re,me=(ce+1+Se)/re,ct={features:[]};return this._addTileFeatures(B.range((ie-Se)/re,te,(ie+1+Se)/re,me),B.points,ie,ce,re,ct),ie===0&&this._addTileFeatures(B.range(1-Se/re,te,1,me),B.points,re,ce,re,ct),ie===re-1&&this._addTileFeatures(B.range(0,te,Se/re,me),B.points,-1,ce,re,ct),ct.features.length?ct:null},Br.prototype.getClusterExpansionZoom=function(G){for(var ie=this._getOriginZoom(G)-1;ie<=this.options.maxZoom;){var ce=this.getChildren(G);if(ie++,ce.length!==1)break;G=ce[0].properties.cluster_id}return ie},Br.prototype._appendLeaves=function(G,ie,ce,B,re){for(var fe=0,Se=this.getChildren(ie);fe<Se.length;fe+=1){var te=Se[fe],me=te.properties;if(me&&me.cluster?re+me.point_count<=B?re+=me.point_count:re=this._appendLeaves(G,me.cluster_id,ce,B,re):re<B?re++:G.push(te),G.length===ce)break}return re},Br.prototype._addTileFeatures=function(G,ie,ce,B,re,fe){for(var Se=0,te=G;Se<te.length;Se+=1){var me=ie[te[Se]],ct=me.numPoints,yr={type:1,geometry:[[Math.round(this.options.extent*(me.x*re-ce)),Math.round(this.options.extent*(me.y*re-B))]],tags:ct?be(me):this.points[me.index].properties},Or=void 0;ct?Or=me.id:this.options.generateId?Or=me.index:this.points[me.index].id&&(Or=this.points[me.index].id),Or!==void 0&&(yr.id=Or),fe.features.push(yr)}},Br.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},Br.prototype._cluster=function(G,ie){for(var ce=[],B=this.options,re=B.reduce,fe=B.minPoints,Se=B.radius/(B.extent*Math.pow(2,ie)),te=0;te<G.length;te++){var me=G[te];if(!(me.zoom<=ie)){me.zoom=ie;for(var ct=this.trees[ie+1],yr=ct.within(me.x,me.y,Se),Or=me.numPoints||1,Ft=Or,kr=0,bn=yr;kr<bn.length;kr+=1){var gn=ct.points[bn[kr]];gn.zoom>ie&&(Ft+=gn.numPoints||1)}if(Ft>=fe){for(var mr=me.x*Or,dn=me.y*Or,Wr=re&&Or>1?this._map(me,!0):null,ln=(te<<5)+(ie+1)+this.points.length,Ei=0,hn=yr;Ei<hn.length;Ei+=1){var wi=ct.points[hn[Ei]];if(!(wi.zoom<=ie)){wi.zoom=ie;var Yi=wi.numPoints||1;mr+=wi.x*Yi,dn+=wi.y*Yi,wi.parentId=ln,re&&(Wr||(Wr=this._map(me,!0)),re(Wr,this._map(wi)))}}me.parentId=ln,ce.push(un(mr/Ft,dn/Ft,ln,Ft,Wr))}else if(ce.push(me),Ft>1)for(var Yn=0,Di=yr;Yn<Di.length;Yn+=1){var ki=ct.points[Di[Yn]];ki.zoom<=ie||(ki.zoom=ie,ce.push(ki))}}}return ce},Br.prototype._getOriginId=function(G){return G-this.points.length>>5},Br.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},Br.prototype._map=function(G,ie){if(G.numPoints)return ie?Pt({},G.properties):G.properties;var ce=this.points[G.index].properties,B=this.options.map(ce);return ie&&B===ce?Pt({},B):B},bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},bi.prototype.splitTile=function(G,ie,ce,B,re,fe,Se){for(var te=[G,ie,ce,B],me=this.options,ct=me.debug;te.length;){B=te.pop(),ce=te.pop(),ie=te.pop(),G=te.pop();var yr=1<<ie,Or=Si(ie,ce,B),Ft=this.tiles[Or];if(!Ft&&(ct>1&&console.time("creation"),Ft=this.tiles[Or]=pr(G,ie,ce,B,me),this.tileCoords.push({z:ie,x:ce,y:B}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ce,B,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var kr="z"+ie;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(Ft.source=G,re){if(ie===me.maxZoom||ie===re)continue;var bn=1<<re-ie;if(ce!==Math.floor(fe/bn)||B!==Math.floor(Se/bn))continue}else if(ie===me.indexMaxZoom||Ft.numPoints<=me.indexMaxPoints)continue;if(Ft.source=null,G.length!==0){ct>1&&console.time("clipping");var gn,mr,dn,Wr,ln,Ei,hn=.5*me.buffer/me.extent,wi=.5-hn,Yi=.5+hn,Yn=1+hn;gn=mr=dn=Wr=null,ln=hr(G,yr,ce-hn,ce+Yi,0,Ft.minX,Ft.maxX,me),Ei=hr(G,yr,ce+wi,ce+Yn,0,Ft.minX,Ft.maxX,me),G=null,ln&&(gn=hr(ln,yr,B-hn,B+Yi,1,Ft.minY,Ft.maxY,me),mr=hr(ln,yr,B+wi,B+Yn,1,Ft.minY,Ft.maxY,me),ln=null),Ei&&(dn=hr(Ei,yr,B-hn,B+Yi,1,Ft.minY,Ft.maxY,me),Wr=hr(Ei,yr,B+wi,B+Yn,1,Ft.minY,Ft.maxY,me),Ei=null),ct>1&&console.timeEnd("clipping"),te.push(gn||[],ie+1,2*ce,2*B),te.push(mr||[],ie+1,2*ce,2*B+1),te.push(dn||[],ie+1,2*ce+1,2*B),te.push(Wr||[],ie+1,2*ce+1,2*B+1)}}},bi.prototype.getTile=function(G,ie,ce){var B=this.options,re=B.extent,fe=B.debug;if(G<0||G>24)return null;var Se=1<<G,te=Si(G,ie=(ie%Se+Se)%Se,ce);if(this.tiles[te])return Rt(this.tiles[te],re);fe>1&&console.log("drilling down to z%d-%d-%d",G,ie,ce);for(var me,ct=G,yr=ie,Or=ce;!me&&ct>0;)ct--,yr=Math.floor(yr/2),Or=Math.floor(Or/2),me=this.tiles[Si(ct,yr,Or)];return me&&me.source?(fe>1&&console.log("found parent tile z%d-%d-%d",ct,yr,Or),fe>1&&console.time("drilling down"),this.splitTile(me.source,ct,yr,Or,G,ie,ce),fe>1&&console.timeEnd("drilling down"),this.tiles[te]?Rt(this.tiles[te],re):null):null};var ia=function(G){function ie(ce,B,re,fe){G.call(this,ce,B,re,Ri),fe&&(this.loadGeoJSON=fe)}return G&&(ie.__proto__=G),(ie.prototype=Object.create(G&&G.prototype)).constructor=ie,ie.prototype.loadData=function(ce,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=B,this._pendingLoadDataParams=ce,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var ce=this;if(this._pendingCallback&&this._pendingLoadDataParams){var B=this._pendingCallback,re=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var fe=!!(re&&re.request&&re.request.collectResourceTiming)&&new d.RequestPerformance(re.request);this.loadGeoJSON(re,function(Se,te){if(Se||!te)return B(Se);if(typeof te!="object")return B(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));(function Ft(kr,bn){var gn,mr=kr&&kr.type;if(mr==="FeatureCollection")for(gn=0;gn<kr.features.length;gn++)Ft(kr.features[gn],bn);else if(mr==="GeometryCollection")for(gn=0;gn<kr.geometries.length;gn++)Ft(kr.geometries[gn],bn);else if(mr==="Feature")Ft(kr.geometry,bn);else if(mr==="Polygon")Ut(kr.coordinates,bn);else if(mr==="MultiPolygon")for(gn=0;gn<kr.coordinates.length;gn++)Ut(kr.coordinates[gn],bn);return kr})(te,!0);try{if(re.filter){var me=d.createExpression(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(me.result==="error")throw new Error(me.value.map(function(Ft){return Ft.key+": "+Ft.message}).join(", "));var ct=te.features.filter(function(Ft){return me.value.evaluate({zoom:0},Ft)});te={type:"FeatureCollection",features:ct}}ce._geoJSONIndex=re.cluster?new Br(function(Ft){var kr=Ft.superclusterOptions,bn=Ft.clusterProperties;if(!bn||!kr)return kr;for(var gn={},mr={},dn={accumulated:null,zoom:0},Wr={properties:null},ln=Object.keys(bn),Ei=0,hn=ln;Ei<hn.length;Ei+=1){var wi=hn[Ei],Yi=bn[wi],Yn=Yi[0],Di=d.createExpression(Yi[1]),ki=d.createExpression(typeof Yn=="string"?[Yn,["accumulated"],["get",wi]]:Yn);gn[wi]=Di.value,mr[wi]=ki.value}return kr.map=function(za){Wr.properties=za;for(var Wn={},ai=0,Ai=ln;ai<Ai.length;ai+=1){var Qn=Ai[ai];Wn[Qn]=gn[Qn].evaluate(dn,Wr)}return Wn},kr.reduce=function(za,Wn){Wr.properties=Wn;for(var ai=0,Ai=ln;ai<Ai.length;ai+=1){var Qn=Ai[ai];dn.accumulated=za[Qn],za[Qn]=mr[Qn].evaluate(dn,Wr)}},kr}(re)).load(te.features):function(Ft,kr){return new bi(Ft,kr)}(te,re.geojsonVtOptions)}catch(Ft){return B(Ft)}ce.loaded={};var yr={};if(fe){var Or=fe.finish();Or&&(yr.resourceTiming={},yr.resourceTiming[re.source]=JSON.parse(JSON.stringify(Or)))}B(null,yr)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(ce,B){var re=this.loaded;return re&&re[ce.uid]?G.prototype.reloadTile.call(this,ce,B):this.loadTile(ce,B)},ie.prototype.loadGeoJSON=function(ce,B){if(ce.request)d.getJSON(ce.request,B);else{if(typeof ce.data!="string")return B(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."));try{return B(null,JSON.parse(ce.data))}catch(re){return B(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(ce,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()},ie.prototype.getClusterExpansionZoom=function(ce,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(re){B(re)}},ie.prototype.getClusterChildren=function(ce,B){try{B(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(re){B(re)}},ie.prototype.getClusterLeaves=function(ce,B){try{B(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(re){B(re)}},ie}(Be),pi=function(G){var ie=this;this.self=G,this.actor=new d.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Be,geojson:ia},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ce,B){if(ie.workerSourceTypes[ce])throw new Error('Worker source with name "'+ce+'" already registered.');ie.workerSourceTypes[ce]=B},this.self.registerRTLTextPlugin=function(ce){if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=ce.applyArabicShaping,d.plugin.processBidirectionalText=ce.processBidirectionalText,d.plugin.processStyledBidirectionalText=ce.processStyledBidirectionalText}};return pi.prototype.setReferrer=function(G,ie){this.referrer=ie},pi.prototype.setImages=function(G,ie,ce){for(var B in this.availableImages[G]=ie,this.workerSources[G]){var re=this.workerSources[G][B];for(var fe in re)re[fe].availableImages=ie}ce()},pi.prototype.setLayers=function(G,ie,ce){this.getLayerIndex(G).replace(ie),ce()},pi.prototype.updateLayers=function(G,ie,ce){this.getLayerIndex(G).update(ie.layers,ie.removedIds),ce()},pi.prototype.loadTile=function(G,ie,ce){this.getWorkerSource(G,ie.type,ie.source).loadTile(ie,ce)},pi.prototype.loadDEMTile=function(G,ie,ce){this.getDEMWorkerSource(G,ie.source).loadTile(ie,ce)},pi.prototype.reloadTile=function(G,ie,ce){this.getWorkerSource(G,ie.type,ie.source).reloadTile(ie,ce)},pi.prototype.abortTile=function(G,ie,ce){this.getWorkerSource(G,ie.type,ie.source).abortTile(ie,ce)},pi.prototype.removeTile=function(G,ie,ce){this.getWorkerSource(G,ie.type,ie.source).removeTile(ie,ce)},pi.prototype.removeDEMTile=function(G,ie){this.getDEMWorkerSource(G,ie.source).removeTile(ie)},pi.prototype.removeSource=function(G,ie,ce){if(this.workerSources[G]&&this.workerSources[G][ie.type]&&this.workerSources[G][ie.type][ie.source]){var B=this.workerSources[G][ie.type][ie.source];delete this.workerSources[G][ie.type][ie.source],B.removeSource!==void 0?B.removeSource(ie,ce):ce()}},pi.prototype.loadWorkerSource=function(G,ie,ce){try{this.self.importScripts(ie.url),ce()}catch(B){ce(B.toString())}},pi.prototype.syncRTLPluginState=function(G,ie,ce){try{d.plugin.setState(ie);var B=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&B!=null){this.self.importScripts(B);var re=d.plugin.isParsed();ce(re?void 0:new Error("RTL Text Plugin failed to import scripts from "+B),re)}}catch(fe){ce(fe.toString())}},pi.prototype.getAvailableImages=function(G){var ie=this.availableImages[G];return ie||(ie=[]),ie},pi.prototype.getLayerIndex=function(G){var ie=this.layerIndexes[G];return ie||(ie=this.layerIndexes[G]=new W),ie},pi.prototype.getWorkerSource=function(G,ie,ce){var B=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][ie]||(this.workerSources[G][ie]={}),this.workerSources[G][ie][ce]||(this.workerSources[G][ie][ce]=new this.workerSourceTypes[ie]({send:function(re,fe,Se){B.actor.send(re,fe,Se,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][ie][ce]},pi.prototype.getDEMWorkerSource=function(G,ie){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ie]||(this.demWorkerSources[G][ie]=new $e),this.demWorkerSources[G][ie]},pi.prototype.enforceCacheSizeLimit=function(G,ie){d.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new pi(self)),pi}),w(["./shared"],function(d){"use strict";var b=d.createCommonjsModule(function(i){function u(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,V=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(V);try{R=new Worker(ee),T=!0}catch(ve){T=!1}return R&&R.terminate(),URL.revokeObjectURL(ee),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var V=R.getImageData(0,0,1,1);return V&&V.width===T.width}()?(h[S=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(T){var R=function(ee){var ve=document.createElement("canvas"),ye=Object.create(u.webGLContextAttributes);return ye.failIfMajorPerformanceCaveat=ee,ve.probablySupportsContext?ve.probablySupportsContext("webgl",ye)||ve.probablySupportsContext("experimental-webgl",ye):ve.supportsContext?ve.supportsContext("webgl",ye)||ve.supportsContext("experimental-webgl",ye):ve.getContext("webgl",ye)||ve.getContext("experimental-webgl",ye)}(T);if(!R)return!1;var V=R.createShader(R.VERTEX_SHADER);return!(!V||R.isContextLost())&&(R.shaderSource(V,"void main() {}"),R.compileShader(V),R.getShaderParameter(V,R.COMPILE_STATUS)===!0)}(S)),h[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Y={create:function(i,u,a){var h=d.window.document.createElement(i);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(i,u){return d.window.document.createElementNS(i,u)}},W=d.window.document&&d.window.document.documentElement.style;function $(i){if(!W)return i[0];for(var u=0;u<i.length;u++)if(i[u]in W)return i[u];return i[0]}var I,k=$(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Y.disableDrag=function(){W&&k&&(I=W[k],W[k]="none")},Y.enableDrag=function(){W&&k&&(W[k]=I)};var we=$(["transform","WebkitTransform"]);Y.setTransform=function(i,u){i.style[we]=u};var Be=!1;try{var We=Object.defineProperty({},"passive",{get:function(){Be=!0}});d.window.addEventListener("test",We,We),d.window.removeEventListener("test",We,We)}catch(i){Be=!1}Y.addEventListener=function(i,u,a,h){h===void 0&&(h={}),i.addEventListener(u,a,"passive"in h&&Be?h:h.capture)},Y.removeEventListener=function(i,u,a,h){h===void 0&&(h={}),i.removeEventListener(u,a,"passive"in h&&Be?h:h.capture)};var $e=function(i){i.preventDefault(),i.stopPropagation(),d.window.removeEventListener("click",$e,!0)};function Ut(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}Y.suppressClick=function(){d.window.addEventListener("click",$e,!0),d.window.setTimeout(function(){d.window.removeEventListener("click",$e,!0)},0)},Y.mousePos=function(i,u){var a=i.getBoundingClientRect();return new d.Point(u.clientX-a.left-i.clientLeft,u.clientY-a.top-i.clientTop)},Y.touchPos=function(i,u){for(var a=i.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new d.Point(u[g].clientX-a.left-i.clientLeft,u[g].clientY-a.top-i.clientTop));return h},Y.mouseButton=function(i){return d.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},Y.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Yt=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var S=g[h];this._notify(S.ids,S.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,S=0,T=a;S<T.length;S+=1){var R=T[S];if(R[0]<g||R[1]<R[0]||h<R[1])return!1;g=R[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var S=0,T=a;S<T.length;S+=1)this.images[T[S]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var g={},S=0,T=a;S<T.length;S+=1){var R=T[S];this.images[R]||this.fire(new d.Event("styleimagemissing",{id:R}));var V=this.images[R];V?g[R]={data:V.data.clone(),pixelRatio:V.pixelRatio,sdf:V.sdf,version:V.version,stretchX:V.stretchX,stretchY:V.stretchY,content:V.content,hasRenderCallback:Boolean(V.userImage&&V.userImage.render)}:d.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var S={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new d.ImagePosition(S,g);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=d.potpack(a),S=g.w,T=g.h,R=this.atlasImage;for(var V in R.resize({width:S||1,height:T||1}),this.patterns){var ee=this.patterns[V].bin,ve=ee.x+1,ye=ee.y+1,Ee=this.images[V].data,Ye=Ee.width,Ge=Ee.height;d.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve,y:ye},{width:Ye,height:Ge}),d.RGBAImage.copy(Ee,R,{x:0,y:Ge-1},{x:ve,y:ye-1},{width:Ye,height:1}),d.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve,y:ye+Ge},{width:Ye,height:1}),d.RGBAImage.copy(Ee,R,{x:Ye-1,y:0},{x:ve-1,y:ye},{width:1,height:Ge}),d.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve+Ye,y:ye},{width:1,height:Ge})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var S=g[h];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var T=this.images[S];Ut(T)&&this.updateImage(S,T)}}},u}(d.Evented),kt=pt,Lt=pt,bt=1e20;function pt(i,u,a,h,g,S){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=S||"normal",this.radius=a||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ir(i,u,a,h,g,S,T){for(var R=0;R<u;R++){for(var V=0;V<a;V++)h[V]=i[V*u+R];for(er(h,g,S,T,a),V=0;V<a;V++)i[V*u+R]=g[V]}for(V=0;V<a;V++){for(R=0;R<u;R++)h[R]=i[V*u+R];for(er(h,g,S,T,u),R=0;R<u;R++)i[V*u+R]=Math.sqrt(g[R])}}function er(i,u,a,h,g){a[0]=0,h[0]=-bt,h[1]=+bt;for(var S=1,T=0;S<g;S++){for(var R=(i[S]+S*S-(i[a[T]]+a[T]*a[T]))/(2*S-2*a[T]);R<=h[T];)T--,R=(i[S]+S*S-(i[a[T]]+a[T]*a[T]))/(2*S-2*a[T]);a[++T]=S,h[T]=R,h[T+1]=+bt}for(S=0,T=0;S<g;S++){for(;h[T+1]<S;)T++;u[S]=(S-a[T])*(S-a[T])+i[a[T]]}}pt.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?bt:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?bt:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(Ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},kt.default=Lt;var nr=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};nr.prototype.setURL=function(i){this.url=i},nr.prototype.getGlyphs=function(i,u){var a=this,h=[];for(var g in i)for(var S=0,T=i[g];S<T.length;S+=1)h.push({stack:g,id:T[S]});d.asyncAll(h,function(R,V){var ee=R.stack,ve=R.id,ye=a.entries[ee];ye||(ye=a.entries[ee]={glyphs:{},requests:{},ranges:{}});var Ee=ye.glyphs[ve];if(Ee===void 0){if(Ee=a._tinySDF(ye,ee,ve))return ye.glyphs[ve]=Ee,void V(null,{stack:ee,id:ve,glyph:Ee});var Ye=Math.floor(ve/256);if(256*Ye>65535)V(new Error("glyphs > 65535 not supported"));else if(ye.ranges[Ye])V(null,{stack:ee,id:ve,glyph:Ee});else{var Ge=ye.requests[Ye];Ge||(Ge=ye.requests[Ye]=[],nr.loadGlyphRange(ee,Ye,a.url,a.requestManager,function(nt,Ne){if(Ne){for(var rt in Ne)a._doesCharSupportLocalGlyph(+rt)||(ye.glyphs[+rt]=Ne[+rt]);ye.ranges[Ye]=!0}for(var dt=0,zt=Ge;dt<zt.length;dt+=1)(0,zt[dt])(nt,Ne);delete ye.requests[Ye]})),Ge.push(function(nt,Ne){nt?V(nt):Ne&&V(null,{stack:ee,id:ve,glyph:Ne[ve]||null})})}}else V(null,{stack:ee,id:ve,glyph:Ee})},function(R,V){if(R)u(R);else if(V){for(var ee={},ve=0,ye=V;ve<ye.length;ve+=1){var Ee=ye[ve],Ye=Ee.stack,Ge=Ee.id,nt=Ee.glyph;(ee[Ye]||(ee[Ye]={}))[Ge]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}u(null,ee)}})},nr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(d.isChar["CJK Unified Ideographs"](i)||d.isChar["Hangul Syllables"](i)||d.isChar.Hiragana(i)||d.isChar.Katakana(i))},nr.prototype._tinySDF=function(i,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=i.tinySDF;if(!g){var S="400";/bold/i.test(u)?S="900":/medium/i.test(u)?S="500":/light/i.test(u)&&(S="200"),g=i.tinySDF=new nr.TinySDF(24,3,8,.25,h,S)}return{id:a,bitmap:new d.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},nr.loadGlyphRange=function(i,u,a,h,g){var S=256*u,T=S+255,R=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",i).replace("{range}",S+"-"+T),d.ResourceType.Glyphs);d.getArrayBuffer(R,function(V,ee){if(V)g(V);else if(ee){for(var ve={},ye=0,Ee=d.parseGlyphPBF(ee);ye<Ee.length;ye+=1){var Ye=Ee[ye];ve[Ye.id]=Ye}g(null,ve)}})},nr.TinySDF=kt;var xt=function(){this.specification=d.styleSpec.light.position};xt.prototype.possiblyEvaluate=function(i,u){return d.sphericalToCartesian(i.expression.evaluate(u))},xt.prototype.interpolate=function(i,u,a){return{x:d.number(i.x,u.x,a),y:d.number(i.y,u.y,a),z:d.number(i.z,u.z,a)}};var Ke=new d.Properties({anchor:new d.DataConstantProperty(d.styleSpec.light.anchor),position:new xt,color:new d.DataConstantProperty(d.styleSpec.light.color),intensity:new d.DataConstantProperty(d.styleSpec.light.intensity)}),_t=function(i){function u(a){i.call(this),this._transitionable=new d.Transitionable(Ke),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(d.validateLight,a,h))for(var g in a){var S=a[g];d.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),S):this._transitionable.setValue(g,S)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&d.emitValidationErrors(this,a.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.styleSpec})))},u}(d.Evented),Fe=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Fe.prototype.getDash=function(i,u){var a=i.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(i,u)),this.dashEntry[a]},Fe.prototype.getDashRanges=function(i,u,a){var h=[],g=i.length%2==1?-i[i.length-1]*a:0,S=i[0]*a,T=!0;h.push({left:g,right:S,isDash:T,zeroLength:i[0]===0});for(var R=i[0],V=1;V<i.length;V++){var ee=i[V];h.push({left:g=R*a,right:S=(R+=ee)*a,isDash:T=!T,zeroLength:ee===0})}return h},Fe.prototype.addRoundDash=function(i,u,a){for(var h=u/2,g=-a;g<=a;g++)for(var S=this.width*(this.nextRow+a+g),T=0,R=i[T],V=0;V<this.width;V++){V/R.right>1&&(R=i[++T]);var ee=Math.abs(V-R.left),ve=Math.abs(V-R.right),ye=Math.min(ee,ve),Ee=void 0,Ye=g/a*(h+1);if(R.isDash){var Ge=h-Math.abs(Ye);Ee=Math.sqrt(ye*ye+Ge*Ge)}else Ee=h-Math.sqrt(ye*ye+Ye*Ye);this.data[S+V]=Math.max(0,Math.min(255,Ee+128))}},Fe.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var a=i[u],h=i[u+1];a.zeroLength?i.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,i.splice(u,1))}var g=i[0],S=i[i.length-1];g.isDash===S.isDash&&(g.left=S.left-this.width,S.right=g.right+this.width);for(var T=this.width*this.nextRow,R=0,V=i[R],ee=0;ee<this.width;ee++){ee/V.right>1&&(V=i[++R]);var ve=Math.abs(ee-V.left),ye=Math.abs(ee-V.right),Ee=Math.min(ve,ye);this.data[T+ee]=Math.max(0,Math.min(255,(V.isDash?Ee:-Ee)+128))}},Fe.prototype.addDash=function(i,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return d.warnOnce("LineAtlas out of space"),null;for(var g=0,S=0;S<i.length;S++)g+=i[S];if(g!==0){var T=this.width/g,R=this.getDashRanges(i,this.width,T);u?this.addRoundDash(R,T,a):this.addRegularDash(R)}var V={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,V},Fe.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Pe=function i(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=d.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var S=new i.Actor(h[g],a,this.id);S.name="Worker "+g,this.actors.push(S)}};function Ve(i,u,a){var h=function(g,S){if(g)return a(g);if(S){var T=d.pick(d.extend(S,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(T.vectorLayers=S.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=u.canonicalizeTileset(T,i.url),a(null,T)}};return i.url?d.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),d.ResourceType.Source),h):d.browser.frame(function(){return h(null,i)})}Pe.prototype.broadcast=function(i,u,a){d.asyncAll(this.actors,function(h,g){h.send(i,u,g)},a=a||function(){})},Pe.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Pe.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Pe.Actor=d.Actor;var Et=function(i,u,a){this.bounds=d.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=a||24};Et.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},Et.prototype.contains=function(i){var u=Math.pow(2,i.z),a=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),S=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=a&&i.x<g&&i.y>=h&&i.y<S};var gr=function(i){function u(a,h,g,S){if(i.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(h,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ve(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new d.ErrorEvent(h)):g&&(d.extend(a,g),g.bounds&&(a.tileBounds=new Et(g.bounds,a.minzoom,a.maxzoom)),d.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),d.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(g,d.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,V){return delete a.request,a.aborted?h(null):R&&R.status!==404?h(R):(V&&V.resourceTiming&&(a.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&a.setExpiryData(V),a.loadVectorData(V,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",S,T.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",S,T.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(d.Evented),ae=function(i){function u(a,h,g,S){i.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ve(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new d.ErrorEvent(h)):g&&(d.extend(a,g),g.bounds&&(a.tileBounds=new Et(g.bounds,a.minzoom,a.maxzoom)),d.postTurnstileEvent(g.tiles),d.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var g=this,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=d.getImage(this.map._requestManager.transformRequest(S,d.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){g.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var V=g.map.painter.context,ee=V.gl;a.texture=g.map.painter.getTileTexture(R.width),a.texture?a.texture.update(R,{useMipmap:!0}):(a.texture=new d.Texture(V,R,ee.RGBA,{useMipmap:!0}),a.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),a.state="loaded",d.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Ae=function(i){function u(a,h,g,S){i.call(this,a,h,g,S),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(T,R){T&&(a.state="errored",h(T)),R&&(a.dem=R,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=d.getImage(this.map._requestManager.transformRequest(g,d.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var V=d.window.ImageBitmap&&R instanceof d.window.ImageBitmap&&d.offscreenCanvasSupported()?R:d.browser.getImageData(R,1),ee={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:V,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",ee,S.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),S=(h.x-1+g)%g,T=h.x===0?a.wrap-1:a.wrap,R=(h.x+1+g)%g,V=h.x+1===g?a.wrap+1:a.wrap,ee={};return ee[new d.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y).key]={backfilled:!1},ee[new d.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(ee[new d.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y-1).key]={backfilled:!1},ee[new d.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ee[new d.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ee[new d.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y+1).key]={backfilled:!1},ee[new d.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ee[new d.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y+1).key]={backfilled:!1}),ee},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(ae),oe=function(i){function u(a,h,g,S){i.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(S),this._data=h.data,this._options=d.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:d.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new d.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new d.Event("data",g))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new d.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new d.Event("data",S))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,g,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},S),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=d.extend({},this.workerOptions),S=this._data;typeof S=="string"?(g.request=this.map._requestManager.transformRequest(d.browser.resolveURL(S),d.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(S),this.actor.send(this.type+".loadData",g,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var g=this,S=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(S,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete a.request,a.unloadVectorData(),a.aborted?h(null):T?h(T):(a.loadVectorData(R,g.map.painter,S==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return d.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(d.Evented),ge=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Me=function(i){function u(a,h,g,S){i.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),function(S,T){g._loaded=!0,S?g.fire(new d.ErrorEvent(S)):T&&(g.image=T,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,V=1/0,ee=-1/0,ve=-1/0,ye=0,Ee=T;ye<Ee.length;ye+=1){var Ye=Ee[ye];R=Math.min(R,Ye.x),V=Math.min(V,Ye.y),ee=Math.max(ee,Ye.x),ve=Math.max(ve,Ye.y)}var Ge=Math.max(ee-R,ve-V),nt=Math.max(0,Math.floor(-Math.log(Ge)/Math.LN2)),Ne=Math.pow(2,nt);return new d.CanonicalTileID(nt,Math.floor((R+ee)/2*Ne),Math.floor((V+ve)/2*Ne))}(g),this.minzoom=this.maxzoom=this.tileID.z;var S=g.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ge.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Qe=function(i){function u(a,h,g,S){i.call(this,a,h,g,S),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,S=h.urls;g<S.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(S[g],d.ResourceType.Source).url);d.getVideo(this.urls,function(T,R){a._loaded=!0,T?a.fire(new d.ErrorEvent(T)):R&&(a.video=R,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ge.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Me),gt=function(i){function u(a,h,g,S){i.call(this,a,h,g,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new d.ErrorEvent(new d.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ge.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},u}(Me),Jt={vector:gr,raster:ae,"raster-dem":Ae,geojson:oe,video:Qe,image:Me,canvas:gt};function Dr(i,u){var a=d.identity([]);return d.translate(a,a,[1,1,0]),d.scale(a,a,[.5*i.width,.5*i.height,1]),d.multiply(a,a,i.calculatePosMatrix(u.toUnwrapped()))}function Br(i,u,a,h,g,S){var T=function(nt,Ne,rt){if(nt)for(var dt=0,zt=nt;dt<zt.length;dt+=1){var ar=Ne[zt[dt]];if(ar&&ar.source===rt&&ar.type==="fill-extrusion")return!0}else for(var rr in Ne){var or=Ne[rr];if(or.source===rt&&or.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,i.id),R=S.maxPitchScaleFactor(),V=i.tilesIn(h,R,T);V.sort(un);for(var ee=[],ve=0,ye=V;ve<ye.length;ve+=1){var Ee=ye[ve];ee.push({wrappedTileID:Ee.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(u,a,i._state,Ee.queryGeometry,Ee.cameraQueryGeometry,Ee.scale,g,S,R,Dr(i.transform,Ee.tileID))})}var Ye=function(nt){for(var Ne={},rt={},dt=0,zt=nt;dt<zt.length;dt+=1){var ar=zt[dt],rr=ar.queryResults,or=ar.wrappedTileID,Lr=rt[or]=rt[or]||{};for(var tn in rr)for(var Xr=rr[tn],yn=Lr[tn]=Lr[tn]||{},Fn=Ne[tn]=Ne[tn]||[],Vn=0,jn=Xr;Vn<jn.length;Vn+=1){var Qi=jn[Vn];yn[Qi.featureIndex]||(yn[Qi.featureIndex]=!0,Fn.push(Qi))}}return Ne}(ee);for(var Ge in Ye)Ye[Ge].forEach(function(nt){var Ne=nt.feature,rt=i.getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=rt});return Ye}function un(i,u){var a=i.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var tr=function(i,u){this.max=i,this.onRemove=u,this.reset()};tr.prototype.reset=function(){for(var i in this.data)for(var u=0,a=this.data[i];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},tr.prototype.add=function(i,u,a){var h=this,g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var S={value:u,timeout:void 0};if(a!==void 0&&(S.timeout=setTimeout(function(){h.remove(i,S)},a)),this.data[g].push(S),this.order.push(g),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},tr.prototype.has=function(i){return i.wrapped().key in this.data},tr.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},tr.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},tr.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},tr.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},tr.prototype.remove=function(i,u){if(!this.has(i))return this;var a=i.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},tr.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},tr.prototype.filter=function(i){var u=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var S=g[h];i(S.value)||u.push(S)}for(var T=0,R=u;T<R.length;T+=1){var V=R[T];this.remove(V.value.tileID,V)}};var se=function(i,u,a){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};se.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},se.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},se.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var be={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},ke=function(i,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var g=i.gl;this.buffer=g.createBuffer(),i.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};ke.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},ke.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},ke.prototype.enableAttributes=function(i,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&i.enableVertexAttribArray(h)}},ke.prototype.setVertexAttribPointers=function(i,u,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],S=u.attributes[g.name];S!==void 0&&i.vertexAttribPointer(S,g.components,i[be[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},ke.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ce=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ce.prototype.get=function(){return this.current},Ce.prototype.set=function(i){},Ce.prototype.getDefault=function(){return this.default},Ce.prototype.setDefault=function(){this.set(this.default)};var Pt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Ce),Dt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(Ce),E=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(Ce),N=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Ce),he=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(Ce),Ze=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(Ce),qe=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(Ce),mt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(Ce),Ct=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(Ce),H=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Ce),Kt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(Ce),jt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(Ce),hr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(Ce),Cr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Ce),Tr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Ce),Pr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(Ce),Je=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(Ce),yt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(Ce),ht=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(Ce),fr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(Ce),$r=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(Ce),lt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Ce),Rt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(Ce),Qt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(Ce),pr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(Ce),vn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(Ce),Pn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(Ce),bi=function(i){function u(a){i.call(this,a),this.vao=a.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(Ce),Si=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(Ce),Ri=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(Ce),ia=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(Ce),pi=function(i){function u(a,h){i.call(this,a),this.context=a,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Ce),G=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(pi),ie=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(pi),ce=function(i,u,a,h){this.context=i,this.width=u,this.height=a;var g=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new G(i,g),h&&(this.depthAttachment=new ie(i,g))};ce.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}i.deleteFramebuffer(this.framebuffer)};var B=function(i,u,a){this.func=i,this.mask=u,this.range=a};B.ReadOnly=!1,B.ReadWrite=!0,B.disabled=new B(519,B.ReadOnly,[0,1]);var re=function(i,u,a,h,g,S){this.test=i,this.ref=u,this.mask=a,this.fail=h,this.depthFail=g,this.pass=S};re.disabled=new re({func:519,mask:0},0,0,7680,7680,7680);var fe=function(i,u,a){this.blendFunction=i,this.blendColor=u,this.mask=a};fe.disabled=new fe(fe.Replace=[1,0],d.Color.transparent,[!1,!1,!1,!1]),fe.unblended=new fe(fe.Replace,d.Color.transparent,[!0,!0,!0,!0]),fe.alphaBlended=new fe([1,771],d.Color.transparent,[!0,!0,!0,!0]);var Se=function(i,u,a){this.enable=i,this.mode=u,this.frontFace=a};Se.disabled=new Se(!1,1029,2305),Se.backCCW=new Se(!0,1029,2305);var te=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Pt(this),this.clearDepth=new Dt(this),this.clearStencil=new E(this),this.colorMask=new N(this),this.depthMask=new he(this),this.stencilMask=new Ze(this),this.stencilFunc=new qe(this),this.stencilOp=new mt(this),this.stencilTest=new Ct(this),this.depthRange=new H(this),this.depthTest=new Kt(this),this.depthFunc=new jt(this),this.blend=new hr(this),this.blendFunc=new Cr(this),this.blendColor=new Tr(this),this.blendEquation=new Pr(this),this.cullFace=new Je(this),this.cullFaceSide=new yt(this),this.frontFace=new ht(this),this.program=new fr(this),this.activeTexture=new $r(this),this.viewport=new lt(this),this.bindFramebuffer=new Rt(this),this.bindRenderbuffer=new Qt(this),this.bindTexture=new pr(this),this.bindVertexBuffer=new vn(this),this.bindElementBuffer=new Pn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bi(this),this.pixelStoreUnpack=new Si(this),this.pixelStoreUnpackPremultiplyAlpha=new Ri(this),this.pixelStoreUnpackFlipY=new ia(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},te.prototype.createIndexBuffer=function(i,u){return new se(this,i,u)},te.prototype.createVertexBuffer=function(i,u,a){return new ke(this,i,u,a)},te.prototype.createRenderbuffer=function(i,u,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,i,u,a),this.bindRenderbuffer.set(null),g},te.prototype.createFramebuffer=function(i,u,a){return new ce(this,i,u,a)},te.prototype.clear=function(i){var u=i.color,a=i.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},te.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},te.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},te.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},te.prototype.setColorMode=function(i){d.deepEqual(i.blendFunction,fe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var me=function(i){function u(a,h,g){var S=this;i.call(this),this.id=a,this.dispatcher=g,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(T,R,V,ee){var ve=new Jt[R.type](T,R,V,ee);if(ve.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ve.id);return d.bindAll(["load","abort","unload","serialize","prepare"],ve),ve}(a,h,g,this),this._tiles={},this._cache=new tr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new d.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return d.values(this._tiles).map(function(a){return a.tileID}).sort(ct).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,g=[];for(var S in this._tiles)this._isIdRenderable(S,a)&&g.push(this._tiles[S]);return a?g.sort(function(T,R){var V=T.tileID,ee=R.tileID,ve=new d.Point(V.canonical.x,V.canonical.y)._rotate(h.transform.angle),ye=new d.Point(ee.canonical.x,ee.canonical.y)._rotate(h.transform.angle);return V.overscaledZ-ee.overscaledZ||ye.y-ve.y||ye.x-ve.x}).map(function(T){return T.tileID.key}):g.map(function(T){return T.tileID}).sort(ct).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},u.prototype._tileLoaded=function(a,h,g,S){if(S)return a.state="errored",void(S.status!==404?this._source.fire(new d.ErrorEvent(S,{tile:a})):this.update(this.transform));a.timeAdded=d.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new d.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var S=h[g];if(a.neighboringTiles&&a.neighboringTiles[S]){var T=this.getTileByID(S);R(a,T),R(T,a)}}function R(V,ee){V.needsHillshadePrepare=!0;var ve=ee.tileID.canonical.x-V.tileID.canonical.x,ye=ee.tileID.canonical.y-V.tileID.canonical.y,Ee=Math.pow(2,V.tileID.canonical.z),Ye=ee.tileID.key;ve===0&&ye===0||Math.abs(ye)>1||(Math.abs(ve)>1&&(Math.abs(ve+Ee)===1?ve+=Ee:Math.abs(ve-Ee)===1&&(ve-=Ee)),ee.dem&&V.dem&&(V.dem.backfillBorder(ee.dem,ve,ye),V.neighboringTiles&&V.neighboringTiles[Ye]&&(V.neighboringTiles[Ye].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,g,S){for(var T in this._tiles){var R=this._tiles[T];if(!(S[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>g)){for(var V=R.tileID;R&&R.tileID.overscaledZ>h+1;){var ee=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[ee.key])&&R.hasData()&&(V=ee)}for(var ve=V;ve.overscaledZ>h;)if(a[(ve=ve.scaledTo(ve.overscaledZ-1)).key]){S[V.key]=V;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var S=a.overscaledZ-1;S>=h;S--){var T=a.scaledTo(S),R=this._getLoadedTile(T);if(R)return R}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,S=Math.floor(h*g*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var S in this._tiles){var T=this._tiles[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),g[T.tileID.key]=T}for(var R in this._tiles=g,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Lr){return new d.OverscaledTileID(Lr.canonical.z,Lr.wrap,Lr.canonical.z,Lr.canonical.x,Lr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Lr){return h._source.hasTile(Lr)}))):g=[];var S=a.coveringZoomLevel(this._source),T=Math.max(S-u.maxOverzooming,this._source.minzoom),R=Math.max(S+u.maxUnderzooming,this._source.minzoom),V=this._updateRetainedTiles(g,S);if(yr(this._source.type)){for(var ee={},ve={},ye=0,Ee=Object.keys(V);ye<Ee.length;ye+=1){var Ye=Ee[ye],Ge=V[Ye],nt=this._tiles[Ye];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=d.browser.now())){var Ne=this.findLoadedParent(Ge,T);Ne&&(this._addTile(Ne.tileID),ee[Ne.tileID.key]=Ne.tileID),ve[Ye]=Ge}}for(var rt in this._retainLoadedChildren(ve,S,R,V),ee)V[rt]||(this._coveredTiles[rt]=!0,V[rt]=ee[rt])}for(var dt in V)this._tiles[dt].clearFadeHold();for(var zt=0,ar=d.keysDifference(this._tiles,V);zt<ar.length;zt+=1){var rr=ar[zt],or=this._tiles[rr];or.hasSymbolBuckets&&!or.holdingForFade()?or.setHoldDuration(this.map._fadeDuration):or.hasSymbolBuckets&&!or.symbolFadeFinished()||this._removeTile(rr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var g={},S={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),R=Math.max(h+u.maxUnderzooming,this._source.minzoom),V={},ee=0,ve=a;ee<ve.length;ee+=1){var ye=ve[ee],Ee=this._addTile(ye);g[ye.key]=ye,Ee.hasData()||h<this._source.maxzoom&&(V[ye.key]=ye)}this._retainLoadedChildren(V,h,R,g);for(var Ye=0,Ge=a;Ye<Ge.length;Ye+=1){var nt=Ge[Ye],Ne=this._tiles[nt.key];if(!Ne.hasData()){if(h+1>this._source.maxzoom){var rt=nt.children(this._source.maxzoom)[0],dt=this.getTile(rt);if(dt&&dt.hasData()){g[rt.key]=rt;continue}}else{var zt=nt.children(this._source.maxzoom);if(g[zt[0].key]&&g[zt[1].key]&&g[zt[2].key]&&g[zt[3].key])continue}for(var ar=Ne.wasRequested(),rr=nt.overscaledZ-1;rr>=T;--rr){var or=nt.scaledTo(rr);if(S[or.key]||(S[or.key]=!0,!(Ne=this.getTile(or))&&ar&&(Ne=this._addTile(or)),Ne&&(g[or.key]=or,ar=Ne.wasRequested(),Ne.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,S=this._tiles[a].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){g=this._loadedParentTiles[S.key];break}h.push(S.key);var T=S.scaledTo(S.overscaledZ-1);if(g=this._getLoadedTile(T))break;S=T}for(var R=0,V=h;R<V.length;R+=1)this._loadedParentTiles[V[R]]=g}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new d.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new d.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var S=h.getExpiryTimeout();S&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},S))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,g){var S=this,T=[],R=this.transform;if(!R)return T;for(var V=g?R.getCameraQueryGeometry(a):a,ee=a.map(function(rr){return R.pointCoordinate(rr)}),ve=V.map(function(rr){return R.pointCoordinate(rr)}),ye=this.getIds(),Ee=1/0,Ye=1/0,Ge=-1/0,nt=-1/0,Ne=0,rt=ve;Ne<rt.length;Ne+=1){var dt=rt[Ne];Ee=Math.min(Ee,dt.x),Ye=Math.min(Ye,dt.y),Ge=Math.max(Ge,dt.x),nt=Math.max(nt,dt.y)}for(var zt=function(rr){var or=S._tiles[ye[rr]];if(!or.holdingForFade()){var Lr=or.tileID,tn=Math.pow(2,R.zoom-or.tileID.overscaledZ),Xr=h*or.queryPadding*d.EXTENT/or.tileSize/tn,yn=[Lr.getTilePoint(new d.MercatorCoordinate(Ee,Ye)),Lr.getTilePoint(new d.MercatorCoordinate(Ge,nt))];if(yn[0].x-Xr<d.EXTENT&&yn[0].y-Xr<d.EXTENT&&yn[1].x+Xr>=0&&yn[1].y+Xr>=0){var Fn=ee.map(function(jn){return Lr.getTilePoint(jn)}),Vn=ve.map(function(jn){return Lr.getTilePoint(jn)});T.push({tile:or,tileID:Lr,queryGeometry:Fn,cameraQueryGeometry:Vn,scale:tn})}}},ar=0;ar<ye.length;ar++)zt(ar);return T},u.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(V){return h._tiles[V].tileID}),S=0,T=g;S<T.length;S+=1){var R=T[S];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(yr(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=d.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,g){var S=this._tiles[a];S&&S.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(S){return!S.hasDependency(a,h)})},u}(d.Evented);function ct(i,u){var a=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-a||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function yr(i){return i==="raster"||i==="image"||i==="video"}function Or(){return new d.window.Worker(Sc.workerUrl)}me.maxOverzooming=10,me.maxUnderzooming=3;var Ft="mapboxgl_preloaded_worker_pool",kr=function(){this.active={}};kr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<kr.workerCount;)this.workers.push(new Or);return this.active[i]=!0,this.workers.slice()},kr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},kr.prototype.isPreloaded=function(){return!!this.active[Ft]},kr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,gn=Math.floor(d.browser.hardwareConcurrency/2);function mr(){return bn||(bn=new kr),bn}function dn(i,u){var a={};for(var h in i)h!=="ref"&&(a[h]=i[h]);return d.refProperties.forEach(function(g){g in u&&(a[g]=u[g])}),a}function Wr(i){i=i.slice();for(var u=Object.create(null),a=0;a<i.length;a++)u[i[a].id]=i[a];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=dn(i[h],u[i[h].ref]));return i}kr.workerCount=Math.max(Math.min(gn,6),1);var ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ei(i,u,a){a.push({command:ln.addSource,args:[i,u[i]]})}function hn(i,u,a){u.push({command:ln.removeSource,args:[i]}),a[i]=!0}function wi(i,u,a,h){hn(i,a,h),Ei(i,u,a)}function Yi(i,u,a){var h;for(h in i[a])if(i[a].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[a][h],u[a][h]))return!1;return!0}function Yn(i,u,a,h,g,S){var T;for(T in u=u||{},i=i||{})i.hasOwnProperty(T)&&(d.deepEqual(i[T],u[T])||a.push({command:S,args:[h,T,u[T],g]}));for(T in u)u.hasOwnProperty(T)&&!i.hasOwnProperty(T)&&(d.deepEqual(i[T],u[T])||a.push({command:S,args:[h,T,u[T],g]}))}function Di(i){return i.id}function ki(i,u){return i[u.id]=u,i}var za=function(i,u){this.reset(i,u)};za.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},za.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=d.clamp(i,0,1);for(var u=1,a=this._distances[u],h=i*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var g=u-1,S=this._distances[g],T=a-S,R=T>0?(h-S)/T:0;return this.points[g].mult(1-R).add(this.points[u].mult(R))};var Wn=function(i,u,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(i/a),this.yCellCount=Math.ceil(u/a);for(var S=0;S<this.xCellCount*this.yCellCount;S++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function ai(i,u,a,h,g){var S=d.create();return u?(d.scale(S,S,[1/g,1/g,1]),a||d.rotateZ(S,S,h.angle)):d.multiply(S,h.labelPlaneMatrix,i),S}function Ai(i,u,a,h,g){if(u){var S=d.clone(i);return d.scale(S,S,[g,g,1]),a||d.rotateZ(S,S,-h.angle),S}return h.glCoordMatrix}function Qn(i,u){var a=[i.x,i.y,0,1];$a(a,a,u);var h=a[3];return{point:new d.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Fi(i,u){return .5+i/u*.5}function ya(i,u){var a=i[0]/i[3],h=i[1]/i[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function Xa(i,u,a,h,g,S,T,R){var V=h?i.textSizeData:i.iconSizeData,ee=d.evaluateSizeForZoom(V,a.transform.zoom),ve=[256/a.width*2+1,256/a.height*2+1],ye=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;ye.clear();for(var Ee=i.lineVertexArray,Ye=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,Ge=a.transform.width/a.transform.height,nt=!1,Ne=0;Ne<Ye.length;Ne++){var rt=Ye.get(Ne);if(rt.hidden||rt.writingMode===d.WritingMode.vertical&&!nt)Ka(rt.numGlyphs,ye);else{nt=!1;var dt=[rt.anchorX,rt.anchorY,0,1];if(d.transformMat4(dt,dt,u),ya(dt,ve)){var zt=Fi(a.transform.cameraToCenterDistance,dt[3]),ar=d.evaluateSizeForFeature(V,ee,rt),rr=T?ar/zt:ar*zt,or=new d.Point(rt.anchorX,rt.anchorY),Lr=Qn(or,g).point,tn={},Xr=Vu(rt,rr,!1,R,u,g,S,i.glyphOffsetArray,Ee,ye,Lr,or,tn,Ge);nt=Xr.useVertical,(Xr.notEnoughRoom||nt||Xr.needsFlipping&&Vu(rt,rr,!0,R,u,g,S,i.glyphOffsetArray,Ee,ye,Lr,or,tn,Ge).notEnoughRoom)&&Ka(rt.numGlyphs,ye)}else Ka(rt.numGlyphs,ye)}}h?i.text.dynamicLayoutVertexBuffer.updateData(ye):i.icon.dynamicLayoutVertexBuffer.updateData(ye)}function _a(i,u,a,h,g,S,T,R,V,ee,ve){var ye=R.glyphStartIndex+R.numGlyphs,Ee=R.lineStartIndex,Ye=R.lineStartIndex+R.lineLength,Ge=u.getoffsetX(R.glyphStartIndex),nt=u.getoffsetX(ye-1),Ne=gi(i*Ge,a,h,g,S,T,R.segment,Ee,Ye,V,ee,ve);if(!Ne)return null;var rt=gi(i*nt,a,h,g,S,T,R.segment,Ee,Ye,V,ee,ve);return rt?{first:Ne,last:rt}:null}function da(i,u,a,h){return i===d.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(i===d.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function Vu(i,u,a,h,g,S,T,R,V,ee,ve,ye,Ee,Ye){var Ge,nt=u/24,Ne=i.lineOffsetX*nt,rt=i.lineOffsetY*nt;if(i.numGlyphs>1){var dt=i.glyphStartIndex+i.numGlyphs,zt=i.lineStartIndex,ar=i.lineStartIndex+i.lineLength,rr=_a(nt,R,Ne,rt,a,ve,ye,i,V,S,Ee);if(!rr)return{notEnoughRoom:!0};var or=Qn(rr.first.point,T).point,Lr=Qn(rr.last.point,T).point;if(h&&!a){var tn=da(i.writingMode,or,Lr,Ye);if(tn)return tn}Ge=[rr.first];for(var Xr=i.glyphStartIndex+1;Xr<dt-1;Xr++)Ge.push(gi(nt*R.getoffsetX(Xr),Ne,rt,a,ve,ye,i.segment,zt,ar,V,S,Ee));Ge.push(rr.last)}else{if(h&&!a){var yn=Qn(ye,g).point,Fn=i.lineStartIndex+i.segment+1,Vn=new d.Point(V.getx(Fn),V.gety(Fn)),jn=Qn(Vn,g),Qi=jn.signedDistanceFromCamera>0?jn.point:Ya(ye,Vn,yn,1,g),_n=da(i.writingMode,yn,Qi,Ye);if(_n)return _n}var ci=gi(nt*R.getoffsetX(i.glyphStartIndex),Ne,rt,a,ve,ye,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,V,S,Ee);if(!ci)return{notEnoughRoom:!0};Ge=[ci]}for(var Ci=0,fi=Ge;Ci<fi.length;Ci+=1){var oi=fi[Ci];d.addDynamicAttributes(ee,oi.point,oi.angle)}return{}}function Ya(i,u,a,h,g){var S=Qn(i.add(i.sub(u)._unit()),g).point,T=a.sub(S);return a.add(T._mult(h/T.mag()))}function gi(i,u,a,h,g,S,T,R,V,ee,ve,ye){var Ee=h?i-u:i+u,Ye=Ee>0?1:-1,Ge=0;h&&(Ye*=-1,Ge=Math.PI),Ye<0&&(Ge+=Math.PI);for(var nt=Ye>0?R+T:R+T+1,Ne=g,rt=g,dt=0,zt=0,ar=Math.abs(Ee),rr=[];dt+zt<=ar;){if((nt+=Ye)<R||nt>=V)return null;if(rt=Ne,rr.push(Ne),(Ne=ye[nt])===void 0){var or=new d.Point(ee.getx(nt),ee.gety(nt)),Lr=Qn(or,ve);if(Lr.signedDistanceFromCamera>0)Ne=ye[nt]=Lr.point;else{var tn=nt-Ye;Ne=Ya(dt===0?S:new d.Point(ee.getx(tn),ee.gety(tn)),or,rt,ar-dt+1,ve)}}dt+=zt,zt=rt.dist(Ne)}var Xr=(ar-dt)/zt,yn=Ne.sub(rt),Fn=yn.mult(Xr)._add(rt);Fn._add(yn._unit()._perp()._mult(a*Ye));var Vn=Ge+Math.atan2(Ne.y-rt.y,Ne.x-rt.x);return rr.push(Fn),{point:Fn,angle:Vn,path:rr}}Wn.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Wn.prototype.insert=function(i,u,a,h,g){this._forEachCell(u,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},Wn.prototype.insertCircle=function(i,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(a),this.circles.push(h)},Wn.prototype._insertBoxCell=function(i,u,a,h,g,S){this.boxCells[g].push(S)},Wn.prototype._insertCircleCell=function(i,u,a,h,g,S){this.circleCells[g].push(S)},Wn.prototype._query=function(i,u,a,h,g,S){if(a<0||i>this.width||h<0||u>this.height)return!g&&[];var T=[];if(i<=0&&u<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var V=0;V<this.circleKeys.length;V++){var ee=this.circles[3*V],ve=this.circles[3*V+1],ye=this.circles[3*V+2];T.push({key:this.circleKeys[V],x1:ee-ye,y1:ve-ye,x2:ee+ye,y2:ve+ye})}return S?T.filter(S):T}return this._forEachCell(i,u,a,h,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},S),g?T.length>0:T},Wn.prototype._queryCircle=function(i,u,a,h,g){var S=i-a,T=i+a,R=u-a,V=u+a;if(T<0||S>this.width||V<0||R>this.height)return!h&&[];var ee=[];return this._forEachCell(S,R,T,V,this._queryCellCircle,ee,{hitTest:h,circle:{x:i,y:u,radius:a},seenUids:{box:{},circle:{}}},g),h?ee.length>0:ee},Wn.prototype.query=function(i,u,a,h,g){return this._query(i,u,a,h,!1,g)},Wn.prototype.hitTest=function(i,u,a,h,g){return this._query(i,u,a,h,!0,g)},Wn.prototype.hitTestCircle=function(i,u,a,h){return this._queryCircle(i,u,a,!0,h)},Wn.prototype._queryCell=function(i,u,a,h,g,S,T,R){var V=T.seenUids,ee=this.boxCells[g];if(ee!==null)for(var ve=this.bboxes,ye=0,Ee=ee;ye<Ee.length;ye+=1){var Ye=Ee[ye];if(!V.box[Ye]){V.box[Ye]=!0;var Ge=4*Ye;if(i<=ve[Ge+2]&&u<=ve[Ge+3]&&a>=ve[Ge+0]&&h>=ve[Ge+1]&&(!R||R(this.boxKeys[Ye]))){if(T.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Ye],x1:ve[Ge],y1:ve[Ge+1],x2:ve[Ge+2],y2:ve[Ge+3]})}}}var nt=this.circleCells[g];if(nt!==null)for(var Ne=this.circles,rt=0,dt=nt;rt<dt.length;rt+=1){var zt=dt[rt];if(!V.circle[zt]){V.circle[zt]=!0;var ar=3*zt;if(this._circleAndRectCollide(Ne[ar],Ne[ar+1],Ne[ar+2],i,u,a,h)&&(!R||R(this.circleKeys[zt]))){if(T.hitTest)return S.push(!0),!0;var rr=Ne[ar],or=Ne[ar+1],Lr=Ne[ar+2];S.push({key:this.circleKeys[zt],x1:rr-Lr,y1:or-Lr,x2:rr+Lr,y2:or+Lr})}}}},Wn.prototype._queryCellCircle=function(i,u,a,h,g,S,T,R){var V=T.circle,ee=T.seenUids,ve=this.boxCells[g];if(ve!==null)for(var ye=this.bboxes,Ee=0,Ye=ve;Ee<Ye.length;Ee+=1){var Ge=Ye[Ee];if(!ee.box[Ge]){ee.box[Ge]=!0;var nt=4*Ge;if(this._circleAndRectCollide(V.x,V.y,V.radius,ye[nt+0],ye[nt+1],ye[nt+2],ye[nt+3])&&(!R||R(this.boxKeys[Ge])))return S.push(!0),!0}}var Ne=this.circleCells[g];if(Ne!==null)for(var rt=this.circles,dt=0,zt=Ne;dt<zt.length;dt+=1){var ar=zt[dt];if(!ee.circle[ar]){ee.circle[ar]=!0;var rr=3*ar;if(this._circlesCollide(rt[rr],rt[rr+1],rt[rr+2],V.x,V.y,V.radius)&&(!R||R(this.circleKeys[ar])))return S.push(!0),!0}}},Wn.prototype._forEachCell=function(i,u,a,h,g,S,T,R){for(var V=this._convertToXCellCoord(i),ee=this._convertToYCellCoord(u),ve=this._convertToXCellCoord(a),ye=this._convertToYCellCoord(h),Ee=V;Ee<=ve;Ee++)for(var Ye=ee;Ye<=ye;Ye++)if(g.call(this,i,u,a,h,this.xCellCount*Ye+Ee,S,T,R))return},Wn.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},Wn.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},Wn.prototype._circlesCollide=function(i,u,a,h,g,S){var T=h-i,R=g-u,V=a+S;return V*V>T*T+R*R},Wn.prototype._circleAndRectCollide=function(i,u,a,h,g,S,T){var R=(S-h)/2,V=Math.abs(i-(h+R));if(V>R+a)return!1;var ee=(T-g)/2,ve=Math.abs(u-(g+ee));if(ve>ee+a)return!1;if(V<=R||ve<=ee)return!0;var ye=V-R,Ee=ve-ee;return ye*ye+Ee*Ee<=a*a};var qa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ka(i,u){for(var a=0;a<i;a++){var h=u.length;u.resize(h+4),u.float32.set(qa,3*h)}}function $a(i,u,a){var h=u[0],g=u[1];return i[0]=a[0]*h+a[4]*g+a[12],i[1]=a[1]*h+a[5]*g+a[13],i[3]=a[3]*h+a[7]*g+a[15],i}var Yo=function(i,u,a){u===void 0&&(u=new Wn(i.width+200,i.height+200,25)),a===void 0&&(a=new Wn(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function Gi(i,u,a){return u*(d.EXTENT/(i.tileSize*Math.pow(2,a-i.tileID.overscaledZ)))}Yo.prototype.placeCollisionBox=function(i,u,a,h,g){var S=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),T=a*S.perspectiveRatio,R=i.x1*T+S.point.x,V=i.y1*T+S.point.y,ee=i.x2*T+S.point.x,ve=i.y2*T+S.point.y;return!this.isInsideGrid(R,V,ee,ve)||!u&&this.grid.hitTest(R,V,ee,ve,g)?{box:[],offscreen:!1}:{box:[R,V,ee,ve],offscreen:this.isOffscreen(R,V,ee,ve)}},Yo.prototype.placeCollisionCircles=function(i,u,a,h,g,S,T,R,V,ee,ve,ye,Ee){var Ye=[],Ge=new d.Point(u.anchorX,u.anchorY),nt=Qn(Ge,S),Ne=Fi(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),rt=(ee?g/Ne:g*Ne)/d.ONE_EM,dt=Qn(Ge,T).point,zt=_a(rt,h,u.lineOffsetX*rt,u.lineOffsetY*rt,!1,dt,Ge,u,a,T,{}),ar=!1,rr=!1,or=!0;if(zt){for(var Lr=.5*ye*Ne+Ee,tn=new d.Point(-100,-100),Xr=new d.Point(this.screenRightBoundary,this.screenBottomBoundary),yn=new za,Fn=zt.first,Vn=zt.last,jn=[],Qi=Fn.path.length-1;Qi>=1;Qi--)jn.push(Fn.path[Qi]);for(var _n=1;_n<Vn.path.length;_n++)jn.push(Vn.path[_n]);var ci=2.5*Lr;if(R){var Ci=jn.map(function(Ls){return Qn(Ls,R)});jn=Ci.some(function(Ls){return Ls.signedDistanceFromCamera<=0})?[]:Ci.map(function(Ls){return Ls.point})}var fi=[];if(jn.length>0){for(var oi=jn[0].clone(),Ti=jn[0].clone(),ii=1;ii<jn.length;ii++)oi.x=Math.min(oi.x,jn[ii].x),oi.y=Math.min(oi.y,jn[ii].y),Ti.x=Math.max(Ti.x,jn[ii].x),Ti.y=Math.max(Ti.y,jn[ii].y);fi=oi.x>=tn.x&&Ti.x<=Xr.x&&oi.y>=tn.y&&Ti.y<=Xr.y?[jn]:Ti.x<tn.x||oi.x>Xr.x||Ti.y<tn.y||oi.y>Xr.y?[]:d.clipLine([jn],tn.x,tn.y,Xr.x,Xr.y)}for(var ri=0,Po=fi;ri<Po.length;ri+=1){var Ja;yn.reset(Po[ri],.25*Lr),Ja=yn.length<=.5*Lr?1:Math.ceil(yn.paddedLength/ci)+1;for(var os=0;os<Ja;os++){var Zo=os/Math.max(Ja-1,1),Ga=yn.lerp(Zo),no=Ga.x+100,ds=Ga.y+100;Ye.push(no,ds,Lr,0);var vs=no-Lr,el=ds-Lr,ms=no+Lr,eu=ds+Lr;if(or=or&&this.isOffscreen(vs,el,ms,eu),rr=rr||this.isInsideGrid(vs,el,ms,eu),!i&&this.grid.hitTestCircle(no,ds,Lr,ve)&&(ar=!0,!V))return{circles:[],offscreen:!1,collisionDetected:ar}}}}return{circles:!V&&ar||!rr?[]:Ye,offscreen:or,collisionDetected:ar}},Yo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,g=-1/0,S=-1/0,T=0,R=i;T<R.length;T+=1){var V=R[T],ee=new d.Point(V.x+100,V.y+100);a=Math.min(a,ee.x),h=Math.min(h,ee.y),g=Math.max(g,ee.x),S=Math.max(S,ee.y),u.push(ee)}for(var ve={},ye={},Ee=0,Ye=this.grid.query(a,h,g,S).concat(this.ignoredGrid.query(a,h,g,S));Ee<Ye.length;Ee+=1){var Ge=Ye[Ee],nt=Ge.key;if(ve[nt.bucketInstanceId]===void 0&&(ve[nt.bucketInstanceId]={}),!ve[nt.bucketInstanceId][nt.featureIndex]){var Ne=[new d.Point(Ge.x1,Ge.y1),new d.Point(Ge.x2,Ge.y1),new d.Point(Ge.x2,Ge.y2),new d.Point(Ge.x1,Ge.y2)];d.polygonIntersectsPolygon(u,Ne)&&(ve[nt.bucketInstanceId][nt.featureIndex]=!0,ye[nt.bucketInstanceId]===void 0&&(ye[nt.bucketInstanceId]=[]),ye[nt.bucketInstanceId].push(nt.featureIndex))}}return ye},Yo.prototype.insertCollisionBox=function(i,u,a,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},i[0],i[1],i[2],i[3])},Yo.prototype.insertCollisionCircles=function(i,u,a,h,g){for(var S=u?this.ignoredGrid:this.grid,T={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},R=0;R<i.length;R+=4)S.insertCircle(T,i[R],i[R+1],i[R+2])},Yo.prototype.projectAndGetPerspectiveRatio=function(i,u,a){var h=[u,a,0,1];return $a(h,h,i),{point:new d.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Yo.prototype.isOffscreen=function(i,u,a,h){return a<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Yo.prototype.isInsideGrid=function(i,u,a,h){return a>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Yo.prototype.getViewportMatrix=function(){var i=d.identity([]);return d.translate(i,i,[-100,-100,0]),i};var Oo=function(i,u,a,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&a?1:0,this.placed=a};Oo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Oa=function(i,u,a,h,g){this.text=new Oo(i?i.text:null,u,a,g),this.icon=new Oo(i?i.icon:null,u,h,g)};Oa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Za=function(i,u,a){this.text=i,this.icon=u,this.skipFade=a},cs=function(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]},va=function(i,u,a,h,g){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},fs=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function Ca(i,u,a,h,g){var S=d.getAnchorAlignment(i),T=-(S.horizontalAlign-.5)*u,R=-(S.verticalAlign-.5)*a,V=d.evaluateVariableOffset(i,h);return new d.Point(T+V[0]*g,R+V[1]*g)}function fo(i,u,a,h,g,S){var T=i.x1,R=i.x2,V=i.y1,ee=i.y2,ve=i.anchorPointX,ye=i.anchorPointY,Ee=new d.Point(u,a);return h&&Ee._rotate(g?S:-S),{x1:T+Ee.x,y1:V+Ee.y,x2:R+Ee.x,y2:ee+Ee.y,anchorPointX:ve,anchorPointY:ye}}fs.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[i]};var Zi=function(i,u,a,h){this.transform=i.clone(),this.collisionIndex=new Yo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new fs(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function pe(i,u,a,h,g){i.emplaceBack(u?1:0,a?1:0,h||0,g||0),i.emplaceBack(u?1:0,a?1:0,h||0,g||0),i.emplaceBack(u?1:0,a?1:0,h||0,g||0),i.emplaceBack(u?1:0,a?1:0,h||0,g||0)}Zi.prototype.getBucketParts=function(i,u,a,h){var g=a.getBucket(u),S=a.latestFeatureIndex;if(g&&S&&u.id===g.layerIds[0]){var T=a.collisionBoxArray,R=g.layers[0].layout,V=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),ee=a.tileSize/d.EXTENT,ve=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),ye=R.get("text-pitch-alignment")==="map",Ee=R.get("text-rotation-alignment")==="map",Ye=Gi(a,1,this.transform.zoom),Ge=ai(ve,ye,Ee,this.transform,Ye),nt=null;if(ye){var Ne=Ai(ve,ye,Ee,this.transform,Ye);nt=d.multiply([],this.transform.labelPlaneMatrix,Ne)}this.retainedQueryData[g.bucketInstanceId]=new va(g.bucketInstanceId,S,g.sourceLayerIndex,g.index,a.tileID);var rt={bucket:g,layout:R,posMatrix:ve,textLabelPlaneMatrix:Ge,labelToScreenMatrix:nt,scale:V,textPixelRatio:ee,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var dt=0,zt=g.sortKeyRanges;dt<zt.length;dt+=1){var ar=zt[dt];i.push({sortKey:ar.sortKey,symbolInstanceStart:ar.symbolInstanceStart,symbolInstanceEnd:ar.symbolInstanceEnd,parameters:rt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:rt})}},Zi.prototype.attemptAnchorPlacement=function(i,u,a,h,g,S,T,R,V,ee,ve,ye,Ee,Ye,Ge){var nt,Ne=[ye.textOffset0,ye.textOffset1],rt=Ca(i,a,h,Ne,g),dt=this.collisionIndex.placeCollisionBox(fo(u,rt.x,rt.y,S,T,this.transform.angle),ve,R,V,ee.predicate);if(!Ge||this.collisionIndex.placeCollisionBox(fo(Ge,rt.x,rt.y,S,T,this.transform.angle),ve,R,V,ee.predicate).box.length!==0)return dt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),this.variableOffsets[ye.crossTileID]={textOffset:Ne,width:a,height:h,anchor:i,textBoxScale:g,prevAnchor:nt},this.markUsedJustification(Ee,i,ye,Ye),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Ye,ye),this.placedOrientations[ye.crossTileID]=Ye),{shift:rt,placedGlyphBoxes:dt}):void 0},Zi.prototype.placeLayerBucketPart=function(i,u,a){var h=this,g=i.parameters,S=g.bucket,T=g.layout,R=g.posMatrix,V=g.textLabelPlaneMatrix,ee=g.labelToScreenMatrix,ve=g.textPixelRatio,ye=g.holdingForFade,Ee=g.collisionBoxArray,Ye=g.partiallyEvaluatedTextSize,Ge=g.collisionGroup,nt=T.get("text-optional"),Ne=T.get("icon-optional"),rt=T.get("text-allow-overlap"),dt=T.get("icon-allow-overlap"),zt=T.get("text-rotation-alignment")==="map",ar=T.get("text-pitch-alignment")==="map",rr=T.get("icon-text-fit")!=="none",or=T.get("symbol-z-order")==="viewport-y",Lr=rt&&(dt||!S.hasIconData()||Ne),tn=dt&&(rt||!S.hasTextData()||nt);!S.collisionArrays&&Ee&&S.deserializeCollisionBoxes(Ee);var Xr=function(_n,ci){if(!u[_n.crossTileID])if(ye)h.placements[_n.crossTileID]=new Za(!1,!1,!1);else{var Ci,fi=!1,oi=!1,Ti=!0,ii=null,ri={box:null,offscreen:null},Po={box:null,offscreen:null},Ja=null,os=null,Zo=0,Ga=0,no=0;ci.textFeatureIndex?Zo=ci.textFeatureIndex:_n.useRuntimeCollisionCircles&&(Zo=_n.featureIndex),ci.verticalTextFeatureIndex&&(Ga=ci.verticalTextFeatureIndex);var ds=ci.textBox;if(ds){var vs=function(qi){var ao=d.WritingMode.horizontal;if(S.allowVerticalPlacement&&!qi&&h.prevPlacement){var ko=h.prevPlacement.placedOrientations[_n.crossTileID];ko&&(h.placedOrientations[_n.crossTileID]=ko,h.markUsedOrientation(S,ao=ko,_n))}return ao},el=function(qi,ao){if(S.allowVerticalPlacement&&_n.numVerticalGlyphVertices>0&&ci.verticalTextBox)for(var ko=0,Rs=S.writingModes;ko<Rs.length&&(Rs[ko]===d.WritingMode.vertical?(ri=ao(),Po=ri):ri=qi(),!(ri&&ri.box&&ri.box.length));ko+=1);else ri=qi()};if(T.get("text-variable-anchor")){var ms=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[_n.crossTileID]){var eu=h.prevPlacement.variableOffsets[_n.crossTileID];ms.indexOf(eu.anchor)>0&&(ms=ms.filter(function(qi){return qi!==eu.anchor})).unshift(eu.anchor)}var Ls=function(qi,ao,ko){for(var Rs=qi.x2-qi.x1,tl=qi.y2-qi.y1,vu=_n.textBoxScale,rl=rr&&!dt?ao:null,nl={box:[],offscreen:!1},Ec=rt?2*ms.length:ms.length,Pu=0;Pu<Ec;++Pu){var Gl=h.attemptAnchorPlacement(ms[Pu%ms.length],qi,Rs,tl,vu,zt,ar,ve,R,Ge,Pu>=ms.length,_n,S,ko,rl);if(Gl&&(nl=Gl.placedGlyphBoxes)&&nl.box&&nl.box.length){fi=!0,ii=Gl.shift;break}}return nl};el(function(){return Ls(ds,ci.iconBox,d.WritingMode.horizontal)},function(){var qi=ci.verticalTextBox;return S.allowVerticalPlacement&&!(ri&&ri.box&&ri.box.length)&&_n.numVerticalGlyphVertices>0&&qi?Ls(qi,ci.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),ri&&(fi=ri.box,Ti=ri.offscreen);var xl=vs(ri&&ri.box);if(!fi&&h.prevPlacement){var bl=h.prevPlacement.variableOffsets[_n.crossTileID];bl&&(h.variableOffsets[_n.crossTileID]=bl,h.markUsedJustification(S,bl.anchor,_n,xl))}}else{var Nu=function(qi,ao){var ko=h.collisionIndex.placeCollisionBox(qi,rt,ve,R,Ge.predicate);return ko&&ko.box&&ko.box.length&&(h.markUsedOrientation(S,ao,_n),h.placedOrientations[_n.crossTileID]=ao),ko};el(function(){return Nu(ds,d.WritingMode.horizontal)},function(){var qi=ci.verticalTextBox;return S.allowVerticalPlacement&&_n.numVerticalGlyphVertices>0&&qi?Nu(qi,d.WritingMode.vertical):{box:null,offscreen:null}}),vs(ri&&ri.box&&ri.box.length)}}if(fi=(Ci=ri)&&Ci.box&&Ci.box.length>0,Ti=Ci&&Ci.offscreen,_n.useRuntimeCollisionCircles){var tu=S.text.placedSymbolArray.get(_n.centerJustifiedTextSymbolIndex),Vl=d.evaluateSizeForFeature(S.textSizeData,Ye,tu),Tu=T.get("text-padding");Ja=h.collisionIndex.placeCollisionCircles(rt,tu,S.lineVertexArray,S.glyphOffsetArray,Vl,R,V,ee,a,ar,Ge.predicate,_n.collisionCircleDiameter,Tu),fi=rt||Ja.circles.length>0&&!Ja.collisionDetected,Ti=Ti&&Ja.offscreen}if(ci.iconFeatureIndex&&(no=ci.iconFeatureIndex),ci.iconBox){var zu=function(qi){var ao=rr&&ii?fo(qi,ii.x,ii.y,zt,ar,h.transform.angle):qi;return h.collisionIndex.placeCollisionBox(ao,dt,ve,R,Ge.predicate)};oi=Po&&Po.box&&Po.box.length&&ci.verticalIconBox?(os=zu(ci.verticalIconBox)).box.length>0:(os=zu(ci.iconBox)).box.length>0,Ti=Ti&&os.offscreen}var Hs=nt||_n.numHorizontalGlyphVertices===0&&_n.numVerticalGlyphVertices===0,io=Ne||_n.numIconVertices===0;if(Hs||io?io?Hs||(oi=oi&&fi):fi=oi&&fi:oi=fi=oi&&fi,fi&&Ci&&Ci.box&&h.collisionIndex.insertCollisionBox(Ci.box,T.get("text-ignore-placement"),S.bucketInstanceId,Po&&Po.box&&Ga?Ga:Zo,Ge.ID),oi&&os&&h.collisionIndex.insertCollisionBox(os.box,T.get("icon-ignore-placement"),S.bucketInstanceId,no,Ge.ID),Ja&&(fi&&h.collisionIndex.insertCollisionCircles(Ja.circles,T.get("text-ignore-placement"),S.bucketInstanceId,Zo,Ge.ID),a)){var Au=S.bucketInstanceId,du=h.collisionCircleArrays[Au];du===void 0&&(du=h.collisionCircleArrays[Au]=new cs);for(var gs=0;gs<Ja.circles.length;gs+=4)du.circles.push(Ja.circles[gs+0]),du.circles.push(Ja.circles[gs+1]),du.circles.push(Ja.circles[gs+2]),du.circles.push(Ja.collisionDetected?1:0)}h.placements[_n.crossTileID]=new Za(fi||Lr,oi||tn,Ti||S.justReloaded),u[_n.crossTileID]=!0}};if(or)for(var yn=S.getSortedSymbolIndexes(this.transform.angle),Fn=yn.length-1;Fn>=0;--Fn){var Vn=yn[Fn];Xr(S.symbolInstances.get(Vn),S.collisionArrays[Vn])}else for(var jn=i.symbolInstanceStart;jn<i.symbolInstanceEnd;jn++)Xr(S.symbolInstances.get(jn),S.collisionArrays[jn]);if(a&&S.bucketInstanceId in this.collisionCircleArrays){var Qi=this.collisionCircleArrays[S.bucketInstanceId];d.invert(Qi.invProjMatrix,R),Qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},Zi.prototype.markUsedJustification=function(i,u,a,h){var g;g=h===d.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];for(var S=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];S<T.length;S+=1){var R=T[S];R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=g>=0&&R!==g?0:a.crossTileID)}},Zi.prototype.markUsedOrientation=function(i,u,a){for(var h=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,g=u===d.WritingMode.vertical?u:0,S=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];S<T.length;S+=1)i.text.placedSymbolArray.get(T[S]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},Zi.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,g=u?u.opacities:{},S=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var R in this.placements){var V=this.placements[R],ee=g[R];ee?(this.opacities[R]=new Oa(ee,h,V.text,V.icon),a=a||V.text!==ee.text.placed||V.icon!==ee.icon.placed):(this.opacities[R]=new Oa(null,h,V.text,V.icon,V.skipFade),a=a||V.text||V.icon)}for(var ve in g){var ye=g[ve];if(!this.opacities[ve]){var Ee=new Oa(ye,h,!1,!1);Ee.isHidden()||(this.opacities[ve]=Ee,a=a||ye.text.placed||ye.icon.placed)}}for(var Ye in S)this.variableOffsets[Ye]||!this.opacities[Ye]||this.opacities[Ye].isHidden()||(this.variableOffsets[Ye]=S[Ye]);for(var Ge in T)this.placedOrientations[Ge]||!this.opacities[Ge]||this.opacities[Ge].isHidden()||(this.placedOrientations[Ge]=T[Ge]);a?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},Zi.prototype.updateLayerOpacities=function(i,u){for(var a={},h=0,g=u;h<g.length;h+=1){var S=g[h],T=S.getBucket(i);T&&S.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,a,S.collisionBoxArray)}},Zi.prototype.updateBucketOpacities=function(i,u,a){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var g=i.layers[0].layout,S=new Oa(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),R=g.get("icon-allow-overlap"),V=g.get("text-variable-anchor"),ee=g.get("text-rotation-alignment")==="map",ve=g.get("text-pitch-alignment")==="map",ye=g.get("icon-text-fit")!=="none",Ee=new Oa(null,0,T&&(R||!i.hasIconData()||g.get("icon-optional")),R&&(T||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&a&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(a);for(var Ye=function(rt,dt,zt){for(var ar=0;ar<dt/4;ar++)rt.opacityVertexArray.emplaceBack(zt)},Ge=function(rt){var dt=i.symbolInstances.get(rt),zt=dt.numHorizontalGlyphVertices,ar=dt.numVerticalGlyphVertices,rr=dt.crossTileID,or=h.opacities[rr];u[rr]?or=S:or||(h.opacities[rr]=or=Ee),u[rr]=!0;var Lr=dt.numIconVertices>0,tn=h.placedOrientations[dt.crossTileID],Xr=tn===d.WritingMode.vertical,yn=tn===d.WritingMode.horizontal||tn===d.WritingMode.horizontalOnly;if(zt>0||ar>0){var Fn=La(or.text);Ye(i.text,zt,Xr?ja:Fn),Ye(i.text,ar,yn?ja:Fn);var Vn=or.text.isHidden();[dt.rightJustifiedTextSymbolIndex,dt.centerJustifiedTextSymbolIndex,dt.leftJustifiedTextSymbolIndex].forEach(function(ri){ri>=0&&(i.text.placedSymbolArray.get(ri).hidden=Vn||Xr?1:0)}),dt.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(dt.verticalPlacedTextSymbolIndex).hidden=Vn||yn?1:0);var jn=h.variableOffsets[dt.crossTileID];jn&&h.markUsedJustification(i,jn.anchor,dt,tn);var Qi=h.placedOrientations[dt.crossTileID];Qi&&(h.markUsedJustification(i,"left",dt,Qi),h.markUsedOrientation(i,Qi,dt))}if(Lr){var _n=La(or.icon),ci=!(ye&&dt.verticalPlacedIconSymbolIndex&&Xr);dt.placedIconSymbolIndex>=0&&(Ye(i.icon,dt.numIconVertices,ci?_n:ja),i.icon.placedSymbolArray.get(dt.placedIconSymbolIndex).hidden=or.icon.isHidden()),dt.verticalPlacedIconSymbolIndex>=0&&(Ye(i.icon,dt.numVerticalIconVertices,ci?ja:_n),i.icon.placedSymbolArray.get(dt.verticalPlacedIconSymbolIndex).hidden=or.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var Ci=i.collisionArrays[rt];if(Ci){var fi=new d.Point(0,0);if(Ci.textBox||Ci.verticalTextBox){var oi=!0;if(V){var Ti=h.variableOffsets[rr];Ti?(fi=Ca(Ti.anchor,Ti.width,Ti.height,Ti.textOffset,Ti.textBoxScale),ee&&fi._rotate(ve?h.transform.angle:-h.transform.angle)):oi=!1}Ci.textBox&&pe(i.textCollisionBox.collisionVertexArray,or.text.placed,!oi||Xr,fi.x,fi.y),Ci.verticalTextBox&&pe(i.textCollisionBox.collisionVertexArray,or.text.placed,!oi||yn,fi.x,fi.y)}var ii=Boolean(!yn&&Ci.verticalIconBox);Ci.iconBox&&pe(i.iconCollisionBox.collisionVertexArray,or.icon.placed,ii,ye?fi.x:0,ye?fi.y:0),Ci.verticalIconBox&&pe(i.iconCollisionBox.collisionVertexArray,or.icon.placed,!ii,ye?fi.x:0,ye?fi.y:0)}}},nt=0;nt<i.symbolInstances.length;nt++)Ge(nt);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var Ne=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Ne.invProjMatrix,i.placementViewportMatrix=Ne.viewportMatrix,i.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},Zi.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Zi.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},Zi.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},Zi.prototype.stillRecent=function(i,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>i},Zi.prototype.setStale=function(){this.stale=!0};var Oe=Math.pow(2,25),ft=Math.pow(2,24),ur=Math.pow(2,17),Qr=Math.pow(2,16),Dn=Math.pow(2,9),Ki=Math.pow(2,8),Ua=Math.pow(2,1);function La(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,a=Math.floor(127*i.opacity);return a*Oe+u*ft+a*ur+u*Qr+a*Dn+u*Ki+a*Ua+u}var ja=0,To=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};To.prototype.continuePlacement=function(i,u,a,h,g){for(var S=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(S,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<S.length;)if(u.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var Mu=function(i,u,a,h,g,S,T){this.placement=new Zi(i,g,S,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};Mu.prototype.isDone=function(){return this._done},Mu.prototype.continuePlacement=function(i,u,a){for(var h=this,g=d.browser.now(),S=function(){var V=d.browser.now()-g;return!h._forceFullPlacement&&V>2};this._currentPlacementIndex>=0;){var T=u[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new To(T)),this._inProgressLayer.continuePlacement(a[T.source],this.placement,this._showCollisionBoxes,T,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Mu.prototype.commit=function(i){return this.placement.commit(i),this.placement};var $l=512/d.EXTENT/2,Il=function(i,u,a){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var g=u.get(h),S=g.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,i)})}};Il.prototype.getScaledCoordinates=function(i,u){var a=$l/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+i.anchorX)*a),y:Math.floor((u.canonical.y*d.EXTENT+i.anchorY)*a)}},Il.prototype.findMatches=function(i,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<i.length;g++){var S=i.get(g);if(!S.crossTileID){var T=this.indexedSymbolInstances[S.key];if(T)for(var R=this.getScaledCoordinates(S,u),V=0,ee=T;V<ee.length;V+=1){var ve=ee[V];if(Math.abs(ve.coord.x-R.x)<=h&&Math.abs(ve.coord.y-R.y)<=h&&!a[ve.crossTileID]){a[ve.crossTileID]=!0,S.crossTileID=ve.crossTileID;break}}}}};var Lo=function(){this.maxCrossTileID=0};Lo.prototype.generate=function(){return++this.maxCrossTileID};var Xs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Xs.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var S in h){var T=h[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),g[T.tileID.key]=T}this.indexes[a]=g}this.lng=i},Xs.prototype.addBucket=function(i,u,a){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var g=this.usedCrossTileIDs[i.overscaledZ];for(var S in this.indexes){var T=this.indexes[S];if(Number(S)>i.overscaledZ)for(var R in T){var V=T[R];V.tileID.isChildOf(i)&&V.findMatches(u.symbolInstances,i,g)}else{var ee=T[i.scaledTo(Number(S)).key];ee&&ee.findMatches(u.symbolInstances,i,g)}}for(var ve=0;ve<u.symbolInstances.length;ve++){var ye=u.symbolInstances.get(ve);ye.crossTileID||(ye.crossTileID=a.generate(),g[ye.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Il(i,u.symbolInstances,u.bucketInstanceId),!0},Xs.prototype.removeBucketCrossTileIDs=function(i,u){for(var a in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[i][g[h].crossTileID]},Xs.prototype.removeStaleBuckets=function(i){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)i[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],u=!0)}return u};var ua=function(){this.layerIndexes={},this.crossTileIDs=new Lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ua.prototype.addLayer=function(i,u,a){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new Xs);var g=!1,S={};h.handleWrapJump(a);for(var T=0,R=u;T<R.length;T+=1){var V=R[T],ee=V.getBucket(i);ee&&i.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(V.tileID,ee,this.crossTileIDs)&&(g=!0),S[ee.bucketInstanceId]=!0)}return h.removeStaleBuckets(S)&&(g=!0),g},ua.prototype.pruneUnusedLayers=function(i){var u={};for(var a in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var Ns=function(i,u){return d.emitValidationErrors(i,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},ou=d.pick(ln,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),bs=d.pick(ln,["setCenter","setZoom","setBearing","setPitch"]),Ps=function(){var i={},u=d.styleSpec.$version;for(var a in d.styleSpec.$root){var h,g=d.styleSpec.$root[a];g.required&&(h=a==="version"?u:g.type==="array"?[]:{})!=null&&(i[a]=h)}return i}(),ti=function(i){function u(a,h){var g=this;h===void 0&&(h={}),i.call(this),this.map=a,this.dispatcher=new Pe(mr(),this),this.imageManager=new Yt,this.imageManager.setEventedParent(this),this.glyphManager=new nr(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new ua,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());var S=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,V){if(d.triggerPluginCompletionEvent(R),V&&V.every(function(ve){return ve}))for(var ee in S.sourceCaches)S.sourceCaches[ee].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=g.sourceCaches[T.sourceId];if(R){var V=R.getSource();if(V&&V.vectorLayerIds)for(var ee in g._layers){var ve=g._layers[ee];ve.source===V.id&&g._validateLayer(ve)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"}));var S=typeof h.validate=="boolean"?h.validate:!d.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var T=this.map._requestManager.transformRequest(a,d.ResourceType.Style);this._request=d.getJSON(T,function(R,V){g._request=null,R?g.fire(new d.ErrorEvent(R)):V&&g._load(V,S)})},u.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(Ps,!1)},u.prototype._load=function(a,h){if(!h||!Ns(this,d.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var S=Wr(this.stylesheet.layers);this._order=S.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var T=0,R=S;T<R.length;T+=1){var V=R[T];(V=d.createStyleLayer(V)).setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,S,T){var R,V,ee,ve=d.browser.devicePixelRatio>1?"@2x":"",ye=d.getJSON(S.transformRequest(S.normalizeSpriteURL(g,ve,".json"),d.ResourceType.SpriteJSON),function(Ge,nt){ye=null,ee||(ee=Ge,R=nt,Ye())}),Ee=d.getImage(S.transformRequest(S.normalizeSpriteURL(g,ve,".png"),d.ResourceType.SpriteImage),function(Ge,nt){Ee=null,ee||(ee=Ge,V=nt,Ye())});function Ye(){if(ee)T(ee);else if(R&&V){var Ge=d.browser.getImageData(V),nt={};for(var Ne in R){var rt=R[Ne],dt=rt.width,zt=rt.height,ar=rt.x,rr=rt.y,or=rt.sdf,Lr=rt.pixelRatio,tn=rt.stretchX,Xr=rt.stretchY,yn=rt.content,Fn=new d.RGBAImage({width:dt,height:zt});d.RGBAImage.copy(Ge,Fn,{x:ar,y:rr},{x:0,y:0},{width:dt,height:zt}),nt[Ne]={data:Fn,pixelRatio:Lr,sdf:or,stretchX:tn,stretchY:Xr,content:yn}}T(null,nt)}}return{cancel:function(){ye&&(ye.cancel(),ye=null),Ee&&(Ee.cancel(),Ee=null)}}}(a,this.map._requestManager,function(g,S){if(h._spriteRequest=null,g)h.fire(new d.ErrorEvent(g));else if(S)for(var T in S)h.imageManager.addImage(T,S[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new d.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(g)===-1)&&this.fire(new d.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+S.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],g=0,S=a;g<S.length;g+=1){var T=this._layers[S[g]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var T in(g.length||S.length)&&this._updateWorkerLayers(g,S),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var ee={};for(var ve in this.sourceCaches){var ye=this.sourceCaches[ve];ee[ve]=ye.used,ye.used=!1}for(var Ee=0,Ye=this._order;Ee<Ye.length;Ee+=1){var Ge=this._layers[Ye[Ee]];Ge.recalculate(a,this._availableImages),!Ge.isHidden(a.zoom)&&Ge.source&&(this.sourceCaches[Ge.source].used=!0)}for(var nt in ee){var Ne=this.sourceCaches[nt];ee[nt]!==Ne.used&&Ne.fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new d.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),Ns(this,d.validateStyle(a)))return!1;(a=d.clone$1(a)).layers=Wr(a.layers);var g=function(T,R){if(!T)return[{command:ln.setStyle,args:[R]}];var V=[];try{if(!d.deepEqual(T.version,R.version))return[{command:ln.setStyle,args:[R]}];d.deepEqual(T.center,R.center)||V.push({command:ln.setCenter,args:[R.center]}),d.deepEqual(T.zoom,R.zoom)||V.push({command:ln.setZoom,args:[R.zoom]}),d.deepEqual(T.bearing,R.bearing)||V.push({command:ln.setBearing,args:[R.bearing]}),d.deepEqual(T.pitch,R.pitch)||V.push({command:ln.setPitch,args:[R.pitch]}),d.deepEqual(T.sprite,R.sprite)||V.push({command:ln.setSprite,args:[R.sprite]}),d.deepEqual(T.glyphs,R.glyphs)||V.push({command:ln.setGlyphs,args:[R.glyphs]}),d.deepEqual(T.transition,R.transition)||V.push({command:ln.setTransition,args:[R.transition]}),d.deepEqual(T.light,R.light)||V.push({command:ln.setLight,args:[R.light]});var ee={},ve=[];(function(Ee,Ye,Ge,nt){var Ne;for(Ne in Ye=Ye||{},Ee=Ee||{})Ee.hasOwnProperty(Ne)&&(Ye.hasOwnProperty(Ne)||hn(Ne,Ge,nt));for(Ne in Ye)Ye.hasOwnProperty(Ne)&&(Ee.hasOwnProperty(Ne)?d.deepEqual(Ee[Ne],Ye[Ne])||(Ee[Ne].type==="geojson"&&Ye[Ne].type==="geojson"&&Yi(Ee,Ye,Ne)?Ge.push({command:ln.setGeoJSONSourceData,args:[Ne,Ye[Ne].data]}):wi(Ne,Ye,Ge,nt)):Ei(Ne,Ye,Ge))})(T.sources,R.sources,ve,ee);var ye=[];T.layers&&T.layers.forEach(function(Ee){ee[Ee.source]?V.push({command:ln.removeLayer,args:[Ee.id]}):ye.push(Ee)}),V=V.concat(ve),function(Ee,Ye,Ge){Ye=Ye||[];var nt,Ne,rt,dt,zt,ar,rr,or=(Ee=Ee||[]).map(Di),Lr=Ye.map(Di),tn=Ee.reduce(ki,{}),Xr=Ye.reduce(ki,{}),yn=or.slice(),Fn=Object.create(null);for(nt=0,Ne=0;nt<or.length;nt++)Xr.hasOwnProperty(rt=or[nt])?Ne++:(Ge.push({command:ln.removeLayer,args:[rt]}),yn.splice(yn.indexOf(rt,Ne),1));for(nt=0,Ne=0;nt<Lr.length;nt++)yn[yn.length-1-nt]!==(rt=Lr[Lr.length-1-nt])&&(tn.hasOwnProperty(rt)?(Ge.push({command:ln.removeLayer,args:[rt]}),yn.splice(yn.lastIndexOf(rt,yn.length-Ne),1)):Ne++,Ge.push({command:ln.addLayer,args:[Xr[rt],ar=yn[yn.length-nt]]}),yn.splice(yn.length-nt,0,rt),Fn[rt]=!0);for(nt=0;nt<Lr.length;nt++)if(dt=tn[rt=Lr[nt]],zt=Xr[rt],!Fn[rt]&&!d.deepEqual(dt,zt))if(d.deepEqual(dt.source,zt.source)&&d.deepEqual(dt["source-layer"],zt["source-layer"])&&d.deepEqual(dt.type,zt.type)){for(rr in Yn(dt.layout,zt.layout,Ge,rt,null,ln.setLayoutProperty),Yn(dt.paint,zt.paint,Ge,rt,null,ln.setPaintProperty),d.deepEqual(dt.filter,zt.filter)||Ge.push({command:ln.setFilter,args:[rt,zt.filter]}),d.deepEqual(dt.minzoom,zt.minzoom)&&d.deepEqual(dt.maxzoom,zt.maxzoom)||Ge.push({command:ln.setLayerZoomRange,args:[rt,zt.minzoom,zt.maxzoom]}),dt)dt.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?Yn(dt[rr],zt[rr],Ge,rt,rr.slice(6),ln.setPaintProperty):d.deepEqual(dt[rr],zt[rr])||Ge.push({command:ln.setLayerProperty,args:[rt,rr,zt[rr]]}));for(rr in zt)zt.hasOwnProperty(rr)&&!dt.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?Yn(dt[rr],zt[rr],Ge,rt,rr.slice(6),ln.setPaintProperty):d.deepEqual(dt[rr],zt[rr])||Ge.push({command:ln.setLayerProperty,args:[rt,rr,zt[rr]]}))}else Ge.push({command:ln.removeLayer,args:[rt]}),ar=yn[yn.lastIndexOf(rt)+1],Ge.push({command:ln.addLayer,args:[zt,ar]})}(ye,R.layers,V)}catch(Ee){console.warn("Unable to compute style diff:",Ee),V=[{command:ln.setStyle,args:[R]}]}return V}(this.serialize(),a).filter(function(T){return!(T.command in bs)});if(g.length===0)return!1;var S=g.filter(function(T){return!(T.command in ou)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(T){return T.command}).join(", ")+".");return g.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,g){var S=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[a]=new me(a,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:T.serialize(),sourceId:a}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new d.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var S=a.id;if(this.getLayer(S))this.fire(new d.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var T;if(a.type==="custom"){if(Ns(this,d.validateCustomStyleLayer(a)))return;T=d.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=d.clone$1(a),a=d.extend(a,{source:S})),this._validate(d.validateStyle.layer,"layers."+S,a,{arrayIndex:-1},g))return;T=d.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,S),this._layerOrderChanged=!0,this._layers[S]=T,this._removedLayers[S]&&T.source&&T.type!=="custom"){var V=this._removedLayers[S];delete this._removedLayers[S],V.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(S,0,a),this._layerOrderChanged=!0)}}else this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var S=this.getLayer(a);S?S.minzoom===h&&S.maxzoom===g||(h!=null&&(S.minzoom=h),g!=null&&(S.maxzoom=g),this._updateLayer(S)):this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var S=this.getLayer(a);if(S){if(!d.deepEqual(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(d.validateStyle.filter,"layers."+S.id+".filter",h,null,g)||(S.filter=d.clone$1(h),this._updateLayer(S)))}else this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return d.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(a);T?d.deepEqual(T.getLayoutProperty(h),g)||(T.setLayoutProperty(h,g,S),this._updateLayer(T)):this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(a);T?d.deepEqual(T.getPaintProperty(h),g)||(T.setPaintProperty(h,g,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new d.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,S=a.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&S?this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||S?(a.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(S,a.id,h)):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,S=this.sourceCaches[g];if(S!==void 0){var T=S.getSource().type,R=T==="vector"?a.sourceLayer:void 0;T!=="vector"||R?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(R,a.id,h):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,S=this.sourceCaches[h];if(S!==void 0){if(S.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(g,a.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:d.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(tn){return h._layers[tn].type==="fill-extrusion"},S={},T=[],R=this._order.length-1;R>=0;R--){var V=this._order[R];if(g(V)){S[V]=R;for(var ee=0,ve=a;ee<ve.length;ee+=1){var ye=ve[ee][V];if(ye)for(var Ee=0,Ye=ye;Ee<Ye.length;Ee+=1)T.push(Ye[Ee])}}}T.sort(function(tn,Xr){return Xr.intersectionZ-tn.intersectionZ});for(var Ge=[],nt=this._order.length-1;nt>=0;nt--){var Ne=this._order[nt];if(g(Ne))for(var rt=T.length-1;rt>=0;rt--){var dt=T[rt].feature;if(S[dt.layer.id]<nt)break;Ge.push(dt),T.pop()}else for(var zt=0,ar=a;zt<ar.length;zt+=1){var rr=ar[zt][Ne];if(rr)for(var or=0,Lr=rr;or<Lr.length;or+=1)Ge.push(Lr[or].feature)}}return Ge},u.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var V=R[T],ee=this._layers[V];if(!ee)return this.fire(new d.ErrorEvent(new Error("The layer '"+V+"' does not exist in the map's style and cannot be queried for features."))),[];S[ee.source]=!0}}var ve=[];for(var ye in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!S[ye]||ve.push(Br(this.sourceCaches[ye],this._layers,this._serializedLayers,a,h,g));return this.placement&&ve.push(function(Ee,Ye,Ge,nt,Ne,rt,dt){for(var zt={},ar=rt.queryRenderedSymbols(nt),rr=[],or=0,Lr=Object.keys(ar).map(Number);or<Lr.length;or+=1)rr.push(dt[Lr[or]]);rr.sort(un);for(var tn=function(){var jn=yn[Xr],Qi=jn.featureIndex.lookupSymbolFeatures(ar[jn.bucketInstanceId],Ye,jn.bucketIndex,jn.sourceLayerIndex,Ne.filter,Ne.layers,Ne.availableImages,Ee);for(var _n in Qi){var ci=zt[_n]=zt[_n]||[],Ci=Qi[_n];Ci.sort(function(Ti,ii){var ri=jn.featureSortOrder;if(ri){var Po=ri.indexOf(Ti.featureIndex);return ri.indexOf(ii.featureIndex)-Po}return ii.featureIndex-Ti.featureIndex});for(var fi=0,oi=Ci;fi<oi.length;fi+=1)ci.push(oi[fi])}},Xr=0,yn=rr;Xr<yn.length;Xr+=1)tn();var Fn=function(jn){zt[jn].forEach(function(Qi){var _n=Qi.feature,ci=Ge[Ee[jn].source].getFeatureState(_n.layer["source-layer"],_n.id);_n.source=_n.layer.source,_n.layer["source-layer"]&&(_n.sourceLayer=_n.layer["source-layer"]),_n.state=ci})};for(var Vn in zt)Fn(Vn);return zt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ve)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(S,T){for(var R=S.getRenderableIds().map(function(Ye){return S.getTileByID(Ye)}),V=[],ee={},ve=0;ve<R.length;ve++){var ye=R[ve],Ee=ye.tileID.canonical.key;ee[Ee]||(ee[Ee]=!0,ye.querySourceFeatures(V,T))}return V}(g,h):[]},u.prototype.addSourceType=function(a,h,g){return u.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),S=!1;for(var T in a)if(!d.deepEqual(a[T],g[T])){S=!0;break}if(S){var R={now:d.browser.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(R)}},u.prototype._validate=function(a,h,g,S,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Ns(this,a.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:g,styleSpec:d.styleSpec},S)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,g,S,T){T===void 0&&(T=!1);for(var R=!1,V=!1,ee={},ve=0,ye=this._order;ve<ye.length;ve+=1){var Ee=this._layers[ye[ve]];if(Ee.type==="symbol"){if(!ee[Ee.source]){var Ye=this.sourceCaches[Ee.source];ee[Ee.source]=Ye.getRenderableIds(!0).map(function(dt){return Ye.getTileByID(dt)}).sort(function(dt,zt){return zt.tileID.overscaledZ-dt.tileID.overscaledZ||(dt.tileID.isLessThan(zt.tileID)?-1:1)})}var Ge=this.crossTileSymbolIndex.addLayer(Ee,ee[Ee.source],a.center.lng);R=R||Ge}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.browser.now(),a.zoom))&&(this.pauseablePlacement=new Mu(a,this._order,T,h,g,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.browser.now()),V=!0),R&&this.pauseablePlacement.placement.setStale()),V||R)for(var nt=0,Ne=this._order;nt<Ne.length;nt+=1){var rt=this._layers[Ne[nt]];rt.type==="symbol"&&this.placement.updateLayerOpacities(rt,ee[rt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(a,h,g){return d.makeRequest(h,g)},u}(d.Evented);ti.getSourceType=function(i){return Jt[i]},ti.setSourceType=function(i,u){Jt[i]=u},ti.registerForPluginStateChange=d.registerForPluginStateChange;var ho=d.createLayout([{name:"a_pos",type:"Int16",components:2}]),su=Ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ol=Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),sl=Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),He=Ui(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Tt=Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),_r=Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Zn=Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),sa=Ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),xa=Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ka=Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),vi=Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ta=Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),eo=Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),qn=Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ba=Ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Jl=Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ra=Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ro=Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),xu=Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ys=Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),zs=Ui(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),rs=Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Iu=Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),xo=Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),rf=Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ul=Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ui(i,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=S?S.concat(g):g,R={};return{fragmentSource:i=i.replace(a,function(V,ee,ve,ye,Ee){return R[Ee]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
varying `+ve+" "+ye+" "+Ee+`;
#else
uniform `+ve+" "+ye+" u_"+Ee+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+ye+" "+Ee+" = u_"+Ee+`;
#endif
`}),vertexSource:u=u.replace(a,function(V,ee,ve,ye,Ee){var Ye=ye==="float"?"vec2":"vec4",Ge=Ee.match(/color/)?"color":Ye;return R[Ee]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ve+" "+Ye+" a_"+Ee+`;
varying `+ve+" "+ye+" "+Ee+`;
#else
uniform `+ve+" "+ye+" u_"+Ee+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = a_"+Ee+`;
#else
    `+ve+" "+ye+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = unpack_mix_"+Ge+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ve+" "+ye+" "+Ee+" = u_"+Ee+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ve+" "+Ye+" a_"+Ee+`;
#else
uniform `+ve+" "+ye+" u_"+Ee+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+ye+" "+Ee+" = a_"+Ee+`;
#else
    `+ve+" "+ye+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+ye+" "+Ee+" = unpack_mix_"+Ge+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ve+" "+ye+" "+Ee+" = u_"+Ee+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var Hf=Object.freeze({__proto__:null,prelude:su,background:Ol,backgroundPattern:sl,circle:He,clippingMask:Tt,heatmap:_r,heatmapTexture:Zn,collisionBox:sa,collisionCircle:xa,debug:ka,fill:vi,fillOutline:Ta,fillOutlinePattern:eo,fillPattern:qn,fillExtrusion:ba,fillExtrusionPattern:Jl,hillshadePrepare:Ra,hillshade:Ro,line:xu,lineGradient:Ys,linePattern:zs,lineSDF:rs,raster:Iu,symbolIcon:xo,symbolSDF:rf,symbolTextAndIcon:ul}),Ql=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Sf(i){for(var u=[],a=0;a<i.length;a++)if(i[a]!==null){var h=i[a].split(" ");u.push(h.pop())}return u}Ql.prototype.bind=function(i,u,a,h,g,S,T,R){this.context=i;for(var V=this.boundPaintVertexBuffers.length!==h.length,ee=0;!V&&ee<h.length;ee++)this.boundPaintVertexBuffers[ee]!==h[ee]&&(V=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!V&&this.boundIndexBuffer===g&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(i.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),R&&R.bind()):this.freshBind(u,a,h,g,S,T,R)},Ql.prototype.freshBind=function(i,u,a,h,g,S,T){var R,V=i.numAttributes,ee=this.context,ve=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T;else{R=ee.currentNumAttributes||0;for(var ye=V;ye<R;ye++)ve.disableVertexAttribArray(ye)}u.enableAttributes(ve,i);for(var Ee=0,Ye=a;Ee<Ye.length;Ee+=1)Ye[Ee].enableAttributes(ve,i);S&&S.enableAttributes(ve,i),T&&T.enableAttributes(ve,i),u.bind(),u.setVertexAttribPointers(ve,i,g);for(var Ge=0,nt=a;Ge<nt.length;Ge+=1){var Ne=nt[Ge];Ne.bind(),Ne.setVertexAttribPointers(ve,i,g)}S&&(S.bind(),S.setVertexAttribPointers(ve,i,g)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(ve,i,g)),ee.currentNumAttributes=V},Ql.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ll=function(i,u,a,h,g,S){var T=i.gl;this.program=T.createProgram();for(var R=Sf(a.staticAttributes),V=h?h.getBinderAttributes():[],ee=R.concat(V),ve=a.staticUniforms?Sf(a.staticUniforms):[],ye=h?h.getBinderUniforms():[],Ee=[],Ye=0,Ge=ve.concat(ye);Ye<Ge.length;Ye+=1){var nt=Ge[Ye];Ee.indexOf(nt)<0&&Ee.push(nt)}var Ne=h?h.defines():[];S&&Ne.push("#define OVERDRAW_INSPECTOR;");var rt=Ne.concat(su.fragmentSource,a.fragmentSource).join(`
`),dt=Ne.concat(su.vertexSource,a.vertexSource).join(`
`),zt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(zt,rt),T.compileShader(zt),T.attachShader(this.program,zt);var ar=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ar,dt),T.compileShader(ar),T.attachShader(this.program,ar),this.attributes={};var rr={};this.numAttributes=ee.length;for(var or=0;or<this.numAttributes;or++)ee[or]&&(T.bindAttribLocation(this.program,or,ee[or]),this.attributes[ee[or]]=or);T.linkProgram(this.program),T.deleteShader(ar),T.deleteShader(zt);for(var Lr=0;Lr<Ee.length;Lr++){var tn=Ee[Lr];if(tn&&!rr[tn]){var Xr=T.getUniformLocation(this.program,tn);Xr&&(rr[tn]=Xr)}}this.fixedUniforms=g(i,rr),this.binderUniforms=h?h.getUniforms(i,rr):[]}}};function Ko(i,u,a){var h=1/Gi(a,1,u.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),S=a.tileSize*Math.pow(2,u.transform.tileZoom)/g,T=S*(a.tileID.canonical.x+a.tileID.wrap*g),R=S*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}Ll.prototype.draw=function(i,u,a,h,g,S,T,R,V,ee,ve,ye,Ee,Ye,Ge,nt){var Ne,rt=i.gl;if(!this.failedToCreate){for(var dt in i.program.set(this.program),i.setDepthMode(a),i.setStencilMode(h),i.setColorMode(g),i.setCullFace(S),this.fixedUniforms)this.fixedUniforms[dt].set(T[dt]);Ye&&Ye.setUniforms(i,this.binderUniforms,ye,{zoom:Ee});for(var zt=(Ne={},Ne[rt.LINES]=2,Ne[rt.TRIANGLES]=3,Ne[rt.LINE_STRIP]=1,Ne)[u],ar=0,rr=ve.get();ar<rr.length;ar+=1){var or=rr[ar],Lr=or.vaos||(or.vaos={});(Lr[R]||(Lr[R]=new Ql)).bind(i,this,V,Ye?Ye.getPaintVertexBuffers():[],ee,or.vertexOffset,Ge,nt),rt.drawElements(u,or.primitiveLength*zt,rt.UNSIGNED_SHORT,or.primitiveOffset*zt*2)}}};var Aa=function(i,u,a,h){var g=u.style.light,S=g.properties.get("position"),T=[S.x,S.y,S.z],R=d.create$1();g.properties.get("anchor")==="viewport"&&d.fromRotation(R,-u.transform.angle),d.transformMat3(T,T,R);var V=g.properties.get("color");return{u_matrix:i,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+a,u_opacity:h}},to=function(i,u,a,h,g,S,T){return d.extend(Aa(i,u,a,h),Ko(S,u,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8})},Ks=function(i){return{u_matrix:i}},ns=function(i,u,a,h){return d.extend(Ks(i),Ko(a,u,h))},fc=function(i,u){return{u_matrix:i,u_world:u}},Rl=function(i,u,a,h,g){return d.extend(ns(i,u,a,h),{u_world:g})},bu=function(i,u,a,h){var g,S,T=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=Gi(a,1,T.zoom);g=!0,S=[R,R]}else g=!1,S=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:d.browser.devicePixelRatio,u_extrude_scale:S}},Su=function(i,u,a){var h=Gi(a,1,u.zoom),g=Math.pow(2,u.zoom-a.tileID.overscaledZ),S=a.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:S}},Ou=function(i,u,a){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},Zs=function(i,u,a){return a===void 0&&(a=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:a}},Eu=function(i){return{u_matrix:i}},hc=function(i,u,a,h){return{u_matrix:i,u_extrude_scale:Gi(u,1,a),u_intensity:h}},Gu=function(i,u,a){var h=i.transform;return{u_matrix:nf(i,u,a),u_ratio:1/Gi(u,1,h.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},ma=function(i,u,a,h){return d.extend(Gu(i,u,a),{u_image:0,u_image_height:h})},Pc=function(i,u,a,h){var g=i.transform,S=ll(u,g);return{u_matrix:nf(i,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Gi(u,1,g.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ef=function(i,u,a,h,g){var S=i.lineAtlas,T=ll(u,i.transform),R=a.layout.get("line-cap")==="round",V=S.getDash(h.from,R),ee=S.getDash(h.to,R),ve=V.width*g.fromScale,ye=ee.width*g.toScale;return d.extend(Gu(i,u,a),{u_patternscale_a:[T/ve,-V.height/2],u_patternscale_b:[T/ye,-ee.height/2],u_sdfgamma:S.width/(256*Math.min(ve,ye)*d.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:ee.y,u_mix:g.t})};function ll(i,u){return 1/Gi(i,1,u.tileZoom)}function nf(i,u,a){return i.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var Mc=function(i,u,a,h,g){return{u_matrix:i,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(S=g.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:pc(g.paint.get("raster-hue-rotate"))};var S,T};function pc(i){i*=Math.PI/180;var u=Math.sin(i),a=Math.cos(i);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var ql,cl=function(i,u,a,h,g,S,T,R,V,ee){var ve=g.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:ve.width/ve.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+V,u_pitch_with_map:+h,u_texsize:ee,u_texture:0}},wu=function(i,u,a,h,g,S,T,R,V,ee,ve){var ye=g.transform;return d.extend(cl(i,u,a,h,g,S,T,R,V,ee),{u_gamma_scale:h?Math.cos(ye._pitch)*ye.cameraToCenterDistance:1,u_device_pixel_ratio:d.browser.devicePixelRatio,u_is_halo:+ve})},ec=function(i,u,a,h,g,S,T,R,V,ee){return d.extend(wu(i,u,a,h,g,S,T,R,!0,V,!0),{u_texsize_icon:ee,u_texture_icon:1})},fl=function(i,u,a){return{u_matrix:i,u_opacity:u,u_color:a}},uu=function(i,u,a,h,g,S){return d.extend(function(T,R,V,ee){var ve=V.imageManager.getPattern(T.from.toString()),ye=V.imageManager.getPattern(T.to.toString()),Ee=V.imageManager.getPixelSize(),Ye=Ee.width,Ge=Ee.height,nt=Math.pow(2,ee.tileID.overscaledZ),Ne=ee.tileSize*Math.pow(2,V.transform.tileZoom)/nt,rt=Ne*(ee.tileID.canonical.x+ee.tileID.wrap*nt),dt=Ne*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ve.tl,u_pattern_br_a:ve.br,u_pattern_tl_b:ye.tl,u_pattern_br_b:ye.br,u_texsize:[Ye,Ge],u_mix:R.t,u_pattern_size_a:ve.displaySize,u_pattern_size_b:ye.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/Gi(ee,1,V.transform.tileZoom),u_pixel_coord_upper:[rt>>16,dt>>16],u_pixel_coord_lower:[65535&rt,65535&dt]}}(h,S,a,g),{u_matrix:i,u_opacity:u})},dc={fillExtrusion:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new d.Uniform1f(i,u.u_height_factor),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new d.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new d.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new d.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new d.UniformColor(i,u.u_color),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_overlay:new d.Uniform1i(i,u.u_overlay),u_overlay_scale:new d.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new d.Uniform1f(i,u.u_extrude_scale),u_intensity:new d.Uniform1f(i,u.u_intensity),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_color_ramp:new d.Uniform1i(i,u.u_color_ramp),u_opacity:new d.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_latrange:new d.Uniform2f(i,u.u_latrange),u_light:new d.Uniform2f(i,u.u_light),u_shadow:new d.UniformColor(i,u.u_shadow),u_highlight:new d.UniformColor(i,u.u_highlight),u_accent:new d.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_dimension:new d.Uniform2f(i,u.u_dimension),u_zoom:new d.Uniform1f(i,u.u_zoom),u_unpack:new d.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_image:new d.Uniform1i(i,u.u_image),u_image_height:new d.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_texsize:new d.Uniform2f(i,u.u_texsize),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_image:new d.Uniform1i(i,u.u_image),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new d.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new d.Uniform1f(i,u.u_sdfgamma),u_image:new d.Uniform1i(i,u.u_image),u_tex_y_a:new d.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new d.Uniform1f(i,u.u_tex_y_b),u_mix:new d.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new d.Uniform2f(i,u.u_tl_parent),u_scale_parent:new d.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new d.Uniform1f(i,u.u_buffer_scale),u_fade_t:new d.Uniform1f(i,u.u_fade_t),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image0:new d.Uniform1i(i,u.u_image0),u_image1:new d.Uniform1i(i,u.u_image1),u_brightness_low:new d.Uniform1f(i,u.u_brightness_low),u_brightness_high:new d.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new d.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new d.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new d.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texsize_icon:new d.Uniform2f(i,u.u_texsize_icon),u_texture:new d.Uniform1i(i,u.u_texture),u_texture_icon:new d.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_color:new d.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image:new d.Uniform1i(i,u.u_image),u_pattern_tl_a:new d.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(i,u.u_pattern_br_b),u_texsize:new d.Uniform2f(i,u.u_texsize),u_mix:new d.Uniform1f(i,u.u_mix),u_pattern_size_a:new d.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new d.Uniform1f(i,u.u_scale_a),u_scale_b:new d.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(i,u.u_tile_units_to_pixels)}}};function hl(i,u,a,h,g,S,T){for(var R=i.context,V=R.gl,ee=i.useProgram("collisionBox"),ve=[],ye=0,Ee=0,Ye=0;Ye<h.length;Ye++){var Ge=h[Ye],nt=u.getTile(Ge),Ne=nt.getBucket(a);if(Ne){var rt=Ge.posMatrix;g[0]===0&&g[1]===0||(rt=i.translatePosMatrix(Ge.posMatrix,nt,g,S));var dt=T?Ne.textCollisionBox:Ne.iconCollisionBox,zt=Ne.collisionCircleArray;if(zt.length>0){var ar=d.create(),rr=rt;d.mul(ar,Ne.placementInvProjMatrix,i.transform.glCoordMatrix),d.mul(ar,ar,Ne.placementViewportMatrix),ve.push({circleArray:zt,circleOffset:Ee,transform:rr,invTransform:ar}),Ee=ye+=zt.length/4}dt&&ee.draw(R,V.LINES,B.disabled,re.disabled,i.colorModeForRenderPass(),Se.disabled,Su(rt,i.transform,nt),a.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,null,i.transform.zoom,null,null,dt.collisionVertexBuffer)}}if(T&&ve.length){var or=i.useProgram("collisionCircle"),Lr=new d.StructArrayLayout2f1f2i16;Lr.resize(4*ye),Lr._trim();for(var tn=0,Xr=0,yn=ve;Xr<yn.length;Xr+=1)for(var Fn=yn[Xr],Vn=0;Vn<Fn.circleArray.length/4;Vn++){var jn=4*Vn,Qi=Fn.circleArray[jn+0],_n=Fn.circleArray[jn+1],ci=Fn.circleArray[jn+2],Ci=Fn.circleArray[jn+3];Lr.emplace(tn++,Qi,_n,ci,Ci,0),Lr.emplace(tn++,Qi,_n,ci,Ci,1),Lr.emplace(tn++,Qi,_n,ci,Ci,2),Lr.emplace(tn++,Qi,_n,ci,Ci,3)}(!ql||ql.length<2*ye)&&(ql=function(Ja){var os=2*Ja,Zo=new d.StructArrayLayout3ui6;Zo.resize(os),Zo._trim();for(var Ga=0;Ga<os;Ga++){var no=6*Ga;Zo.uint16[no+0]=4*Ga+0,Zo.uint16[no+1]=4*Ga+1,Zo.uint16[no+2]=4*Ga+2,Zo.uint16[no+3]=4*Ga+2,Zo.uint16[no+4]=4*Ga+3,Zo.uint16[no+5]=4*Ga+0}return Zo}(ye));for(var fi=R.createIndexBuffer(ql,!0),oi=R.createVertexBuffer(Lr,d.collisionCircleLayout.members,!0),Ti=0,ii=ve;Ti<ii.length;Ti+=1){var ri=ii[Ti],Po=Ou(ri.transform,ri.invTransform,i.transform);or.draw(R,V.TRIANGLES,B.disabled,re.disabled,i.colorModeForRenderPass(),Se.disabled,Po,a.id,oi,fi,d.SegmentVector.simpleSegment(0,2*ri.circleOffset,ri.circleArray.length,ri.circleArray.length/2),null,i.transform.zoom,null,null,null)}oi.destroy(),fi.destroy()}}var $s=d.identity(new Float32Array(16));function Ic(i,u,a,h,g,S){var T=d.getAnchorAlignment(i),R=-(T.horizontalAlign-.5)*u,V=-(T.verticalAlign-.5)*a,ee=d.evaluateVariableOffset(i,h);return new d.Point((R/g+ee[0])*S,(V/g+ee[1])*S)}function Oc(i,u,a,h,g,S,T,R,V,ee,ve){var ye=i.text.placedSymbolArray,Ee=i.text.dynamicLayoutVertexArray,Ye=i.icon.dynamicLayoutVertexArray,Ge={};Ee.clear();for(var nt=0;nt<ye.length;nt++){var Ne=ye.get(nt),rt=Ne.hidden||!Ne.crossTileID||i.allowVerticalPlacement&&!Ne.placedOrientation?null:h[Ne.crossTileID];if(rt){var dt=new d.Point(Ne.anchorX,Ne.anchorY),zt=Qn(dt,a?R:T),ar=Fi(S.cameraToCenterDistance,zt.signedDistanceFromCamera),rr=g.evaluateSizeForFeature(i.textSizeData,ee,Ne)*ar/d.ONE_EM;a&&(rr*=i.tilePixelRatio/V);for(var or=Ic(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale,rr),Lr=a?Qn(dt.add(or),T).point:zt.point.add(u?or.rotate(-S.angle):or),tn=i.allowVerticalPlacement&&Ne.placedOrientation===d.WritingMode.vertical?Math.PI/2:0,Xr=0;Xr<Ne.numGlyphs;Xr++)d.addDynamicAttributes(Ee,Lr,tn);ve&&Ne.associatedIconIndex>=0&&(Ge[Ne.associatedIconIndex]={shiftedAnchor:Lr,angle:tn})}else Ka(Ne.numGlyphs,Ee)}if(ve){Ye.clear();for(var yn=i.icon.placedSymbolArray,Fn=0;Fn<yn.length;Fn++){var Vn=yn.get(Fn);if(Vn.hidden)Ka(Vn.numGlyphs,Ye);else{var jn=Ge[Fn];if(jn)for(var Qi=0;Qi<Vn.numGlyphs;Qi++)d.addDynamicAttributes(Ye,jn.shiftedAnchor,jn.angle);else Ka(Vn.numGlyphs,Ye)}}i.icon.dynamicLayoutVertexBuffer.updateData(Ye)}i.text.dynamicLayoutVertexBuffer.updateData(Ee)}function Lc(i,u,a){return a.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function Hu(i,u,a,h,g,S,T,R,V,ee,ve,ye){for(var Ee=i.context,Ye=Ee.gl,Ge=i.transform,nt=R==="map",Ne=V==="map",rt=nt&&a.layout.get("symbol-placement")!=="point",dt=nt&&!Ne&&!rt,zt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,ar=!1,rr=i.depthModeForSublayer(0,B.ReadOnly),or=a.layout.get("text-variable-anchor"),Lr=[],tn=0,Xr=h;tn<Xr.length;tn+=1){var yn=Xr[tn],Fn=u.getTile(yn),Vn=Fn.getBucket(a);if(Vn){var jn=g?Vn.text:Vn.icon;if(jn&&jn.segments.get().length){var Qi=jn.programConfigurations.get(a.id),_n=g||Vn.sdfIcons,ci=g?Vn.textSizeData:Vn.iconSizeData,Ci=Ne||Ge.pitch!==0,fi=i.useProgram(Lc(_n,g,Vn),Qi),oi=d.evaluateSizeForZoom(ci,Ge.zoom),Ti=void 0,ii=[0,0],ri=void 0,Po=void 0,Ja=null,os=void 0;if(g)ri=Fn.glyphAtlasTexture,Po=Ye.LINEAR,Ti=Fn.glyphAtlasTexture.size,Vn.iconsInText&&(ii=Fn.imageAtlasTexture.size,Ja=Fn.imageAtlasTexture,os=Ci||i.options.rotating||i.options.zooming||ci.kind==="composite"||ci.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{var Zo=a.layout.get("icon-size").constantOr(0)!==1||Vn.iconsNeedLinear;ri=Fn.imageAtlasTexture,Po=_n||i.options.rotating||i.options.zooming||Zo||Ci?Ye.LINEAR:Ye.NEAREST,Ti=Fn.imageAtlasTexture.size}var Ga=Gi(Fn,1,i.transform.zoom),no=ai(yn.posMatrix,Ne,nt,i.transform,Ga),ds=Ai(yn.posMatrix,Ne,nt,i.transform,Ga),vs=or&&Vn.hasTextData(),el=a.layout.get("icon-text-fit")!=="none"&&vs&&Vn.hasIconData();rt&&Xa(Vn,yn.posMatrix,i,g,no,ds,Ne,ee);var ms=i.translatePosMatrix(yn.posMatrix,Fn,S,T),eu=rt||g&&or||el?$s:no,Ls=i.translatePosMatrix(ds,Fn,S,T,!0),xl=_n&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,bl={program:fi,buffers:jn,uniformValues:_n?Vn.iconsInText?ec(ci.kind,oi,dt,Ne,i,ms,eu,Ls,Ti,ii):wu(ci.kind,oi,dt,Ne,i,ms,eu,Ls,g,Ti,!0):cl(ci.kind,oi,dt,Ne,i,ms,eu,Ls,g,Ti),atlasTexture:ri,atlasTextureIcon:Ja,atlasInterpolation:Po,atlasInterpolationIcon:os,isSDF:_n,hasHalo:xl};if(zt&&Vn.canOverlap){ar=!0;for(var Nu=0,tu=jn.segments.get();Nu<tu.length;Nu+=1){var Vl=tu[Nu];Lr.push({segments:new d.SegmentVector([Vl]),sortKey:Vl.sortKey,state:bl})}}else Lr.push({segments:jn.segments,sortKey:0,state:bl})}}}ar&&Lr.sort(function(du,gs){return du.sortKey-gs.sortKey});for(var Tu=0,zu=Lr;Tu<zu.length;Tu+=1){var Hs=zu[Tu],io=Hs.state;if(Ee.activeTexture.set(Ye.TEXTURE0),io.atlasTexture.bind(io.atlasInterpolation,Ye.CLAMP_TO_EDGE),io.atlasTextureIcon&&(Ee.activeTexture.set(Ye.TEXTURE1),io.atlasTextureIcon&&io.atlasTextureIcon.bind(io.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),io.isSDF){var Au=io.uniformValues;io.hasHalo&&(Au.u_is_halo=1,Dl(io.buffers,Hs.segments,a,i,io.program,rr,ve,ye,Au)),Au.u_is_halo=0}Dl(io.buffers,Hs.segments,a,i,io.program,rr,ve,ye,io.uniformValues)}}function Dl(i,u,a,h,g,S,T,R,V){var ee=h.context;g.draw(ee,ee.gl.TRIANGLES,S,T,R,Se.disabled,V,a.id,i.layoutVertexBuffer,i.indexBuffer,u,a.paint,h.transform.zoom,i.programConfigurations.get(a.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function tc(i,u,a,h,g,S,T){var R,V,ee,ve,ye,Ee=i.context.gl,Ye=a.paint.get("fill-pattern"),Ge=Ye&&Ye.constantOr(1),nt=a.getCrossfadeParameters();T?(V=Ge&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=Ee.LINES):(V=Ge?"fillPattern":"fill",R=Ee.TRIANGLES);for(var Ne=0,rt=h;Ne<rt.length;Ne+=1){var dt=rt[Ne],zt=u.getTile(dt);if(!Ge||zt.patternsLoaded()){var ar=zt.getBucket(a);if(ar){var rr=ar.programConfigurations.get(a.id),or=i.useProgram(V,rr);Ge&&(i.context.activeTexture.set(Ee.TEXTURE0),zt.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),rr.updatePaintBuffers(nt));var Lr=Ye.constantOr(null);if(Lr&&zt.imageAtlas){var tn=zt.imageAtlas,Xr=tn.patternPositions[Lr.to.toString()],yn=tn.patternPositions[Lr.from.toString()];Xr&&yn&&rr.setConstantPatternPositions(Xr,yn)}var Fn=i.translatePosMatrix(dt.posMatrix,zt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){ve=ar.indexBuffer2,ye=ar.segments2;var Vn=[Ee.drawingBufferWidth,Ee.drawingBufferHeight];ee=V==="fillOutlinePattern"&&Ge?Rl(Fn,i,nt,zt,Vn):fc(Fn,Vn)}else ve=ar.indexBuffer,ye=ar.segments,ee=Ge?ns(Fn,i,nt,zt):Ks(Fn);or.draw(i.context,R,g,i.stencilModeForClipping(dt),S,Se.disabled,ee,a.id,ar.layoutVertexBuffer,ve,ye,a.paint,i.transform.zoom,rr)}}}}function Wu(i,u,a,h,g,S,T){for(var R=i.context,V=R.gl,ee=a.paint.get("fill-extrusion-pattern"),ve=ee.constantOr(1),ye=a.getCrossfadeParameters(),Ee=a.paint.get("fill-extrusion-opacity"),Ye=0,Ge=h;Ye<Ge.length;Ye+=1){var nt=Ge[Ye],Ne=u.getTile(nt),rt=Ne.getBucket(a);if(rt){var dt=rt.programConfigurations.get(a.id),zt=i.useProgram(ve?"fillExtrusionPattern":"fillExtrusion",dt);ve&&(i.context.activeTexture.set(V.TEXTURE0),Ne.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),dt.updatePaintBuffers(ye));var ar=ee.constantOr(null);if(ar&&Ne.imageAtlas){var rr=Ne.imageAtlas,or=rr.patternPositions[ar.to.toString()],Lr=rr.patternPositions[ar.from.toString()];or&&Lr&&dt.setConstantPatternPositions(or,Lr)}var tn=i.translatePosMatrix(nt.posMatrix,Ne,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Xr=a.paint.get("fill-extrusion-vertical-gradient"),yn=ve?to(tn,i,Xr,Ee,nt,ye,Ne):Aa(tn,i,Xr,Ee);zt.draw(R,R.gl.TRIANGLES,g,S,T,Se.backCCW,yn,a.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,a.paint,i.transform.zoom,dt)}}}function kl(i,u,a,h,g,S){var T=i.context,R=T.gl,V=u.fbo;if(V){var ee=i.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,V.colorAttachment.get());var ve=function(ye,Ee,Ye){var Ge=Ye.paint.get("hillshade-shadow-color"),nt=Ye.paint.get("hillshade-highlight-color"),Ne=Ye.paint.get("hillshade-accent-color"),rt=Ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ye.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=ye.transform.angle);var dt,zt,ar,rr=!ye.options.moving;return{u_matrix:ye.transform.calculatePosMatrix(Ee.tileID.toUnwrapped(),rr),u_image:0,u_latrange:(dt=Ee.tileID,zt=Math.pow(2,dt.canonical.z),ar=dt.canonical.y,[new d.MercatorCoordinate(0,ar/zt).toLngLat().lat,new d.MercatorCoordinate(0,(ar+1)/zt).toLngLat().lat]),u_light:[Ye.paint.get("hillshade-exaggeration"),rt],u_shadow:Ge,u_highlight:nt,u_accent:Ne}}(i,u,a);ee.draw(T,R.TRIANGLES,h,g,S,Se.disabled,ve,a.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function Rc(i,u,a,h,g,S){var T=i.context,R=T.gl,V=u.dem;if(V&&V.data){var ee=V.dim,ve=V.stride,ye=V.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(ve),u.demTexture){var Ee=u.demTexture;Ee.update(ye,{premultiply:!1}),Ee.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else u.demTexture=new d.Texture(T,ye,R.RGBA,{premultiply:!1}),u.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Ye=u.fbo;if(!Ye){var Ge=new d.Texture(T,{width:ee,height:ee,data:null},R.RGBA);Ge.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Ye=u.fbo=T.createFramebuffer(ee,ee,!0)).colorAttachment.set(Ge.texture)}T.bindFramebuffer.set(Ye.framebuffer),T.viewport.set([0,0,ee,ee]),i.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,g,S,Se.disabled,function(nt,Ne){var rt=Ne.stride,dt=d.create();return d.ortho(dt,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(dt,dt,[0,-d.EXTENT,0]),{u_matrix:dt,u_image:1,u_dimension:[rt,rt],u_zoom:nt.overscaledZ,u_unpack:Ne.getUnpackVector()}}(u.tileID,V),a.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Xu(i,u,a,h,g){var S=h.paint.get("raster-fade-duration");if(S>0){var T=d.browser.now(),R=(T-i.timeAdded)/S,V=u?(T-u.timeAdded)/S:-1,ee=a.getSource(),ve=g.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),ye=!u||Math.abs(u.tileID.overscaledZ-ve)>Math.abs(i.tileID.overscaledZ-ve),Ee=ye&&i.refreshedUponExpiration?1:d.clamp(ye?R:1-V,0,1);return i.refreshedUponExpiration&&R>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}var No=new d.Color(1,0,0,1),af=new d.Color(0,1,0,1),of=new d.Color(0,0,1,1),Fl=new d.Color(1,0,1,1),Dc=new d.Color(0,1,1,1);function Fa(i,u,a,h){Yu(i,0,u+a/2,i.transform.width,a,h)}function kc(i,u,a,h){Yu(i,u-a/2,0,a,i.transform.height,h)}function Yu(i,u,a,h,g,S){var T=i.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(u*d.browser.devicePixelRatio,a*d.browser.devicePixelRatio,h*d.browser.devicePixelRatio,g*d.browser.devicePixelRatio),T.clear({color:S}),R.disable(R.SCISSOR_TEST)}function Fc(i,u,a){var h=i.context,g=h.gl,S=a.posMatrix,T=i.useProgram("debug"),R=B.disabled,V=re.disabled,ee=i.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),i.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.draw(h,g.LINE_STRIP,R,V,ee,Se.disabled,Zs(S,d.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var ve=u.getTileByID(a.key).latestRawTileData,ye=Math.floor((ve&&ve.byteLength||0)/1024),Ee=u.getTile(a).tileSize,Ye=512/Math.min(Ee,512)*(a.overscaledZ/i.transform.zoom)*.5,Ge=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ge+=" => "+a.overscaledZ),function(nt,Ne){nt.initDebugOverlayCanvas();var rt=nt.debugOverlayCanvas,dt=nt.context.gl,zt=nt.debugOverlayCanvas.getContext("2d");zt.clearRect(0,0,rt.width,rt.height),zt.shadowColor="white",zt.shadowBlur=2,zt.lineWidth=1.5,zt.strokeStyle="white",zt.textBaseline="top",zt.font="bold 36px Open Sans, sans-serif",zt.fillText(Ne,5,5),zt.strokeText(Ne,5,5),nt.debugOverlayTexture.update(rt),nt.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(i,Ge+" "+ye+"kb"),T.draw(h,g.TRIANGLES,R,V,fe.alphaBlended,Se.disabled,Zs(S,d.Color.transparent,Ye),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var Cu={symbol:function(i,u,a,h,g){if(i.renderPass==="translucent"){var S=re.disabled,T=i.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(R,V,ee,ve,ye,Ee,Ye){for(var Ge=V.transform,nt=ye==="map",Ne=Ee==="map",rt=0,dt=R;rt<dt.length;rt+=1){var zt=dt[rt],ar=ve.getTile(zt),rr=ar.getBucket(ee);if(rr&&rr.text&&rr.text.segments.get().length){var or=d.evaluateSizeForZoom(rr.textSizeData,Ge.zoom),Lr=Gi(ar,1,V.transform.zoom),tn=ai(zt.posMatrix,Ne,nt,V.transform,Lr),Xr=ee.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if(or){var yn=Math.pow(2,Ge.zoom-ar.tileID.overscaledZ);Oc(rr,nt,Ne,Ye,d.symbolSize,Ge,tn,zt.posMatrix,yn,or,Xr)}}}}(h,i,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&Hu(i,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),S,T),a.paint.get("text-opacity").constantOr(1)!==0&&Hu(i,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),S,T),u.map.showCollisionBoxes&&(hl(i,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),hl(i,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,a,h){if(i.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),S=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||S.constantOr(1)!==0&&T.constantOr(1)!==0){for(var V=i.context,ee=V.gl,ve=i.depthModeForSublayer(0,B.ReadOnly),ye=re.disabled,Ee=i.colorModeForRenderPass(),Ye=[],Ge=0;Ge<h.length;Ge++){var nt=h[Ge],Ne=u.getTile(nt),rt=Ne.getBucket(a);if(rt){var dt=rt.programConfigurations.get(a.id),zt={programConfiguration:dt,program:i.useProgram("circle",dt),layoutVertexBuffer:rt.layoutVertexBuffer,indexBuffer:rt.indexBuffer,uniformValues:bu(i,nt,Ne,a)};if(R)for(var ar=0,rr=rt.segments.get();ar<rr.length;ar+=1){var or=rr[ar];Ye.push({segments:new d.SegmentVector([or]),sortKey:or.sortKey,state:zt})}else Ye.push({segments:rt.segments,sortKey:0,state:zt})}}R&&Ye.sort(function(Fn,Vn){return Fn.sortKey-Vn.sortKey});for(var Lr=0,tn=Ye;Lr<tn.length;Lr+=1){var Xr=tn[Lr],yn=Xr.state;yn.program.draw(V,ee.TRIANGLES,ve,ye,Ee,Se.disabled,yn.uniformValues,a.id,yn.layoutVertexBuffer,yn.indexBuffer,Xr.segments,a.paint,i.transform.zoom,yn.programConfiguration)}}}},heatmap:function(i,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var g=i.context,S=g.gl,T=re.disabled,R=new fe([S.ONE,S.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(Ye,Ge,nt){var Ne=Ye.gl;Ye.activeTexture.set(Ne.TEXTURE1),Ye.viewport.set([0,0,Ge.width/4,Ge.height/4]);var rt=nt.heatmapFbo;if(rt)Ne.bindTexture(Ne.TEXTURE_2D,rt.colorAttachment.get()),Ye.bindFramebuffer.set(rt.framebuffer);else{var dt=Ne.createTexture();Ne.bindTexture(Ne.TEXTURE_2D,dt),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MIN_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MAG_FILTER,Ne.LINEAR),rt=nt.heatmapFbo=Ye.createFramebuffer(Ge.width/4,Ge.height/4,!1),function(zt,ar,rr,or){var Lr=zt.gl;Lr.texImage2D(Lr.TEXTURE_2D,0,Lr.RGBA,ar.width/4,ar.height/4,0,Lr.RGBA,zt.extRenderToTextureHalfFloat?zt.extTextureHalfFloat.HALF_FLOAT_OES:Lr.UNSIGNED_BYTE,null),or.colorAttachment.set(rr)}(Ye,Ge,dt,rt)}})(g,i,a),g.clear({color:d.Color.transparent});for(var V=0;V<h.length;V++){var ee=h[V];if(!u.hasRenderableParent(ee)){var ve=u.getTile(ee),ye=ve.getBucket(a);if(ye){var Ee=ye.programConfigurations.get(a.id);i.useProgram("heatmap",Ee).draw(g,S.TRIANGLES,B.disabled,T,R,Se.disabled,hc(ee.posMatrix,ve,i.transform.zoom,a.paint.get("heatmap-intensity")),a.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,a.paint,i.transform.zoom,Ee)}}}g.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(Ye,Ge){var nt=Ye.context,Ne=nt.gl,rt=Ge.heatmapFbo;if(rt){nt.activeTexture.set(Ne.TEXTURE0),Ne.bindTexture(Ne.TEXTURE_2D,rt.colorAttachment.get()),nt.activeTexture.set(Ne.TEXTURE1);var dt=Ge.colorRampTexture;dt||(dt=Ge.colorRampTexture=new d.Texture(nt,Ge.colorRamp,Ne.RGBA)),dt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ye.useProgram("heatmapTexture").draw(nt,Ne.TRIANGLES,B.disabled,re.disabled,Ye.colorModeForRenderPass(),Se.disabled,function(zt,ar,rr,or){var Lr=d.create();d.ortho(Lr,0,zt.width,zt.height,0,0,1);var tn=zt.context.gl;return{u_matrix:Lr,u_world:[tn.drawingBufferWidth,tn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ar.paint.get("heatmap-opacity")}}(Ye,Ge),Ge.id,Ye.viewportBuffer,Ye.quadTriangleIndexBuffer,Ye.viewportSegments,Ge.paint,Ye.transform.zoom)}}(i,a))},line:function(i,u,a,h){if(i.renderPass==="translucent"){var g=a.paint.get("line-opacity"),S=a.paint.get("line-width");if(g.constantOr(1)!==0&&S.constantOr(1)!==0)for(var T=i.depthModeForSublayer(0,B.ReadOnly),R=i.colorModeForRenderPass(),V=a.paint.get("line-dasharray"),ee=a.paint.get("line-pattern"),ve=ee.constantOr(1),ye=a.paint.get("line-gradient"),Ee=a.getCrossfadeParameters(),Ye=ve?"linePattern":V?"lineSDF":ye?"lineGradient":"line",Ge=i.context,nt=Ge.gl,Ne=!0,rt=0,dt=h;rt<dt.length;rt+=1){var zt=dt[rt],ar=u.getTile(zt);if(!ve||ar.patternsLoaded()){var rr=ar.getBucket(a);if(rr){var or=rr.programConfigurations.get(a.id),Lr=i.context.program.get(),tn=i.useProgram(Ye,or),Xr=Ne||tn.program!==Lr,yn=ee.constantOr(null);if(yn&&ar.imageAtlas){var Fn=ar.imageAtlas,Vn=Fn.patternPositions[yn.to.toString()],jn=Fn.patternPositions[yn.from.toString()];Vn&&jn&&or.setConstantPatternPositions(Vn,jn)}var Qi=ve?Pc(i,ar,a,Ee):V?Ef(i,ar,a,V,Ee):ye?ma(i,ar,a,rr.lineClipsArray.length):Gu(i,ar,a);if(ve)Ge.activeTexture.set(nt.TEXTURE0),ar.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),or.updatePaintBuffers(Ee);else if(V&&(Xr||i.lineAtlas.dirty))Ge.activeTexture.set(nt.TEXTURE0),i.lineAtlas.bind(Ge);else if(ye){var _n=rr.gradients[a.id],ci=_n.texture;if(a.gradientVersion!==_n.version){var Ci=256;if(a.stepInterpolant){var fi=u.getSource().maxzoom,oi=zt.canonical.z===fi?Math.ceil(1<<i.transform.maxZoom-zt.canonical.z):1;Ci=d.clamp(d.nextPowerOfTwo(rr.maxLineLength/d.EXTENT*1024*oi),256,Ge.maxTextureSize)}_n.gradient=d.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ci,image:_n.gradient||void 0,clips:rr.lineClipsArray}),_n.texture?_n.texture.update(_n.gradient):_n.texture=new d.Texture(Ge,_n.gradient,nt.RGBA),_n.version=a.gradientVersion,ci=_n.texture}Ge.activeTexture.set(nt.TEXTURE0),ci.bind(a.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}tn.draw(Ge,nt.TRIANGLES,T,i.stencilModeForClipping(zt),R,Se.disabled,Qi,a.id,rr.layoutVertexBuffer,rr.indexBuffer,rr.segments,a.paint,i.transform.zoom,or,rr.layoutVertexBuffer2),Ne=!1}}}}},fill:function(i,u,a,h){var g=a.paint.get("fill-color"),S=a.paint.get("fill-opacity");if(S.constantOr(1)!==0){var T=i.colorModeForRenderPass(),R=a.paint.get("fill-pattern"),V=i.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(d.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===V){var ee=i.depthModeForSublayer(1,i.renderPass==="opaque"?B.ReadWrite:B.ReadOnly);tc(i,u,a,h,ee,T,!1)}if(i.renderPass==="translucent"&&a.paint.get("fill-antialias")){var ve=i.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,B.ReadOnly);tc(i,u,a,h,ve,T,!0)}}},"fill-extrusion":function(i,u,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&i.renderPass==="translucent"){var S=new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Wu(i,u,a,h,S,re.disabled,fe.disabled),Wu(i,u,a,h,S,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var T=i.colorModeForRenderPass();Wu(i,u,a,h,S,re.disabled,T)}}},hillshade:function(i,u,a,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var g=i.context,S=i.depthModeForSublayer(0,B.ReadOnly),T=i.colorModeForRenderPass(),R=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],V=R[0],ee=0,ve=R[1];ee<ve.length;ee+=1){var ye=ve[ee],Ee=u.getTile(ye);Ee.needsHillshadePrepare&&i.renderPass==="offscreen"?Rc(i,Ee,a,S,re.disabled,T):i.renderPass==="translucent"&&kl(i,Ee,a,S,V[ye.overscaledZ],T)}g.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,a,h){if(i.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=i.context,S=g.gl,T=u.getSource(),R=i.useProgram("raster"),V=i.colorModeForRenderPass(),ee=T instanceof Me?[{},h]:i.stencilConfigForOverlap(h),ve=ee[0],ye=ee[1],Ee=ye[ye.length-1].overscaledZ,Ye=!i.options.moving,Ge=0,nt=ye;Ge<nt.length;Ge+=1){var Ne=nt[Ge],rt=i.depthModeForSublayer(Ne.overscaledZ-Ee,a.paint.get("raster-opacity")===1?B.ReadWrite:B.ReadOnly,S.LESS),dt=u.getTile(Ne),zt=i.transform.calculatePosMatrix(Ne.toUnwrapped(),Ye);dt.registerFadeDuration(a.paint.get("raster-fade-duration"));var ar=u.findLoadedParent(Ne,0),rr=Xu(dt,ar,u,a,i.transform),or=void 0,Lr=void 0,tn=a.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;g.activeTexture.set(S.TEXTURE0),dt.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(S.TEXTURE1),ar?(ar.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),or=Math.pow(2,ar.tileID.overscaledZ-dt.tileID.overscaledZ),Lr=[dt.tileID.canonical.x*or%1,dt.tileID.canonical.y*or%1]):dt.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var Xr=Mc(zt,Lr||[0,0],or||1,rr,a);T instanceof Me?R.draw(g,S.TRIANGLES,rt,re.disabled,V,Se.disabled,Xr,a.id,T.boundsBuffer,i.quadTriangleIndexBuffer,T.boundsSegments):R.draw(g,S.TRIANGLES,rt,ve[Ne.overscaledZ],V,Se.disabled,Xr,a.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var S=i.context,T=S.gl,R=i.transform,V=R.tileSize,ee=a.paint.get("background-pattern");if(!i.isPatternMissing(ee)){var ve=!ee&&h.a===1&&g===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===ve){var ye=re.disabled,Ee=i.depthModeForSublayer(0,ve==="opaque"?B.ReadWrite:B.ReadOnly),Ye=i.colorModeForRenderPass(),Ge=i.useProgram(ee?"backgroundPattern":"background"),nt=R.coveringTiles({tileSize:V});ee&&(S.activeTexture.set(T.TEXTURE0),i.imageManager.bind(i.context));for(var Ne=a.getCrossfadeParameters(),rt=0,dt=nt;rt<dt.length;rt+=1){var zt=dt[rt],ar=i.transform.calculatePosMatrix(zt.toUnwrapped()),rr=ee?uu(ar,g,i,ee,{tileID:zt,tileSize:V},Ne):fl(ar,g,h);Ge.draw(S,T.TRIANGLES,Ee,ye,Ye,Se.disabled,rr,a.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,a){for(var h=0;h<a.length;h++)Fc(i,u,a[h])},custom:function(i,u,a){var h=i.context,g=a.implementation;if(i.renderPass==="offscreen"){var S=g.prerender;S&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),S.call(g,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(re.disabled);var T=g.renderingMode==="3d"?new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,B.ReadOnly);h.setDepthMode(T),g.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},Pa=function(i,u){this.context=new te(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=me.maxUnderzooming+me.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ua,this.gpuTimers={}};Pa.prototype.resize=function(i,u){if(this.width=i*d.browser.devicePixelRatio,this.height=u*d.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},Pa.prototype.setup=function(){var i=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,ho.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);var a=new d.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(d.EXTENT,0),a.emplaceBack(0,d.EXTENT),a.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=i.createVertexBuffer(a,ho.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);var h=new d.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(d.EXTENT,0,d.EXTENT,0),h.emplaceBack(0,d.EXTENT,0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,ge.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);var g=new d.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,ho.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);var S=new d.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);var T=new d.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new d.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new re({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Pa.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=d.create();d.ortho(a,0,this.width,this.height,0,0,1),d.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,B.disabled,this.stencilClearMode,fe.disabled,Se.disabled,Eu(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Pa.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(fe.disabled),a.setDepthMode(B.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,T=u;S<T.length;S+=1){var R=T[S],V=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,B.disabled,new re({func:h.ALWAYS,mask:0},V,255,h.KEEP,h.KEEP,h.REPLACE),fe.disabled,Se.disabled,Eu(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Pa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new re({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},Pa.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new re({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},Pa.prototype.stencilConfigForOverlap=function(i){var u,a=this.context.gl,h=i.sort(function(V,ee){return ee.overscaledZ-V.overscaledZ}),g=h[h.length-1].overscaledZ,S=h[0].overscaledZ-g+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var T={},R=0;R<S;R++)T[R+g]=new re({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=S,[T,h]}return[(u={},u[g]=re.disabled,u),h]},Pa.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new fe([i.CONSTANT_COLOR,i.ONE],new d.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fe.unblended:fe.alphaBlended},Pa.prototype.depthModeForSublayer=function(i,u,a){if(!this.opaquePassEnabledForLayer())return B.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new B(a||this.context.gl.LEQUAL,u,[h,h])},Pa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Pa.prototype.render=function(i,u){var a=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(d.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var S in g){var T=g[S];T.used&&T.prepare(this.context)}var R,V,ee={},ve={},ye={};for(var Ee in g){var Ye=g[Ee];ee[Ee]=Ye.getVisibleCoordinates(),ve[Ee]=ee[Ee].slice().reverse(),ye[Ee]=Ye.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ge=0;Ge<h.length;Ge++)if(this.style._layers[h[Ge]].is3D()){this.opaquePassCutoff=Ge;break}this.renderPass="offscreen";for(var nt=0,Ne=h;nt<Ne.length;nt+=1){var rt=this.style._layers[Ne[nt]];if(rt.hasOffscreenPass()&&!rt.isHidden(this.transform.zoom)){var dt=ve[rt.source];(rt.type==="custom"||dt.length)&&this.renderLayer(this,g[rt.source],rt,dt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var zt=this.style._layers[h[this.currentLayer]],ar=g[zt.source],rr=ee[zt.source];this._renderTileClippingMasks(zt,rr),this.renderLayer(this,ar,zt,rr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var or=this.style._layers[h[this.currentLayer]],Lr=g[or.source],tn=(or.type==="symbol"?ye:ve)[or.source];this._renderTileClippingMasks(or,ee[or.source]),this.renderLayer(this,Lr,or,tn)}this.options.showTileBoundaries&&(d.values(this.style._layers).forEach(function(Xr){Xr.source&&!Xr.isHidden(a.transform.zoom)&&(Xr.source!==(V&&V.id)&&(V=a.style.sourceCaches[Xr.source]),(!R||R.getSource().maxzoom<V.getSource().maxzoom)&&(R=V))}),R&&Cu.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Xr){var yn=Xr.transform.padding;Fa(Xr,Xr.transform.height-(yn.top||0),3,No),Fa(Xr,yn.bottom||0,3,af),kc(Xr,yn.left||0,3,of),kc(Xr,Xr.transform.width-(yn.right||0),3,Fl);var Fn=Xr.transform.centerPoint;(function(Vn,jn,Qi,_n){Yu(Vn,jn-1,Qi-10,2,20,_n),Yu(Vn,jn-10,Qi-1,20,2,_n)})(Xr,Fn.x,Xr.transform.height-Fn.y,Dc)}(this),this.context.setDefault()},Pa.prototype.renderLayer=function(i,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),Cu[a.type](i,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Pa.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[i.id];a||(a=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},Pa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},Pa.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},Pa.prototype.queryGpuTimers=function(i){var u={};for(var a in i){var h=i[a],g=this.context.extTimerQuery,S=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[a]=S}return u},Pa.prototype.translatePosMatrix=function(i,u,a,h,g){if(!a[0]&&!a[1])return i;var S=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(S){var T=Math.sin(S),R=Math.cos(S);a=[a[0]*R-a[1]*T,a[0]*T+a[1]*R]}var V=[g?a[0]:Gi(u,a[0],this.transform.zoom),g?a[1]:Gi(u,a[1],this.transform.zoom),0],ee=new Float32Array(16);return d.translate(ee,i,V),ee},Pa.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},Pa.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},Pa.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),a=this.imageManager.getPattern(i.to.toString());return!u||!a},Pa.prototype.useProgram=function(i,u){this.cache=this.cache||{};var a=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new Ll(this.context,i,Hf[i],u,dc[i],this._showOverdrawInspector)),this.cache[a]},Pa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Pa.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},Pa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Pa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var rc=function(i,u){this.points=i,this.planes=u};rc.fromInvProjectionMatrix=function(i,u,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return d.transformMat4([],T,i)}).map(function(T){return d.scale$1([],T,1/T[3]/u*h)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=d.sub([],g[T[0]],g[T[1]]),V=d.sub([],g[T[2]],g[T[1]]),ee=d.normalize([],d.cross([],R,V)),ve=-d.dot(ee,g[T[1]]);return ee.concat(ve)});return new rc(g,S)};var Lu=function(i,u){this.min=i,this.max=u,this.center=d.scale$2([],d.add([],this.min,this.max),.5)};Lu.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],a=d.clone$2(this.min),h=d.clone$2(this.max),g=0;g<u.length;g++)a[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Lu(a,h)},Lu.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},Lu.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},Lu.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<i.planes.length;h++){for(var g=i.planes[h],S=0,T=0;T<u.length;T++)S+=d.dot$1(g,u[T])>=0;if(S===0)return 0;S!==u.length&&(a=!1)}if(a)return 2;for(var R=0;R<3;R++){for(var V=Number.MAX_VALUE,ee=-Number.MAX_VALUE,ve=0;ve<i.points.length;ve++){var ye=i.points[ve][R]-this.min[R];V=Math.min(V,ye),ee=Math.max(ee,ye)}if(ee<0||V>this.max[R]-this.min[R])return 0}return 1};var Ku=function(i,u,a,h){if(i===void 0&&(i=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=a,this.right=h};Ku.prototype.interpolate=function(i,u,a){return u.top!=null&&i.top!=null&&(this.top=d.number(i.top,u.top,a)),u.bottom!=null&&i.bottom!=null&&(this.bottom=d.number(i.bottom,u.bottom,a)),u.left!=null&&i.left!=null&&(this.left=d.number(i.left,u.left,a)),u.right!=null&&i.right!=null&&(this.right=d.number(i.right,u.right,a)),this},Ku.prototype.getCenter=function(i,u){var a=d.clamp((this.left+i-this.right)/2,0,i),h=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.Point(a,h)},Ku.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},Ku.prototype.clone=function(){return new Ku(this.top,this.bottom,this.left,this.right)},Ku.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Hi=function(i,u,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ku,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Hi.prototype.clone=function(){var i=new Hi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new d.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(i){var u=-d.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=d.create$2(),d.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(i){var u=d.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Hi.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},Hi.prototype.interpolatePadding=function(i,u,a){this._unmodified=!1,this._edgeInsets.interpolate(i,u,a),this._constrain(),this._calcMatrices()},Hi.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},Hi.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new d.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new d.Point(0,0)),h=this.pointCoordinate(new d.Point(this.width,0)),g=this.pointCoordinate(new d.Point(this.width,this.height)),S=this.pointCoordinate(new d.Point(0,this.height)),T=Math.floor(Math.min(a.x,h.x,g.x,S.x)),R=Math.floor(Math.max(a.x,h.x,g.x,S.x)),V=T-1;V<=R+1;V++)V!==0&&u.push(new d.UnwrappedTileID(V,i));return u},Hi.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),a=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=d.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),S=[g*h.x,g*h.y,0],T=rc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),R=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=u);var V=function(Xr){return{aabb:new Lu([Xr*g,0,0],[(Xr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Xr,fullyVisible:!1}},ee=[],ve=[],ye=u,Ee=i.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var Ye=1;Ye<=3;Ye++)ee.push(V(-Ye)),ee.push(V(Ye));for(ee.push(V(0));ee.length>0;){var Ge=ee.pop(),nt=Ge.x,Ne=Ge.y,rt=Ge.fullyVisible;if(!rt){var dt=Ge.aabb.intersects(T);if(dt===0)continue;rt=dt===2}var zt=Ge.aabb.distanceX(S),ar=Ge.aabb.distanceY(S),rr=Math.max(Math.abs(zt),Math.abs(ar));if(Ge.zoom===ye||rr>3+(1<<ye-Ge.zoom)-2&&Ge.zoom>=R)ve.push({tileID:new d.OverscaledTileID(Ge.zoom===ye?Ee:Ge.zoom,Ge.wrap,Ge.zoom,nt,Ne),distanceSq:d.sqrLen([S[0]-.5-nt,S[1]-.5-Ne])});else for(var or=0;or<4;or++){var Lr=(nt<<1)+or%2,tn=(Ne<<1)+(or>>1);ee.push({aabb:Ge.aabb.quadrant(or),zoom:Ge.zoom+1,x:Lr,y:tn,wrap:Ge.wrap,fullyVisible:rt})}}return ve.sort(function(Xr,yn){return Xr.distanceSq-yn.distanceSq}).map(function(Xr){return Xr.tileID})},Hi.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Hi.prototype.zoomScale=function(i){return Math.pow(2,i)},Hi.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},Hi.prototype.project=function(i){var u=d.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.Point(d.mercatorXfromLng(i.lng)*this.worldSize,d.mercatorYfromLat(u)*this.worldSize)},Hi.prototype.unproject=function(i){return new d.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Hi.prototype.setLocationAtPoint=function(i,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(i),S=new d.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},Hi.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},Hi.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},Hi.prototype.locationCoordinate=function(i){return d.MercatorCoordinate.fromLngLat(i)},Hi.prototype.coordinateLocation=function(i){return i.toLngLat()},Hi.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],a=[i.x,i.y,1,1];d.transformMat4(u,u,this.pixelMatrixInverse),d.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],g=a[3],S=u[1]/h,T=a[1]/g,R=u[2]/h,V=a[2]/g,ee=R===V?0:(0-R)/(V-R);return new d.MercatorCoordinate(d.number(u[0]/h,a[0]/g,ee)/this.worldSize,d.number(S,T,ee)/this.worldSize)},Hi.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix),new d.Point(u[0]/u[3],u[1]/u[3])},Hi.prototype.getBounds=function(){return new d.LngLatBounds().extend(this.pointLocation(new d.Point(0,0))).extend(this.pointLocation(new d.Point(this.width,0))).extend(this.pointLocation(new d.Point(this.width,this.height))).extend(this.pointLocation(new d.Point(0,this.height)))},Hi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new d.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Hi.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Hi.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var a=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=i.canonical,S=this.worldSize/this.zoomScale(g.z),T=g.x+Math.pow(2,g.z)*i.wrap,R=d.identity(new Float64Array(16));return d.translate(R,R,[T*S,g.y*S,0]),d.scale(R,R,[S/d.EXTENT,S/d.EXTENT,1]),d.multiply(R,u?this.alignedProjMatrix:this.projMatrix,R),h[a]=new Float32Array(R),h[a]},Hi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Hi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,a,h,g=-90,S=90,T=-180,R=180,V=this.size,ee=this._unmodified;if(this.latRange){var ve=this.latRange;g=d.mercatorYfromLat(ve[1])*this.worldSize,i=(S=d.mercatorYfromLat(ve[0])*this.worldSize)-g<V.y?V.y/(S-g):0}if(this.lngRange){var ye=this.lngRange;T=d.mercatorXfromLng(ye[0])*this.worldSize,u=(R=d.mercatorXfromLng(ye[1])*this.worldSize)-T<V.x?V.x/(R-T):0}var Ee=this.point,Ye=Math.max(u||0,i||0);if(Ye)return this.center=this.unproject(new d.Point(u?(R+T)/2:Ee.x,i?(S+g)/2:Ee.y)),this.zoom+=this.scaleZoom(Ye),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var Ge=Ee.y,nt=V.y/2;Ge-nt<g&&(h=g+nt),Ge+nt>S&&(h=S-nt)}if(this.lngRange){var Ne=Ee.x,rt=V.x/2;Ne-rt<T&&(a=T+rt),Ne+rt>R&&(a=R-rt)}a===void 0&&h===void 0||(this.center=this.unproject(new d.Point(a!==void 0?a:Ee.x,h!==void 0?h:Ee.y))),this._unmodified=ee,this._constraining=!1}},Hi.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+i.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(d.clamp(Math.PI-u-a,.01,Math.PI-.01)),g=this.point,S=g.x,T=g.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),V=this.height/50,ee=new Float64Array(16);d.perspective(ee,this._fov,this.width/this.height,V,R),ee[8]=2*-i.x/this.width,ee[9]=2*i.y/this.height,d.scale(ee,ee,[1,-1,1]),d.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),d.rotateX(ee,ee,this._pitch),d.rotateZ(ee,ee,this.angle),d.translate(ee,ee,[-S,-T,0]),this.mercatorMatrix=d.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),d.scale(ee,ee,[1,1,d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=d.invert([],this.projMatrix);var ve=this.width%2/2,ye=this.height%2/2,Ee=Math.cos(this.angle),Ye=Math.sin(this.angle),Ge=S-Math.round(S)+Ee*ve+Ye*ye,nt=T-Math.round(T)+Ee*ye+Ye*ve,Ne=new Float64Array(ee);if(d.translate(Ne,Ne,[Ge>.5?Ge-1:Ge,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Ne,ee=d.create(),d.scale(ee,ee,[this.width/2,-this.height/2,1]),d.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=d.create(),d.scale(ee,ee,[1,-1,1]),d.translate(ee,ee,[-1,-1,0]),d.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=d.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Hi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new d.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},Hi.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.Point(0,i))},Hi.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var a=u.x,h=u.y,g=u.x,S=u.y,T=0,R=i;T<R.length;T+=1){var V=R[T];a=Math.min(a,V.x),h=Math.min(h,V.y),g=Math.max(g,V.x),S=Math.max(S,V.y)}return[new d.Point(a,h),new d.Point(g,h),new d.Point(g,S),new d.Point(a,S),new d.Point(a,h)]},Object.defineProperties(Hi.prototype,Ma);var Us=function(i){var u,a,h,g;this._hashName=i&&encodeURIComponent(i),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(u(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};Us.prototype.addTo=function(i){return this._map=i,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Us.prototype.remove=function(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Us.prototype.getHashString=function(i){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),S=Math.round(u.lng*g)/g,T=Math.round(u.lat*g)/g,R=this._map.getBearing(),V=this._map.getPitch(),ee="";if(ee+=i?"/"+S+"/"+T+"/"+a:a+"/"+T+"/"+S,(R||V)&&(ee+="/"+Math.round(10*R)/10),V&&(ee+="/"+Math.round(V)),this._hashName){var ve=this._hashName,ye=!1,Ee=d.window.location.hash.slice(1).split("&").map(function(Ye){var Ge=Ye.split("=")[0];return Ge===ve?(ye=!0,Ge+"="+ee):Ye}).filter(function(Ye){return Ye});return ye||Ee.push(ve+"="+ee),"#"+Ee.join("&")}return"#"+ee},Us.prototype._getCurrentHash=function(){var i,u=this,a=d.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):a.split("/")},Us.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},Us.prototype._updateHashUnthrottled=function(){var i=d.window.location.href.replace(/(#.+)?$/,this.getHashString());try{d.window.history.replaceState(d.window.history.state,null,i)}catch(u){}};var vc={linearity:.3,easing:d.bezier(0,0,.3,1)},nc=d.extend({deceleration:2500,maxSpeed:1400},vc),ic=d.extend({deceleration:20,maxSpeed:1400},vc),Of=d.extend({deceleration:1e3,maxSpeed:360},vc),Lf=d.extend({deceleration:1e3,maxSpeed:90},vc),ac=function(i){this._map=i,this.clear()};function $u(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function Ru(i,u,a){var h=a.maxSpeed,g=a.linearity,S=a.deceleration,T=d.clamp(i*g/(u/1e3),-h,h),R=Math.abs(T)/(S*g);return{easing:a.easing,duration:1e3*R,amount:T*(R/2)}}ac.prototype.clear=function(){this._inertiaBuffer=[]},ac.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.browser.now(),settings:i})},ac.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=d.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},ac.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new d.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var R=Ru(u.pan.mag(),S,d.extend({},nc,i||{}));T.offset=u.pan.mult(R.amount/u.pan.mag()),T.center=this._map.transform.center,$u(T,R)}if(u.zoom){var V=Ru(u.zoom,S,ic);T.zoom=this._map.transform.zoom+V.amount,$u(T,V)}if(u.bearing){var ee=Ru(u.bearing,S,Of);T.bearing=this._map.transform.bearing+d.clamp(ee.amount,-179,179),$u(T,ee)}if(u.pitch){var ve=Ru(u.pitch,S,Lf);T.pitch=this._map.transform.pitch+ve.amount,$u(T,ve)}if(T.zoom||T.bearing){var ye=u.pinchAround===void 0?u.around:u.pinchAround;T.around=ye?this._map.unproject(ye):this._map.getCenter()}return this.clear(),d.extend(T,{noMoveStart:!0})}};var ro=function(i){function u(h,g,S,T){T===void 0&&(T={});var R=Y.mousePos(g.getCanvasContainer(),S),V=g.unproject(R);i.call(this,h,d.extend({point:R,lngLat:V,originalEvent:S},T)),this._defaultPrevented=!1,this.target=g}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(d.Event),hs=function(i){function u(h,g,S){var T=h==="touchend"?S.changedTouches:S.touches,R=Y.touchPos(g.getCanvasContainer(),T),V=R.map(function(ye){return g.unproject(ye)}),ee=R.reduce(function(ye,Ee,Ye,Ge){return ye.add(Ee.div(Ge.length))},new d.Point(0,0)),ve=g.unproject(ee);i.call(this,h,{points:R,point:ee,lngLats:V,lngLat:ve,originalEvent:S}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(d.Event),pl=function(i){function u(h,g,S){i.call(this,h,{originalEvent:S}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(d.Event),Va=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};Va.prototype.reset=function(){delete this._mousedownPos},Va.prototype.wheel=function(i){return this._firePreventable(new pl(i.type,this._map,i))},Va.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new ro(i.type,this._map,i))},Va.prototype.mouseup=function(i){this._map.fire(new ro(i.type,this._map,i))},Va.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new ro(i.type,this._map,i))},Va.prototype.dblclick=function(i){return this._firePreventable(new ro(i.type,this._map,i))},Va.prototype.mouseover=function(i){this._map.fire(new ro(i.type,this._map,i))},Va.prototype.mouseout=function(i){this._map.fire(new ro(i.type,this._map,i))},Va.prototype.touchstart=function(i){return this._firePreventable(new hs(i.type,this._map,i))},Va.prototype.touchmove=function(i){this._map.fire(new hs(i.type,this._map,i))},Va.prototype.touchend=function(i){this._map.fire(new hs(i.type,this._map,i))},Va.prototype.touchcancel=function(i){this._map.fire(new hs(i.type,this._map,i))},Va.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},Va.prototype.isEnabled=function(){return!0},Va.prototype.isActive=function(){return!1},Va.prototype.enable=function(){},Va.prototype.disable=function(){};var wn=function(i){this._map=i};wn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},wn.prototype.mousemove=function(i){this._map.fire(new ro(i.type,this._map,i))},wn.prototype.mousedown=function(){this._delayContextMenu=!0},wn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},wn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ro(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},wn.prototype.isEnabled=function(){return!0},wn.prototype.isActive=function(){return!1},wn.prototype.enable=function(){},wn.prototype.disable=function(){};var js=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function mc(i,u){for(var a={},h=0;h<i.length;h++)a[i[h].identifier]=u[h];return a}js.prototype.isEnabled=function(){return!!this._enabled},js.prototype.isActive=function(){return!!this._active},js.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},js.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},js.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},js.prototype.mousemoveWindow=function(i,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=Y.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var g=Math.min(h.x,a.x),S=Math.max(h.x,a.x),T=Math.min(h.y,a.y),R=Math.max(h.y,a.y);Y.setTransform(this._box,"translate("+g+"px,"+T+"px)"),this._box.style.width=S-g+"px",this._box.style.height=R-T+"px"}}},js.prototype.mouseupWindow=function(i,u){var a=this;if(this._active&&i.button===0){var h=this._startPos,g=u;if(this.reset(),Y.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(S){return S.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},js.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},js.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos},js.prototype._fireEvent=function(i,u){return this._map.fire(new d.Event(i,{originalEvent:u}))};var Bl=function(i){this.reset(),this.numTouches=i.numTouches};Bl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Bl.prototype.touchstart=function(i,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new d.Point(0,0),S=0,T=h;S<T.length;S+=1)g._add(T[S]);return g.div(h.length)}(u),this.touches=mc(a,u)))},Bl.prototype.touchmove=function(i,u,a){if(!this.aborted&&this.centroid){var h=mc(a,u);for(var g in this.touches){var S=h[g];(!S||S.dist(this.touches[g])>30)&&(this.aborted=!0)}}},Bl.prototype.touchend=function(i,u,a){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var lu=function(i){this.singleTap=new Bl(i),this.numTaps=i.numTaps,this.reset()};lu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},lu.prototype.touchstart=function(i,u,a){this.singleTap.touchstart(i,u,a)},lu.prototype.touchmove=function(i,u,a){this.singleTap.touchmove(i,u,a)},lu.prototype.touchend=function(i,u,a){var h=this.singleTap.touchend(i,u,a);if(h){var g=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(h)<30;if(g&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Vs=function(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()};Vs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vs.prototype.touchstart=function(i,u,a){this._zoomIn.touchstart(i,u,a),this._zoomOut.touchstart(i,u,a)},Vs.prototype.touchmove=function(i,u,a){this._zoomIn.touchmove(i,u,a),this._zoomOut.touchmove(i,u,a)},Vs.prototype.touchend=function(i,u,a){var h=this,g=this._zoomIn.touchend(i,u,a),S=this._zoomOut.touchend(i,u,a);return g?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:i})}}):S?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:i})}}):void 0},Vs.prototype.touchcancel=function(){this.reset()},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active};var dl={0:1,2:2},Kr=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(i,u){return!1},Kr.prototype._move=function(i,u){return{}},Kr.prototype.mousedown=function(i,u){if(!this._lastPoint){var a=Y.mouseButton(i);this._correctButton(i,a)&&(this._lastPoint=u,this._eventButton=a)}},Kr.prototype.mousemoveWindow=function(i,u){var a=this._lastPoint;if(a){if(i.preventDefault(),function(h,g){var S=dl[g];return h.buttons===void 0||(h.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},Kr.prototype.mouseupWindow=function(i){this._lastPoint&&Y.mouseButton(i)===this._eventButton&&(this._moved&&Y.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var Bc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(a,h){i.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}(Kr),gc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Kr),Ju=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Kr),Js=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};Js.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new d.Point(0,0)},Js.prototype.touchstart=function(i,u,a){return this._calculateTransform(i,u,a)},Js.prototype.touchmove=function(i,u,a){if(this._active&&!(a.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,a)},Js.prototype.touchend=function(i,u,a){this._calculateTransform(i,u,a),this._active&&a.length<this._minTouches&&this.reset()},Js.prototype.touchcancel=function(){this.reset()},Js.prototype._calculateTransform=function(i,u,a){a.length>0&&(this._active=!0);var h=mc(a,u),g=new d.Point(0,0),S=new d.Point(0,0),T=0;for(var R in h){var V=h[R],ee=this._touches[R];ee&&(g._add(V),S._add(V.sub(ee)),T++,h[R]=V)}if(this._touches=h,!(T<this._minTouches)&&S.mag()){var ve=S.div(T);if(this._sum._add(ve),!(this._sum.mag()<this._clickTolerance))return{around:g.div(T),panDelta:ve}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active};var Ms=function(){this.reset()};function Nc(i,u,a){for(var h=0;h<i.length;h++)if(i[h].identifier===a)return u[h]}function zc(i,u){return Math.log(i/u)/Math.LN2}Ms.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ms.prototype._start=function(i){},Ms.prototype._move=function(i,u,a){return{}},Ms.prototype.touchstart=function(i,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},Ms.prototype.touchmove=function(i,u,a){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,g=h[1],S=Nc(a,u,h[0]),T=Nc(a,u,g);if(S&&T){var R=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],R,i)}}},Ms.prototype.touchend=function(i,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],S=Nc(a,u,h[0]),T=Nc(a,u,g);S&&T||(this._active&&Y.suppressClick(),this.reset())}},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var Gs=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(zc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zc(this._distance,g),pinchAround:h}},u}(Ms);function Qu(i,u){return 180*i.angleWith(u)/Math.PI}var Nl=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qu(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=Qu(a,this._startVector);return Math.abs(g)<h},u}(Ms);function Du(i){return Math.abs(i.y)>Math.abs(i.x)}var Zc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,Du(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,g){var S=a[0].sub(this._lastPoints[0]),T=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,T,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var S=a.mag()>=2,T=h.mag()>=2;if(S||T){if(!S||!T)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var R=a.y>0==h.y>0;return Du(a)&&Du(h)&&R}},u}(Ms),yc={panStep:100,bearingStep:15,pitchStep:10},cu=function(){var i=yc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Is(i){return i*(2-i)}cu.prototype.reset=function(){this._active=!1},cu.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var a=0,h=0,g=0,S=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),S=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),S=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(R){var V=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Is,zoom:a?Math.round(V)+a*(i.shiftKey?2:1):V,bearing:R.getBearing()+h*u._bearingStep,pitch:R.getPitch()+g*u._pitchStep,offset:[-S*u._panStep,-T*u._panStep],center:R.getCenter()},{originalEvent:i})}}}},cu.prototype.enable=function(){this._enabled=!0},cu.prototype.disable=function(){this._enabled=!1,this.reset()},cu.prototype.isEnabled=function(){return this._enabled},cu.prototype.isActive=function(){return this._active},cu.prototype.disableRotation=function(){this._rotationDisabled=!0},cu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Bi=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,d.bindAll(["_onTimeout"],this)};Bi.prototype.setZoomRate=function(i){this._defaultZoomRate=i},Bi.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},Bi.prototype.isEnabled=function(){return!!this._enabled},Bi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Bi.prototype.isZooming=function(){return!!this._zooming},Bi.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},Bi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Bi.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,a=d.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},Bi.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},Bi.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=Y.mousePos(this._el,i);this._around=d.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Bi.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,R=this._startZoom,V=this._easing,ee=!1;if(this._type==="wheel"&&R&&V){var ve=Math.min((d.browser.now()-this._lastWheelEventTime)/200,1),ye=V(ve);S=d.number(R,T,ye),ve<1?this._frameId||(this._frameId=!0):ee=!0}else S=T,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:S-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Bi.prototype._smoothOutEasing=function(i){var u=d.ease;if(this._prevEase){var a=this._prevEase,h=(d.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),S=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-S*S);u=d.bezier(S,T,.25,1)}return this._prevEase={start:d.browser.now(),duration:i,easing:u},u},Bi.prototype.reset=function(){this._active=!1};var Qs=function(i,u){this._clickZoom=i,this._tapZoom=u};Qs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Qs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Qs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Qs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var $o=function(){this.reset()};$o.prototype.reset=function(){this._active=!1},$o.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(i.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:i})}}},$o.prototype.enable=function(){this._enabled=!0},$o.prototype.disable=function(){this._enabled=!1,this.reset()},$o.prototype.isEnabled=function(){return this._enabled},$o.prototype.isActive=function(){return this._active};var Ao=function(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()};Ao.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ao.prototype.touchstart=function(i,u,a){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(i,u,a))},Ao.prototype.touchmove=function(i,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(i,u,a)},Ao.prototype.touchend=function(i,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(i,u,a)&&(this._tapTime=i.timeStamp)},Ao.prototype.touchcancel=function(){this.reset()},Ao.prototype.enable=function(){this._enabled=!0},Ao.prototype.disable=function(){this._enabled=!1,this.reset()},Ao.prototype.isEnabled=function(){return this._enabled},Ao.prototype.isActive=function(){return this._active};var vl=function(i,u,a){this._el=i,this._mousePan=u,this._touchPan=a};vl.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},vl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},vl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},vl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var qu=function(i,u,a){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};qu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},qu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},qu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},qu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fu=function(i,u,a,h){this._el=i,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};fu.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var is=function(i){return i.zoom||i.drag||i.pitch||i.rotate},zl=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(d.Event);function Un(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var On=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ac(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[d.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var S=g[h],T=S[0];Y.addEventListener(T,S[1],T===d.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};On.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var a=u[i],h=a[0];Y.removeEventListener(h,a[1],h===d.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},On.prototype._addDefaultHandlers=function(i){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new Va(u,i));var h=u.boxZoom=new js(u,i);this._add("boxZoom",h);var g=new Vs,S=new $o;u.doubleClickZoom=new Qs(S,g),this._add("tapZoom",g),this._add("clickZoom",S);var T=new Ao;this._add("tapDragZoom",T);var R=u.touchPitch=new Zc;this._add("touchPitch",R);var V=new gc(i),ee=new Ju(i);u.dragRotate=new qu(i,V,ee),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var ve=new Bc(i),ye=new Js(i);u.dragPan=new vl(a,ve,ye),this._add("mousePan",ve),this._add("touchPan",ye,["touchZoom","touchRotate"]);var Ee=new Nl,Ye=new Gs;u.touchZoomRotate=new fu(a,Ye,Ee,T),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",Ye,["touchPan","touchRotate"]);var Ge=u.scrollZoom=new Bi(u,this);this._add("scrollZoom",Ge,["mousePan"]);var nt=u.keyboard=new cu;this._add("keyboard",nt),this._add("blockableMapEvent",new wn(u));for(var Ne=0,rt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ne<rt.length;Ne+=1){var dt=rt[Ne];i.interactive&&i[dt]&&u[dt].enable(i[dt])}},On.prototype._add=function(i,u,a){this._handlers.push({handlerName:i,handler:u,allowed:a}),this._handlersById[i]=u},On.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},On.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},On.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},On.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},On.prototype.isMoving=function(){return Boolean(is(this._eventsInProgress))||this.isZooming()},On.prototype._blockedByActive=function(i,u,a){for(var h in i)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},On.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},On.prototype._getMapTouches=function(i){for(var u=[],a=0,h=i;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&u.push(g)}return u},On.prototype.handleEvent=function(i,u){if(i.type!=="blur"){this._updatingCamera=!0;for(var a=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},g={},S={},T=i.touches?this._getMapTouches(i.touches):void 0,R=T?Y.touchPos(this._el,T):Y.mousePos(this._el,i),V=0,ee=this._handlers;V<ee.length;V+=1){var ve=ee[V],ye=ve.handlerName,Ee=ve.handler,Ye=ve.allowed;if(Ee.isEnabled()){var Ge=void 0;this._blockedByActive(S,Ye,ye)?Ee.reset():Ee[u||i.type]&&(Ge=Ee[u||i.type](i,R,T),this.mergeHandlerResult(h,g,Ge,ye,a),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||Ee.isActive())&&(S[ye]=Ee)}}var nt={};for(var Ne in this._previousActiveHandlers)S[Ne]||(nt[Ne]=a);this._previousActiveHandlers=S,(Object.keys(nt).length||Un(h))&&(this._changes.push([h,g,nt]),this._triggerRenderFrame()),(Object.keys(S).length||Un(h))&&this._map._stop(!0),this._updatingCamera=!1;var rt=h.cameraAnimation;rt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],rt(this._map))}else this.stop(!0)},On.prototype.mergeHandlerResult=function(i,u,a,h,g){if(a){d.extend(i,a);var S={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(u.zoom=S),a.panDelta!==void 0&&(u.drag=S),a.pitchDelta!==void 0&&(u.pitch=S),a.bearingDelta!==void 0&&(u.rotate=S)}},On.prototype._applyChanges=function(){for(var i={},u={},a={},h=0,g=this._changes;h<g.length;h+=1){var S=g[h],T=S[0],R=S[1],V=S[2];T.panDelta&&(i.panDelta=(i.panDelta||new d.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(i.around=T.around),T.pinchAround!==void 0&&(i.pinchAround=T.pinchAround),T.noInertia&&(i.noInertia=T.noInertia),d.extend(u,R),d.extend(a,V)}this._updateMapTransform(i,u,a),this._changes=[]},On.prototype._updateMapTransform=function(i,u,a){var h=this._map,g=h.transform;if(!Un(i))return this._fireEvents(u,a,!0);var S=i.panDelta,T=i.zoomDelta,R=i.bearingDelta,V=i.pitchDelta,ee=i.around,ve=i.pinchAround;ve!==void 0&&(ee=ve),h._stop(!0),ee=ee||h.transform.centerPoint;var ye=g.pointLocation(S?ee.sub(S):ee);R&&(g.bearing+=R),V&&(g.pitch+=V),T&&(g.zoom+=T),g.setLocationAtPoint(ye,ee),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,a,!0)},On.prototype._fireEvents=function(i,u,a){var h=this,g=is(this._eventsInProgress),S=is(i),T={};for(var R in i)this._eventsInProgress[R]||(T[R+"start"]=i[R].originalEvent),this._eventsInProgress[R]=i[R];for(var V in!g&&S&&this._fireEvent("movestart",S.originalEvent),T)this._fireEvent(V,T[V]);for(var ee in S&&this._fireEvent("move",S.originalEvent),i)this._fireEvent(ee,i[ee].originalEvent);var ve,ye={};for(var Ee in this._eventsInProgress){var Ye=this._eventsInProgress[Ee],Ge=Ye.handlerName,nt=Ye.originalEvent;this._handlersById[Ge].isActive()||(delete this._eventsInProgress[Ee],ye[Ee+"end"]=ve=u[Ge]||nt)}for(var Ne in ye)this._fireEvent(Ne,ye[Ne]);var rt=is(this._eventsInProgress);if(a&&(g||S)&&!rt){this._updatingCamera=!0;var dt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),zt=function(ar){return ar!==0&&-h._bearingSnap<ar&&ar<h._bearingSnap};dt?(zt(dt.bearing||this._map.getBearing())&&(dt.bearing=0),this._map.easeTo(dt,{originalEvent:ve})):(this._map.fire(new d.Event("moveend",{originalEvent:ve})),zt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},On.prototype._fireEvent=function(i,u){this._map.fire(new d.Event(i,u?{originalEvent:u}:{}))},On.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new zl("renderFrame",{timeStamp:u})),i._applyChanges()})},On.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Zl=function(i){function u(a,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,g){return a=d.Point.convert(a).mult(-1),this.panTo(this.transform.center,d.extend({offset:a},h),g)},u.prototype.panTo=function(a,h,g){return this.easeTo(d.extend({center:a},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,g){return this.easeTo(d.extend({zoom:a},h),g)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,g){return this.easeTo(d.extend({bearing:a},h),g)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,d.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=d.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(a,h,g,S){var T={top:0,bottom:0,right:0,left:0};if(typeof(S=d.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var R=S.padding;S.padding={top:R,bottom:R,right:R,left:R}}S.padding=d.extend(T,S.padding);var V=this.transform,ee=V.padding,ve=V.project(d.LngLat.convert(a)),ye=V.project(d.LngLat.convert(h)),Ee=ve.rotate(-g*Math.PI/180),Ye=ye.rotate(-g*Math.PI/180),Ge=new d.Point(Math.max(Ee.x,Ye.x),Math.max(Ee.y,Ye.y)),nt=new d.Point(Math.min(Ee.x,Ye.x),Math.min(Ee.y,Ye.y)),Ne=Ge.sub(nt),rt=(V.width-(ee.left+ee.right+S.padding.left+S.padding.right))/Ne.x,dt=(V.height-(ee.top+ee.bottom+S.padding.top+S.padding.bottom))/Ne.y;if(!(dt<0||rt<0)){var zt=Math.min(V.scaleZoom(V.scale*Math.min(rt,dt)),S.maxZoom),ar=typeof S.offset.x=="number"?new d.Point(S.offset.x,S.offset.y):d.Point.convert(S.offset),rr=new d.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(g*Math.PI/180),or=ar.add(rr).mult(V.scale/V.zoomScale(zt));return{center:V.unproject(ve.add(ye).div(2).sub(or)),zoom:zt,bearing:g}}d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},u.prototype.fitScreenCoordinates=function(a,h,g,S,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.Point.convert(a)),this.transform.pointLocation(d.Point.convert(h)),g,S),S,T)},u.prototype._fitInternal=function(a,h,g){return a?(delete(h=d.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,S=!1,T=!1,R=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(S=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=d.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(T=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(R=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),S&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),T&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),R&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h))},u.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=d.extend({offset:[0,0],duration:500,easing:d.ease},a)).animate===!1||!a.essential&&d.browser.prefersReducedMotion)&&(a.duration=0);var S=this.transform,T=this.getZoom(),R=this.getBearing(),V=this.getPitch(),ee=this.getPadding(),ve="zoom"in a?+a.zoom:T,ye="bearing"in a?this._normalizeBearing(a.bearing,R):R,Ee="pitch"in a?+a.pitch:V,Ye="padding"in a?a.padding:S.padding,Ge=d.Point.convert(a.offset),nt=S.centerPoint.add(Ge),Ne=S.pointLocation(nt),rt=d.LngLat.convert(a.center||Ne);this._normalizeCenter(rt);var dt,zt,ar=S.project(Ne),rr=S.project(rt).sub(ar),or=S.zoomScale(ve-T);a.around&&(dt=d.LngLat.convert(a.around),zt=S.locationPoint(dt));var Lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==T,this._rotating=this._rotating||R!==ye,this._pitching=this._pitching||Ee!==V,this._padding=!S.isPaddingEqual(Ye),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Lr),this._ease(function(tn){if(g._zooming&&(S.zoom=d.number(T,ve,tn)),g._rotating&&(S.bearing=d.number(R,ye,tn)),g._pitching&&(S.pitch=d.number(V,Ee,tn)),g._padding&&(S.interpolatePadding(ee,Ye,tn),nt=S.centerPoint.add(Ge)),dt)S.setLocationAtPoint(dt,zt);else{var Xr=S.zoomScale(S.zoom-T),yn=ve>T?Math.min(2,or):Math.max(.5,or),Fn=Math.pow(yn,1-tn),Vn=S.unproject(ar.add(rr.mult(tn*Fn)).mult(Xr));S.setLocationAtPoint(S.renderWorldCopies?Vn.wrap():Vn,nt)}g._fireMoveEvents(h)},function(tn){g._afterEase(h,tn)},a),this},u.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new d.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new d.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new d.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new d.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new d.Event("move",a)),this._zooming&&this.fire(new d.Event("zoom",a)),this._rotating&&this.fire(new d.Event("rotate",a)),this._pitching&&this.fire(new d.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.Event("zoomend",a)),S&&this.fire(new d.Event("rotateend",a)),T&&this.fire(new d.Event("pitchend",a)),this.fire(new d.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&d.browser.prefersReducedMotion){var S=d.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,h)}this.stop(),a=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},a);var T=this.transform,R=this.getZoom(),V=this.getBearing(),ee=this.getPitch(),ve=this.getPadding(),ye="zoom"in a?d.clamp(+a.zoom,T.minZoom,T.maxZoom):R,Ee="bearing"in a?this._normalizeBearing(a.bearing,V):V,Ye="pitch"in a?+a.pitch:ee,Ge="padding"in a?a.padding:T.padding,nt=T.zoomScale(ye-R),Ne=d.Point.convert(a.offset),rt=T.centerPoint.add(Ne),dt=T.pointLocation(rt),zt=d.LngLat.convert(a.center||dt);this._normalizeCenter(zt);var ar=T.project(dt),rr=T.project(zt).sub(ar),or=a.curve,Lr=Math.max(T.width,T.height),tn=Lr/nt,Xr=rr.mag();if("minZoom"in a){var yn=d.clamp(Math.min(a.minZoom,R,ye),T.minZoom,T.maxZoom),Fn=Lr/T.zoomScale(yn-R);or=Math.sqrt(Fn/Xr*2)}var Vn=or*or;function jn(ii){var ri=(tn*tn-Lr*Lr+(ii?-1:1)*Vn*Vn*Xr*Xr)/(2*(ii?tn:Lr)*Vn*Xr);return Math.log(Math.sqrt(ri*ri+1)-ri)}function Qi(ii){return(Math.exp(ii)-Math.exp(-ii))/2}function _n(ii){return(Math.exp(ii)+Math.exp(-ii))/2}var ci=jn(0),Ci=function(ii){return _n(ci)/_n(ci+or*ii)},fi=function(ii){return Lr*((_n(ci)*(Qi(ri=ci+or*ii)/_n(ri))-Qi(ci))/Vn)/Xr;var ri},oi=(jn(1)-ci)/or;if(Math.abs(Xr)<1e-6||!isFinite(oi)){if(Math.abs(Lr-tn)<1e-6)return this.easeTo(a,h);var Ti=tn<Lr?-1:1;oi=Math.abs(Math.log(tn/Lr))/or,fi=function(){return 0},Ci=function(ii){return Math.exp(Ti*or*ii)}}return a.duration="duration"in a?+a.duration:1e3*oi/("screenSpeed"in a?+a.screenSpeed/or:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=V!==Ee,this._pitching=Ye!==ee,this._padding=!T.isPaddingEqual(Ge),this._prepareEase(h,!1),this._ease(function(ii){var ri=ii*oi,Po=1/Ci(ri);T.zoom=ii===1?ye:R+T.scaleZoom(Po),g._rotating&&(T.bearing=d.number(V,Ee,ii)),g._pitching&&(T.pitch=d.number(ee,Ye,ii)),g._padding&&(T.interpolatePadding(ve,Ge,ii),rt=T.centerPoint.add(Ne));var Ja=ii===1?zt:T.unproject(ar.add(rr.mult(fi(ri))).mult(Po));T.setLocationAtPoint(T.renderWorldCopies?Ja.wrap():Ja,rt),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var S=this.handlers;S&&S.stop(!1)}return this},u.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=d.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((d.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=d.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},u}(d.Evented),ps=function(i){i===void 0&&(i={}),this.options=i,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ps.prototype.getDefaultPosition=function(){return"bottom-right"},ps.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=Y.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ps.prototype.onRemove=function(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ps.prototype._setElementTitle=function(i,u){var a=this._map._getUIString("AttributionControl."+u);i.title=a,i.setAttribute("aria-label",a)},ps.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ps.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(i){var a=u.reduce(function(h,g,S){return g.value&&(h+=g.key+"="+g.value+(S<u.length-1?"&":"")),h},"?");i.href=d.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},ps.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ps.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var S=g.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort(function(R,V){return R.length-V.length});var T=(i=i.filter(function(R,V){for(var ee=V+1;ee<i.length;ee++)if(i[ee].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,i.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ps.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Do=function(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)};Do.prototype.onAdd=function(i){this._map=i,this._container=Y.create("div","mapboxgl-ctrl");var u=Y.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Do.prototype.onRemove=function(){Y.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Do.prototype.getDefaultPosition=function(){return"bottom-left"},Do.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Do.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},Do.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var zo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};zo.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},zo.prototype.remove=function(i){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===i)return void(g.cancelled=!0)}},zo.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},zo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ku={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},hu=d.window.HTMLImageElement,Ul=d.window.HTMLElement,ra=d.window.ImageBitmap,po={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Uc=function(i){function u(h){var g=this;if((h=d.extend({},po,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new Hi(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,S,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new zo,this._controls=[],this._mapId=d.uniqueId(),this._locale=d.extend({},ku,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new d.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=d.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof Ul))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),d.window!==void 0&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new On(this,h),this._hash=h.hash&&new Us(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,d.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ps({customAttribution:h.customAttribution})),this.addControl(new Do,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(T){g._update(T.dataType==="style"),g.fire(new d.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){g.fire(new d.Event(T.dataType+"dataloading",T))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[g];return g.indexOf("bottom")!==-1?T.insertBefore(S,T.firstChild):T.appendChild(S),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),S=g[0],T=g[1];this._resizeCanvas(S,T),this.transform.resize(S,T),this.painter.resize(S,T);var R=!this._moving;return R&&(this.stop(),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h))),this.fire(new d.Event("resize",h)),R&&this.fire(new d.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(d.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(d.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(d.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,S){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var V=!1;return{layer:g,listener:S,delegates:{mousemove:function(ve){var ye=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];ye.length?V||(V=!0,S.call(R,new ro(h,R,ve.originalEvent,{features:ye}))):V=!1},mouseout:function(){V=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ee=!1;return{layer:g,listener:S,delegates:{mousemove:function(ve){(R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[]).length?ee=!0:ee&&(ee=!1,S.call(R,new ro(h,R,ve.originalEvent)))},mouseout:function(ve){ee&&(ee=!1,S.call(R,new ro(h,R,ve.originalEvent)))}}}}return{layer:g,listener:S,delegates:(T={},T[h]=function(ve){var ye=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];ye.length&&(ve.features=ye,S.call(R,ve),delete ve.features)},T)}},u.prototype.on=function(h,g,S){if(S===void 0)return i.prototype.on.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},u.prototype.once=function(h,g,S){if(S===void 0)return i.prototype.once.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},u.prototype.off=function(h,g,S){var T=this;return S===void 0?i.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var V=R[h],ee=0;ee<V.length;ee++){var ve=V[ee];if(ve.layer===g&&ve.listener===S){for(var ye in ve.delegates)T.off(ye,ve.delegates[ye]);return V.splice(ee,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var S;if(g!==void 0||h===void 0||h instanceof d.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof d.Point||typeof h[0]=="number")S=[d.Point.convert(h)];else{var T=d.Point.convert(h[0]),R=d.Point.convert(h[1]);S=[T,new d.Point(R.x,T.y),R,new d.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(S,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ti(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var S=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,d.ResourceType.Style);d.getJSON(R,function(V,ee){V?S.fire(new d.ErrorEvent(V)):ee&&S._updateDiff(ee,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(S){d.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new d.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var S=h[g]._tiles;for(var T in S){var R=S[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,S)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,S){S===void 0&&(S={});var T=S.pixelRatio;T===void 0&&(T=1);var R=S.sdf;R===void 0&&(R=!1);var V=S.stretchX,ee=S.stretchY,ve=S.content;if(this._lazyInitEmptyStyle(),g instanceof hu||ra&&g instanceof ra){var ye=d.browser.getImageData(g);this.style.addImage(h,{data:new d.RGBAImage({width:ye.width,height:ye.height},ye.data),pixelRatio:T,stretchX:V,stretchY:ee,content:ve,sdf:R,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ee=g;this.style.addImage(h,{data:new d.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:T,stretchX:V,stretchY:ee,content:ve,sdf:R,version:0,userImage:Ee}),Ee.onAdd&&Ee.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var S=this.style.getImage(h);if(!S)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=g instanceof hu||ra&&g instanceof ra?d.browser.getImageData(g):g,R=T.width,V=T.height,ee=T.data;return R===void 0||V===void 0?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==S.data.width||V!==S.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(ee,!(g instanceof hu||ra&&g instanceof ra)),void this.style.updateImage(h,S))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){d.getImage(this._requestManager.transformRequest(h,d.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,S){return this.style.setLayerZoomRange(h,g,S),this._update(!0)},u.prototype.setFilter=function(h,g,S){return S===void 0&&(S={}),this.style.setFilter(h,g,S),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,g,S,T),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,g,S,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=Y.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=Y.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var T=this._controlContainer=Y.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(V){R[V]=Y.create("div","mapboxgl-ctrl-"+V,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var S=d.browser.devicePixelRatio||1;this._canvas.width=S*h,this._canvas.height=S*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=d.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Pa(g,this.transform),d.webpSupported.testSupport(g)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,S=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,g),T=d.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,ve=d.browser.now();this.style.zoomHistory.update(ee,ve);var ye=new d.EvaluationParameters(ee,{now:ve,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ee=ye.crossFadingFactor();Ee===1&&Ee===this._crossFadingFactor||(V=!0,this._crossFadingFactor=Ee),this.style.update(ye)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ye=d.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,g),setTimeout(function(){var Ne=R.getQueryObjectEXT(g,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(g),S.fire(new d.Event("gpu-timing-frame",{cpuTime:Ye,gpuTime:Ne}))},50)}if(this.listens("gpu-timing-layer")){var Ge=this.painter.collectGpuTimers();setTimeout(function(){var Ne=S.painter.queryGpuTimers(Ge);S.fire(new d.Event("gpu-timing-layer",{layerTimes:Ne}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),d.window!==void 0&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),Fu(this._canvasContainer),Fu(this._controlContainer),Fu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new d.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=d.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){d.setCacheLimits(h,g)},a.version.get=function(){return d.version},Object.defineProperties(u.prototype,a),u}(Zl);function Fu(i){i.parentNode&&i.parentNode.removeChild(i)}var _c={showCompass:!0,showZoom:!0,visualizePitch:!1},Bu=function(i){var u=this;this.options=d.extend({},_c,i),this._container=Y.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),Y.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),Y.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=Y.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Bu.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),a=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},Bu.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Bu.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Os(this._map,this._compass,this.options.visualizePitch)),this._container},Bu.prototype.onRemove=function(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Bu.prototype._createButton=function(i,u){var a=Y.create("button",i,this._container);return a.type="button",a.addEventListener("click",u),a},Bu.prototype._setButtonTitle=function(i,u){var a=this._map._getUIString("NavigationControl."+u);i.title=a,i.setAttribute("aria-label",a)};var Os=function(i,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new gc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,a&&(this.mousePitch=new Ju({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Y.addEventListener(u,"mousedown",this.mousedown),Y.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(u,"touchmove",this.touchmove),Y.addEventListener(u,"touchend",this.touchend),Y.addEventListener(u,"touchcancel",this.reset)};function oc(i,u,a){if(i=new d.LngLat(i.lng,i.lat),u){var h=new d.LngLat(i.lng-360,i.lat),g=new d.LngLat(i.lng+360,i.lat),S=a.locationPoint(i).distSqr(u);a.locationPoint(h).distSqr(u)<S?i=h:a.locationPoint(g).distSqr(u)<S&&(i=g)}for(;Math.abs(i.lng-a.center.lng)>180;){var T=a.locationPoint(i);if(T.x>=0&&T.y>=0&&T.x<=a.width&&T.y<=a.height)break;i.lng>a.center.lng?i.lng-=360:i.lng+=360}return i}Os.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),Y.disableDrag()},Os.prototype.move=function(i,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(i,u);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},Os.prototype.off=function(){var i=this.element;Y.removeEventListener(i,"mousedown",this.mousedown),Y.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(i,"touchmove",this.touchmove),Y.removeEventListener(i,"touchend",this.touchend),Y.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},Os.prototype.offTemp=function(){Y.enableDrag(),Y.removeEventListener(d.window,"mousemove",this.mousemove),Y.removeEventListener(d.window,"mouseup",this.mouseup)},Os.prototype.mousedown=function(i){this.down(d.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),Y.mousePos(this.element,i)),Y.addEventListener(d.window,"mousemove",this.mousemove),Y.addEventListener(d.window,"mouseup",this.mouseup)},Os.prototype.mousemove=function(i){this.move(i,Y.mousePos(this.element,i))},Os.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},Os.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},Os.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},Os.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var as={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xc(i,u,a){var h=i.classList;for(var g in as)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+u)}var jl,sc=function(i){function u(a,h){if(i.call(this),(a instanceof d.window.HTMLElement||h)&&(a=d.extend({element:a},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=d.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div"),this._element.setAttribute("aria-label","Map marker");var g=Y.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var S=Y.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var T=Y.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=Y.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var V=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];V<ee.length;V+=1){var ve=ee[V],ye=Y.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",ve.rx),ye.setAttributeNS(null,"ry",ve.ry),R.appendChild(ye)}var Ee=Y.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"fill",this._color);var Ye=Y.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ee.appendChild(Ye);var Ge=Y.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"fill","#000000");var nt=Y.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ge.appendChild(nt);var Ne=Y.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ne.setAttributeNS(null,"fill","#FFFFFF");var rt=Y.createNS("http://www.w3.org/2000/svg","g");rt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var dt=Y.createNS("http://www.w3.org/2000/svg","circle");dt.setAttributeNS(null,"fill","#000000"),dt.setAttributeNS(null,"opacity","0.25"),dt.setAttributeNS(null,"cx","5.5"),dt.setAttributeNS(null,"cy","5.5"),dt.setAttributeNS(null,"r","5.4999962");var zt=Y.createNS("http://www.w3.org/2000/svg","circle");zt.setAttributeNS(null,"fill","#FFFFFF"),zt.setAttributeNS(null,"cx","5.5"),zt.setAttributeNS(null,"cy","5.5"),zt.setAttributeNS(null,"r","5.4999962"),rt.appendChild(dt),rt.appendChild(zt),T.appendChild(R),T.appendChild(Ee),T.appendChild(Ge),T.appendChild(Ne),T.appendChild(rt),g.appendChild(T),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=d.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ar){ar.preventDefault()}),this._element.addEventListener("mousedown",function(ar){ar.preventDefault()}),xc(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=d.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=oc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,as[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=d.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(d.Evented),jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},uc=0,ml=!1,Vc=function(i){function u(a){i.call(this),this.options=d.extend({},jc,a),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=Y.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,jl!==void 0?h(jl):d.window.navigator.permissions!==void 0?d.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(jl=g.state!=="denied")}):h(jl=!!d.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,uc=0,ml=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new d.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,S=this._map.getBearing(),T=d.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),T,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new d.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),S=h.distanceTo(g),T=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&ml)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=Y.create("button","mapboxgl-ctrl-geolocate",this._container),Y.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new sc(this._dotElement),this._circleElement=Y.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new d.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":uc--,ml=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++uc>1?(a={maximumAge:6e5,timeout:0},ml=!0):(a=this.options.positionOptions,ml=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(d.Evented),gl={maxWidth:100,unit:"metric"},yl=function(i){this.options=d.extend({},gl,i),d.bindAll(["_onMove","setUnit"],this)};function _l(i,u,a){var h=a&&a.maxWidth||100,g=i._container.clientHeight/2,S=i.unproject([0,g]),T=i.unproject([h,g]),R=S.distanceTo(T);if(a&&a.unit==="imperial"){var V=3.2808*R;V>5280?pu(u,h,V/5280,i._getUIString("ScaleControl.Miles")):pu(u,h,V,i._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?pu(u,h,R/1852,i._getUIString("ScaleControl.NauticalMiles")):R>=1e3?pu(u,h,R/1e3,i._getUIString("ScaleControl.Kilometers")):pu(u,h,R,i._getUIString("ScaleControl.Meters"))}function pu(i,u,a,h){var g,S,T,R=(g=a,(S=Math.pow(10,(""+Math.floor(g)).length-1))*(T=(T=g/S)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(V){var ee=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*ee)/ee}(T)));i.style.width=u*(R/a)+"px",i.innerHTML=R+"&nbsp;"+h}yl.prototype.getDefaultPosition=function(){return"bottom-left"},yl.prototype._onMove=function(){_l(this._map,this._container,this.options)},yl.prototype.onAdd=function(i){return this._map=i,this._container=Y.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},yl.prototype.onRemove=function(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},yl.prototype.setUnit=function(i){this.options.unit=i,_l(this._map,this._container,this.options)};var qs=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof d.window.HTMLElement?this._container=i.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in d.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in d.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in d.window.document&&(this._fullscreenchange="MSFullscreenChange")};qs.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},qs.prototype.onRemove=function(){Y.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},qs.prototype._checkFullscreenSupport=function(){return!!(d.window.document.fullscreenEnabled||d.window.document.mozFullScreenEnabled||d.window.document.msFullscreenEnabled||d.window.document.webkitFullscreenEnabled)},qs.prototype._setupUI=function(){var i=this._fullscreenButton=Y.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},qs.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},qs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},qs.prototype._isFullscreen=function(){return this._fullscreen},qs.prototype._changeIcon=function(){(d.window.document.fullscreenElement||d.window.document.mozFullScreenElement||d.window.document.webkitFullscreenElement||d.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},qs.prototype._onClickFullscreen=function(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.mozCancelFullScreen?d.window.document.mozCancelFullScreen():d.window.document.msExitFullscreen?d.window.document.msExitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Gc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),sf=function(i){function u(a){i.call(this),this.options=d.extend(Object.create(Gc),a),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=d.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(d.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,g=d.window.document.createDocumentFragment(),S=d.window.document.createElement("body");for(S.innerHTML=a;h=S.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Y.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Y.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Y.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ye){return h._container.classList.add(ye)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=oc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),S=this.options.anchor,T=function ye(Ee){if(Ee){if(typeof Ee=="number"){var Ye=Math.round(Math.sqrt(.5*Math.pow(Ee,2)));return{center:new d.Point(0,0),top:new d.Point(0,Ee),"top-left":new d.Point(Ye,Ye),"top-right":new d.Point(-Ye,Ye),bottom:new d.Point(0,-Ee),"bottom-left":new d.Point(Ye,-Ye),"bottom-right":new d.Point(-Ye,-Ye),left:new d.Point(Ee,0),right:new d.Point(-Ee,0)}}if(Ee instanceof d.Point||Array.isArray(Ee)){var Ge=d.Point.convert(Ee);return{center:Ge,top:Ge,"top-left":Ge,"top-right":Ge,bottom:Ge,"bottom-left":Ge,"bottom-right":Ge,left:Ge,right:Ge}}return{center:d.Point.convert(Ee.center||[0,0]),top:d.Point.convert(Ee.top||[0,0]),"top-left":d.Point.convert(Ee["top-left"]||[0,0]),"top-right":d.Point.convert(Ee["top-right"]||[0,0]),bottom:d.Point.convert(Ee.bottom||[0,0]),"bottom-left":d.Point.convert(Ee["bottom-left"]||[0,0]),"bottom-right":d.Point.convert(Ee["bottom-right"]||[0,0]),left:d.Point.convert(Ee.left||[0,0]),right:d.Point.convert(Ee.right||[0,0])}}return ye(new d.Point(0,0))}(this.options.offset);if(!S){var R,V=this._container.offsetWidth,ee=this._container.offsetHeight;R=g.y+T.bottom.y<ee?["top"]:g.y>this._map.transform.height-ee?["bottom"]:[],g.x<V/2?R.push("left"):g.x>this._map.transform.width-V/2&&R.push("right"),S=R.length===0?"bottom":R.join("-")}var ve=g.add(T[S]).round();Y.setTransform(this._container,as[S]+" translate("+ve.x+"px,"+ve.y+"px)"),xc(this._container,S,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(bc);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(d.Evented),Sc={version:d.version,supported:b,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:Uc,NavigationControl:Bu,GeolocateControl:Vc,AttributionControl:ps,ScaleControl:yl,FullscreenControl:qs,Popup:sf,Marker:sc,Style:ti,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.Point,MercatorCoordinate:d.MercatorCoordinate,Evented:d.Evented,config:d.config,prewarm:function(){mr().acquire(Ft)},clearPrewarmedResources:function(){var i=bn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Ft),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(i){d.config.ACCESS_TOKEN=i},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(i){d.config.API_URL=i},get workerCount(){return kr.workerCount},set workerCount(i){kr.workerCount=i},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){d.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){d.clearTileCache(i)},workerUrl:""};return Sc}),Q})},86387:function(sr,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function(Yt){return(0,w.default)((0,I.default)(Yt)&&Yt.length>=1,"Must merge at least 1 JSON schema."),b.default.apply(void 0,[{}].concat(Ut(Yt),[function(kt,Lt,bt){if(!(0,W.default)(kt)){if(bt==="required")return(0,we.default)(kt.concat(Lt));if((0,We.default)(kt)){if(!(0,We.default)(Lt))throw new Error('Failed to merge schemas because "'+bt+'" has different values.');return}w.default.deepEqual(kt,Lt,'Failed to merge schemas because "'+bt+'" has different values: '+JSON.stringify(kt)+" and "+JSON.stringify(Lt)+".")}}]))};var Q=x(48583),w=$e(Q),d=x(38554),b=$e(d),Y=x(59722),W=$e(Y),$=x(53778),I=$e($),k=x(97644),we=$e(k),Be=x(8146),We=$e(Be);function $e(Yt){return Yt&&Yt.__esModule?Yt:{default:Yt}}function Ut(Yt){if(Array.isArray(Yt)){for(var kt=0,Lt=Array(Yt.length);kt<Yt.length;kt++)Lt[kt]=Yt[kt];return Lt}else return Array.from(Yt)}sr.exports=L.default},28660:function(sr,L,x){var Q=x(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var w;(function(d){(function(b){var Y=typeof x.g=="object"?x.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),W=$(d);typeof Y.Reflect=="undefined"?Y.Reflect=d:W=$(Y.Reflect,W),b(W);function $(I,k){return function(we,Be){typeof I[we]!="function"&&Object.defineProperty(I,we,{configurable:!0,writable:!0,value:Be}),k&&k(we,Be)}}})(function(b){var Y=Object.prototype.hasOwnProperty,W=typeof Symbol=="function",$=W&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",I=W&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",k=typeof Object.create=="function",we={__proto__:[]}instanceof Array,Be=!k&&!we,We={create:k?function(){return Pr(Object.create(null))}:we?function(){return Pr({__proto__:null})}:function(){return Pr({})},has:Be?function(Je,yt){return Y.call(Je,yt)}:function(Je,yt){return yt in Je},get:Be?function(Je,yt){return Y.call(Je,yt)?Je[yt]:void 0}:function(Je,yt){return Je[yt]}},$e=Object.getPrototypeOf(Function),Ut=typeof Q=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Yt=!Ut&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:hr(),kt=!Ut&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Cr(),Lt=!Ut&&typeof WeakMap=="function"?WeakMap:Tr(),bt=new Lt;function pt(Je,yt,ht,fr){if(Br(ht)){if(!E(Je))throw new TypeError;if(!he(yt))throw new TypeError;return Et(Je,yt)}else{if(!E(Je))throw new TypeError;if(!se(yt))throw new TypeError;if(!se(fr)&&!Br(fr)&&!un(fr))throw new TypeError;return un(fr)&&(fr=void 0),ht=Dt(ht),gr(Je,yt,ht,fr)}}b("decorate",pt);function Ir(Je,yt){function ht(fr,$r){if(!se(fr))throw new TypeError;if(!Br($r)&&!Ze($r))throw new TypeError;Qe(Je,yt,fr,$r)}return ht}b("metadata",Ir);function er(Je,yt,ht,fr){if(!se(ht))throw new TypeError;return Br(fr)||(fr=Dt(fr)),Qe(Je,yt,ht,fr)}b("defineMetadata",er);function nr(Je,yt,ht){if(!se(yt))throw new TypeError;return Br(ht)||(ht=Dt(ht)),Ae(Je,yt,ht)}b("hasMetadata",nr);function xt(Je,yt,ht){if(!se(yt))throw new TypeError;return Br(ht)||(ht=Dt(ht)),oe(Je,yt,ht)}b("hasOwnMetadata",xt);function Ke(Je,yt,ht){if(!se(yt))throw new TypeError;return Br(ht)||(ht=Dt(ht)),ge(Je,yt,ht)}b("getMetadata",Ke);function _t(Je,yt,ht){if(!se(yt))throw new TypeError;return Br(ht)||(ht=Dt(ht)),Me(Je,yt,ht)}b("getOwnMetadata",_t);function Fe(Je,yt){if(!se(Je))throw new TypeError;return Br(yt)||(yt=Dt(yt)),gt(Je,yt)}b("getMetadataKeys",Fe);function Pe(Je,yt){if(!se(Je))throw new TypeError;return Br(yt)||(yt=Dt(yt)),Jt(Je,yt)}b("getOwnMetadataKeys",Pe);function Ve(Je,yt,ht){if(!se(yt))throw new TypeError;Br(ht)||(ht=Dt(ht));var fr=ae(yt,ht,!1);if(Br(fr)||!fr.delete(Je))return!1;if(fr.size>0)return!0;var $r=bt.get(yt);return $r.delete(ht),$r.size>0||bt.delete(yt),!0}b("deleteMetadata",Ve);function Et(Je,yt){for(var ht=Je.length-1;ht>=0;--ht){var fr=Je[ht],$r=fr(yt);if(!Br($r)&&!un($r)){if(!he($r))throw new TypeError;yt=$r}}return yt}function gr(Je,yt,ht,fr){for(var $r=Je.length-1;$r>=0;--$r){var lt=Je[$r],Rt=lt(yt,ht,fr);if(!Br(Rt)&&!un(Rt)){if(!se(Rt))throw new TypeError;fr=Rt}}return fr}function ae(Je,yt,ht){var fr=bt.get(Je);if(Br(fr)){if(!ht)return;fr=new Yt,bt.set(Je,fr)}var $r=fr.get(yt);if(Br($r)){if(!ht)return;$r=new Yt,fr.set(yt,$r)}return $r}function Ae(Je,yt,ht){var fr=oe(Je,yt,ht);if(fr)return!0;var $r=jt(yt);return un($r)?!1:Ae(Je,$r,ht)}function oe(Je,yt,ht){var fr=ae(yt,ht,!1);return Br(fr)?!1:Ce(fr.has(Je))}function ge(Je,yt,ht){var fr=oe(Je,yt,ht);if(fr)return Me(Je,yt,ht);var $r=jt(yt);if(!un($r))return ge(Je,$r,ht)}function Me(Je,yt,ht){var fr=ae(yt,ht,!1);if(!Br(fr))return fr.get(Je)}function Qe(Je,yt,ht,fr){var $r=ae(ht,fr,!0);$r.set(Je,yt)}function gt(Je,yt){var ht=Jt(Je,yt),fr=jt(Je);if(fr===null)return ht;var $r=gt(fr,yt);if($r.length<=0)return ht;if(ht.length<=0)return $r;for(var lt=new kt,Rt=[],Qt=0,pr=ht;Qt<pr.length;Qt++){var vn=pr[Qt],Pn=lt.has(vn);Pn||(lt.add(vn),Rt.push(vn))}for(var bi=0,Si=$r;bi<Si.length;bi++){var vn=Si[bi],Pn=lt.has(vn);Pn||(lt.add(vn),Rt.push(vn))}return Rt}function Jt(Je,yt){var ht=[],fr=ae(Je,yt,!1);if(Br(fr))return ht;for(var $r=fr.keys(),lt=mt($r),Rt=0;;){var Qt=H(lt);if(!Qt)return ht.length=Rt,ht;var pr=Ct(Qt);try{ht[Rt]=pr}catch(vn){try{Kt(lt)}finally{throw vn}}Rt++}}function Dr(Je){if(Je===null)return 1;switch(typeof Je){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Je===null?1:6;default:return 6}}function Br(Je){return Je===void 0}function un(Je){return Je===null}function tr(Je){return typeof Je=="symbol"}function se(Je){return typeof Je=="object"?Je!==null:typeof Je=="function"}function be(Je,yt){switch(Dr(Je)){case 0:return Je;case 1:return Je;case 2:return Je;case 3:return Je;case 4:return Je;case 5:return Je}var ht=yt===3?"string":yt===5?"number":"default",fr=qe(Je,$);if(fr!==void 0){var $r=fr.call(Je,ht);if(se($r))throw new TypeError;return $r}return ke(Je,ht==="default"?"number":ht)}function ke(Je,yt){if(yt==="string"){var ht=Je.toString;if(N(ht)){var fr=ht.call(Je);if(!se(fr))return fr}var $r=Je.valueOf;if(N($r)){var fr=$r.call(Je);if(!se(fr))return fr}}else{var $r=Je.valueOf;if(N($r)){var fr=$r.call(Je);if(!se(fr))return fr}var lt=Je.toString;if(N(lt)){var fr=lt.call(Je);if(!se(fr))return fr}}throw new TypeError}function Ce(Je){return!!Je}function Pt(Je){return""+Je}function Dt(Je){var yt=be(Je,3);return tr(yt)?yt:Pt(yt)}function E(Je){return Array.isArray?Array.isArray(Je):Je instanceof Object?Je instanceof Array:Object.prototype.toString.call(Je)==="[object Array]"}function N(Je){return typeof Je=="function"}function he(Je){return typeof Je=="function"}function Ze(Je){switch(Dr(Je)){case 3:return!0;case 4:return!0;default:return!1}}function qe(Je,yt){var ht=Je[yt];if(ht!=null){if(!N(ht))throw new TypeError;return ht}}function mt(Je){var yt=qe(Je,I);if(!N(yt))throw new TypeError;var ht=yt.call(Je);if(!se(ht))throw new TypeError;return ht}function Ct(Je){return Je.value}function H(Je){var yt=Je.next();return yt.done?!1:yt}function Kt(Je){var yt=Je.return;yt&&yt.call(Je)}function jt(Je){var yt=Object.getPrototypeOf(Je);if(typeof Je!="function"||Je===$e||yt!==$e)return yt;var ht=Je.prototype,fr=ht&&Object.getPrototypeOf(ht);if(fr==null||fr===Object.prototype)return yt;var $r=fr.constructor;return typeof $r!="function"||$r===Je?yt:$r}function hr(){var Je={},yt=[],ht=function(){function Rt(Qt,pr,vn){this._index=0,this._keys=Qt,this._values=pr,this._selector=vn}return Rt.prototype["@@iterator"]=function(){return this},Rt.prototype[I]=function(){return this},Rt.prototype.next=function(){var Qt=this._index;if(Qt>=0&&Qt<this._keys.length){var pr=this._selector(this._keys[Qt],this._values[Qt]);return Qt+1>=this._keys.length?(this._index=-1,this._keys=yt,this._values=yt):this._index++,{value:pr,done:!1}}return{value:void 0,done:!0}},Rt.prototype.throw=function(Qt){throw this._index>=0&&(this._index=-1,this._keys=yt,this._values=yt),Qt},Rt.prototype.return=function(Qt){return this._index>=0&&(this._index=-1,this._keys=yt,this._values=yt),{value:Qt,done:!0}},Rt}();return function(){function Rt(){this._keys=[],this._values=[],this._cacheKey=Je,this._cacheIndex=-2}return Object.defineProperty(Rt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Rt.prototype.has=function(Qt){return this._find(Qt,!1)>=0},Rt.prototype.get=function(Qt){var pr=this._find(Qt,!1);return pr>=0?this._values[pr]:void 0},Rt.prototype.set=function(Qt,pr){var vn=this._find(Qt,!0);return this._values[vn]=pr,this},Rt.prototype.delete=function(Qt){var pr=this._find(Qt,!1);if(pr>=0){for(var vn=this._keys.length,Pn=pr+1;Pn<vn;Pn++)this._keys[Pn-1]=this._keys[Pn],this._values[Pn-1]=this._values[Pn];return this._keys.length--,this._values.length--,Qt===this._cacheKey&&(this._cacheKey=Je,this._cacheIndex=-2),!0}return!1},Rt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Je,this._cacheIndex=-2},Rt.prototype.keys=function(){return new ht(this._keys,this._values,fr)},Rt.prototype.values=function(){return new ht(this._keys,this._values,$r)},Rt.prototype.entries=function(){return new ht(this._keys,this._values,lt)},Rt.prototype["@@iterator"]=function(){return this.entries()},Rt.prototype[I]=function(){return this.entries()},Rt.prototype._find=function(Qt,pr){return this._cacheKey!==Qt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Qt)),this._cacheIndex<0&&pr&&(this._cacheIndex=this._keys.length,this._keys.push(Qt),this._values.push(void 0)),this._cacheIndex},Rt}();function fr(Rt,Qt){return Rt}function $r(Rt,Qt){return Qt}function lt(Rt,Qt){return[Rt,Qt]}}function Cr(){return function(){function Je(){this._map=new Yt}return Object.defineProperty(Je.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Je.prototype.has=function(yt){return this._map.has(yt)},Je.prototype.add=function(yt){return this._map.set(yt,yt),this},Je.prototype.delete=function(yt){return this._map.delete(yt)},Je.prototype.clear=function(){this._map.clear()},Je.prototype.keys=function(){return this._map.keys()},Je.prototype.values=function(){return this._map.values()},Je.prototype.entries=function(){return this._map.entries()},Je.prototype["@@iterator"]=function(){return this.keys()},Je.prototype[I]=function(){return this.keys()},Je}()}function Tr(){var Je=16,yt=We.create(),ht=fr();return function(){function pr(){this._key=fr()}return pr.prototype.has=function(vn){var Pn=$r(vn,!1);return Pn!==void 0?We.has(Pn,this._key):!1},pr.prototype.get=function(vn){var Pn=$r(vn,!1);return Pn!==void 0?We.get(Pn,this._key):void 0},pr.prototype.set=function(vn,Pn){var bi=$r(vn,!0);return bi[this._key]=Pn,this},pr.prototype.delete=function(vn){var Pn=$r(vn,!1);return Pn!==void 0?delete Pn[this._key]:!1},pr.prototype.clear=function(){this._key=fr()},pr}();function fr(){var pr;do pr="@@WeakMap@@"+Qt();while(We.has(yt,pr));return yt[pr]=!0,pr}function $r(pr,vn){if(!Y.call(pr,ht)){if(!vn)return;Object.defineProperty(pr,ht,{value:We.create()})}return pr[ht]}function lt(pr,vn){for(var Pn=0;Pn<vn;++Pn)pr[Pn]=Math.random()*255|0;return pr}function Rt(pr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(pr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(pr)):lt(new Uint8Array(pr),pr):lt(new Array(pr),pr)}function Qt(){var pr=Rt(Je);pr[6]=pr[6]&79|64,pr[8]=pr[8]&191|128;for(var vn="",Pn=0;Pn<Je;++Pn){var bi=pr[Pn];(Pn===4||Pn===6||Pn===8)&&(vn+="-"),bi<16&&(vn+="0"),vn+=bi.toString(16).toLowerCase()}return vn}}function Pr(Je){return Je.__=void 0,delete Je.__,Je}})})(w||(w={}))},81550:function(sr){(function(L,x){sr.exports=x()})(this,function(){"use strict";var L=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},x=function(U,Te){for(var ze=Object.keys(Te),qt=0;qt<ze.length;++qt)U[ze[qt]]=Te[ze[qt]];return U},Q=`
`;function w(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function d(U){var Te=new Error("(regl) "+U);throw console.error(Te),Te}function b(U,Te){U||d(Te)}function Y(U){return U?": "+U:""}function W(U,Te,ze){U in Te||d("unknown parameter ("+U+")"+Y(ze)+". possible values: "+Object.keys(Te).join())}function $(U,Te){L(U)||d("invalid parameter type"+Y(Te)+". must be a typed array")}function I(U,Te){switch(Te){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function k(U,Te,ze){I(U,Te)||d("invalid parameter type"+Y(ze)+". expected "+Te+", got "+typeof U)}function we(U,Te){U>=0&&(U|0)===U||d("invalid parameter type, ("+U+")"+Y(Te)+". must be a nonnegative integer")}function Be(U,Te,ze){Te.indexOf(U)<0&&d("invalid value"+Y(ze)+". must be one of: "+Te)}var We=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function $e(U){Object.keys(U).forEach(function(Te){We.indexOf(Te)<0&&d('invalid regl constructor argument "'+Te+'". must be one of '+We)})}function Ut(U,Te){for(U=U+"";U.length<Te;)U=" "+U;return U}function Yt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function kt(U,Te){this.number=U,this.line=Te,this.errors=[]}function Lt(U,Te,ze){this.file=U,this.line=Te,this.message=ze}function bt(){var U=new Error,Te=(U.stack||U).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Te);if(ze)return ze[1];var qt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Te);return qt?qt[1]:"unknown"}function pt(){var U=new Error,Te=(U.stack||U).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Te);if(ze)return ze[1];var qt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Te);return qt?qt[1]:"unknown"}function Ir(U,Te){var ze=U.split(`
`),qt=1,wr=0,Ht={unknown:new Yt,0:new Yt};Ht.unknown.name=Ht[0].name=Te||bt(),Ht.unknown.lines.push(new kt(0,""));for(var dr=0;dr<ze.length;++dr){var Ur=ze[dr],Hr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ur);if(Hr)switch(Hr[1]){case"line":var Jr=/(\d+)(\s+\d+)?/.exec(Hr[2]);Jr&&(qt=Jr[1]|0,Jr[2]&&(wr=Jr[2]|0,wr in Ht||(Ht[wr]=new Yt)));break;case"define":var Gr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Hr[2]);Gr&&(Ht[wr].name=Gr[1]?w(Gr[2]):Gr[2]);break}Ht[wr].lines.push(new kt(qt++,Ur))}return Object.keys(Ht).forEach(function(rn){var fn=Ht[rn];fn.lines.forEach(function(jr){fn.index[jr.number]=jr})}),Ht}function er(U){var Te=[];return U.split(`
`).forEach(function(ze){if(!(ze.length<5)){var qt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);qt?Te.push(new Lt(qt[1]|0,qt[2]|0,qt[3].trim())):ze.length>0&&Te.push(new Lt("unknown",0,ze))}}),Te}function nr(U,Te){Te.forEach(function(ze){var qt=U[ze.file];if(qt){var wr=qt.index[ze.line];if(wr){wr.errors.push(ze),qt.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push(ze)})}function xt(U,Te,ze,qt,wr){if(!U.getShaderParameter(Te,U.COMPILE_STATUS)){var Ht=U.getShaderInfoLog(Te),dr=qt===U.FRAGMENT_SHADER?"fragment":"vertex";gr(ze,"string",dr+" shader source must be a string",wr);var Ur=Ir(ze,wr),Hr=er(Ht);nr(Ur,Hr),Object.keys(Ur).forEach(function(Jr){var Gr=Ur[Jr];if(!Gr.hasErrors)return;var rn=[""],fn=[""];function jr(an,Nt){rn.push(an),fn.push(Nt||"")}jr("file number "+Jr+": "+Gr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Gr.lines.forEach(function(an){if(an.errors.length>0){jr(Ut(an.number,4)+"|  ","background-color:yellow; font-weight:bold"),jr(an.line+Q,"color:red; background-color:yellow; font-weight:bold");var Nt=0;an.errors.forEach(function(lr){var Vr=lr.message,mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Vr);if(mn){var Fr=mn[1];switch(Vr=mn[2],Fr){case"assign":Fr="=";break}Nt=Math.max(an.line.indexOf(Fr,Nt),0)}else Nt=0;jr(Ut("| ",6)),jr(Ut("^^^",Nt+3)+Q,"font-weight:bold"),jr(Ut("| ",6)),jr(Vr+Q,"font-weight:bold")}),jr(Ut("| ",6)+Q)}else jr(Ut(an.number,4)+"|  "),jr(an.line+Q,"color:red")}),typeof document!="undefined"&&!window.chrome?(fn[0]=rn.join("%c"),console.log.apply(console,fn)):console.log(rn.join(""))}),b.raise("Error compiling "+dr+" shader, "+Ur[0].name)}}function Ke(U,Te,ze,qt,wr){if(!U.getProgramParameter(Te,U.LINK_STATUS)){var Ht=U.getProgramInfoLog(Te),dr=Ir(ze,wr),Ur=Ir(qt,wr),Hr='Error linking program with vertex shader, "'+Ur[0].name+'", and fragment shader "'+dr[0].name+'"';typeof document!="undefined"?console.log("%c"+Hr+Q+"%c"+Ht,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Hr+Q+Ht),b.raise(Hr)}}function _t(U){U._commandRef=bt()}function Fe(U,Te,ze,qt){_t(U);function wr(Hr){return Hr?qt.id(Hr):0}U._fragId=wr(U.static.frag),U._vertId=wr(U.static.vert);function Ht(Hr,Jr){Object.keys(Jr).forEach(function(Gr){Hr[qt.id(Gr)]=!0})}var dr=U._uniformSet={};Ht(dr,Te.static),Ht(dr,Te.dynamic);var Ur=U._attributeSet={};Ht(Ur,ze.static),Ht(Ur,ze.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function Pe(U,Te){var ze=pt();d(U+" in command "+(Te||bt())+(ze==="unknown"?"":" called from "+ze))}function Ve(U,Te,ze){U||Pe(Te,ze||bt())}function Et(U,Te,ze,qt){U in Te||Pe("unknown parameter ("+U+")"+Y(ze)+". possible values: "+Object.keys(Te).join(),qt||bt())}function gr(U,Te,ze,qt){I(U,Te)||Pe("invalid parameter type"+Y(ze)+". expected "+Te+", got "+typeof U,qt||bt())}function ae(U){U()}function Ae(U,Te,ze){U.texture?Be(U.texture._texture.internalformat,Te,"unsupported texture format for attachment"):Be(U.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var oe=33071,ge=9728,Me=9984,Qe=9985,gt=9986,Jt=9987,Dr=5120,Br=5121,un=5122,tr=5123,se=5124,be=5125,ke=5126,Ce=32819,Pt=32820,Dt=33635,E=34042,N=36193,he={};he[Dr]=he[Br]=1,he[un]=he[tr]=he[N]=he[Dt]=he[Ce]=he[Pt]=2,he[se]=he[be]=he[ke]=he[E]=4;function Ze(U,Te){return U===Pt||U===Ce||U===Dt?2:U===E?4:he[U]*Te}function qe(U){return!(U&U-1)&&!!U}function mt(U,Te,ze){var qt,wr=Te.width,Ht=Te.height,dr=Te.channels;b(wr>0&&wr<=ze.maxTextureSize&&Ht>0&&Ht<=ze.maxTextureSize,"invalid texture shape"),(U.wrapS!==oe||U.wrapT!==oe)&&b(qe(wr)&&qe(Ht),"incompatible wrap mode for texture, both width and height must be power of 2"),Te.mipmask===1?wr!==1&&Ht!==1&&b(U.minFilter!==Me&&U.minFilter!==gt&&U.minFilter!==Qe&&U.minFilter!==Jt,"min filter requires mipmap"):(b(qe(wr)&&qe(Ht),"texture must be a square power of 2 to support mipmapping"),b(Te.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),Te.type===ke&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&b(U.minFilter===ge&&U.magFilter===ge,"filter not supported, must enable oes_texture_float_linear"),b(!U.genMipmaps,"mipmap generation not supported with float textures"));var Ur=Te.images;for(qt=0;qt<16;++qt)if(Ur[qt]){var Hr=wr>>qt,Jr=Ht>>qt;b(Te.mipmask&1<<qt,"missing mipmap data");var Gr=Ur[qt];if(b(Gr.width===Hr&&Gr.height===Jr,"invalid shape for mip images"),b(Gr.format===Te.format&&Gr.internalformat===Te.internalformat&&Gr.type===Te.type,"incompatible type for mip image"),!Gr.compressed)if(Gr.data){var rn=Math.ceil(Ze(Gr.type,dr)*Hr/Gr.unpackAlignment)*Gr.unpackAlignment;b(Gr.data.byteLength===rn*Jr,"invalid data for image, buffer size is inconsistent with image format")}else Gr.element||Gr.copy}else U.genMipmaps||b((Te.mipmask&1<<qt)==0,"extra mipmap data");Te.compressed&&b(!U.genMipmaps,"mipmap generation for compressed images not supported")}function Ct(U,Te,ze,qt){var wr=U.width,Ht=U.height,dr=U.channels;b(wr>0&&wr<=qt.maxTextureSize&&Ht>0&&Ht<=qt.maxTextureSize,"invalid texture shape"),b(wr===Ht,"cube map must be square"),b(Te.wrapS===oe&&Te.wrapT===oe,"wrap mode not supported by cube map");for(var Ur=0;Ur<ze.length;++Ur){var Hr=ze[Ur];b(Hr.width===wr&&Hr.height===Ht,"inconsistent cube map face shape"),Te.genMipmaps&&(b(!Hr.compressed,"can not generate mipmap for compressed textures"),b(Hr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Jr=Hr.images,Gr=0;Gr<16;++Gr){var rn=Jr[Gr];if(rn){var fn=wr>>Gr,jr=Ht>>Gr;b(Hr.mipmask&1<<Gr,"missing mipmap data"),b(rn.width===fn&&rn.height===jr,"invalid shape for mip images"),b(rn.format===U.format&&rn.internalformat===U.internalformat&&rn.type===U.type,"incompatible type for mip image"),rn.compressed||(rn.data?b(rn.data.byteLength===fn*jr*Math.max(Ze(rn.type,dr),rn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rn.element||rn.copy)}}}}var H=x(b,{optional:ae,raise:d,commandRaise:Pe,command:Ve,parameter:W,commandParameter:Et,constructor:$e,type:k,commandType:gr,isTypedArray:$,nni:we,oneOf:Be,shaderError:xt,linkError:Ke,callSite:pt,saveCommandRef:_t,saveDrawInfo:Fe,framebufferFormat:Ae,guessCommand:bt,texture2D:mt,textureCube:Ct}),Kt=0,jt=0,hr=5,Cr=6;function Tr(U,Te){this.id=Kt++,this.type=U,this.data=Te}function Pr(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Je(U){if(U.length===0)return[];var Te=U.charAt(0),ze=U.charAt(U.length-1);if(U.length>1&&Te===ze&&(Te==='"'||Te==="'"))return['"'+Pr(U.substr(1,U.length-2))+'"'];var qt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(qt)return Je(U.substr(0,qt.index)).concat(Je(qt[1])).concat(Je(U.substr(qt.index+qt[0].length)));var wr=U.split(".");if(wr.length===1)return['"'+Pr(U)+'"'];for(var Ht=[],dr=0;dr<wr.length;++dr)Ht=Ht.concat(Je(wr[dr]));return Ht}function yt(U){return"["+Je(U).join("][")+"]"}function ht(U,Te){return new Tr(U,yt(Te+""))}function fr(U){return typeof U=="function"&&!U._reglType||U instanceof Tr}function $r(U,Te){if(typeof U=="function")return new Tr(jt,U);if(typeof U=="number"||typeof U=="boolean")return new Tr(hr,U);if(Array.isArray(U))return new Tr(Cr,U.map((ze,qt)=>$r(ze,Te+"["+qt+"]")));if(U instanceof Tr)return U;H(!1,"invalid option type in uniform "+Te)}var lt={DynamicVariable:Tr,define:ht,isDynamic:fr,unbox:$r,accessor:yt},Rt={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},Qt=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function pr(){var U={"":0},Te=[""];return{id:function(ze){var qt=U[ze];return qt||(qt=U[ze]=Te.length,Te.push(ze),qt)},str:function(ze){return Te[ze]}}}function vn(U,Te,ze){var qt=document.createElement("canvas");x(qt.style,{border:0,margin:0,padding:0,top:0,left:0}),U.appendChild(qt),U===document.body&&(qt.style.position="absolute",x(U.style,{margin:0,padding:0}));function wr(){var Ur=window.innerWidth,Hr=window.innerHeight;if(U!==document.body){var Jr=U.getBoundingClientRect();Ur=Jr.right-Jr.left,Hr=Jr.bottom-Jr.top}qt.width=ze*Ur,qt.height=ze*Hr,x(qt.style,{width:Ur+"px",height:Hr+"px"})}var Ht;U!==document.body&&typeof ResizeObserver=="function"?(Ht=new ResizeObserver(function(){setTimeout(wr)}),Ht.observe(U)):window.addEventListener("resize",wr,!1);function dr(){Ht?Ht.disconnect():window.removeEventListener("resize",wr),U.removeChild(qt)}return wr(),{canvas:qt,onDestroy:dr}}function Pn(U,Te){function ze(qt){try{return U.getContext(qt,Te)}catch(wr){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function bi(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function Si(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function Ri(U){return typeof U=="string"?U.split():(H(Array.isArray(U),"invalid extension array"),U)}function ia(U){return typeof U=="string"?(H(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function pi(U){var Te=U||{},ze,qt,wr,Ht,dr={},Ur=[],Hr=[],Jr=typeof window=="undefined"?1:window.devicePixelRatio,Gr=!1,rn=function(an){an&&H.raise(an)},fn=function(){};if(typeof Te=="string"?(H(typeof document!="undefined","selector queries only supported in DOM enviroments"),ze=document.querySelector(Te),H(ze,"invalid query string for element")):typeof Te=="object"?bi(Te)?ze=Te:Si(Te)?(Ht=Te,wr=Ht.canvas):(H.constructor(Te),"gl"in Te?Ht=Te.gl:"canvas"in Te?wr=ia(Te.canvas):"container"in Te&&(qt=ia(Te.container)),"attributes"in Te&&(dr=Te.attributes,H.type(dr,"object","invalid context attributes")),"extensions"in Te&&(Ur=Ri(Te.extensions)),"optionalExtensions"in Te&&(Hr=Ri(Te.optionalExtensions)),"onDone"in Te&&(H.type(Te.onDone,"function","invalid or missing onDone callback"),rn=Te.onDone),"profile"in Te&&(Gr=!!Te.profile),"pixelRatio"in Te&&(Jr=+Te.pixelRatio,H(Jr>0,"invalid pixel ratio"))):H.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?wr=ze:qt=ze),!Ht){if(!wr){H(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var jr=vn(qt||document.body,rn,Jr);if(!jr)return null;wr=jr.canvas,fn=jr.onDestroy}dr.premultipliedAlpha===void 0&&(dr.premultipliedAlpha=!0),Ht=Pn(wr,dr)}return Ht?{gl:Ht,canvas:wr,container:qt,extensions:Ur,optionalExtensions:Hr,pixelRatio:Jr,profile:Gr,onDone:rn,onDestroy:fn}:(fn(),rn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function G(U,Te){var ze={};function qt(dr){H.type(dr,"string","extension name must be string");var Ur=dr.toLowerCase(),Hr;try{Hr=ze[Ur]=U.getExtension(Ur)}catch(Jr){}return!!Hr}for(var wr=0;wr<Te.extensions.length;++wr){var Ht=Te.extensions[wr];if(!qt(Ht))return Te.onDestroy(),Te.onDone('"'+Ht+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Te.optionalExtensions.forEach(qt),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(dr){if(ze[dr]&&!qt(dr))throw new Error("(regl): error restoring extension "+dr)})}}}function ie(U,Te){for(var ze=Array(U),qt=0;qt<U;++qt)ze[qt]=Te(qt);return ze}var ce=5120,B=5121,re=5122,fe=5123,Se=5124,te=5125,me=5126;function ct(U){for(var Te=16;Te<=1<<28;Te*=16)if(U<=Te)return Te;return 0}function yr(U){var Te,ze;return Te=(U>65535)<<4,U>>>=Te,ze=(U>255)<<3,U>>>=ze,Te|=ze,ze=(U>15)<<2,U>>>=ze,Te|=ze,ze=(U>3)<<1,U>>>=ze,Te|=ze,Te|U>>1}function Or(){var U=ie(8,function(){return[]});function Te(Ht){var dr=ct(Ht),Ur=U[yr(dr)>>2];return Ur.length>0?Ur.pop():new ArrayBuffer(dr)}function ze(Ht){U[yr(Ht.byteLength)>>2].push(Ht)}function qt(Ht,dr){var Ur=null;switch(Ht){case ce:Ur=new Int8Array(Te(dr),0,dr);break;case B:Ur=new Uint8Array(Te(dr),0,dr);break;case re:Ur=new Int16Array(Te(2*dr),0,dr);break;case fe:Ur=new Uint16Array(Te(2*dr),0,dr);break;case Se:Ur=new Int32Array(Te(4*dr),0,dr);break;case te:Ur=new Uint32Array(Te(4*dr),0,dr);break;case me:Ur=new Float32Array(Te(4*dr),0,dr);break;default:return null}return Ur.length!==dr?Ur.subarray(0,dr):Ur}function wr(Ht){ze(Ht.buffer)}return{alloc:Te,free:ze,allocType:qt,freeType:wr}}var Ft=Or();Ft.zero=Or();var kr=3408,bn=3410,gn=3411,mr=3412,dn=3413,Wr=3414,ln=3415,Ei=33901,hn=33902,wi=3379,Yi=3386,Yn=34921,Di=36347,ki=36348,za=35661,Wn=35660,ai=34930,Ai=36349,Qn=34076,Fi=34024,ya=7936,Xa=7937,_a=7938,da=35724,Vu=34047,Ya=36063,gi=34852,qa=3553,Ka=34067,$a=34069,Yo=33984,Gi=6408,Oo=5126,Oa=5121,Za=36160,cs=36053,va=36064,fs=16384,Ca=function(U,Te){var ze=1;Te.ext_texture_filter_anisotropic&&(ze=U.getParameter(Vu));var qt=1,wr=1;Te.webgl_draw_buffers&&(qt=U.getParameter(gi),wr=U.getParameter(Ya));var Ht=!!Te.oes_texture_float;if(Ht){var dr=U.createTexture();U.bindTexture(qa,dr),U.texImage2D(qa,0,Gi,1,1,0,Gi,Oo,null);var Ur=U.createFramebuffer();if(U.bindFramebuffer(Za,Ur),U.framebufferTexture2D(Za,va,qa,dr,0),U.bindTexture(qa,null),U.checkFramebufferStatus(Za)!==cs)Ht=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(fs);var Hr=Ft.allocType(Oo,4);U.readPixels(0,0,1,1,Gi,Oo,Hr),U.getError()?Ht=!1:(U.deleteFramebuffer(Ur),U.deleteTexture(dr),Ht=Hr[0]===1),Ft.freeType(Hr)}}var Jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Gr=!0;if(!Jr){var rn=U.createTexture(),fn=Ft.allocType(Oa,36);U.activeTexture(Yo),U.bindTexture(Ka,rn),U.texImage2D($a,0,Gi,3,3,0,Gi,Oa,fn),Ft.freeType(fn),U.bindTexture(Ka,null),U.deleteTexture(rn),Gr=!U.getError()}return{colorBits:[U.getParameter(bn),U.getParameter(gn),U.getParameter(mr),U.getParameter(dn)],depthBits:U.getParameter(Wr),stencilBits:U.getParameter(ln),subpixelBits:U.getParameter(kr),extensions:Object.keys(Te).filter(function(jr){return!!Te[jr]}),maxAnisotropic:ze,maxDrawbuffers:qt,maxColorAttachments:wr,pointSizeDims:U.getParameter(Ei),lineWidthDims:U.getParameter(hn),maxViewportDims:U.getParameter(Yi),maxCombinedTextureUnits:U.getParameter(za),maxCubeMapSize:U.getParameter(Qn),maxRenderbufferSize:U.getParameter(Fi),maxTextureUnits:U.getParameter(ai),maxTextureSize:U.getParameter(wi),maxAttributes:U.getParameter(Yn),maxVertexUniforms:U.getParameter(Di),maxVertexTextureUnits:U.getParameter(Wn),maxVaryingVectors:U.getParameter(ki),maxFragmentUniforms:U.getParameter(Ai),glsl:U.getParameter(da),renderer:U.getParameter(Xa),vendor:U.getParameter(ya),version:U.getParameter(_a),readFloat:Ht,npotTextureCube:Gr}};function fo(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||L(U.data))}var Zi=function(U){return Object.keys(U).map(function(Te){return U[Te]})},pe={shape:Ki,flatten:Dn};function Oe(U,Te,ze){for(var qt=0;qt<Te;++qt)ze[qt]=U[qt]}function ft(U,Te,ze,qt){for(var wr=0,Ht=0;Ht<Te;++Ht)for(var dr=U[Ht],Ur=0;Ur<ze;++Ur)qt[wr++]=dr[Ur]}function ur(U,Te,ze,qt,wr,Ht){for(var dr=Ht,Ur=0;Ur<Te;++Ur)for(var Hr=U[Ur],Jr=0;Jr<ze;++Jr)for(var Gr=Hr[Jr],rn=0;rn<qt;++rn)wr[dr++]=Gr[rn]}function Qr(U,Te,ze,qt,wr){for(var Ht=1,dr=ze+1;dr<Te.length;++dr)Ht*=Te[dr];var Ur=Te[ze];if(Te.length-ze==4){var Hr=Te[ze+1],Jr=Te[ze+2],Gr=Te[ze+3];for(dr=0;dr<Ur;++dr)ur(U[dr],Hr,Jr,Gr,qt,wr),wr+=Ht}else for(dr=0;dr<Ur;++dr)Qr(U[dr],Te,ze+1,qt,wr),wr+=Ht}function Dn(U,Te,ze,qt){var wr=1;if(Te.length)for(var Ht=0;Ht<Te.length;++Ht)wr*=Te[Ht];else wr=0;var dr=qt||Ft.allocType(ze,wr);switch(Te.length){case 0:break;case 1:Oe(U,Te[0],dr);break;case 2:ft(U,Te[0],Te[1],dr);break;case 3:ur(U,Te[0],Te[1],Te[2],dr,0);break;default:Qr(U,Te,0,dr,0)}return dr}function Ki(U){for(var Te=[],ze=U;ze.length;ze=ze[0])Te.push(ze.length);return Te}var Ua={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},La=5120,ja=5122,To=5124,Mu=5121,$l=5123,Il=5125,Lo=5126,Xs=5126,ua={int8:La,int16:ja,int32:To,uint8:Mu,uint16:$l,uint32:Il,float:Lo,float32:Xs},Ns=35048,ou=35040,bs={dynamic:Ns,stream:ou,static:35044},Ps=pe.flatten,ti=pe.shape,ho=35044,su=35040,Ol=5121,sl=5126,He=[];He[5120]=1,He[5122]=2,He[5124]=4,He[5121]=1,He[5123]=2,He[5125]=4,He[5126]=4;function Tt(U){return Ua[Object.prototype.toString.call(U)]|0}function _r(U,Te){for(var ze=0;ze<Te.length;++ze)U[ze]=Te[ze]}function Zn(U,Te,ze,qt,wr,Ht,dr){for(var Ur=0,Hr=0;Hr<ze;++Hr)for(var Jr=0;Jr<qt;++Jr)U[Ur++]=Te[wr*Hr+Ht*Jr+dr]}function sa(U,Te,ze,qt){var wr=0,Ht={};function dr(Nt){this.id=wr++,this.buffer=U.createBuffer(),this.type=Nt,this.usage=ho,this.byteLength=0,this.dimension=1,this.dtype=Ol,this.persistentData=null,ze.profile&&(this.stats={size:0})}dr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},dr.prototype.destroy=function(){fn(this)};var Ur=[];function Hr(Nt,lr){var Vr=Ur.pop();return Vr||(Vr=new dr(Nt)),Vr.bind(),rn(Vr,lr,su,0,1,!1),Vr}function Jr(Nt){Ur.push(Nt)}function Gr(Nt,lr,Vr){Nt.byteLength=lr.byteLength,U.bufferData(Nt.type,lr,Vr)}function rn(Nt,lr,Vr,mn,Fr,Sn){var zr;if(Nt.usage=Vr,Array.isArray(lr)){if(Nt.dtype=mn||sl,lr.length>0){var sn;if(Array.isArray(lr[0])){zr=ti(lr);for(var Rr=1,nn=1;nn<zr.length;++nn)Rr*=zr[nn];Nt.dimension=Rr,sn=Ps(lr,zr,Nt.dtype),Gr(Nt,sn,Vr),Sn?Nt.persistentData=sn:Ft.freeType(sn)}else if(typeof lr[0]=="number"){Nt.dimension=Fr;var Xn=Ft.allocType(Nt.dtype,lr.length);_r(Xn,lr),Gr(Nt,Xn,Vr),Sn?Nt.persistentData=Xn:Ft.freeType(Xn)}else L(lr[0])?(Nt.dimension=lr[0].length,Nt.dtype=mn||Tt(lr[0])||sl,sn=Ps(lr,[lr.length,lr[0].length],Nt.dtype),Gr(Nt,sn,Vr),Sn?Nt.persistentData=sn:Ft.freeType(sn)):H.raise("invalid buffer data")}}else if(L(lr))Nt.dtype=mn||Tt(lr),Nt.dimension=Fr,Gr(Nt,lr,Vr),Sn&&(Nt.persistentData=new Uint8Array(new Uint8Array(lr.buffer)));else if(fo(lr)){zr=lr.shape;var Kn=lr.stride,on=lr.offset,Nr=0,Mr=0,si=0,ui=0;zr.length===1?(Nr=zr[0],Mr=1,si=Kn[0],ui=0):zr.length===2?(Nr=zr[0],Mr=zr[1],si=Kn[0],ui=Kn[1]):H.raise("invalid shape"),Nt.dtype=mn||Tt(lr.data)||sl,Nt.dimension=Mr;var kn=Ft.allocType(Nt.dtype,Nr*Mr);Zn(kn,lr.data,Nr,Mr,si,ui,on),Gr(Nt,kn,Vr),Sn?Nt.persistentData=kn:Ft.freeType(kn)}else lr instanceof ArrayBuffer?(Nt.dtype=Ol,Nt.dimension=Fr,Gr(Nt,lr,Vr),Sn&&(Nt.persistentData=new Uint8Array(new Uint8Array(lr)))):H.raise("invalid buffer data")}function fn(Nt){Te.bufferCount--,qt(Nt);var lr=Nt.buffer;H(lr,"buffer must not be deleted already"),U.deleteBuffer(lr),Nt.buffer=null,delete Ht[Nt.id]}function jr(Nt,lr,Vr,mn){Te.bufferCount++;var Fr=new dr(lr);Ht[Fr.id]=Fr;function Sn(Rr){var nn=ho,Xn=null,Kn=0,on=0,Nr=1;return Array.isArray(Rr)||L(Rr)||fo(Rr)||Rr instanceof ArrayBuffer?Xn=Rr:typeof Rr=="number"?Kn=Rr|0:Rr&&(H.type(Rr,"object","buffer arguments must be an object, a number or an array"),"data"in Rr&&(H(Xn===null||Array.isArray(Xn)||L(Xn)||fo(Xn),"invalid data for buffer"),Xn=Rr.data),"usage"in Rr&&(H.parameter(Rr.usage,bs,"invalid buffer usage"),nn=bs[Rr.usage]),"type"in Rr&&(H.parameter(Rr.type,ua,"invalid buffer type"),on=ua[Rr.type]),"dimension"in Rr&&(H.type(Rr.dimension,"number","invalid dimension"),Nr=Rr.dimension|0),"length"in Rr&&(H.nni(Kn,"buffer length must be a nonnegative integer"),Kn=Rr.length|0)),Fr.bind(),Xn?rn(Fr,Xn,nn,on,Nr,mn):(Kn&&U.bufferData(Fr.type,Kn,nn),Fr.dtype=on||Ol,Fr.usage=nn,Fr.dimension=Nr,Fr.byteLength=Kn),ze.profile&&(Fr.stats.size=Fr.byteLength*He[Fr.dtype]),Sn}function zr(Rr,nn){H(nn+Rr.byteLength<=Fr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Rr.byteLength+" starting from offset "+nn+" to a buffer of size "+Fr.byteLength),U.bufferSubData(Fr.type,nn,Rr)}function sn(Rr,nn){var Xn=(nn||0)|0,Kn;if(Fr.bind(),L(Rr)||Rr instanceof ArrayBuffer)zr(Rr,Xn);else if(Array.isArray(Rr)){if(Rr.length>0)if(typeof Rr[0]=="number"){var on=Ft.allocType(Fr.dtype,Rr.length);_r(on,Rr),zr(on,Xn),Ft.freeType(on)}else if(Array.isArray(Rr[0])||L(Rr[0])){Kn=ti(Rr);var Nr=Ps(Rr,Kn,Fr.dtype);zr(Nr,Xn),Ft.freeType(Nr)}else H.raise("invalid buffer data")}else if(fo(Rr)){Kn=Rr.shape;var Mr=Rr.stride,si=0,ui=0,kn=0,ea=0;Kn.length===1?(si=Kn[0],ui=1,kn=Mr[0],ea=0):Kn.length===2?(si=Kn[0],ui=Kn[1],kn=Mr[0],ea=Mr[1]):H.raise("invalid shape");var Pi=Array.isArray(Rr.data)?Fr.dtype:Tt(Rr.data),ji=Ft.allocType(Pi,si*ui);Zn(ji,Rr.data,si,ui,kn,ea,Rr.offset),zr(ji,Xn),Ft.freeType(ji)}else H.raise("invalid data for buffer subdata");return Sn}return Vr||Sn(Nt),Sn._reglType="buffer",Sn._buffer=Fr,Sn.subdata=sn,ze.profile&&(Sn.stats=Fr.stats),Sn.destroy=function(){fn(Fr)},Sn}function an(){Zi(Ht).forEach(function(Nt){Nt.buffer=U.createBuffer(),U.bindBuffer(Nt.type,Nt.buffer),U.bufferData(Nt.type,Nt.persistentData||Nt.byteLength,Nt.usage)})}return ze.profile&&(Te.getTotalBufferSize=function(){var Nt=0;return Object.keys(Ht).forEach(function(lr){Nt+=Ht[lr].stats.size}),Nt}),{create:jr,createStream:Hr,destroyStream:Jr,clear:function(){Zi(Ht).forEach(fn),Ur.forEach(fn)},getBuffer:function(Nt){return Nt&&Nt._buffer instanceof dr?Nt._buffer:null},restore:an,_initBuffer:rn}}var xa=0,ka=0,vi=1,Ta=1,eo=4,qn=4,ba={points:xa,point:ka,lines:vi,line:Ta,triangles:eo,triangle:qn,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Jl=0,Ra=1,Ro=4,xu=5120,Ys=5121,zs=5122,rs=5123,Iu=5124,xo=5125,rf=34963,ul=35040,Ui=35044;function Hf(U,Te,ze,qt){var wr={},Ht=0,dr={uint8:Ys,uint16:rs};Te.oes_element_index_uint&&(dr.uint32=xo);function Ur(an){this.id=Ht++,wr[this.id]=this,this.buffer=an,this.primType=Ro,this.vertCount=0,this.type=0}Ur.prototype.bind=function(){this.buffer.bind()};var Hr=[];function Jr(an){var Nt=Hr.pop();return Nt||(Nt=new Ur(ze.create(null,rf,!0,!1)._buffer)),rn(Nt,an,ul,-1,-1,0,0),Nt}function Gr(an){Hr.push(an)}function rn(an,Nt,lr,Vr,mn,Fr,Sn){an.buffer.bind();var zr;if(Nt){var sn=Sn;!Sn&&(!L(Nt)||fo(Nt)&&!L(Nt.data))&&(sn=Te.oes_element_index_uint?xo:rs),ze._initBuffer(an.buffer,Nt,lr,sn,3)}else U.bufferData(rf,Fr,lr),an.buffer.dtype=zr||Ys,an.buffer.usage=lr,an.buffer.dimension=3,an.buffer.byteLength=Fr;if(zr=Sn,!Sn){switch(an.buffer.dtype){case Ys:case xu:zr=Ys;break;case rs:case zs:zr=rs;break;case xo:case Iu:zr=xo;break;default:H.raise("unsupported type for element array")}an.buffer.dtype=zr}an.type=zr,H(zr!==xo||!!Te.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Rr=mn;Rr<0&&(Rr=an.buffer.byteLength,zr===rs?Rr>>=1:zr===xo&&(Rr>>=2)),an.vertCount=Rr;var nn=Vr;if(Vr<0){nn=Ro;var Xn=an.buffer.dimension;Xn===1&&(nn=Jl),Xn===2&&(nn=Ra),Xn===3&&(nn=Ro)}an.primType=nn}function fn(an){qt.elementsCount--,H(an.buffer!==null,"must not double destroy elements"),delete wr[an.id],an.buffer.destroy(),an.buffer=null}function jr(an,Nt){var lr=ze.create(null,rf,!0),Vr=new Ur(lr._buffer);qt.elementsCount++;function mn(Fr){if(!Fr)lr(),Vr.primType=Ro,Vr.vertCount=0,Vr.type=Ys;else if(typeof Fr=="number")lr(Fr),Vr.primType=Ro,Vr.vertCount=Fr|0,Vr.type=Ys;else{var Sn=null,zr=Ui,sn=-1,Rr=-1,nn=0,Xn=0;Array.isArray(Fr)||L(Fr)||fo(Fr)?Sn=Fr:(H.type(Fr,"object","invalid arguments for elements"),"data"in Fr&&(Sn=Fr.data,H(Array.isArray(Sn)||L(Sn)||fo(Sn),"invalid data for element buffer")),"usage"in Fr&&(H.parameter(Fr.usage,bs,"invalid element buffer usage"),zr=bs[Fr.usage]),"primitive"in Fr&&(H.parameter(Fr.primitive,ba,"invalid element buffer primitive"),sn=ba[Fr.primitive]),"count"in Fr&&(H(typeof Fr.count=="number"&&Fr.count>=0,"invalid vertex count for elements"),Rr=Fr.count|0),"type"in Fr&&(H.parameter(Fr.type,dr,"invalid buffer type"),Xn=dr[Fr.type]),"length"in Fr?nn=Fr.length|0:(nn=Rr,Xn===rs||Xn===zs?nn*=2:(Xn===xo||Xn===Iu)&&(nn*=4))),rn(Vr,Sn,zr,sn,Rr,nn,Xn)}return mn}return mn(an),mn._reglType="elements",mn._elements=Vr,mn.subdata=function(Fr,Sn){return lr.subdata(Fr,Sn),mn},mn.destroy=function(){fn(Vr)},mn}return{create:jr,createStream:Jr,destroyStream:Gr,getElements:function(an){return typeof an=="function"&&an._elements instanceof Ur?an._elements:null},clear:function(){Zi(wr).forEach(fn)}}}var Ql=new Float32Array(1),Sf=new Uint32Array(Ql.buffer),Ll=5123;function Ko(U){for(var Te=Ft.allocType(Ll,U.length),ze=0;ze<U.length;++ze)if(isNaN(U[ze]))Te[ze]=65535;else if(U[ze]===Infinity)Te[ze]=31744;else if(U[ze]===-Infinity)Te[ze]=64512;else{Ql[0]=U[ze];var qt=Sf[0],wr=qt>>>31<<15,Ht=(qt<<1>>>24)-127,dr=qt>>13&(1<<10)-1;if(Ht<-24)Te[ze]=wr;else if(Ht<-14){var Ur=-14-Ht;Te[ze]=wr+(dr+(1<<10)>>Ur)}else Ht>15?Te[ze]=wr+31744:Te[ze]=wr+(Ht+15<<10)+dr}return Te}function Aa(U){return Array.isArray(U)||L(U)}var to=function(U){return!(U&U-1)&&!!U},Ks=34467,ns=3553,fc=34067,Rl=34069,bu=6408,Su=6406,Ou=6407,Zs=6409,Eu=6410,hc=32854,Gu=32855,ma=36194,Pc=32819,Ef=32820,ll=33635,nf=34042,Mc=6402,pc=34041,ql=35904,cl=35906,wu=36193,ec=33776,fl=33777,uu=33778,dc=33779,hl=35986,$s=35987,Ic=34798,Oc=35840,Lc=35841,Hu=35842,Dl=35843,tc=36196,Wu=5121,kl=5123,Rc=5125,Xu=5126,No=10242,af=10243,of=10497,Fl=33071,Dc=33648,Fa=10240,kc=10241,Yu=9728,Fc=9729,Cu=9984,Pa=9985,rc=9986,Lu=9987,Ku=33170,Hi=4352,Ma=4353,Us=4354,vc=34046,nc=3317,ic=37440,Of=37441,Lf=37443,ac=37444,$u=33984,Ru=[Cu,rc,Pa,Lu],ro=[0,Zs,Eu,Ou,bu],hs={};hs[Zs]=hs[Su]=hs[Mc]=1,hs[pc]=hs[Eu]=2,hs[Ou]=hs[ql]=3,hs[bu]=hs[cl]=4;function pl(U){return"[object "+U+"]"}var Va=pl("HTMLCanvasElement"),wn=pl("OffscreenCanvas"),js=pl("CanvasRenderingContext2D"),mc=pl("ImageBitmap"),Bl=pl("HTMLImageElement"),lu=pl("HTMLVideoElement"),Vs=Object.keys(Ua).concat([Va,wn,js,mc,Bl,lu]),dl=[];dl[Wu]=1,dl[Xu]=4,dl[wu]=2,dl[kl]=2,dl[Rc]=4;var Kr=[];Kr[hc]=2,Kr[Gu]=2,Kr[ma]=2,Kr[pc]=4,Kr[ec]=.5,Kr[fl]=.5,Kr[uu]=1,Kr[dc]=1,Kr[hl]=.5,Kr[$s]=1,Kr[Ic]=1,Kr[Oc]=.5,Kr[Lc]=.25,Kr[Hu]=.5,Kr[Dl]=.25,Kr[tc]=.5;function Bc(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function gc(U){if(!Array.isArray(U))return!1;var Te=U.length;return!(Te===0||!Aa(U[0]))}function Ju(U){return Object.prototype.toString.call(U)}function Js(U){return Ju(U)===Va}function Ms(U){return Ju(U)===wn}function Nc(U){return Ju(U)===js}function zc(U){return Ju(U)===mc}function Gs(U){return Ju(U)===Bl}function Qu(U){return Ju(U)===lu}function Nl(U){if(!U)return!1;var Te=Ju(U);return Vs.indexOf(Te)>=0?!0:Bc(U)||gc(U)||fo(U)}function Du(U){return Ua[Object.prototype.toString.call(U)]|0}function Zc(U,Te){var ze=Te.length;switch(U.type){case Wu:case kl:case Rc:case Xu:var qt=Ft.allocType(U.type,ze);qt.set(Te),U.data=qt;break;case wu:U.data=Ko(Te);break;default:H.raise("unsupported texture type, must specify a typed array")}}function yc(U,Te){return Ft.allocType(U.type===wu?Xu:U.type,Te)}function cu(U,Te){U.type===wu?(U.data=Ko(Te),Ft.freeType(Te)):U.data=Te}function Is(U,Te,ze,qt,wr,Ht){for(var dr=U.width,Ur=U.height,Hr=U.channels,Jr=dr*Ur*Hr,Gr=yc(U,Jr),rn=0,fn=0;fn<Ur;++fn)for(var jr=0;jr<dr;++jr)for(var an=0;an<Hr;++an)Gr[rn++]=Te[ze*jr+qt*fn+wr*an+Ht];cu(U,Gr)}function Bi(U,Te,ze,qt,wr,Ht){var dr;if(typeof Kr[U]!="undefined"?dr=Kr[U]:dr=hs[U]*dl[Te],Ht&&(dr*=6),wr){for(var Ur=0,Hr=ze;Hr>=1;)Ur+=dr*Hr*Hr,Hr/=2;return Ur}else return dr*ze*qt}function Qs(U,Te,ze,qt,wr,Ht,dr){var Ur={"don't care":Hi,"dont care":Hi,nice:Us,fast:Ma},Hr={repeat:of,clamp:Fl,mirror:Dc},Jr={nearest:Yu,linear:Fc},Gr=x({mipmap:Lu,"nearest mipmap nearest":Cu,"linear mipmap nearest":Pa,"nearest mipmap linear":rc,"linear mipmap linear":Lu},Jr),rn={none:0,browser:ac},fn={uint8:Wu,rgba4:Pc,rgb565:ll,"rgb5 a1":Ef},jr={alpha:Su,luminance:Zs,"luminance alpha":Eu,rgb:Ou,rgba:bu,rgba4:hc,"rgb5 a1":Gu,rgb565:ma},an={};Te.ext_srgb&&(jr.srgb=ql,jr.srgba=cl),Te.oes_texture_float&&(fn.float32=fn.float=Xu),Te.oes_texture_half_float&&(fn.float16=fn["half float"]=wu),Te.webgl_depth_texture&&(x(jr,{depth:Mc,"depth stencil":pc}),x(fn,{uint16:kl,uint32:Rc,"depth stencil":nf})),Te.webgl_compressed_texture_s3tc&&x(an,{"rgb s3tc dxt1":ec,"rgba s3tc dxt1":fl,"rgba s3tc dxt3":uu,"rgba s3tc dxt5":dc}),Te.webgl_compressed_texture_atc&&x(an,{"rgb atc":hl,"rgba atc explicit alpha":$s,"rgba atc interpolated alpha":Ic}),Te.webgl_compressed_texture_pvrtc&&x(an,{"rgb pvrtc 4bppv1":Oc,"rgb pvrtc 2bppv1":Lc,"rgba pvrtc 4bppv1":Hu,"rgba pvrtc 2bppv1":Dl}),Te.webgl_compressed_texture_etc1&&(an["rgb etc1"]=tc);var Nt=Array.prototype.slice.call(U.getParameter(Ks));Object.keys(an).forEach(function(Ue){var $t=an[Ue];Nt.indexOf($t)>=0&&(jr[Ue]=$t)});var lr=Object.keys(jr);ze.textureFormats=lr;var Vr=[];Object.keys(jr).forEach(function(Ue){var $t=jr[Ue];Vr[$t]=Ue});var mn=[];Object.keys(fn).forEach(function(Ue){var $t=fn[Ue];mn[$t]=Ue});var Fr=[];Object.keys(Jr).forEach(function(Ue){var $t=Jr[Ue];Fr[$t]=Ue});var Sn=[];Object.keys(Gr).forEach(function(Ue){var $t=Gr[Ue];Sn[$t]=Ue});var zr=[];Object.keys(Hr).forEach(function(Ue){var $t=Hr[Ue];zr[$t]=Ue});var sn=lr.reduce(function(Ue,$t){var Wt=jr[$t];return Wt===Zs||Wt===Su||Wt===Zs||Wt===Eu||Wt===Mc||Wt===pc||Te.ext_srgb&&(Wt===ql||Wt===cl)?Ue[Wt]=Wt:Wt===Gu||$t.indexOf("rgba")>=0?Ue[Wt]=bu:Ue[Wt]=Ou,Ue},{});function Rr(){this.internalformat=bu,this.format=bu,this.type=Wu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ac,this.width=0,this.height=0,this.channels=0}function nn(Ue,$t){Ue.internalformat=$t.internalformat,Ue.format=$t.format,Ue.type=$t.type,Ue.compressed=$t.compressed,Ue.premultiplyAlpha=$t.premultiplyAlpha,Ue.flipY=$t.flipY,Ue.unpackAlignment=$t.unpackAlignment,Ue.colorSpace=$t.colorSpace,Ue.width=$t.width,Ue.height=$t.height,Ue.channels=$t.channels}function Xn(Ue,$t){if(!(typeof $t!="object"||!$t)){if("premultiplyAlpha"in $t&&(H.type($t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ue.premultiplyAlpha=$t.premultiplyAlpha),"flipY"in $t&&(H.type($t.flipY,"boolean","invalid texture flip"),Ue.flipY=$t.flipY),"alignment"in $t&&(H.oneOf($t.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ue.unpackAlignment=$t.alignment),"colorSpace"in $t&&(H.parameter($t.colorSpace,rn,"invalid colorSpace"),Ue.colorSpace=rn[$t.colorSpace]),"type"in $t){var Wt=$t.type;H(Te.oes_texture_float||!(Wt==="float"||Wt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),H(Te.oes_texture_half_float||!(Wt==="half float"||Wt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),H(Te.webgl_depth_texture||!(Wt==="uint16"||Wt==="uint32"||Wt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Wt,fn,"invalid texture type"),Ue.type=fn[Wt]}var Cn=Ue.width,Xi=Ue.height,Le=Ue.channels,xe=!1;"shape"in $t?(H(Array.isArray($t.shape)&&$t.shape.length>=2,"shape must be an array"),Cn=$t.shape[0],Xi=$t.shape[1],$t.shape.length===3&&(Le=$t.shape[2],H(Le>0&&Le<=4,"invalid number of channels"),xe=!0),H(Cn>=0&&Cn<=ze.maxTextureSize,"invalid width"),H(Xi>=0&&Xi<=ze.maxTextureSize,"invalid height")):("radius"in $t&&(Cn=Xi=$t.radius,H(Cn>=0&&Cn<=ze.maxTextureSize,"invalid radius")),"width"in $t&&(Cn=$t.width,H(Cn>=0&&Cn<=ze.maxTextureSize,"invalid width")),"height"in $t&&(Xi=$t.height,H(Xi>=0&&Xi<=ze.maxTextureSize,"invalid height")),"channels"in $t&&(Le=$t.channels,H(Le>0&&Le<=4,"invalid number of channels"),xe=!0)),Ue.width=Cn|0,Ue.height=Xi|0,Ue.channels=Le|0;var it=!1;if("format"in $t){var Ot=$t.format;H(Te.webgl_depth_texture||!(Ot==="depth"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Ot,jr,"invalid texture format");var At=Ue.internalformat=jr[Ot];Ue.format=sn[At],Ot in fn&&("type"in $t||(Ue.type=fn[Ot])),Ot in an&&(Ue.compressed=!0),it=!0}!xe&&it?Ue.channels=hs[Ue.format]:xe&&!it?Ue.channels!==ro[Ue.format]&&(Ue.format=Ue.internalformat=ro[Ue.channels]):it&&xe&&H(Ue.channels===hs[Ue.format],"number of channels inconsistent with specified format")}}function Kn(Ue){U.pixelStorei(ic,Ue.flipY),U.pixelStorei(Of,Ue.premultiplyAlpha),U.pixelStorei(Lf,Ue.colorSpace),U.pixelStorei(nc,Ue.unpackAlignment)}function on(){Rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Nr(Ue,$t){var Wt=null;if(Nl($t)?Wt=$t:$t&&(H.type($t,"object","invalid pixel data type"),Xn(Ue,$t),"x"in $t&&(Ue.xOffset=$t.x|0),"y"in $t&&(Ue.yOffset=$t.y|0),Nl($t.data)&&(Wt=$t.data)),H(!Ue.compressed||Wt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),$t.copy){H(!Wt,"can not specify copy and data field for the same texture");var Cn=wr.viewportWidth,Xi=wr.viewportHeight;Ue.width=Ue.width||Cn-Ue.xOffset,Ue.height=Ue.height||Xi-Ue.yOffset,Ue.needsCopy=!0,H(Ue.xOffset>=0&&Ue.xOffset<Cn&&Ue.yOffset>=0&&Ue.yOffset<Xi&&Ue.width>0&&Ue.width<=Cn&&Ue.height>0&&Ue.height<=Xi,"copy texture read out of bounds")}else if(!Wt)Ue.width=Ue.width||1,Ue.height=Ue.height||1,Ue.channels=Ue.channels||4;else if(L(Wt))Ue.channels=Ue.channels||4,Ue.data=Wt,!("type"in $t)&&Ue.type===Wu&&(Ue.type=Du(Wt));else if(Bc(Wt))Ue.channels=Ue.channels||4,Zc(Ue,Wt),Ue.alignment=1,Ue.needsFree=!0;else if(fo(Wt)){var Le=Wt.data;!Array.isArray(Le)&&Ue.type===Wu&&(Ue.type=Du(Le));var xe=Wt.shape,it=Wt.stride,Ot,At,ut,at,St,De;xe.length===3?(ut=xe[2],De=it[2]):(H(xe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ut=1,De=1),Ot=xe[0],At=xe[1],at=it[0],St=it[1],Ue.alignment=1,Ue.width=Ot,Ue.height=At,Ue.channels=ut,Ue.format=Ue.internalformat=ro[ut],Ue.needsFree=!0,Is(Ue,Le,at,St,De,Wt.offset)}else if(Js(Wt)||Ms(Wt)||Nc(Wt))Js(Wt)||Ms(Wt)?Ue.element=Wt:Ue.element=Wt.canvas,Ue.width=Ue.element.width,Ue.height=Ue.element.height,Ue.channels=4;else if(zc(Wt))Ue.element=Wt,Ue.width=Wt.width,Ue.height=Wt.height,Ue.channels=4;else if(Gs(Wt))Ue.element=Wt,Ue.width=Wt.naturalWidth,Ue.height=Wt.naturalHeight,Ue.channels=4;else if(Qu(Wt))Ue.element=Wt,Ue.width=Wt.videoWidth,Ue.height=Wt.videoHeight,Ue.channels=4;else if(gc(Wt)){var tt=Ue.width||Wt[0].length,Ie=Ue.height||Wt.length,wt=Ue.channels;Aa(Wt[0][0])?wt=wt||Wt[0][0].length:wt=wt||1;for(var Zt=pe.shape(Wt),Er=1,Xt=0;Xt<Zt.length;++Xt)Er*=Zt[Xt];var xr=yc(Ue,Er);pe.flatten(Wt,Zt,"",xr),cu(Ue,xr),Ue.alignment=1,Ue.width=tt,Ue.height=Ie,Ue.channels=wt,Ue.format=Ue.internalformat=ro[wt],Ue.needsFree=!0}Ue.type===Xu?H(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ue.type===wu&&H(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Mr(Ue,$t,Wt){var Cn=Ue.element,Xi=Ue.data,Le=Ue.internalformat,xe=Ue.format,it=Ue.type,Ot=Ue.width,At=Ue.height;Kn(Ue),Cn?U.texImage2D($t,Wt,xe,xe,it,Cn):Ue.compressed?U.compressedTexImage2D($t,Wt,Le,Ot,At,0,Xi):Ue.needsCopy?(qt(),U.copyTexImage2D($t,Wt,xe,Ue.xOffset,Ue.yOffset,Ot,At,0)):U.texImage2D($t,Wt,xe,Ot,At,0,xe,it,Xi||null)}function si(Ue,$t,Wt,Cn,Xi){var Le=Ue.element,xe=Ue.data,it=Ue.internalformat,Ot=Ue.format,At=Ue.type,ut=Ue.width,at=Ue.height;Kn(Ue),Le?U.texSubImage2D($t,Xi,Wt,Cn,Ot,At,Le):Ue.compressed?U.compressedTexSubImage2D($t,Xi,Wt,Cn,it,ut,at,xe):Ue.needsCopy?(qt(),U.copyTexSubImage2D($t,Xi,Wt,Cn,Ue.xOffset,Ue.yOffset,ut,at)):U.texSubImage2D($t,Xi,Wt,Cn,ut,at,Ot,At,xe)}var ui=[];function kn(){return ui.pop()||new on}function ea(Ue){Ue.needsFree&&Ft.freeType(Ue.data),on.call(Ue),ui.push(Ue)}function Pi(){Rr.call(this),this.genMipmaps=!1,this.mipmapHint=Hi,this.mipmask=0,this.images=Array(16)}function ji(Ue,$t,Wt){var Cn=Ue.images[0]=kn();Ue.mipmask=1,Cn.width=Ue.width=$t,Cn.height=Ue.height=Wt,Cn.channels=Ue.channels=4}function fa(Ue,$t){var Wt=null;if(Nl($t))Wt=Ue.images[0]=kn(),nn(Wt,Ue),Nr(Wt,$t),Ue.mipmask=1;else if(Xn(Ue,$t),Array.isArray($t.mipmap))for(var Cn=$t.mipmap,Xi=0;Xi<Cn.length;++Xi)Wt=Ue.images[Xi]=kn(),nn(Wt,Ue),Wt.width>>=Xi,Wt.height>>=Xi,Nr(Wt,Cn[Xi]),Ue.mipmask|=1<<Xi;else Wt=Ue.images[0]=kn(),nn(Wt,Ue),Nr(Wt,$t),Ue.mipmask=1;nn(Ue,Ue.images[0]),Ue.compressed&&(Ue.internalformat===ec||Ue.internalformat===fl||Ue.internalformat===uu||Ue.internalformat===dc)&&H(Ue.width%4==0&&Ue.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Jo(Ue,$t){for(var Wt=Ue.images,Cn=0;Cn<Wt.length;++Cn){if(!Wt[Cn])return;Mr(Wt[Cn],$t,Cn)}}var ss=[];function $i(){var Ue=ss.pop()||new Pi;Rr.call(Ue),Ue.mipmask=0;for(var $t=0;$t<16;++$t)Ue.images[$t]=null;return Ue}function vo(Ue){for(var $t=Ue.images,Wt=0;Wt<$t.length;++Wt)$t[Wt]&&ea($t[Wt]),$t[Wt]=null;ss.push(Ue)}function so(){this.minFilter=Yu,this.magFilter=Yu,this.wrapS=Fl,this.wrapT=Fl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Hi}function Qo(Ue,$t){if("min"in $t){var Wt=$t.min;H.parameter(Wt,Gr),Ue.minFilter=Gr[Wt],Ru.indexOf(Ue.minFilter)>=0&&!("faces"in $t)&&(Ue.genMipmaps=!0)}if("mag"in $t){var Cn=$t.mag;H.parameter(Cn,Jr),Ue.magFilter=Jr[Cn]}var Xi=Ue.wrapS,Le=Ue.wrapT;if("wrap"in $t){var xe=$t.wrap;typeof xe=="string"?(H.parameter(xe,Hr),Xi=Le=Hr[xe]):Array.isArray(xe)&&(H.parameter(xe[0],Hr),H.parameter(xe[1],Hr),Xi=Hr[xe[0]],Le=Hr[xe[1]])}else{if("wrapS"in $t){var it=$t.wrapS;H.parameter(it,Hr),Xi=Hr[it]}if("wrapT"in $t){var Ot=$t.wrapT;H.parameter(Ot,Hr),Le=Hr[Ot]}}if(Ue.wrapS=Xi,Ue.wrapT=Le,"anisotropic"in $t){var At=$t.anisotropic;H(typeof At=="number"&&At>=1&&At<=ze.maxAnisotropic,"aniso samples must be between 1 and "),Ue.anisotropic=$t.anisotropic}if("mipmap"in $t){var ut=!1;switch(typeof $t.mipmap){case"string":H.parameter($t.mipmap,Ur,"invalid mipmap hint"),Ue.mipmapHint=Ur[$t.mipmap],Ue.genMipmaps=!0,ut=!0;break;case"boolean":ut=Ue.genMipmaps=$t.mipmap;break;case"object":H(Array.isArray($t.mipmap),"invalid mipmap type"),Ue.genMipmaps=!1,ut=!0;break;default:H.raise("invalid mipmap type")}ut&&!("min"in $t)&&(Ue.minFilter=Cu)}}function ys(Ue,$t){U.texParameteri($t,kc,Ue.minFilter),U.texParameteri($t,Fa,Ue.magFilter),U.texParameteri($t,No,Ue.wrapS),U.texParameteri($t,af,Ue.wrapT),Te.ext_texture_filter_anisotropic&&U.texParameteri($t,vc,Ue.anisotropic),Ue.genMipmaps&&(U.hint(Ku,Ue.mipmapHint),U.generateMipmap($t))}var Es=0,ks={},_s=ze.maxTextureUnits,Fo=Array(_s).map(function(){return null});function Ni(Ue){Rr.call(this),this.mipmask=0,this.internalformat=bu,this.id=Es++,this.refCount=1,this.target=Ue,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new so,dr.profile&&(this.stats={size:0})}function Fs(Ue){U.activeTexture($u),U.bindTexture(Ue.target,Ue.texture)}function Sa(){var Ue=Fo[0];Ue?U.bindTexture(Ue.target,Ue.texture):U.bindTexture(ns,null)}function li(Ue){var $t=Ue.texture;H($t,"must not double destroy texture");var Wt=Ue.unit,Cn=Ue.target;Wt>=0&&(U.activeTexture($u+Wt),U.bindTexture(Cn,null),Fo[Wt]=null),U.deleteTexture($t),Ue.texture=null,Ue.params=null,Ue.pixels=null,Ue.refCount=0,delete ks[Ue.id],Ht.textureCount--}x(Ni.prototype,{bind:function(){var Ue=this;Ue.bindCount+=1;var $t=Ue.unit;if($t<0){for(var Wt=0;Wt<_s;++Wt){var Cn=Fo[Wt];if(Cn){if(Cn.bindCount>0)continue;Cn.unit=-1}Fo[Wt]=Ue,$t=Wt;break}$t>=_s&&H.raise("insufficient number of texture units"),dr.profile&&Ht.maxTextureUnits<$t+1&&(Ht.maxTextureUnits=$t+1),Ue.unit=$t,U.activeTexture($u+$t),U.bindTexture(Ue.target,Ue.texture)}return $t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&li(this)}});function Wi(Ue,$t){var Wt=new Ni(ns);ks[Wt.id]=Wt,Ht.textureCount++;function Cn(xe,it){var Ot=Wt.texInfo;so.call(Ot);var At=$i();return typeof xe=="number"?typeof it=="number"?ji(At,xe|0,it|0):ji(At,xe|0,xe|0):xe?(H.type(xe,"object","invalid arguments to regl.texture"),Qo(Ot,xe),fa(At,xe)):ji(At,1,1),Ot.genMipmaps&&(At.mipmask=(At.width<<1)-1),Wt.mipmask=At.mipmask,nn(Wt,At),H.texture2D(Ot,At,ze),Wt.internalformat=At.internalformat,Cn.width=At.width,Cn.height=At.height,Fs(Wt),Jo(At,ns),ys(Ot,ns),Sa(),vo(At),dr.profile&&(Wt.stats.size=Bi(Wt.internalformat,Wt.type,At.width,At.height,Ot.genMipmaps,!1)),Cn.format=Vr[Wt.internalformat],Cn.type=mn[Wt.type],Cn.mag=Fr[Ot.magFilter],Cn.min=Sn[Ot.minFilter],Cn.wrapS=zr[Ot.wrapS],Cn.wrapT=zr[Ot.wrapT],Cn}function Xi(xe,it,Ot,At){H(!!xe,"must specify image data");var ut=it|0,at=Ot|0,St=At|0,De=kn();return nn(De,Wt),De.width=0,De.height=0,Nr(De,xe),De.width=De.width||(Wt.width>>St)-ut,De.height=De.height||(Wt.height>>St)-at,H(Wt.type===De.type&&Wt.format===De.format&&Wt.internalformat===De.internalformat,"incompatible format for texture.subimage"),H(ut>=0&&at>=0&&ut+De.width<=Wt.width&&at+De.height<=Wt.height,"texture.subimage write out of bounds"),H(Wt.mipmask&1<<St,"missing mipmap data"),H(De.data||De.element||De.needsCopy,"missing image data"),Fs(Wt),si(De,ns,ut,at,St),Sa(),ea(De),Cn}function Le(xe,it){var Ot=xe|0,At=it|0||Ot;if(Ot===Wt.width&&At===Wt.height)return Cn;Cn.width=Wt.width=Ot,Cn.height=Wt.height=At,Fs(Wt);for(var ut=0;Wt.mipmask>>ut;++ut){var at=Ot>>ut,St=At>>ut;if(!at||!St)break;U.texImage2D(ns,ut,Wt.format,at,St,0,Wt.format,Wt.type,null)}return Sa(),dr.profile&&(Wt.stats.size=Bi(Wt.internalformat,Wt.type,Ot,At,!1,!1)),Cn}return Cn(Ue,$t),Cn.subimage=Xi,Cn.resize=Le,Cn._reglType="texture2d",Cn._texture=Wt,dr.profile&&(Cn.stats=Wt.stats),Cn.destroy=function(){Wt.decRef()},Cn}function oa(Ue,$t,Wt,Cn,Xi,Le){var xe=new Ni(fc);ks[xe.id]=xe,Ht.cubeCount++;var it=new Array(6);function Ot(at,St,De,tt,Ie,wt){var Zt,Er=xe.texInfo;for(so.call(Er),Zt=0;Zt<6;++Zt)it[Zt]=$i();if(typeof at=="number"||!at){var Xt=at|0||1;for(Zt=0;Zt<6;++Zt)ji(it[Zt],Xt,Xt)}else if(typeof at=="object")if(St)fa(it[0],at),fa(it[1],St),fa(it[2],De),fa(it[3],tt),fa(it[4],Ie),fa(it[5],wt);else if(Qo(Er,at),Xn(xe,at),"faces"in at){var xr=at.faces;for(H(Array.isArray(xr)&&xr.length===6,"cube faces must be a length 6 array"),Zt=0;Zt<6;++Zt)H(typeof xr[Zt]=="object"&&!!xr[Zt],"invalid input for cube map face"),nn(it[Zt],xe),fa(it[Zt],xr[Zt])}else for(Zt=0;Zt<6;++Zt)fa(it[Zt],at);else H.raise("invalid arguments to cube map");for(nn(xe,it[0]),ze.npotTextureCube||H(to(xe.width)&&to(xe.height),"your browser does not support non power or two texture dimensions"),Er.genMipmaps?xe.mipmask=(it[0].width<<1)-1:xe.mipmask=it[0].mipmask,H.textureCube(xe,Er,it,ze),xe.internalformat=it[0].internalformat,Ot.width=it[0].width,Ot.height=it[0].height,Fs(xe),Zt=0;Zt<6;++Zt)Jo(it[Zt],Rl+Zt);for(ys(Er,fc),Sa(),dr.profile&&(xe.stats.size=Bi(xe.internalformat,xe.type,Ot.width,Ot.height,Er.genMipmaps,!0)),Ot.format=Vr[xe.internalformat],Ot.type=mn[xe.type],Ot.mag=Fr[Er.magFilter],Ot.min=Sn[Er.minFilter],Ot.wrapS=zr[Er.wrapS],Ot.wrapT=zr[Er.wrapT],Zt=0;Zt<6;++Zt)vo(it[Zt]);return Ot}function At(at,St,De,tt,Ie){H(!!St,"must specify image data"),H(typeof at=="number"&&at===(at|0)&&at>=0&&at<6,"invalid face");var wt=De|0,Zt=tt|0,Er=Ie|0,Xt=kn();return nn(Xt,xe),Xt.width=0,Xt.height=0,Nr(Xt,St),Xt.width=Xt.width||(xe.width>>Er)-wt,Xt.height=Xt.height||(xe.height>>Er)-Zt,H(xe.type===Xt.type&&xe.format===Xt.format&&xe.internalformat===Xt.internalformat,"incompatible format for texture.subimage"),H(wt>=0&&Zt>=0&&wt+Xt.width<=xe.width&&Zt+Xt.height<=xe.height,"texture.subimage write out of bounds"),H(xe.mipmask&1<<Er,"missing mipmap data"),H(Xt.data||Xt.element||Xt.needsCopy,"missing image data"),Fs(xe),si(Xt,Rl+at,wt,Zt,Er),Sa(),ea(Xt),Ot}function ut(at){var St=at|0;if(St!==xe.width){Ot.width=xe.width=St,Ot.height=xe.height=St,Fs(xe);for(var De=0;De<6;++De)for(var tt=0;xe.mipmask>>tt;++tt)U.texImage2D(Rl+De,tt,xe.format,St>>tt,St>>tt,0,xe.format,xe.type,null);return Sa(),dr.profile&&(xe.stats.size=Bi(xe.internalformat,xe.type,Ot.width,Ot.height,!1,!0)),Ot}}return Ot(Ue,$t,Wt,Cn,Xi,Le),Ot.subimage=At,Ot.resize=ut,Ot._reglType="textureCube",Ot._texture=xe,dr.profile&&(Ot.stats=xe.stats),Ot.destroy=function(){xe.decRef()},Ot}function qo(){for(var Ue=0;Ue<_s;++Ue)U.activeTexture($u+Ue),U.bindTexture(ns,null),Fo[Ue]=null;Zi(ks).forEach(li),Ht.cubeCount=0,Ht.textureCount=0}dr.profile&&(Ht.getTotalTextureSize=function(){var Ue=0;return Object.keys(ks).forEach(function($t){Ue+=ks[$t].stats.size}),Ue});function El(){for(var Ue=0;Ue<_s;++Ue){var $t=Fo[Ue];$t&&($t.bindCount=0,$t.unit=-1,Fo[Ue]=null)}Zi(ks).forEach(function(Wt){Wt.texture=U.createTexture(),U.bindTexture(Wt.target,Wt.texture);for(var Cn=0;Cn<32;++Cn)if((Wt.mipmask&1<<Cn)!=0)if(Wt.target===ns)U.texImage2D(ns,Cn,Wt.internalformat,Wt.width>>Cn,Wt.height>>Cn,0,Wt.internalformat,Wt.type,null);else for(var Xi=0;Xi<6;++Xi)U.texImage2D(Rl+Xi,Cn,Wt.internalformat,Wt.width>>Cn,Wt.height>>Cn,0,Wt.internalformat,Wt.type,null);ys(Wt.texInfo,Wt.target)})}function wl(){for(var Ue=0;Ue<_s;++Ue){var $t=Fo[Ue];$t&&($t.bindCount=0,$t.unit=-1,Fo[Ue]=null),U.activeTexture($u+Ue),U.bindTexture(ns,null),U.bindTexture(fc,null)}}return{create2D:Wi,createCube:oa,clear:qo,getTexture:function(Ue){return null},restore:El,refresh:wl}}var $o=36161,Ao=32854,vl=32855,qu=36194,fu=33189,is=36168,zl=34041,Un=35907,On=34836,Zl=34842,ps=34843,Do=[];Do[Ao]=2,Do[vl]=2,Do[qu]=2,Do[fu]=2,Do[is]=1,Do[zl]=4,Do[Un]=4,Do[On]=16,Do[Zl]=8,Do[ps]=6;function zo(U,Te,ze){return Do[U]*Te*ze}var ku=function(U,Te,ze,qt,wr){var Ht={rgba4:Ao,rgb565:qu,"rgb5 a1":vl,depth:fu,stencil:is,"depth stencil":zl};Te.ext_srgb&&(Ht.srgba=Un),Te.ext_color_buffer_half_float&&(Ht.rgba16f=Zl,Ht.rgb16f=ps),Te.webgl_color_buffer_float&&(Ht.rgba32f=On);var dr=[];Object.keys(Ht).forEach(function(jr){var an=Ht[jr];dr[an]=jr});var Ur=0,Hr={};function Jr(jr){this.id=Ur++,this.refCount=1,this.renderbuffer=jr,this.format=Ao,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}Jr.prototype.decRef=function(){--this.refCount<=0&&Gr(this)};function Gr(jr){var an=jr.renderbuffer;H(an,"must not double destroy renderbuffer"),U.bindRenderbuffer($o,null),U.deleteRenderbuffer(an),jr.renderbuffer=null,jr.refCount=0,delete Hr[jr.id],qt.renderbufferCount--}function rn(jr,an){var Nt=new Jr(U.createRenderbuffer());Hr[Nt.id]=Nt,qt.renderbufferCount++;function lr(mn,Fr){var Sn=0,zr=0,sn=Ao;if(typeof mn=="object"&&mn){var Rr=mn;if("shape"in Rr){var nn=Rr.shape;H(Array.isArray(nn)&&nn.length>=2,"invalid renderbuffer shape"),Sn=nn[0]|0,zr=nn[1]|0}else"radius"in Rr&&(Sn=zr=Rr.radius|0),"width"in Rr&&(Sn=Rr.width|0),"height"in Rr&&(zr=Rr.height|0);"format"in Rr&&(H.parameter(Rr.format,Ht,"invalid renderbuffer format"),sn=Ht[Rr.format])}else typeof mn=="number"?(Sn=mn|0,typeof Fr=="number"?zr=Fr|0:zr=Sn):mn?H.raise("invalid arguments to renderbuffer constructor"):Sn=zr=1;if(H(Sn>0&&zr>0&&Sn<=ze.maxRenderbufferSize&&zr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(Sn===Nt.width&&zr===Nt.height&&sn===Nt.format))return lr.width=Nt.width=Sn,lr.height=Nt.height=zr,Nt.format=sn,U.bindRenderbuffer($o,Nt.renderbuffer),U.renderbufferStorage($o,sn,Sn,zr),H(U.getError()===0,"invalid render buffer format"),wr.profile&&(Nt.stats.size=zo(Nt.format,Nt.width,Nt.height)),lr.format=dr[Nt.format],lr}function Vr(mn,Fr){var Sn=mn|0,zr=Fr|0||Sn;return Sn===Nt.width&&zr===Nt.height||(H(Sn>0&&zr>0&&Sn<=ze.maxRenderbufferSize&&zr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),lr.width=Nt.width=Sn,lr.height=Nt.height=zr,U.bindRenderbuffer($o,Nt.renderbuffer),U.renderbufferStorage($o,Nt.format,Sn,zr),H(U.getError()===0,"invalid render buffer format"),wr.profile&&(Nt.stats.size=zo(Nt.format,Nt.width,Nt.height))),lr}return lr(jr,an),lr.resize=Vr,lr._reglType="renderbuffer",lr._renderbuffer=Nt,wr.profile&&(lr.stats=Nt.stats),lr.destroy=function(){Nt.decRef()},lr}wr.profile&&(qt.getTotalRenderbufferSize=function(){var jr=0;return Object.keys(Hr).forEach(function(an){jr+=Hr[an].stats.size}),jr});function fn(){Zi(Hr).forEach(function(jr){jr.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer($o,jr.renderbuffer),U.renderbufferStorage($o,jr.format,jr.width,jr.height)}),U.bindRenderbuffer($o,null)}return{create:rn,clear:function(){Zi(Hr).forEach(Gr)},restore:fn}},hu=36160,Ul=36161,ra=3553,po=34069,Uc=36064,Fu=36096,_c=36128,Bu=33306,Os=36053,oc=36054,as=36055,xc=36057,jl=36061,sc=36193,jc=5121,uc=5126,ml=6407,Vc=6408,gl=6402,yl=[ml,Vc],_l=[];_l[Vc]=4,_l[ml]=3;var pu=[];pu[jc]=1,pu[uc]=4,pu[sc]=2;var qs=32854,Gc=32855,bc=36194,sf=33189,Sc=36168,i=34041,u=35907,a=34836,h=34842,g=34843,S=[qs,Gc,bc,u,h,g,a],T={};T[Os]="complete",T[oc]="incomplete attachment",T[xc]="incomplete dimensions",T[as]="incomplete, missing attachment",T[jl]="unsupported";function R(U,Te,ze,qt,wr,Ht){var dr={cur:null,next:null,dirty:!1,setFBO:null},Ur=["rgba"],Hr=["rgba4","rgb565","rgb5 a1"];Te.ext_srgb&&Hr.push("srgba"),Te.ext_color_buffer_half_float&&Hr.push("rgba16f","rgb16f"),Te.webgl_color_buffer_float&&Hr.push("rgba32f");var Jr=["uint8"];Te.oes_texture_half_float&&Jr.push("half float","float16"),Te.oes_texture_float&&Jr.push("float","float32");function Gr(on,Nr,Mr){this.target=on,this.texture=Nr,this.renderbuffer=Mr;var si=0,ui=0;Nr?(si=Nr.width,ui=Nr.height):Mr&&(si=Mr.width,ui=Mr.height),this.width=si,this.height=ui}function rn(on){on&&(on.texture&&on.texture._texture.decRef(),on.renderbuffer&&on.renderbuffer._renderbuffer.decRef())}function fn(on,Nr,Mr){if(!!on)if(on.texture){var si=on.texture._texture,ui=Math.max(1,si.width),kn=Math.max(1,si.height);H(ui===Nr&&kn===Mr,"inconsistent width/height for supplied texture"),si.refCount+=1}else{var ea=on.renderbuffer._renderbuffer;H(ea.width===Nr&&ea.height===Mr,"inconsistent width/height for renderbuffer"),ea.refCount+=1}}function jr(on,Nr){Nr&&(Nr.texture?U.framebufferTexture2D(hu,on,Nr.target,Nr.texture._texture.texture,0):U.framebufferRenderbuffer(hu,on,Ul,Nr.renderbuffer._renderbuffer.renderbuffer))}function an(on){var Nr=ra,Mr=null,si=null,ui=on;typeof on=="object"&&(ui=on.data,"target"in on&&(Nr=on.target|0)),H.type(ui,"function","invalid attachment data");var kn=ui._reglType;return kn==="texture2d"?(Mr=ui,H(Nr===ra)):kn==="textureCube"?(Mr=ui,H(Nr>=po&&Nr<po+6,"invalid cube map target")):kn==="renderbuffer"?(si=ui,Nr=Ul):H.raise("invalid regl object for attachment"),new Gr(Nr,Mr,si)}function Nt(on,Nr,Mr,si,ui){if(Mr){var kn=qt.create2D({width:on,height:Nr,format:si,type:ui});return kn._texture.refCount=0,new Gr(ra,kn,null)}else{var ea=wr.create({width:on,height:Nr,format:si});return ea._renderbuffer.refCount=0,new Gr(Ul,null,ea)}}function lr(on){return on&&(on.texture||on.renderbuffer)}function Vr(on,Nr,Mr){on&&(on.texture?on.texture.resize(Nr,Mr):on.renderbuffer&&on.renderbuffer.resize(Nr,Mr),on.width=Nr,on.height=Mr)}var mn=0,Fr={};function Sn(){this.id=mn++,Fr[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function zr(on){on.colorAttachments.forEach(rn),rn(on.depthAttachment),rn(on.stencilAttachment),rn(on.depthStencilAttachment)}function sn(on){var Nr=on.framebuffer;H(Nr,"must not double destroy framebuffer"),U.deleteFramebuffer(Nr),on.framebuffer=null,Ht.framebufferCount--,delete Fr[on.id]}function Rr(on){var Nr;U.bindFramebuffer(hu,on.framebuffer);var Mr=on.colorAttachments;for(Nr=0;Nr<Mr.length;++Nr)jr(Uc+Nr,Mr[Nr]);for(Nr=Mr.length;Nr<ze.maxColorAttachments;++Nr)U.framebufferTexture2D(hu,Uc+Nr,ra,null,0);U.framebufferTexture2D(hu,Bu,ra,null,0),U.framebufferTexture2D(hu,Fu,ra,null,0),U.framebufferTexture2D(hu,_c,ra,null,0),jr(Fu,on.depthAttachment),jr(_c,on.stencilAttachment),jr(Bu,on.depthStencilAttachment);var si=U.checkFramebufferStatus(hu);!U.isContextLost()&&si!==Os&&H.raise("framebuffer configuration not supported, status = "+T[si]),U.bindFramebuffer(hu,dr.next?dr.next.framebuffer:null),dr.cur=dr.next,U.getError()}function nn(on,Nr){var Mr=new Sn;Ht.framebufferCount++;function si(kn,ea){var Pi;H(dr.next!==Mr,"can not update framebuffer which is currently in use");var ji=0,fa=0,Jo=!0,ss=!0,$i=null,vo=!0,so="rgba",Qo="uint8",ys=1,Es=null,ks=null,_s=null,Fo=!1;if(typeof kn=="number")ji=kn|0,fa=ea|0||ji;else if(!kn)ji=fa=1;else{H.type(kn,"object","invalid arguments for framebuffer");var Ni=kn;if("shape"in Ni){var Fs=Ni.shape;H(Array.isArray(Fs)&&Fs.length>=2,"invalid shape for framebuffer"),ji=Fs[0],fa=Fs[1]}else"radius"in Ni&&(ji=fa=Ni.radius),"width"in Ni&&(ji=Ni.width),"height"in Ni&&(fa=Ni.height);("color"in Ni||"colors"in Ni)&&($i=Ni.color||Ni.colors,Array.isArray($i)&&H($i.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),$i||("colorCount"in Ni&&(ys=Ni.colorCount|0,H(ys>0,"invalid color buffer count")),"colorTexture"in Ni&&(vo=!!Ni.colorTexture,so="rgba4"),"colorType"in Ni&&(Qo=Ni.colorType,vo?(H(Te.oes_texture_float||!(Qo==="float"||Qo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),H(Te.oes_texture_half_float||!(Qo==="half float"||Qo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Qo==="half float"||Qo==="float16"?(H(Te.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),so="rgba16f"):(Qo==="float"||Qo==="float32")&&(H(Te.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),so="rgba32f"),H.oneOf(Qo,Jr,"invalid color type")),"colorFormat"in Ni&&(so=Ni.colorFormat,Ur.indexOf(so)>=0?vo=!0:Hr.indexOf(so)>=0?vo=!1:vo?H.oneOf(Ni.colorFormat,Ur,"invalid color format for texture"):H.oneOf(Ni.colorFormat,Hr,"invalid color format for renderbuffer"))),("depthTexture"in Ni||"depthStencilTexture"in Ni)&&(Fo=!!(Ni.depthTexture||Ni.depthStencilTexture),H(!Fo||Te.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ni&&(typeof Ni.depth=="boolean"?Jo=Ni.depth:(Es=Ni.depth,ss=!1)),"stencil"in Ni&&(typeof Ni.stencil=="boolean"?ss=Ni.stencil:(ks=Ni.stencil,Jo=!1)),"depthStencil"in Ni&&(typeof Ni.depthStencil=="boolean"?Jo=ss=Ni.depthStencil:(_s=Ni.depthStencil,Jo=!1,ss=!1))}var Sa=null,li=null,Wi=null,oa=null;if(Array.isArray($i))Sa=$i.map(an);else if($i)Sa=[an($i)];else for(Sa=new Array(ys),Pi=0;Pi<ys;++Pi)Sa[Pi]=Nt(ji,fa,vo,so,Qo);H(Te.webgl_draw_buffers||Sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),H(Sa.length<=ze.maxColorAttachments,"too many color attachments, not supported"),ji=ji||Sa[0].width,fa=fa||Sa[0].height,Es?li=an(Es):Jo&&!ss&&(li=Nt(ji,fa,Fo,"depth","uint32")),ks?Wi=an(ks):ss&&!Jo&&(Wi=Nt(ji,fa,!1,"stencil","uint8")),_s?oa=an(_s):!Es&&!ks&&ss&&Jo&&(oa=Nt(ji,fa,Fo,"depth stencil","depth stencil")),H(!!Es+!!ks+!!_s<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var qo=null;for(Pi=0;Pi<Sa.length;++Pi)if(fn(Sa[Pi],ji,fa),H(!Sa[Pi]||Sa[Pi].texture&&yl.indexOf(Sa[Pi].texture._texture.format)>=0||Sa[Pi].renderbuffer&&S.indexOf(Sa[Pi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Pi+" is invalid"),Sa[Pi]&&Sa[Pi].texture){var El=_l[Sa[Pi].texture._texture.format]*pu[Sa[Pi].texture._texture.type];qo===null?qo=El:H(qo===El,"all color attachments much have the same number of bits per pixel.")}return fn(li,ji,fa),H(!li||li.texture&&li.texture._texture.format===gl||li.renderbuffer&&li.renderbuffer._renderbuffer.format===sf,"invalid depth attachment for framebuffer object"),fn(Wi,ji,fa),H(!Wi||Wi.renderbuffer&&Wi.renderbuffer._renderbuffer.format===Sc,"invalid stencil attachment for framebuffer object"),fn(oa,ji,fa),H(!oa||oa.texture&&oa.texture._texture.format===i||oa.renderbuffer&&oa.renderbuffer._renderbuffer.format===i,"invalid depth-stencil attachment for framebuffer object"),zr(Mr),Mr.width=ji,Mr.height=fa,Mr.colorAttachments=Sa,Mr.depthAttachment=li,Mr.stencilAttachment=Wi,Mr.depthStencilAttachment=oa,si.color=Sa.map(lr),si.depth=lr(li),si.stencil=lr(Wi),si.depthStencil=lr(oa),si.width=Mr.width,si.height=Mr.height,Rr(Mr),si}function ui(kn,ea){H(dr.next!==Mr,"can not resize a framebuffer which is currently in use");var Pi=Math.max(kn|0,1),ji=Math.max(ea|0||Pi,1);if(Pi===Mr.width&&ji===Mr.height)return si;for(var fa=Mr.colorAttachments,Jo=0;Jo<fa.length;++Jo)Vr(fa[Jo],Pi,ji);return Vr(Mr.depthAttachment,Pi,ji),Vr(Mr.stencilAttachment,Pi,ji),Vr(Mr.depthStencilAttachment,Pi,ji),Mr.width=si.width=Pi,Mr.height=si.height=ji,Rr(Mr),si}return si(on,Nr),x(si,{resize:ui,_reglType:"framebuffer",_framebuffer:Mr,destroy:function(){sn(Mr),zr(Mr)},use:function(kn){dr.setFBO({framebuffer:si},kn)}})}function Xn(on){var Nr=Array(6);function Mr(ui){var kn;H(Nr.indexOf(dr.next)<0,"can not update framebuffer which is currently in use");var ea={color:null},Pi=0,ji=null,fa="rgba",Jo="uint8",ss=1;if(typeof ui=="number")Pi=ui|0;else if(!ui)Pi=1;else{H.type(ui,"object","invalid arguments for framebuffer");var $i=ui;if("shape"in $i){var vo=$i.shape;H(Array.isArray(vo)&&vo.length>=2,"invalid shape for framebuffer"),H(vo[0]===vo[1],"cube framebuffer must be square"),Pi=vo[0]}else"radius"in $i&&(Pi=$i.radius|0),"width"in $i?(Pi=$i.width|0,"height"in $i&&H($i.height===Pi,"must be square")):"height"in $i&&(Pi=$i.height|0);("color"in $i||"colors"in $i)&&(ji=$i.color||$i.colors,Array.isArray(ji)&&H(ji.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),ji||("colorCount"in $i&&(ss=$i.colorCount|0,H(ss>0,"invalid color buffer count")),"colorType"in $i&&(H.oneOf($i.colorType,Jr,"invalid color type"),Jo=$i.colorType),"colorFormat"in $i&&(fa=$i.colorFormat,H.oneOf($i.colorFormat,Ur,"invalid color format for texture"))),"depth"in $i&&(ea.depth=$i.depth),"stencil"in $i&&(ea.stencil=$i.stencil),"depthStencil"in $i&&(ea.depthStencil=$i.depthStencil)}var so;if(ji)if(Array.isArray(ji))for(so=[],kn=0;kn<ji.length;++kn)so[kn]=ji[kn];else so=[ji];else{so=Array(ss);var Qo={radius:Pi,format:fa,type:Jo};for(kn=0;kn<ss;++kn)so[kn]=qt.createCube(Qo)}for(ea.color=Array(so.length),kn=0;kn<so.length;++kn){var ys=so[kn];H(typeof ys=="function"&&ys._reglType==="textureCube","invalid cube map"),Pi=Pi||ys.width,H(ys.width===Pi&&ys.height===Pi,"invalid cube map shape"),ea.color[kn]={target:po,data:so[kn]}}for(kn=0;kn<6;++kn){for(var Es=0;Es<so.length;++Es)ea.color[Es].target=po+kn;kn>0&&(ea.depth=Nr[0].depth,ea.stencil=Nr[0].stencil,ea.depthStencil=Nr[0].depthStencil),Nr[kn]?Nr[kn](ea):Nr[kn]=nn(ea)}return x(Mr,{width:Pi,height:Pi,color:so})}function si(ui){var kn,ea=ui|0;if(H(ea>0&&ea<=ze.maxCubeMapSize,"invalid radius for cube fbo"),ea===Mr.width)return Mr;var Pi=Mr.color;for(kn=0;kn<Pi.length;++kn)Pi[kn].resize(ea);for(kn=0;kn<6;++kn)Nr[kn].resize(ea);return Mr.width=Mr.height=ea,Mr}return Mr(on),x(Mr,{faces:Nr,resize:si,_reglType:"framebufferCube",destroy:function(){Nr.forEach(function(ui){ui.destroy()})}})}function Kn(){dr.cur=null,dr.next=null,dr.dirty=!0,Zi(Fr).forEach(function(on){on.framebuffer=U.createFramebuffer(),Rr(on)})}return x(dr,{getFramebuffer:function(on){if(typeof on=="function"&&on._reglType==="framebuffer"){var Nr=on._framebuffer;if(Nr instanceof Sn)return Nr}return null},create:nn,createCube:Xn,clear:function(){Zi(Fr).forEach(sn)},restore:Kn})}var V=5126,ee=34962;function ve(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=V,this.offset=0,this.stride=0,this.divisor=0}function ye(U,Te,ze,qt,wr){for(var Ht=ze.maxAttributes,dr=new Array(Ht),Ur=0;Ur<Ht;++Ur)dr[Ur]=new ve;var Hr=0,Jr={},Gr={Record:ve,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:fn()?Fr:function(){},createVAO:Sn,getVAO:an,destroyBuffer:rn,setVAO:fn()?Nt:lr,clear:fn()?Vr:function(){}};function rn(zr){for(var sn=0;sn<dr.length;++sn){var Rr=dr[sn];Rr.buffer===zr&&(U.disableVertexAttribArray(sn),Rr.buffer=null)}}function fn(){return Te.oes_vertex_array_object}function jr(){return Te.angle_instanced_arrays}function an(zr){return typeof zr=="function"&&zr._vao?zr._vao:null}function Nt(zr){if(zr!==Gr.currentVAO){var sn=fn();zr?sn.bindVertexArrayOES(zr.vao):sn.bindVertexArrayOES(null),Gr.currentVAO=zr}}function lr(zr){if(zr!==Gr.currentVAO){if(zr)zr.bindAttrs();else for(var sn=jr(),Rr=0;Rr<dr.length;++Rr){var nn=dr[Rr];nn.buffer?(U.enableVertexAttribArray(Rr),U.vertexAttribPointer(Rr,nn.size,nn.type,nn.normalized,nn.stride,nn.offfset),sn&&nn.divisor&&sn.vertexAttribDivisorANGLE(Rr,nn.divisor)):(U.disableVertexAttribArray(Rr),U.vertexAttrib4f(Rr,nn.x,nn.y,nn.z,nn.w))}Gr.currentVAO=zr}}function Vr(){Zi(Jr).forEach(function(zr){zr.destroy()})}function mn(){this.id=++Hr,this.attributes=[];var zr=fn();zr?this.vao=zr.createVertexArrayOES():this.vao=null,Jr[this.id]=this,this.buffers=[]}mn.prototype.bindAttrs=function(){for(var zr=jr(),sn=this.attributes,Rr=0;Rr<sn.length;++Rr){var nn=sn[Rr];nn.buffer?(U.enableVertexAttribArray(Rr),U.bindBuffer(ee,nn.buffer.buffer),U.vertexAttribPointer(Rr,nn.size,nn.type,nn.normalized,nn.stride,nn.offset),zr&&nn.divisor&&zr.vertexAttribDivisorANGLE(Rr,nn.divisor)):(U.disableVertexAttribArray(Rr),U.vertexAttrib4f(Rr,nn.x,nn.y,nn.z,nn.w))}for(var Xn=sn.length;Xn<Ht;++Xn)U.disableVertexAttribArray(Xn)},mn.prototype.refresh=function(){var zr=fn();zr&&(zr.bindVertexArrayOES(this.vao),this.bindAttrs(),Gr.currentVAO=this)},mn.prototype.destroy=function(){if(this.vao){var zr=fn();this===Gr.currentVAO&&(Gr.currentVAO=null,zr.bindVertexArrayOES(null)),zr.deleteVertexArrayOES(this.vao),this.vao=null}Jr[this.id]&&(delete Jr[this.id],qt.vaoCount-=1)};function Fr(){var zr=fn();zr&&Zi(Jr).forEach(function(sn){sn.refresh()})}function Sn(zr){var sn=new mn;qt.vaoCount+=1;function Rr(nn){H(Array.isArray(nn),"arguments to vertex array constructor must be an array"),H(nn.length<Ht,"too many attributes"),H(nn.length>0,"must specify at least one attribute");var Xn={},Kn=sn.attributes;Kn.length=nn.length;for(var on=0;on<nn.length;++on){var Nr=nn[on],Mr=Kn[on]=new ve,si=Nr.data||Nr;if(Array.isArray(si)||L(si)||fo(si)){var ui;sn.buffers[on]&&(ui=sn.buffers[on],L(si)&&ui._buffer.byteLength>=si.byteLength?ui.subdata(si):(ui.destroy(),sn.buffers[on]=null)),sn.buffers[on]||(ui=sn.buffers[on]=wr.create(Nr,ee,!1,!0)),Mr.buffer=wr.getBuffer(ui),Mr.size=Mr.buffer.dimension|0,Mr.normalized=!1,Mr.type=Mr.buffer.dtype,Mr.offset=0,Mr.stride=0,Mr.divisor=0,Mr.state=1,Xn[on]=1}else wr.getBuffer(Nr)?(Mr.buffer=wr.getBuffer(Nr),Mr.size=Mr.buffer.dimension|0,Mr.normalized=!1,Mr.type=Mr.buffer.dtype,Mr.offset=0,Mr.stride=0,Mr.divisor=0,Mr.state=1):wr.getBuffer(Nr.buffer)?(Mr.buffer=wr.getBuffer(Nr.buffer),Mr.size=(+Nr.size||Mr.buffer.dimension)|0,Mr.normalized=!!Nr.normalized||!1,"type"in Nr?(H.parameter(Nr.type,ua,"invalid buffer type"),Mr.type=ua[Nr.type]):Mr.type=Mr.buffer.dtype,Mr.offset=(Nr.offset||0)|0,Mr.stride=(Nr.stride||0)|0,Mr.divisor=(Nr.divisor||0)|0,Mr.state=1,H(Mr.size>=1&&Mr.size<=4,"size must be between 1 and 4"),H(Mr.offset>=0,"invalid offset"),H(Mr.stride>=0&&Mr.stride<=255,"stride must be between 0 and 255"),H(Mr.divisor>=0,"divisor must be positive"),H(!Mr.divisor||!!Te.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Nr?(H(on>0,"first attribute must not be a constant"),Mr.x=+Nr.x||0,Mr.y=+Nr.y||0,Mr.z=+Nr.z||0,Mr.w=+Nr.w||0,Mr.state=2):H(!1,"invalid attribute spec for location "+on)}for(var kn=0;kn<sn.buffers.length;++kn)!Xn[kn]&&sn.buffers[kn]&&(sn.buffers[kn].destroy(),sn.buffers[kn]=null);return sn.refresh(),Rr}return Rr.destroy=function(){for(var nn=0;nn<sn.buffers.length;++nn)sn.buffers[nn]&&sn.buffers[nn].destroy();sn.buffers.length=0,sn.destroy()},Rr._vao=sn,Rr._reglType="vao",Rr(zr)}return Gr}var Ee=35632,Ye=35633,Ge=35718,nt=35721;function Ne(U,Te,ze,qt){var wr={},Ht={};function dr(Nt,lr,Vr,mn){this.name=Nt,this.id=lr,this.location=Vr,this.info=mn}function Ur(Nt,lr){for(var Vr=0;Vr<Nt.length;++Vr)if(Nt[Vr].id===lr.id){Nt[Vr].location=lr.location;return}Nt.push(lr)}function Hr(Nt,lr,Vr){var mn=Nt===Ee?wr:Ht,Fr=mn[lr];if(!Fr){var Sn=Te.str(lr);Fr=U.createShader(Nt),U.shaderSource(Fr,Sn),U.compileShader(Fr),H.shaderError(U,Fr,Sn,Nt,Vr),mn[lr]=Fr}return Fr}var Jr={},Gr=[],rn=0;function fn(Nt,lr){this.id=rn++,this.fragId=Nt,this.vertId=lr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,qt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function jr(Nt,lr,Vr){var mn,Fr,Sn=Hr(Ee,Nt.fragId),zr=Hr(Ye,Nt.vertId),sn=Nt.program=U.createProgram();if(U.attachShader(sn,Sn),U.attachShader(sn,zr),Vr)for(mn=0;mn<Vr.length;++mn){var Rr=Vr[mn];U.bindAttribLocation(sn,Rr[0],Rr[1])}U.linkProgram(sn),H.linkError(U,sn,Te.str(Nt.fragId),Te.str(Nt.vertId),lr);var nn=U.getProgramParameter(sn,Ge);qt.profile&&(Nt.stats.uniformsCount=nn);var Xn=Nt.uniforms;for(mn=0;mn<nn;++mn)if(Fr=U.getActiveUniform(sn,mn),Fr)if(Fr.size>1)for(var Kn=0;Kn<Fr.size;++Kn){var on=Fr.name.replace("[0]","["+Kn+"]");Ur(Xn,new dr(on,Te.id(on),U.getUniformLocation(sn,on),Fr))}else Ur(Xn,new dr(Fr.name,Te.id(Fr.name),U.getUniformLocation(sn,Fr.name),Fr));var Nr=U.getProgramParameter(sn,nt);qt.profile&&(Nt.stats.attributesCount=Nr);var Mr=Nt.attributes;for(mn=0;mn<Nr;++mn)Fr=U.getActiveAttrib(sn,mn),Fr&&Ur(Mr,new dr(Fr.name,Te.id(Fr.name),U.getAttribLocation(sn,Fr.name),Fr))}qt.profile&&(ze.getMaxUniformsCount=function(){var Nt=0;return Gr.forEach(function(lr){lr.stats.uniformsCount>Nt&&(Nt=lr.stats.uniformsCount)}),Nt},ze.getMaxAttributesCount=function(){var Nt=0;return Gr.forEach(function(lr){lr.stats.attributesCount>Nt&&(Nt=lr.stats.attributesCount)}),Nt});function an(){wr={},Ht={};for(var Nt=0;Nt<Gr.length;++Nt)jr(Gr[Nt],null,Gr[Nt].attributes.map(function(lr){return[lr.location,lr.name]}))}return{clear:function(){var Nt=U.deleteShader.bind(U);Zi(wr).forEach(Nt),wr={},Zi(Ht).forEach(Nt),Ht={},Gr.forEach(function(lr){U.deleteProgram(lr.program)}),Gr.length=0,Jr={},ze.shaderCount=0},program:function(Nt,lr,Vr,mn){H.command(Nt>=0,"missing vertex shader",Vr),H.command(lr>=0,"missing fragment shader",Vr);var Fr=Jr[lr];Fr||(Fr=Jr[lr]={});var Sn=Fr[Nt];if(Sn&&(Sn.refCount++,!mn))return Sn;var zr=new fn(lr,Nt);return ze.shaderCount++,jr(zr,Vr,mn),Sn||(Fr[Nt]=zr),Gr.push(zr),x(zr,{destroy:function(){if(zr.refCount--,zr.refCount<=0){U.deleteProgram(zr.program);var sn=Gr.indexOf(zr);Gr.splice(sn,1),ze.shaderCount--}Fr[zr.vertId].refCount<=0&&(U.deleteShader(Ht[zr.vertId]),delete Ht[zr.vertId],delete Jr[zr.fragId][zr.vertId]),Object.keys(Jr[zr.fragId]).length||(U.deleteShader(wr[zr.fragId]),delete wr[zr.fragId],delete Jr[zr.fragId])}})},restore:an,shader:Hr,frag:-1,vert:-1}}var rt=6408,dt=5121,zt=3333,ar=5126;function rr(U,Te,ze,qt,wr,Ht,dr){function Ur(Gr){var rn;Te.next===null?(H(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rn=dt):(H(Te.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rn=Te.next.colorAttachments[0].texture._texture.type,Ht.oes_texture_float?(H(rn===dt||rn===ar,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rn===ar&&H(dr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):H(rn===dt,"Reading from a framebuffer is only allowed for the type 'uint8'"));var fn=0,jr=0,an=qt.framebufferWidth,Nt=qt.framebufferHeight,lr=null;L(Gr)?lr=Gr:Gr&&(H.type(Gr,"object","invalid arguments to regl.read()"),fn=Gr.x|0,jr=Gr.y|0,H(fn>=0&&fn<qt.framebufferWidth,"invalid x offset for regl.read"),H(jr>=0&&jr<qt.framebufferHeight,"invalid y offset for regl.read"),an=(Gr.width||qt.framebufferWidth-fn)|0,Nt=(Gr.height||qt.framebufferHeight-jr)|0,lr=Gr.data||null),lr&&(rn===dt?H(lr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rn===ar&&H(lr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),H(an>0&&an+fn<=qt.framebufferWidth,"invalid width for read pixels"),H(Nt>0&&Nt+jr<=qt.framebufferHeight,"invalid height for read pixels"),ze();var Vr=an*Nt*4;return lr||(rn===dt?lr=new Uint8Array(Vr):rn===ar&&(lr=lr||new Float32Array(Vr))),H.isTypedArray(lr,"data buffer for regl.read() must be a typedarray"),H(lr.byteLength>=Vr,"data buffer for regl.read() too small"),U.pixelStorei(zt,4),U.readPixels(fn,jr,an,Nt,rt,rn,lr),lr}function Hr(Gr){var rn;return Te.setFBO({framebuffer:Gr.framebuffer},function(){rn=Ur(Gr)}),rn}function Jr(Gr){return!Gr||!("framebuffer"in Gr)?Ur(Gr):Hr(Gr)}return Jr}function or(U){return Array.prototype.slice.call(U)}function Lr(U){return or(U).join("")}function tn(){var U=0,Te=[],ze=[];function qt(rn){for(var fn=0;fn<ze.length;++fn)if(ze[fn]===rn)return Te[fn];var jr="g"+U++;return Te.push(jr),ze.push(rn),jr}function wr(){var rn=[];function fn(){rn.push.apply(rn,or(arguments))}var jr=[];function an(){var Nt="v"+U++;return jr.push(Nt),arguments.length>0&&(rn.push(Nt,"="),rn.push.apply(rn,or(arguments)),rn.push(";")),Nt}return x(fn,{def:an,toString:function(){return Lr([jr.length>0?"var "+jr.join(",")+";":"",Lr(rn)])}})}function Ht(){var rn=wr(),fn=wr(),jr=rn.toString,an=fn.toString;function Nt(lr,Vr){fn(lr,Vr,"=",rn.def(lr,Vr),";")}return x(function(){rn.apply(rn,or(arguments))},{def:rn.def,entry:rn,exit:fn,save:Nt,set:function(lr,Vr,mn){Nt(lr,Vr),rn(lr,Vr,"=",mn,";")},toString:function(){return jr()+an()}})}function dr(){var rn=Lr(arguments),fn=Ht(),jr=Ht(),an=fn.toString,Nt=jr.toString;return x(fn,{then:function(){return fn.apply(fn,or(arguments)),this},else:function(){return jr.apply(jr,or(arguments)),this},toString:function(){var lr=Nt();return lr&&(lr="else{"+lr+"}"),Lr(["if(",rn,"){",an(),"}",lr])}})}var Ur=wr(),Hr={};function Jr(rn,fn){var jr=[];function an(){var Fr="a"+jr.length;return jr.push(Fr),Fr}fn=fn||0;for(var Nt=0;Nt<fn;++Nt)an();var lr=Ht(),Vr=lr.toString,mn=Hr[rn]=x(lr,{arg:an,toString:function(){return Lr(["function(",jr.join(),"){",Vr(),"}"])}});return mn}function Gr(){var rn=['"use strict";',Ur,"return {"];Object.keys(Hr).forEach(function(an){rn.push('"',an,'":',Hr[an].toString(),",")}),rn.push("}");var fn=Lr(rn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),jr=Function.apply(null,Te.concat(fn));return jr.apply(null,ze)}return{global:Ur,link:qt,block:wr,proc:Jr,scope:Ht,cond:dr,compile:Gr}}var Xr="xyzw".split(""),yn=5121,Fn=1,Vn=2,jn=0,Qi=1,_n=2,ci=3,Ci=4,fi=5,oi=6,Ti="dither",ii="blend.enable",ri="blend.color",Po="blend.equation",Ja="blend.func",os="depth.enable",Zo="depth.func",Ga="depth.range",no="depth.mask",ds="colorMask",vs="cull.enable",el="cull.face",ms="frontFace",eu="lineWidth",Ls="polygonOffset.enable",xl="polygonOffset.offset",bl="sample.alpha",Nu="sample.enable",tu="sample.coverage",Vl="stencil.enable",Tu="stencil.mask",zu="stencil.func",Hs="stencil.opFront",io="stencil.opBack",Au="scissor.enable",du="scissor.box",gs="viewport",qi="profile",ao="framebuffer",ko="vert",Rs="frag",tl="elements",vu="primitive",rl="count",nl="offset",Ec="instances",Pu="vao",Gl="Width",wc="Height",Ws=ao+Gl,Uo=ao+wc,Hc=gs+Gl,Rf=gs+wc,Sl="drawingBuffer",uf=Sl+Gl,Wc=Sl+wc,Wf=[Ja,Po,zu,Hs,io,tu,gs,du,xl],Hl=34962,ih=34963,lf=35632,ru=35633,j=3553,z=34067,M=2884,D=3042,ne=3024,_e=2960,vt=2929,Vt=3089,Bt=32823,Sr=32926,qr=32928,Rn=5126,Gn=35664,Mn=35665,di=35666,yi=5124,aa=35667,Mi=35668,Ha=35669,Mo=35670,bo=35671,So=35672,Qa=35673,ca=35674,Wa=35675,Eo=35676,oo=35678,wo=35680,Ds=4,mu=1028,Zu=1029,Ss=2304,Xc=2305,cf=32775,jp=32776,Xf=519,Yc=7680,ff=0,fp=1,Mh=32774,hp=513,Ih=36160,Vp=36064,Wl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Kc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],wf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Xl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Cf={frag:lf,vert:ru},il={cw:Ss,ccw:Xc};function Yf(U){return Array.isArray(U)||L(U)||fo(U)}function Oh(U){return U.sort(function(Te,ze){return Te===gs?-1:ze===gs?1:Te<ze?-1:1})}function gu(U,Te,ze,qt){this.thisDep=U,this.contextDep=Te,this.propDep=ze,this.append=qt}function al(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function jo(U){return new gu(!1,!1,!1,U)}function Uu(U,Te){var ze=U.type;if(ze===jn){var qt=U.data.length;return new gu(!0,qt>=1,qt>=2,Te)}else if(ze===Ci){var wr=U.data;return new gu(wr.thisDep,wr.contextDep,wr.propDep,Te)}else{if(ze===fi)return new gu(!1,!1,!1,Te);if(ze===oi){for(var Ht=!1,dr=!1,Ur=!1,Hr=0;Hr<U.data.length;++Hr){var Jr=U.data[Hr];if(Jr.type===Qi)Ur=!0;else if(Jr.type===_n)dr=!0;else if(Jr.type===ci)Ht=!0;else if(Jr.type===jn){Ht=!0;var Gr=Jr.data;Gr>=1&&(dr=!0),Gr>=2&&(Ur=!0)}else Jr.type===Ci&&(Ht=Ht||Jr.data.thisDep,dr=dr||Jr.data.contextDep,Ur=Ur||Jr.data.propDep)}return new gu(Ht,dr,Ur,Te)}else return new gu(ze===ci,ze===_n,ze===Qi,Te)}}var Lh=new gu(!1,!1,!1,function(){});function pp(U,Te,ze,qt,wr,Ht,dr,Ur,Hr,Jr,Gr,rn,fn,jr,an){var Nt=Jr.Record,lr={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(lr.min=cf,lr.max=jp);var Vr=ze.angle_instanced_arrays,mn=ze.webgl_draw_buffers,Fr={dirty:!0,profile:an.profile},Sn={},zr=[],sn={},Rr={};function nn(Le){return Le.replace(".","_")}function Xn(Le,xe,it){var Ot=nn(Le);zr.push(Le),Sn[Ot]=Fr[Ot]=!!it,sn[Ot]=xe}function Kn(Le,xe,it){var Ot=nn(Le);zr.push(Le),Array.isArray(it)?(Fr[Ot]=it.slice(),Sn[Ot]=it.slice()):Fr[Ot]=Sn[Ot]=it,Rr[Ot]=xe}Xn(Ti,ne),Xn(ii,D),Kn(ri,"blendColor",[0,0,0,0]),Kn(Po,"blendEquationSeparate",[Mh,Mh]),Kn(Ja,"blendFuncSeparate",[fp,ff,fp,ff]),Xn(os,vt,!0),Kn(Zo,"depthFunc",hp),Kn(Ga,"depthRange",[0,1]),Kn(no,"depthMask",!0),Kn(ds,ds,[!0,!0,!0,!0]),Xn(vs,M),Kn(el,"cullFace",Zu),Kn(ms,ms,Xc),Kn(eu,eu,1),Xn(Ls,Bt),Kn(xl,"polygonOffset",[0,0]),Xn(bl,Sr),Xn(Nu,qr),Kn(tu,"sampleCoverage",[1,!1]),Xn(Vl,_e),Kn(Tu,"stencilMask",-1),Kn(zu,"stencilFunc",[Xf,0,-1]),Kn(Hs,"stencilOpSeparate",[mu,Yc,Yc,Yc]),Kn(io,"stencilOpSeparate",[Zu,Yc,Yc,Yc]),Xn(Au,Vt),Kn(du,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),Kn(gs,gs,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var on={gl:U,context:fn,strings:Te,next:Sn,current:Fr,draw:rn,elements:Ht,buffer:wr,shader:Gr,attributes:Jr.state,vao:Jr,uniforms:Hr,framebuffer:Ur,extensions:ze,timer:jr,isBufferArgs:Yf},Nr={primTypes:ba,compareFuncs:wf,blendFuncs:Wl,blendEquations:lr,stencilOps:Xl,glTypes:ua,orientationType:il};H.optional(function(){on.isArrayLike=Aa}),mn&&(Nr.backBuffer=[Zu],Nr.drawBuffer=ie(qt.maxDrawbuffers,function(Le){return Le===0?[0]:ie(Le,function(xe){return Vp+xe})}));var Mr=0;function si(){var Le=tn(),xe=Le.link,it=Le.global;Le.id=Mr++,Le.batchId="0";var Ot=xe(on),At=Le.shared={props:"a0"};Object.keys(on).forEach(function(tt){At[tt]=it.def(Ot,".",tt)}),H.optional(function(){Le.CHECK=xe(H),Le.commandStr=H.guessCommand(),Le.command=xe(Le.commandStr),Le.assert=function(tt,Ie,wt){tt("if(!(",Ie,"))",this.CHECK,".commandRaise(",xe(wt),",",this.command,");")},Nr.invalidBlendCombinations=Kc});var ut=Le.next={},at=Le.current={};Object.keys(Rr).forEach(function(tt){Array.isArray(Fr[tt])&&(ut[tt]=it.def(At.next,".",tt),at[tt]=it.def(At.current,".",tt))});var St=Le.constants={};Object.keys(Nr).forEach(function(tt){St[tt]=it.def(JSON.stringify(Nr[tt]))}),Le.invoke=function(tt,Ie){switch(Ie.type){case jn:var wt=["this",At.context,At.props,Le.batchId];return tt.def(xe(Ie.data),".call(",wt.slice(0,Math.max(Ie.data.length+1,4)),")");case Qi:return tt.def(At.props,Ie.data);case _n:return tt.def(At.context,Ie.data);case ci:return tt.def("this",Ie.data);case Ci:return Ie.data.append(Le,tt),Ie.data.ref;case fi:return Ie.data.toString();case oi:return Ie.data.map(function(Zt){return Le.invoke(tt,Zt)})}},Le.attribCache={};var De={};return Le.scopeAttrib=function(tt){var Ie=Te.id(tt);if(Ie in De)return De[Ie];var wt=Jr.scope[Ie];wt||(wt=Jr.scope[Ie]=new Nt);var Zt=De[Ie]=xe(wt);return Zt},Le}function ui(Le){var xe=Le.static,it=Le.dynamic,Ot;if(qi in xe){var At=!!xe[qi];Ot=jo(function(at,St){return At}),Ot.enable=At}else if(qi in it){var ut=it[qi];Ot=Uu(ut,function(at,St){return at.invoke(St,ut)})}return Ot}function kn(Le,xe){var it=Le.static,Ot=Le.dynamic;if(ao in it){var At=it[ao];return At?(At=Ur.getFramebuffer(At),H.command(At,"invalid framebuffer object"),jo(function(at,St){var De=at.link(At),tt=at.shared;St.set(tt.framebuffer,".next",De);var Ie=tt.context;return St.set(Ie,"."+Ws,De+".width"),St.set(Ie,"."+Uo,De+".height"),De})):jo(function(at,St){var De=at.shared;St.set(De.framebuffer,".next","null");var tt=De.context;return St.set(tt,"."+Ws,tt+"."+uf),St.set(tt,"."+Uo,tt+"."+Wc),"null"})}else if(ao in Ot){var ut=Ot[ao];return Uu(ut,function(at,St){var De=at.invoke(St,ut),tt=at.shared,Ie=tt.framebuffer,wt=St.def(Ie,".getFramebuffer(",De,")");H.optional(function(){at.assert(St,"!"+De+"||"+wt,"invalid framebuffer object")}),St.set(Ie,".next",wt);var Zt=tt.context;return St.set(Zt,"."+Ws,wt+"?"+wt+".width:"+Zt+"."+uf),St.set(Zt,"."+Uo,wt+"?"+wt+".height:"+Zt+"."+Wc),wt})}else return null}function ea(Le,xe,it){var Ot=Le.static,At=Le.dynamic;function ut(De){if(De in Ot){var tt=Ot[De];H.commandType(tt,"object","invalid "+De,it.commandStr);var Ie=!0,wt=tt.x|0,Zt=tt.y|0,Er,Xt;return"width"in tt?(Er=tt.width|0,H.command(Er>=0,"invalid "+De,it.commandStr)):Ie=!1,"height"in tt?(Xt=tt.height|0,H.command(Xt>=0,"invalid "+De,it.commandStr)):Ie=!1,new gu(!Ie&&xe&&xe.thisDep,!Ie&&xe&&xe.contextDep,!Ie&&xe&&xe.propDep,function(zn,Ii){var In=zn.shared.context,$n=Er;"width"in tt||($n=Ii.def(In,".",Ws,"-",wt));var Oi=Xt;return"height"in tt||(Oi=Ii.def(In,".",Uo,"-",Zt)),[wt,Zt,$n,Oi]})}else if(De in At){var xr=At[De],Yr=Uu(xr,function(zn,Ii){var In=zn.invoke(Ii,xr);H.optional(function(){zn.assert(Ii,In+"&&typeof "+In+'==="object"',"invalid "+De)});var $n=zn.shared.context,Oi=Ii.def(In,".x|0"),ha=Ii.def(In,".y|0"),Co=Ii.def('"width" in ',In,"?",In,".width|0:","(",$n,".",Ws,"-",Oi,")"),yu=Ii.def('"height" in ',In,"?",In,".height|0:","(",$n,".",Uo,"-",ha,")");return H.optional(function(){zn.assert(Ii,Co+">=0&&"+yu+">=0","invalid "+De)}),[Oi,ha,Co,yu]});return xe&&(Yr.thisDep=Yr.thisDep||xe.thisDep,Yr.contextDep=Yr.contextDep||xe.contextDep,Yr.propDep=Yr.propDep||xe.propDep),Yr}else return xe?new gu(xe.thisDep,xe.contextDep,xe.propDep,function(zn,Ii){var In=zn.shared.context;return[0,0,Ii.def(In,".",Ws),Ii.def(In,".",Uo)]}):null}var at=ut(gs);if(at){var St=at;at=new gu(at.thisDep,at.contextDep,at.propDep,function(De,tt){var Ie=St.append(De,tt),wt=De.shared.context;return tt.set(wt,"."+Hc,Ie[2]),tt.set(wt,"."+Rf,Ie[3]),Ie})}return{viewport:at,scissor_box:ut(du)}}function Pi(Le,xe){var it=Le.static,Ot=typeof it[Rs]=="string"&&typeof it[ko]=="string";if(Ot){if(Object.keys(xe.dynamic).length>0)return null;var At=xe.static,ut=Object.keys(At);if(ut.length>0&&typeof At[ut[0]]=="number"){for(var at=[],St=0;St<ut.length;++St)H(typeof At[ut[St]]=="number","must specify all vertex attribute locations when using vaos"),at.push([At[ut[St]]|0,ut[St]]);return at}}return null}function ji(Le,xe,it){var Ot=Le.static,At=Le.dynamic;function ut(Ie){if(Ie in Ot){var wt=Te.id(Ot[Ie]);H.optional(function(){Gr.shader(Cf[Ie],wt,H.guessCommand())});var Zt=jo(function(){return wt});return Zt.id=wt,Zt}else if(Ie in At){var Er=At[Ie];return Uu(Er,function(Xt,xr){var Yr=Xt.invoke(xr,Er),zn=xr.def(Xt.shared.strings,".id(",Yr,")");return H.optional(function(){xr(Xt.shared.shader,".shader(",Cf[Ie],",",zn,",",Xt.command,");")}),zn})}return null}var at=ut(Rs),St=ut(ko),De=null,tt;return al(at)&&al(St)?(De=Gr.program(St.id,at.id,null,it),tt=jo(function(Ie,wt){return Ie.link(De)})):tt=new gu(at&&at.thisDep||St&&St.thisDep,at&&at.contextDep||St&&St.contextDep,at&&at.propDep||St&&St.propDep,function(Ie,wt){var Zt=Ie.shared.shader,Er;at?Er=at.append(Ie,wt):Er=wt.def(Zt,".",Rs);var Xt;St?Xt=St.append(Ie,wt):Xt=wt.def(Zt,".",ko);var xr=Zt+".program("+Xt+","+Er;return H.optional(function(){xr+=","+Ie.command}),wt.def(xr+")")}),{frag:at,vert:St,progVar:tt,program:De}}function fa(Le,xe){var it=Le.static,Ot=Le.dynamic;function At(){if(tl in it){var Ie=it[tl];Yf(Ie)?Ie=Ht.getElements(Ht.create(Ie,!0)):Ie&&(Ie=Ht.getElements(Ie),H.command(Ie,"invalid elements",xe.commandStr));var wt=jo(function(Er,Xt){if(Ie){var xr=Er.link(Ie);return Er.ELEMENTS=xr,xr}return Er.ELEMENTS=null,null});return wt.value=Ie,wt}else if(tl in Ot){var Zt=Ot[tl];return Uu(Zt,function(Er,Xt){var xr=Er.shared,Yr=xr.isBufferArgs,zn=xr.elements,Ii=Er.invoke(Xt,Zt),In=Xt.def("null"),$n=Xt.def(Yr,"(",Ii,")"),Oi=Er.cond($n).then(In,"=",zn,".createStream(",Ii,");").else(In,"=",zn,".getElements(",Ii,");");return H.optional(function(){Er.assert(Oi.else,"!"+Ii+"||"+In,"invalid elements")}),Xt.entry(Oi),Xt.exit(Er.cond($n).then(zn,".destroyStream(",In,");")),Er.ELEMENTS=In,In})}return null}var ut=At();function at(){if(vu in it){var Ie=it[vu];return H.commandParameter(Ie,ba,"invalid primitve",xe.commandStr),jo(function(Zt,Er){return ba[Ie]})}else if(vu in Ot){var wt=Ot[vu];return Uu(wt,function(Zt,Er){var Xt=Zt.constants.primTypes,xr=Zt.invoke(Er,wt);return H.optional(function(){Zt.assert(Er,xr+" in "+Xt,"invalid primitive, must be one of "+Object.keys(ba))}),Er.def(Xt,"[",xr,"]")})}else if(ut)return al(ut)?ut.value?jo(function(Zt,Er){return Er.def(Zt.ELEMENTS,".primType")}):jo(function(){return Ds}):new gu(ut.thisDep,ut.contextDep,ut.propDep,function(Zt,Er){var Xt=Zt.ELEMENTS;return Er.def(Xt,"?",Xt,".primType:",Ds)});return null}function St(Ie,wt){if(Ie in it){var Zt=it[Ie]|0;return H.command(!wt||Zt>=0,"invalid "+Ie,xe.commandStr),jo(function(Xt,xr){return wt&&(Xt.OFFSET=Zt),Zt})}else if(Ie in Ot){var Er=Ot[Ie];return Uu(Er,function(Xt,xr){var Yr=Xt.invoke(xr,Er);return wt&&(Xt.OFFSET=Yr,H.optional(function(){Xt.assert(xr,Yr+">=0","invalid "+Ie)})),Yr})}else if(wt&&ut)return jo(function(Xt,xr){return Xt.OFFSET="0",0});return null}var De=St(nl,!0);function tt(){if(rl in it){var Ie=it[rl]|0;return H.command(typeof Ie=="number"&&Ie>=0,"invalid vertex count",xe.commandStr),jo(function(){return Ie})}else if(rl in Ot){var wt=Ot[rl];return Uu(wt,function(Xt,xr){var Yr=Xt.invoke(xr,wt);return H.optional(function(){Xt.assert(xr,"typeof "+Yr+'==="number"&&'+Yr+">=0&&"+Yr+"===("+Yr+"|0)","invalid vertex count")}),Yr})}else if(ut)if(al(ut)){if(ut)return De?new gu(De.thisDep,De.contextDep,De.propDep,function(Xt,xr){var Yr=xr.def(Xt.ELEMENTS,".vertCount-",Xt.OFFSET);return H.optional(function(){Xt.assert(xr,Yr+">=0","invalid vertex offset/element buffer too small")}),Yr}):jo(function(Xt,xr){return xr.def(Xt.ELEMENTS,".vertCount")});var Zt=jo(function(){return-1});return H.optional(function(){Zt.MISSING=!0}),Zt}else{var Er=new gu(ut.thisDep||De.thisDep,ut.contextDep||De.contextDep,ut.propDep||De.propDep,function(Xt,xr){var Yr=Xt.ELEMENTS;return Xt.OFFSET?xr.def(Yr,"?",Yr,".vertCount-",Xt.OFFSET,":-1"):xr.def(Yr,"?",Yr,".vertCount:-1")});return H.optional(function(){Er.DYNAMIC=!0}),Er}return null}return{elements:ut,primitive:at(),count:tt(),instances:St(Ec,!1),offset:De}}function Jo(Le,xe){var it=Le.static,Ot=Le.dynamic,At={};return zr.forEach(function(ut){var at=nn(ut);function St(De,tt){if(ut in it){var Ie=De(it[ut]);At[at]=jo(function(){return Ie})}else if(ut in Ot){var wt=Ot[ut];At[at]=Uu(wt,function(Zt,Er){return tt(Zt,Er,Zt.invoke(Er,wt))})}}switch(ut){case vs:case ii:case Ti:case Vl:case os:case Au:case Ls:case bl:case Nu:case no:return St(function(De){return H.commandType(De,"boolean",ut,xe.commandStr),De},function(De,tt,Ie){return H.optional(function(){De.assert(tt,"typeof "+Ie+'==="boolean"',"invalid flag "+ut,De.commandStr)}),Ie});case Zo:return St(function(De){return H.commandParameter(De,wf,"invalid "+ut,xe.commandStr),wf[De]},function(De,tt,Ie){var wt=De.constants.compareFuncs;return H.optional(function(){De.assert(tt,Ie+" in "+wt,"invalid "+ut+", must be one of "+Object.keys(wf))}),tt.def(wt,"[",Ie,"]")});case Ga:return St(function(De){return H.command(Aa(De)&&De.length===2&&typeof De[0]=="number"&&typeof De[1]=="number"&&De[0]<=De[1],"depth range is 2d array",xe.commandStr),De},function(De,tt,Ie){H.optional(function(){De.assert(tt,De.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===2&&typeof "+Ie+'[0]==="number"&&typeof '+Ie+'[1]==="number"&&'+Ie+"[0]<="+Ie+"[1]","depth range must be a 2d array")});var wt=tt.def("+",Ie,"[0]"),Zt=tt.def("+",Ie,"[1]");return[wt,Zt]});case Ja:return St(function(De){H.commandType(De,"object","blend.func",xe.commandStr);var tt="srcRGB"in De?De.srcRGB:De.src,Ie="srcAlpha"in De?De.srcAlpha:De.src,wt="dstRGB"in De?De.dstRGB:De.dst,Zt="dstAlpha"in De?De.dstAlpha:De.dst;return H.commandParameter(tt,Wl,at+".srcRGB",xe.commandStr),H.commandParameter(Ie,Wl,at+".srcAlpha",xe.commandStr),H.commandParameter(wt,Wl,at+".dstRGB",xe.commandStr),H.commandParameter(Zt,Wl,at+".dstAlpha",xe.commandStr),H.command(Kc.indexOf(tt+", "+wt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+tt+", "+wt+")",xe.commandStr),[Wl[tt],Wl[wt],Wl[Ie],Wl[Zt]]},function(De,tt,Ie){var wt=De.constants.blendFuncs;H.optional(function(){De.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid blend func, must be an object")});function Zt(In,$n){var Oi=tt.def('"',In,$n,'" in ',Ie,"?",Ie,".",In,$n,":",Ie,".",In);return H.optional(function(){De.assert(tt,Oi+" in "+wt,"invalid "+ut+"."+In+$n+", must be one of "+Object.keys(Wl))}),Oi}var Er=Zt("src","RGB"),Xt=Zt("dst","RGB");H.optional(function(){var In=De.constants.invalidBlendCombinations;De.assert(tt,In+".indexOf("+Er+'+", "+'+Xt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var xr=tt.def(wt,"[",Er,"]"),Yr=tt.def(wt,"[",Zt("src","Alpha"),"]"),zn=tt.def(wt,"[",Xt,"]"),Ii=tt.def(wt,"[",Zt("dst","Alpha"),"]");return[xr,zn,Yr,Ii]});case Po:return St(function(De){if(typeof De=="string")return H.commandParameter(De,lr,"invalid "+ut,xe.commandStr),[lr[De],lr[De]];if(typeof De=="object")return H.commandParameter(De.rgb,lr,ut+".rgb",xe.commandStr),H.commandParameter(De.alpha,lr,ut+".alpha",xe.commandStr),[lr[De.rgb],lr[De.alpha]];H.commandRaise("invalid blend.equation",xe.commandStr)},function(De,tt,Ie){var wt=De.constants.blendEquations,Zt=tt.def(),Er=tt.def(),Xt=De.cond("typeof ",Ie,'==="string"');return H.optional(function(){function xr(Yr,zn,Ii){De.assert(Yr,Ii+" in "+wt,"invalid "+zn+", must be one of "+Object.keys(lr))}xr(Xt.then,ut,Ie),De.assert(Xt.else,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ut),xr(Xt.else,ut+".rgb",Ie+".rgb"),xr(Xt.else,ut+".alpha",Ie+".alpha")}),Xt.then(Zt,"=",Er,"=",wt,"[",Ie,"];"),Xt.else(Zt,"=",wt,"[",Ie,".rgb];",Er,"=",wt,"[",Ie,".alpha];"),tt(Xt),[Zt,Er]});case ri:return St(function(De){return H.command(Aa(De)&&De.length===4,"blend.color must be a 4d array",xe.commandStr),ie(4,function(tt){return+De[tt]})},function(De,tt,Ie){return H.optional(function(){De.assert(tt,De.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","blend.color must be a 4d array")}),ie(4,function(wt){return tt.def("+",Ie,"[",wt,"]")})});case Tu:return St(function(De){return H.commandType(De,"number",at,xe.commandStr),De|0},function(De,tt,Ie){return H.optional(function(){De.assert(tt,"typeof "+Ie+'==="number"',"invalid stencil.mask")}),tt.def(Ie,"|0")});case zu:return St(function(De){H.commandType(De,"object",at,xe.commandStr);var tt=De.cmp||"keep",Ie=De.ref||0,wt="mask"in De?De.mask:-1;return H.commandParameter(tt,wf,ut+".cmp",xe.commandStr),H.commandType(Ie,"number",ut+".ref",xe.commandStr),H.commandType(wt,"number",ut+".mask",xe.commandStr),[wf[tt],Ie,wt]},function(De,tt,Ie){var wt=De.constants.compareFuncs;H.optional(function(){function xr(){De.assert(tt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}xr(Ie+"&&typeof ",Ie,'==="object"'),xr('!("cmp" in ',Ie,")||(",Ie,".cmp in ",wt,")")});var Zt=tt.def('"cmp" in ',Ie,"?",wt,"[",Ie,".cmp]",":",Yc),Er=tt.def(Ie,".ref|0"),Xt=tt.def('"mask" in ',Ie,"?",Ie,".mask|0:-1");return[Zt,Er,Xt]});case Hs:case io:return St(function(De){H.commandType(De,"object",at,xe.commandStr);var tt=De.fail||"keep",Ie=De.zfail||"keep",wt=De.zpass||"keep";return H.commandParameter(tt,Xl,ut+".fail",xe.commandStr),H.commandParameter(Ie,Xl,ut+".zfail",xe.commandStr),H.commandParameter(wt,Xl,ut+".zpass",xe.commandStr),[ut===io?Zu:mu,Xl[tt],Xl[Ie],Xl[wt]]},function(De,tt,Ie){var wt=De.constants.stencilOps;H.optional(function(){De.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ut)});function Zt(Er){return H.optional(function(){De.assert(tt,'!("'+Er+'" in '+Ie+")||("+Ie+"."+Er+" in "+wt+")","invalid "+ut+"."+Er+", must be one of "+Object.keys(Xl))}),tt.def('"',Er,'" in ',Ie,"?",wt,"[",Ie,".",Er,"]:",Yc)}return[ut===io?Zu:mu,Zt("fail"),Zt("zfail"),Zt("zpass")]});case xl:return St(function(De){H.commandType(De,"object",at,xe.commandStr);var tt=De.factor|0,Ie=De.units|0;return H.commandType(tt,"number",at+".factor",xe.commandStr),H.commandType(Ie,"number",at+".units",xe.commandStr),[tt,Ie]},function(De,tt,Ie){H.optional(function(){De.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ut)});var wt=tt.def(Ie,".factor|0"),Zt=tt.def(Ie,".units|0");return[wt,Zt]});case el:return St(function(De){var tt=0;return De==="front"?tt=mu:De==="back"&&(tt=Zu),H.command(!!tt,at,xe.commandStr),tt},function(De,tt,Ie){return H.optional(function(){De.assert(tt,Ie+'==="front"||'+Ie+'==="back"',"invalid cull.face")}),tt.def(Ie,'==="front"?',mu,":",Zu)});case eu:return St(function(De){return H.command(typeof De=="number"&&De>=qt.lineWidthDims[0]&&De<=qt.lineWidthDims[1],"invalid line width, must be a positive number between "+qt.lineWidthDims[0]+" and "+qt.lineWidthDims[1],xe.commandStr),De},function(De,tt,Ie){return H.optional(function(){De.assert(tt,"typeof "+Ie+'==="number"&&'+Ie+">="+qt.lineWidthDims[0]+"&&"+Ie+"<="+qt.lineWidthDims[1],"invalid line width")}),Ie});case ms:return St(function(De){return H.commandParameter(De,il,at,xe.commandStr),il[De]},function(De,tt,Ie){return H.optional(function(){De.assert(tt,Ie+'==="cw"||'+Ie+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),tt.def(Ie+'==="cw"?'+Ss+":"+Xc)});case ds:return St(function(De){return H.command(Aa(De)&&De.length===4,"color.mask must be length 4 array",xe.commandStr),De.map(function(tt){return!!tt})},function(De,tt,Ie){return H.optional(function(){De.assert(tt,De.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","invalid color.mask")}),ie(4,function(wt){return"!!"+Ie+"["+wt+"]"})});case tu:return St(function(De){H.command(typeof De=="object"&&De,at,xe.commandStr);var tt="value"in De?De.value:1,Ie=!!De.invert;return H.command(typeof tt=="number"&&tt>=0&&tt<=1,"sample.coverage.value must be a number between 0 and 1",xe.commandStr),[tt,Ie]},function(De,tt,Ie){H.optional(function(){De.assert(tt,Ie+"&&typeof "+Ie+'==="object"',"invalid sample.coverage")});var wt=tt.def('"value" in ',Ie,"?+",Ie,".value:1"),Zt=tt.def("!!",Ie,".invert");return[wt,Zt]})}}),At}function ss(Le,xe){var it=Le.static,Ot=Le.dynamic,At={};return Object.keys(it).forEach(function(ut){var at=it[ut],St;if(typeof at=="number"||typeof at=="boolean")St=jo(function(){return at});else if(typeof at=="function"){var De=at._reglType;De==="texture2d"||De==="textureCube"?St=jo(function(tt){return tt.link(at)}):De==="framebuffer"||De==="framebufferCube"?(H.command(at.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ut+'"',xe.commandStr),St=jo(function(tt){return tt.link(at.color[0])})):H.commandRaise('invalid data for uniform "'+ut+'"',xe.commandStr)}else Aa(at)?St=jo(function(tt){var Ie=tt.global.def("[",ie(at.length,function(wt){return H.command(typeof at[wt]=="number"||typeof at[wt]=="boolean","invalid uniform "+ut,tt.commandStr),at[wt]}),"]");return Ie}):H.commandRaise('invalid or missing data for uniform "'+ut+'"',xe.commandStr);St.value=at,At[ut]=St}),Object.keys(Ot).forEach(function(ut){var at=Ot[ut];At[ut]=Uu(at,function(St,De){return St.invoke(De,at)})}),At}function $i(Le,xe){var it=Le.static,Ot=Le.dynamic,At={};return Object.keys(it).forEach(function(ut){var at=it[ut],St=Te.id(ut),De=new Nt;if(Yf(at))De.state=Fn,De.buffer=wr.getBuffer(wr.create(at,Hl,!1,!0)),De.type=0;else{var tt=wr.getBuffer(at);if(tt)De.state=Fn,De.buffer=tt,De.type=0;else if(H.command(typeof at=="object"&&at,"invalid data for attribute "+ut,xe.commandStr),"constant"in at){var Ie=at.constant;De.buffer="null",De.state=Vn,typeof Ie=="number"?De.x=Ie:(H.command(Aa(Ie)&&Ie.length>0&&Ie.length<=4,"invalid constant for attribute "+ut,xe.commandStr),Xr.forEach(function(zn,Ii){Ii<Ie.length&&(De[zn]=Ie[Ii])}))}else{Yf(at.buffer)?tt=wr.getBuffer(wr.create(at.buffer,Hl,!1,!0)):tt=wr.getBuffer(at.buffer),H.command(!!tt,'missing buffer for attribute "'+ut+'"',xe.commandStr);var wt=at.offset|0;H.command(wt>=0,'invalid offset for attribute "'+ut+'"',xe.commandStr);var Zt=at.stride|0;H.command(Zt>=0&&Zt<256,'invalid stride for attribute "'+ut+'", must be integer betweeen [0, 255]',xe.commandStr);var Er=at.size|0;H.command(!("size"in at)||Er>0&&Er<=4,'invalid size for attribute "'+ut+'", must be 1,2,3,4',xe.commandStr);var Xt=!!at.normalized,xr=0;"type"in at&&(H.commandParameter(at.type,ua,"invalid type for attribute "+ut,xe.commandStr),xr=ua[at.type]);var Yr=at.divisor|0;"divisor"in at&&(H.command(Yr===0||Vr,'cannot specify divisor for attribute "'+ut+'", instancing not supported',xe.commandStr),H.command(Yr>=0,'invalid divisor for attribute "'+ut+'"',xe.commandStr)),H.optional(function(){var zn=xe.commandStr,Ii=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(at).forEach(function(In){H.command(Ii.indexOf(In)>=0,'unknown parameter "'+In+'" for attribute pointer "'+ut+'" (valid parameters are '+Ii+")",zn)})}),De.buffer=tt,De.state=Fn,De.size=Er,De.normalized=Xt,De.type=xr||tt.dtype,De.offset=wt,De.stride=Zt,De.divisor=Yr}}At[ut]=jo(function(zn,Ii){var In=zn.attribCache;if(St in In)return In[St];var $n={isStream:!1};return Object.keys(De).forEach(function(Oi){$n[Oi]=De[Oi]}),De.buffer&&($n.buffer=zn.link(De.buffer),$n.type=$n.type||$n.buffer+".dtype"),In[St]=$n,$n})}),Object.keys(Ot).forEach(function(ut){var at=Ot[ut];function St(De,tt){var Ie=De.invoke(tt,at),wt=De.shared,Zt=De.constants,Er=wt.isBufferArgs,Xt=wt.buffer;H.optional(function(){De.assert(tt,Ie+"&&(typeof "+Ie+'==="object"||typeof '+Ie+'==="function")&&('+Er+"("+Ie+")||"+Xt+".getBuffer("+Ie+")||"+Xt+".getBuffer("+Ie+".buffer)||"+Er+"("+Ie+'.buffer)||("constant" in '+Ie+"&&(typeof "+Ie+'.constant==="number"||'+wt.isArrayLike+"("+Ie+".constant))))",'invalid dynamic attribute "'+ut+'"')});var xr={isStream:tt.def(!1)},Yr=new Nt;Yr.state=Fn,Object.keys(Yr).forEach(function($n){xr[$n]=tt.def(""+Yr[$n])});var zn=xr.buffer,Ii=xr.type;tt("if(",Er,"(",Ie,")){",xr.isStream,"=true;",zn,"=",Xt,".createStream(",Hl,",",Ie,");",Ii,"=",zn,".dtype;","}else{",zn,"=",Xt,".getBuffer(",Ie,");","if(",zn,"){",Ii,"=",zn,".dtype;",'}else if("constant" in ',Ie,"){",xr.state,"=",Vn,";","if(typeof "+Ie+'.constant === "number"){',xr[Xr[0]],"=",Ie,".constant;",Xr.slice(1).map(function($n){return xr[$n]}).join("="),"=0;","}else{",Xr.map(function($n,Oi){return xr[$n]+"="+Ie+".constant.length>"+Oi+"?"+Ie+".constant["+Oi+"]:0;"}).join(""),"}}else{","if(",Er,"(",Ie,".buffer)){",zn,"=",Xt,".createStream(",Hl,",",Ie,".buffer);","}else{",zn,"=",Xt,".getBuffer(",Ie,".buffer);","}",Ii,'="type" in ',Ie,"?",Zt.glTypes,"[",Ie,".type]:",zn,".dtype;",xr.normalized,"=!!",Ie,".normalized;");function In($n){tt(xr[$n],"=",Ie,".",$n,"|0;")}return In("size"),In("offset"),In("stride"),In("divisor"),tt("}}"),tt.exit("if(",xr.isStream,"){",Xt,".destroyStream(",zn,");","}"),xr}At[ut]=Uu(at,St)}),At}function vo(Le,xe){var it=Le.static,Ot=Le.dynamic;if(Pu in it){var At=it[Pu];return At!==null&&Jr.getVAO(At)===null&&(At=Jr.createVAO(At)),jo(function(at){return at.link(Jr.getVAO(At))})}else if(Pu in Ot){var ut=Ot[Pu];return Uu(ut,function(at,St){var De=at.invoke(St,ut);return St.def(at.shared.vao+".getVAO("+De+")")})}return null}function so(Le){var xe=Le.static,it=Le.dynamic,Ot={};return Object.keys(xe).forEach(function(At){var ut=xe[At];Ot[At]=jo(function(at,St){return typeof ut=="number"||typeof ut=="boolean"?""+ut:at.link(ut)})}),Object.keys(it).forEach(function(At){var ut=it[At];Ot[At]=Uu(ut,function(at,St){return at.invoke(St,ut)})}),Ot}function Qo(Le,xe,it,Ot,At){var ut=Le.static,at=Le.dynamic;H.optional(function(){var In=[ao,ko,Rs,tl,vu,nl,rl,Ec,qi,Pu].concat(zr);function $n(Oi){Object.keys(Oi).forEach(function(ha){H.command(In.indexOf(ha)>=0,'unknown parameter "'+ha+'"',At.commandStr)})}$n(ut),$n(at)});var St=Pi(Le,xe),De=kn(Le,At),tt=ea(Le,De,At),Ie=fa(Le,At),wt=Jo(Le,At),Zt=ji(Le,At,St);function Er(In){var $n=tt[In];$n&&(wt[In]=$n)}Er(gs),Er(nn(du));var Xt=Object.keys(wt).length>0,xr={framebuffer:De,draw:Ie,shader:Zt,state:wt,dirty:Xt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(xr.profile=ui(Le,At),xr.uniforms=ss(it,At),xr.drawVAO=xr.scopeVAO=vo(Le,At),!xr.drawVAO&&Zt.program&&!St&&ze.angle_instanced_arrays){var Yr=!0,zn=Zt.program.attributes.map(function(In){var $n=xe.static[In];return Yr=Yr&&!!$n,$n});if(Yr&&zn.length>0){var Ii=Jr.getVAO(Jr.createVAO(zn));xr.drawVAO=new gu(null,null,null,function(In,$n){return In.link(Ii)}),xr.useVAO=!0}}return St?xr.useVAO=!0:xr.attributes=$i(xe,At),xr.context=so(Ot,At),xr}function ys(Le,xe,it){var Ot=Le.shared,At=Ot.context,ut=Le.scope();Object.keys(it).forEach(function(at){xe.save(At,"."+at);var St=it[at],De=St.append(Le,xe);Array.isArray(De)?ut(At,".",at,"=[",De.join(),"];"):ut(At,".",at,"=",De,";")}),xe(ut)}function Es(Le,xe,it,Ot){var At=Le.shared,ut=At.gl,at=At.framebuffer,St;mn&&(St=xe.def(At.extensions,".webgl_draw_buffers"));var De=Le.constants,tt=De.drawBuffer,Ie=De.backBuffer,wt;it?wt=it.append(Le,xe):wt=xe.def(at,".next"),Ot||xe("if(",wt,"!==",at,".cur){"),xe("if(",wt,"){",ut,".bindFramebuffer(",Ih,",",wt,".framebuffer);"),mn&&xe(St,".drawBuffersWEBGL(",tt,"[",wt,".colorAttachments.length]);"),xe("}else{",ut,".bindFramebuffer(",Ih,",null);"),mn&&xe(St,".drawBuffersWEBGL(",Ie,");"),xe("}",at,".cur=",wt,";"),Ot||xe("}")}function ks(Le,xe,it){var Ot=Le.shared,At=Ot.gl,ut=Le.current,at=Le.next,St=Ot.current,De=Ot.next,tt=Le.cond(St,".dirty");zr.forEach(function(Ie){var wt=nn(Ie);if(!(wt in it.state)){var Zt,Er;if(wt in at){Zt=at[wt],Er=ut[wt];var Xt=ie(Fr[wt].length,function(Yr){return tt.def(Zt,"[",Yr,"]")});tt(Le.cond(Xt.map(function(Yr,zn){return Yr+"!=="+Er+"["+zn+"]"}).join("||")).then(At,".",Rr[wt],"(",Xt,");",Xt.map(function(Yr,zn){return Er+"["+zn+"]="+Yr}).join(";"),";"))}else{Zt=tt.def(De,".",wt);var xr=Le.cond(Zt,"!==",St,".",wt);tt(xr),wt in sn?xr(Le.cond(Zt).then(At,".enable(",sn[wt],");").else(At,".disable(",sn[wt],");"),St,".",wt,"=",Zt,";"):xr(At,".",Rr[wt],"(",Zt,");",St,".",wt,"=",Zt,";")}}}),Object.keys(it.state).length===0&&tt(St,".dirty=false;"),xe(tt)}function _s(Le,xe,it,Ot){var At=Le.shared,ut=Le.current,at=At.current,St=At.gl;Oh(Object.keys(it)).forEach(function(De){var tt=it[De];if(!(Ot&&!Ot(tt))){var Ie=tt.append(Le,xe);if(sn[De]){var wt=sn[De];al(tt)?Ie?xe(St,".enable(",wt,");"):xe(St,".disable(",wt,");"):xe(Le.cond(Ie).then(St,".enable(",wt,");").else(St,".disable(",wt,");")),xe(at,".",De,"=",Ie,";")}else if(Aa(Ie)){var Zt=ut[De];xe(St,".",Rr[De],"(",Ie,");",Ie.map(function(Er,Xt){return Zt+"["+Xt+"]="+Er}).join(";"),";")}else xe(St,".",Rr[De],"(",Ie,");",at,".",De,"=",Ie,";")}})}function Fo(Le,xe){Vr&&(Le.instancing=xe.def(Le.shared.extensions,".angle_instanced_arrays"))}function Ni(Le,xe,it,Ot,At){var ut=Le.shared,at=Le.stats,St=ut.current,De=ut.timer,tt=it.profile;function Ie(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var wt,Zt;function Er(In){wt=xe.def(),In(wt,"=",Ie(),";"),typeof At=="string"?In(at,".count+=",At,";"):In(at,".count++;"),jr&&(Ot?(Zt=xe.def(),In(Zt,"=",De,".getNumPendingQueries();")):In(De,".beginQuery(",at,");"))}function Xt(In){In(at,".cpuTime+=",Ie(),"-",wt,";"),jr&&(Ot?In(De,".pushScopeStats(",Zt,",",De,".getNumPendingQueries(),",at,");"):In(De,".endQuery();"))}function xr(In){var $n=xe.def(St,".profile");xe(St,".profile=",In,";"),xe.exit(St,".profile=",$n,";")}var Yr;if(tt){if(al(tt)){tt.enable?(Er(xe),Xt(xe.exit),xr("true")):xr("false");return}Yr=tt.append(Le,xe),xr(Yr)}else Yr=xe.def(St,".profile");var zn=Le.block();Er(zn),xe("if(",Yr,"){",zn,"}");var Ii=Le.block();Xt(Ii),xe.exit("if(",Yr,"){",Ii,"}")}function Fs(Le,xe,it,Ot,At){var ut=Le.shared;function at(De){switch(De){case Gn:case aa:case bo:return 2;case Mn:case Mi:case So:return 3;case di:case Ha:case Qa:return 4;default:return 1}}function St(De,tt,Ie){var wt=ut.gl,Zt=xe.def(De,".location"),Er=xe.def(ut.attributes,"[",Zt,"]"),Xt=Ie.state,xr=Ie.buffer,Yr=[Ie.x,Ie.y,Ie.z,Ie.w],zn=["buffer","normalized","offset","stride"];function Ii(){xe("if(!",Er,".buffer){",wt,".enableVertexAttribArray(",Zt,");}");var $n=Ie.type,Oi;if(Ie.size?Oi=xe.def(Ie.size,"||",tt):Oi=tt,xe("if(",Er,".type!==",$n,"||",Er,".size!==",Oi,"||",zn.map(function(Co){return Er+"."+Co+"!=="+Ie[Co]}).join("||"),"){",wt,".bindBuffer(",Hl,",",xr,".buffer);",wt,".vertexAttribPointer(",[Zt,Oi,$n,Ie.normalized,Ie.stride,Ie.offset],");",Er,".type=",$n,";",Er,".size=",Oi,";",zn.map(function(Co){return Er+"."+Co+"="+Ie[Co]+";"}).join(""),"}"),Vr){var ha=Ie.divisor;xe("if(",Er,".divisor!==",ha,"){",Le.instancing,".vertexAttribDivisorANGLE(",[Zt,ha],");",Er,".divisor=",ha,";}")}}function In(){xe("if(",Er,".buffer){",wt,".disableVertexAttribArray(",Zt,");",Er,".buffer=null;","}if(",Xr.map(function($n,Oi){return Er+"."+$n+"!=="+Yr[Oi]}).join("||"),"){",wt,".vertexAttrib4f(",Zt,",",Yr,");",Xr.map(function($n,Oi){return Er+"."+$n+"="+Yr[Oi]+";"}).join(""),"}")}Xt===Fn?Ii():Xt===Vn?In():(xe("if(",Xt,"===",Fn,"){"),Ii(),xe("}else{"),In(),xe("}"))}Ot.forEach(function(De){var tt=De.name,Ie=it.attributes[tt],wt;if(Ie){if(!At(Ie))return;wt=Ie.append(Le,xe)}else{if(!At(Lh))return;var Zt=Le.scopeAttrib(tt);H.optional(function(){Le.assert(xe,Zt+".state","missing attribute "+tt)}),wt={},Object.keys(new Nt).forEach(function(Er){wt[Er]=xe.def(Zt,".",Er)})}St(Le.link(De),at(De.info.type),wt)})}function Sa(Le,xe,it,Ot,At){for(var ut=Le.shared,at=ut.gl,St,De=0;De<Ot.length;++De){var tt=Ot[De],Ie=tt.name,wt=tt.info.type,Zt=it.uniforms[Ie],Er=Le.link(tt),Xt=Er+".location",xr;if(Zt){if(!At(Zt))continue;if(al(Zt)){var Yr=Zt.value;if(H.command(Yr!==null&&typeof Yr!="undefined",'missing uniform "'+Ie+'"',Le.commandStr),wt===oo||wt===wo){H.command(typeof Yr=="function"&&(wt===oo&&(Yr._reglType==="texture2d"||Yr._reglType==="framebuffer")||wt===wo&&(Yr._reglType==="textureCube"||Yr._reglType==="framebufferCube")),"invalid texture for uniform "+Ie,Le.commandStr);var zn=Le.link(Yr._texture||Yr.color[0]._texture);xe(at,".uniform1i(",Xt,",",zn+".bind());"),xe.exit(zn,".unbind();")}else if(wt===ca||wt===Wa||wt===Eo){H.optional(function(){H.command(Aa(Yr),"invalid matrix for uniform "+Ie,Le.commandStr),H.command(wt===ca&&Yr.length===4||wt===Wa&&Yr.length===9||wt===Eo&&Yr.length===16,"invalid length for matrix uniform "+Ie,Le.commandStr)});var Ii=Le.global.def("new Float32Array(["+Array.prototype.slice.call(Yr)+"])"),In=2;wt===Wa?In=3:wt===Eo&&(In=4),xe(at,".uniformMatrix",In,"fv(",Xt,",false,",Ii,");")}else{switch(wt){case Rn:H.commandType(Yr,"number","uniform "+Ie,Le.commandStr),St="1f";break;case Gn:H.command(Aa(Yr)&&Yr.length===2,"uniform "+Ie,Le.commandStr),St="2f";break;case Mn:H.command(Aa(Yr)&&Yr.length===3,"uniform "+Ie,Le.commandStr),St="3f";break;case di:H.command(Aa(Yr)&&Yr.length===4,"uniform "+Ie,Le.commandStr),St="4f";break;case Mo:H.commandType(Yr,"boolean","uniform "+Ie,Le.commandStr),St="1i";break;case yi:H.commandType(Yr,"number","uniform "+Ie,Le.commandStr),St="1i";break;case bo:H.command(Aa(Yr)&&Yr.length===2,"uniform "+Ie,Le.commandStr),St="2i";break;case aa:H.command(Aa(Yr)&&Yr.length===2,"uniform "+Ie,Le.commandStr),St="2i";break;case So:H.command(Aa(Yr)&&Yr.length===3,"uniform "+Ie,Le.commandStr),St="3i";break;case Mi:H.command(Aa(Yr)&&Yr.length===3,"uniform "+Ie,Le.commandStr),St="3i";break;case Qa:H.command(Aa(Yr)&&Yr.length===4,"uniform "+Ie,Le.commandStr),St="4i";break;case Ha:H.command(Aa(Yr)&&Yr.length===4,"uniform "+Ie,Le.commandStr),St="4i";break}xe(at,".uniform",St,"(",Xt,",",Aa(Yr)?Array.prototype.slice.call(Yr):Yr,");")}continue}else xr=Zt.append(Le,xe)}else{if(!At(Lh))continue;xr=xe.def(ut.uniforms,"[",Te.id(Ie),"]")}wt===oo?(H(!Array.isArray(xr),"must specify a scalar prop for textures"),xe("if(",xr,"&&",xr,'._reglType==="framebuffer"){',xr,"=",xr,".color[0];","}")):wt===wo&&(H(!Array.isArray(xr),"must specify a scalar prop for cube maps"),xe("if(",xr,"&&",xr,'._reglType==="framebufferCube"){',xr,"=",xr,".color[0];","}")),H.optional(function(){function yu(Tl,kf){Le.assert(xe,Tl,'bad data or missing for uniform "'+Ie+'".  '+kf)}function Df(Tl){H(!Array.isArray(xr),"must not specify an array type for uniform"),yu("typeof "+xr+'==="'+Tl+'"',"invalid type, expected "+Tl)}function Cl(Tl,kf){Array.isArray(xr)?H(xr.length===Tl,"must have length "+Tl):yu(ut.isArrayLike+"("+xr+")&&"+xr+".length==="+Tl,"invalid vector, should have length "+Tl,Le.commandStr)}function sh(Tl){H(!Array.isArray(xr),"must not specify a value type"),yu("typeof "+xr+'==="function"&&'+xr+'._reglType==="texture'+(Tl===j?"2d":"Cube")+'"',"invalid texture type",Le.commandStr)}switch(wt){case yi:Df("number");break;case aa:Cl(2,"number");break;case Mi:Cl(3,"number");break;case Ha:Cl(4,"number");break;case Rn:Df("number");break;case Gn:Cl(2,"number");break;case Mn:Cl(3,"number");break;case di:Cl(4,"number");break;case Mo:Df("boolean");break;case bo:Cl(2,"boolean");break;case So:Cl(3,"boolean");break;case Qa:Cl(4,"boolean");break;case ca:Cl(4,"number");break;case Wa:Cl(9,"number");break;case Eo:Cl(16,"number");break;case oo:sh(j);break;case wo:sh(z);break}});var $n=1;switch(wt){case oo:case wo:var Oi=xe.def(xr,"._texture");xe(at,".uniform1i(",Xt,",",Oi,".bind());"),xe.exit(Oi,".unbind();");continue;case yi:case Mo:St="1i";break;case aa:case bo:St="2i",$n=2;break;case Mi:case So:St="3i",$n=3;break;case Ha:case Qa:St="4i",$n=4;break;case Rn:St="1f";break;case Gn:St="2f",$n=2;break;case Mn:St="3f",$n=3;break;case di:St="4f",$n=4;break;case ca:St="Matrix2fv";break;case Wa:St="Matrix3fv";break;case Eo:St="Matrix4fv";break}if(xe(at,".uniform",St,"(",Xt,","),St.charAt(0)==="M"){var ha=Math.pow(wt-ca+2,2),Co=Le.global.def("new Float32Array(",ha,")");Array.isArray(xr)?xe("false,(",ie(ha,function(yu){return Co+"["+yu+"]="+xr[yu]}),",",Co,")"):xe("false,(Array.isArray(",xr,")||",xr," instanceof Float32Array)?",xr,":(",ie(ha,function(yu){return Co+"["+yu+"]="+xr+"["+yu+"]"}),",",Co,")")}else $n>1?xe(ie($n,function(yu){return Array.isArray(xr)?xr[yu]:xr+"["+yu+"]"})):(H(!Array.isArray(xr),"uniform value must not be an array"),xe(xr));xe(");")}}function li(Le,xe,it,Ot){var At=Le.shared,ut=At.gl,at=At.draw,St=Ot.draw;function De(){var Oi=St.elements,ha,Co=xe;return Oi?((Oi.contextDep&&Ot.contextDynamic||Oi.propDep)&&(Co=it),ha=Oi.append(Le,Co)):ha=Co.def(at,".",tl),ha&&Co("if("+ha+")"+ut+".bindBuffer("+ih+","+ha+".buffer.buffer);"),ha}function tt(){var Oi=St.count,ha,Co=xe;return Oi?((Oi.contextDep&&Ot.contextDynamic||Oi.propDep)&&(Co=it),ha=Oi.append(Le,Co),H.optional(function(){Oi.MISSING&&Le.assert(xe,"false","missing vertex count"),Oi.DYNAMIC&&Le.assert(Co,ha+">=0","missing vertex count")})):(ha=Co.def(at,".",rl),H.optional(function(){Le.assert(Co,ha+">=0","missing vertex count")})),ha}var Ie=De();function wt(Oi){var ha=St[Oi];return ha?ha.contextDep&&Ot.contextDynamic||ha.propDep?ha.append(Le,it):ha.append(Le,xe):xe.def(at,".",Oi)}var Zt=wt(vu),Er=wt(nl),Xt=tt();if(typeof Xt=="number"){if(Xt===0)return}else it("if(",Xt,"){"),it.exit("}");var xr,Yr;Vr&&(xr=wt(Ec),Yr=Le.instancing);var zn=Ie+".type",Ii=St.elements&&al(St.elements);function In(){function Oi(){it(Yr,".drawElementsInstancedANGLE(",[Zt,Xt,zn,Er+"<<(("+zn+"-"+yn+")>>1)",xr],");")}function ha(){it(Yr,".drawArraysInstancedANGLE(",[Zt,Er,Xt,xr],");")}Ie?Ii?Oi():(it("if(",Ie,"){"),Oi(),it("}else{"),ha(),it("}")):ha()}function $n(){function Oi(){it(ut+".drawElements("+[Zt,Xt,zn,Er+"<<(("+zn+"-"+yn+")>>1)"]+");")}function ha(){it(ut+".drawArrays("+[Zt,Er,Xt]+");")}Ie?Ii?Oi():(it("if(",Ie,"){"),Oi(),it("}else{"),ha(),it("}")):ha()}Vr&&(typeof xr!="number"||xr>=0)?typeof xr=="string"?(it("if(",xr,">0){"),In(),it("}else if(",xr,"<0){"),$n(),it("}")):In():$n()}function Wi(Le,xe,it,Ot,At){var ut=si(),at=ut.proc("body",At);return H.optional(function(){ut.commandStr=xe.commandStr,ut.command=ut.link(xe.commandStr)}),Vr&&(ut.instancing=at.def(ut.shared.extensions,".angle_instanced_arrays")),Le(ut,at,it,Ot),ut.compile().body}function oa(Le,xe,it,Ot){Fo(Le,xe),it.useVAO?it.drawVAO?xe(Le.shared.vao,".setVAO(",it.drawVAO.append(Le,xe),");"):xe(Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"):(xe(Le.shared.vao,".setVAO(null);"),Fs(Le,xe,it,Ot.attributes,function(){return!0})),Sa(Le,xe,it,Ot.uniforms,function(){return!0}),li(Le,xe,xe,it)}function qo(Le,xe){var it=Le.proc("draw",1);Fo(Le,it),ys(Le,it,xe.context),Es(Le,it,xe.framebuffer),ks(Le,it,xe),_s(Le,it,xe.state),Ni(Le,it,xe,!1,!0);var Ot=xe.shader.progVar.append(Le,it);if(it(Le.shared.gl,".useProgram(",Ot,".program);"),xe.shader.program)oa(Le,it,xe,xe.shader.program);else{it(Le.shared.vao,".setVAO(null);");var At=Le.global.def("{}"),ut=it.def(Ot,".id"),at=it.def(At,"[",ut,"]");it(Le.cond(at).then(at,".call(this,a0);").else(at,"=",At,"[",ut,"]=",Le.link(function(St){return Wi(oa,Le,xe,St,1)}),"(",Ot,");",at,".call(this,a0);"))}Object.keys(xe.state).length>0&&it(Le.shared.current,".dirty=true;")}function El(Le,xe,it,Ot){Le.batchId="a1",Fo(Le,xe);function At(){return!0}Fs(Le,xe,it,Ot.attributes,At),Sa(Le,xe,it,Ot.uniforms,At),li(Le,xe,xe,it)}function wl(Le,xe,it,Ot){Fo(Le,xe);var At=it.contextDep,ut=xe.def(),at="a0",St="a1",De=xe.def();Le.shared.props=De,Le.batchId=ut;var tt=Le.scope(),Ie=Le.scope();xe(tt.entry,"for(",ut,"=0;",ut,"<",St,";++",ut,"){",De,"=",at,"[",ut,"];",Ie,"}",tt.exit);function wt(zn){return zn.contextDep&&At||zn.propDep}function Zt(zn){return!wt(zn)}if(it.needsContext&&ys(Le,Ie,it.context),it.needsFramebuffer&&Es(Le,Ie,it.framebuffer),_s(Le,Ie,it.state,wt),it.profile&&wt(it.profile)&&Ni(Le,Ie,it,!1,!0),Ot)it.useVAO?it.drawVAO?wt(it.drawVAO)?Ie(Le.shared.vao,".setVAO(",it.drawVAO.append(Le,Ie),");"):tt(Le.shared.vao,".setVAO(",it.drawVAO.append(Le,tt),");"):tt(Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"):(tt(Le.shared.vao,".setVAO(null);"),Fs(Le,tt,it,Ot.attributes,Zt),Fs(Le,Ie,it,Ot.attributes,wt)),Sa(Le,tt,it,Ot.uniforms,Zt),Sa(Le,Ie,it,Ot.uniforms,wt),li(Le,tt,Ie,it);else{var Er=Le.global.def("{}"),Xt=it.shader.progVar.append(Le,Ie),xr=Ie.def(Xt,".id"),Yr=Ie.def(Er,"[",xr,"]");Ie(Le.shared.gl,".useProgram(",Xt,".program);","if(!",Yr,"){",Yr,"=",Er,"[",xr,"]=",Le.link(function(zn){return Wi(El,Le,it,zn,2)}),"(",Xt,");}",Yr,".call(this,a0[",ut,"],",ut,");")}}function Ue(Le,xe){var it=Le.proc("batch",2);Le.batchId="0",Fo(Le,it);var Ot=!1,At=!0;Object.keys(xe.context).forEach(function(Er){Ot=Ot||xe.context[Er].propDep}),Ot||(ys(Le,it,xe.context),At=!1);var ut=xe.framebuffer,at=!1;ut?(ut.propDep?Ot=at=!0:ut.contextDep&&Ot&&(at=!0),at||Es(Le,it,ut)):Es(Le,it,null),xe.state.viewport&&xe.state.viewport.propDep&&(Ot=!0);function St(Er){return Er.contextDep&&Ot||Er.propDep}ks(Le,it,xe),_s(Le,it,xe.state,function(Er){return!St(Er)}),(!xe.profile||!St(xe.profile))&&Ni(Le,it,xe,!1,"a1"),xe.contextDep=Ot,xe.needsContext=At,xe.needsFramebuffer=at;var De=xe.shader.progVar;if(De.contextDep&&Ot||De.propDep)wl(Le,it,xe,null);else{var tt=De.append(Le,it);if(it(Le.shared.gl,".useProgram(",tt,".program);"),xe.shader.program)wl(Le,it,xe,xe.shader.program);else{it(Le.shared.vao,".setVAO(null);");var Ie=Le.global.def("{}"),wt=it.def(tt,".id"),Zt=it.def(Ie,"[",wt,"]");it(Le.cond(Zt).then(Zt,".call(this,a0,a1);").else(Zt,"=",Ie,"[",wt,"]=",Le.link(function(Er){return Wi(wl,Le,xe,Er,2)}),"(",tt,");",Zt,".call(this,a0,a1);"))}}Object.keys(xe.state).length>0&&it(Le.shared.current,".dirty=true;")}function $t(Le,xe){var it=Le.proc("scope",3);Le.batchId="a2";var Ot=Le.shared,At=Ot.current;ys(Le,it,xe.context),xe.framebuffer&&xe.framebuffer.append(Le,it),Oh(Object.keys(xe.state)).forEach(function(at){var St=xe.state[at],De=St.append(Le,it);Aa(De)?De.forEach(function(tt,Ie){it.set(Le.next[at],"["+Ie+"]",tt)}):it.set(Ot.next,"."+at,De)}),Ni(Le,it,xe,!0,!0),[tl,nl,rl,Ec,vu].forEach(function(at){var St=xe.draw[at];!St||it.set(Ot.draw,"."+at,""+St.append(Le,it))}),Object.keys(xe.uniforms).forEach(function(at){var St=xe.uniforms[at].append(Le,it);Array.isArray(St)&&(St="["+St.join()+"]"),it.set(Ot.uniforms,"["+Te.id(at)+"]",St)}),Object.keys(xe.attributes).forEach(function(at){var St=xe.attributes[at].append(Le,it),De=Le.scopeAttrib(at);Object.keys(new Nt).forEach(function(tt){it.set(De,"."+tt,St[tt])})}),xe.scopeVAO&&it.set(Ot.vao,".targetVAO",xe.scopeVAO.append(Le,it));function ut(at){var St=xe.shader[at];St&&it.set(Ot.shader,"."+at,St.append(Le,it))}ut(ko),ut(Rs),Object.keys(xe.state).length>0&&(it(At,".dirty=true;"),it.exit(At,".dirty=true;")),it("a1(",Le.shared.context,",a0,",Le.batchId,");")}function Wt(Le){if(!(typeof Le!="object"||Aa(Le))){for(var xe=Object.keys(Le),it=0;it<xe.length;++it)if(lt.isDynamic(Le[xe[it]]))return!0;return!1}}function Cn(Le,xe,it){var Ot=xe.static[it];if(!Ot||!Wt(Ot))return;var At=Le.global,ut=Object.keys(Ot),at=!1,St=!1,De=!1,tt=Le.global.def("{}");ut.forEach(function(wt){var Zt=Ot[wt];if(lt.isDynamic(Zt)){typeof Zt=="function"&&(Zt=Ot[wt]=lt.unbox(Zt));var Er=Uu(Zt,null);at=at||Er.thisDep,De=De||Er.propDep,St=St||Er.contextDep}else{switch(At(tt,".",wt,"="),typeof Zt){case"number":At(Zt);break;case"string":At('"',Zt,'"');break;case"object":Array.isArray(Zt)&&At("[",Zt.join(),"]");break;default:At(Le.link(Zt));break}At(";")}});function Ie(wt,Zt){ut.forEach(function(Er){var Xt=Ot[Er];if(!!lt.isDynamic(Xt)){var xr=wt.invoke(Zt,Xt);Zt(tt,".",Er,"=",xr,";")}})}xe.dynamic[it]=new lt.DynamicVariable(Ci,{thisDep:at,contextDep:St,propDep:De,ref:tt,append:Ie}),delete xe.static[it]}function Xi(Le,xe,it,Ot,At){var ut=si();ut.stats=ut.link(At),Object.keys(xe.static).forEach(function(St){Cn(ut,xe,St)}),Wf.forEach(function(St){Cn(ut,Le,St)});var at=Qo(Le,xe,it,Ot,ut);return qo(ut,at),$t(ut,at),Ue(ut,at),x(ut.compile(),{destroy:function(){at.shader.program.destroy()}})}return{next:Sn,current:Fr,procs:function(){var Le=si(),xe=Le.proc("poll"),it=Le.proc("refresh"),Ot=Le.block();xe(Ot),it(Ot);var At=Le.shared,ut=At.gl,at=At.next,St=At.current;Ot(St,".dirty=false;"),Es(Le,xe),Es(Le,it,null,!0);var De;Vr&&(De=Le.link(Vr)),ze.oes_vertex_array_object&&it(Le.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var tt=0;tt<qt.maxAttributes;++tt){var Ie=it.def(At.attributes,"[",tt,"]"),wt=Le.cond(Ie,".buffer");wt.then(ut,".enableVertexAttribArray(",tt,");",ut,".bindBuffer(",Hl,",",Ie,".buffer.buffer);",ut,".vertexAttribPointer(",tt,",",Ie,".size,",Ie,".type,",Ie,".normalized,",Ie,".stride,",Ie,".offset);").else(ut,".disableVertexAttribArray(",tt,");",ut,".vertexAttrib4f(",tt,",",Ie,".x,",Ie,".y,",Ie,".z,",Ie,".w);",Ie,".buffer=null;"),it(wt),Vr&&it(De,".vertexAttribDivisorANGLE(",tt,",",Ie,".divisor);")}return it(Le.shared.vao,".currentVAO=null;",Le.shared.vao,".setVAO(",Le.shared.vao,".targetVAO);"),Object.keys(sn).forEach(function(Zt){var Er=sn[Zt],Xt=Ot.def(at,".",Zt),xr=Le.block();xr("if(",Xt,"){",ut,".enable(",Er,")}else{",ut,".disable(",Er,")}",St,".",Zt,"=",Xt,";"),it(xr),xe("if(",Xt,"!==",St,".",Zt,"){",xr,"}")}),Object.keys(Rr).forEach(function(Zt){var Er=Rr[Zt],Xt=Fr[Zt],xr,Yr,zn=Le.block();if(zn(ut,".",Er,"("),Aa(Xt)){var Ii=Xt.length;xr=Le.global.def(at,".",Zt),Yr=Le.global.def(St,".",Zt),zn(ie(Ii,function(In){return xr+"["+In+"]"}),");",ie(Ii,function(In){return Yr+"["+In+"]="+xr+"["+In+"];"}).join("")),xe("if(",ie(Ii,function(In){return xr+"["+In+"]!=="+Yr+"["+In+"]"}).join("||"),"){",zn,"}")}else xr=Ot.def(at,".",Zt),Yr=Ot.def(St,".",Zt),zn(xr,");",St,".",Zt,"=",xr,";"),xe("if(",xr,"!==",Yr,"){",zn,"}");it(zn)}),Le.compile()}(),compile:Xi}}function Rh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Dh=34918,nu=34919,kh=35007,ah=function(U,Te){if(!Te.ext_disjoint_timer_query)return null;var ze=[];function qt(){return ze.pop()||Te.ext_disjoint_timer_query.createQueryEXT()}function wr(Vr){ze.push(Vr)}var Ht=[];function dr(Vr){var mn=qt();Te.ext_disjoint_timer_query.beginQueryEXT(kh,mn),Ht.push(mn),jr(Ht.length-1,Ht.length,Vr)}function Ur(){Te.ext_disjoint_timer_query.endQueryEXT(kh)}function Hr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Jr=[];function Gr(){return Jr.pop()||new Hr}function rn(Vr){Jr.push(Vr)}var fn=[];function jr(Vr,mn,Fr){var Sn=Gr();Sn.startQueryIndex=Vr,Sn.endQueryIndex=mn,Sn.sum=0,Sn.stats=Fr,fn.push(Sn)}var an=[],Nt=[];function lr(){var Vr,mn,Fr=Ht.length;if(Fr!==0){Nt.length=Math.max(Nt.length,Fr+1),an.length=Math.max(an.length,Fr+1),an[0]=0,Nt[0]=0;var Sn=0;for(Vr=0,mn=0;mn<Ht.length;++mn){var zr=Ht[mn];Te.ext_disjoint_timer_query.getQueryObjectEXT(zr,nu)?(Sn+=Te.ext_disjoint_timer_query.getQueryObjectEXT(zr,Dh),wr(zr)):Ht[Vr++]=zr,an[mn+1]=Sn,Nt[mn+1]=Vr}for(Ht.length=Vr,Vr=0,mn=0;mn<fn.length;++mn){var sn=fn[mn],Rr=sn.startQueryIndex,nn=sn.endQueryIndex;sn.sum+=an[nn]-an[Rr];var Xn=Nt[Rr],Kn=Nt[nn];Kn===Xn?(sn.stats.gpuTime+=sn.sum/1e6,rn(sn)):(sn.startQueryIndex=Xn,sn.endQueryIndex=Kn,fn[Vr++]=sn)}fn.length=Vr}}return{beginQuery:dr,endQuery:Ur,pushScopeStats:jr,update:lr,getNumPendingQueries:function(){return Ht.length},clear:function(){ze.push.apply(ze,Ht);for(var Vr=0;Vr<ze.length;Vr++)Te.ext_disjoint_timer_query.deleteQueryEXT(ze[Vr]);Ht.length=0,ze.length=0},restore:function(){Ht.length=0,ze.length=0}}},oh=16384,dp=256,Fh=1024,vp=34962,Bh="webglcontextlost",Nh="webglcontextrestored",Kf=1,mp=2,zh=3;function $c(U,Te){for(var ze=0;ze<U.length;++ze)if(U[ze]===Te)return ze;return-1}function Zh(U){var Te=pi(U);if(!Te)return null;var ze=Te.gl,qt=ze.getContextAttributes(),wr=ze.isContextLost(),Ht=G(ze,Te);if(!Ht)return null;var dr=pr(),Ur=Rh(),Hr=Ht.extensions,Jr=ah(ze,Hr),Gr=Qt(),rn=ze.drawingBufferWidth,fn=ze.drawingBufferHeight,jr={tick:0,time:0,viewportWidth:rn,viewportHeight:fn,framebufferWidth:rn,framebufferHeight:fn,drawingBufferWidth:rn,drawingBufferHeight:fn,pixelRatio:Te.pixelRatio},an={},Nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},lr=Ca(ze,Hr),Vr=sa(ze,Ur,Te,Fr),mn=ye(ze,Hr,lr,Ur,Vr);function Fr(li){return mn.destroyBuffer(li)}var Sn=Hf(ze,Hr,Vr,Ur),zr=Ne(ze,dr,Ur,Te),sn=Qs(ze,Hr,lr,function(){Xn.procs.poll()},jr,Ur,Te),Rr=ku(ze,Hr,lr,Ur,Te),nn=R(ze,Hr,lr,sn,Rr,Ur),Xn=pp(ze,dr,Hr,lr,Vr,Sn,sn,nn,an,mn,zr,Nt,jr,Jr,Te),Kn=rr(ze,nn,Xn.procs.poll,jr,qt,Hr,lr),on=Xn.next,Nr=ze.canvas,Mr=[],si=[],ui=[],kn=[Te.onDestroy],ea=null;function Pi(){if(Mr.length===0){Jr&&Jr.update(),ea=null;return}ea=Rt.next(Pi),_s();for(var li=Mr.length-1;li>=0;--li){var Wi=Mr[li];Wi&&Wi(jr,null,0)}ze.flush(),Jr&&Jr.update()}function ji(){!ea&&Mr.length>0&&(ea=Rt.next(Pi))}function fa(){ea&&(Rt.cancel(Pi),ea=null)}function Jo(li){li.preventDefault(),wr=!0,fa(),si.forEach(function(Wi){Wi()})}function ss(li){ze.getError(),wr=!1,Ht.restore(),zr.restore(),Vr.restore(),sn.restore(),Rr.restore(),nn.restore(),mn.restore(),Jr&&Jr.restore(),Xn.procs.refresh(),ji(),ui.forEach(function(Wi){Wi()})}Nr&&(Nr.addEventListener(Bh,Jo,!1),Nr.addEventListener(Nh,ss,!1));function $i(){Mr.length=0,fa(),Nr&&(Nr.removeEventListener(Bh,Jo),Nr.removeEventListener(Nh,ss)),zr.clear(),nn.clear(),Rr.clear(),sn.clear(),Sn.clear(),Vr.clear(),mn.clear(),Jr&&Jr.clear(),kn.forEach(function(li){li()})}function vo(li){H(!!li,"invalid args to regl({...})"),H.type(li,"object","invalid args to regl({...})");function Wi(At){var ut=x({},At);delete ut.uniforms,delete ut.attributes,delete ut.context,delete ut.vao,"stencil"in ut&&ut.stencil.op&&(ut.stencil.opBack=ut.stencil.opFront=ut.stencil.op,delete ut.stencil.op);function at(St){if(St in ut){var De=ut[St];delete ut[St],Object.keys(De).forEach(function(tt){ut[St+"."+tt]=De[tt]})}}return at("blend"),at("depth"),at("cull"),at("stencil"),at("polygonOffset"),at("scissor"),at("sample"),"vao"in At&&(ut.vao=At.vao),ut}function oa(At,ut){var at={},St={};return Object.keys(At).forEach(function(De){var tt=At[De];if(lt.isDynamic(tt)){St[De]=lt.unbox(tt,De);return}else if(ut&&Array.isArray(tt)){for(var Ie=0;Ie<tt.length;++Ie)if(lt.isDynamic(tt[Ie])){St[De]=lt.unbox(tt,De);return}}at[De]=tt}),{dynamic:St,static:at}}var qo=oa(li.context||{},!0),El=oa(li.uniforms||{},!0),wl=oa(li.attributes||{},!1),Ue=oa(Wi(li),!1),$t={gpuTime:0,cpuTime:0,count:0},Wt=Xn.compile(Ue,wl,El,qo,$t),Cn=Wt.draw,Xi=Wt.batch,Le=Wt.scope,xe=[];function it(At){for(;xe.length<At;)xe.push(null);return xe}function Ot(At,ut){var at;if(wr&&H.raise("context lost"),typeof At=="function")return Le.call(this,null,At,0);if(typeof ut=="function")if(typeof At=="number")for(at=0;at<At;++at)Le.call(this,null,ut,at);else if(Array.isArray(At))for(at=0;at<At.length;++at)Le.call(this,At[at],ut,at);else return Le.call(this,At,ut,0);else if(typeof At=="number"){if(At>0)return Xi.call(this,it(At|0),At|0)}else if(Array.isArray(At)){if(At.length)return Xi.call(this,At,At.length)}else return Cn.call(this,At)}return x(Ot,{stats:$t,destroy:function(){Wt.destroy()}})}var so=nn.setFBO=vo({framebuffer:lt.define.call(null,Kf,"framebuffer")});function Qo(li,Wi){var oa=0;Xn.procs.poll();var qo=Wi.color;qo&&(ze.clearColor(+qo[0]||0,+qo[1]||0,+qo[2]||0,+qo[3]||0),oa|=oh),"depth"in Wi&&(ze.clearDepth(+Wi.depth),oa|=dp),"stencil"in Wi&&(ze.clearStencil(Wi.stencil|0),oa|=Fh),H(!!oa,"called regl.clear with no buffer specified"),ze.clear(oa)}function ys(li){if(H(typeof li=="object"&&li,"regl.clear() takes an object as input"),"framebuffer"in li)if(li.framebuffer&&li.framebuffer_reglType==="framebufferCube")for(var Wi=0;Wi<6;++Wi)so(x({framebuffer:li.framebuffer.faces[Wi]},li),Qo);else so(li,Qo);else Qo(null,li)}function Es(li){H.type(li,"function","regl.frame() callback must be a function"),Mr.push(li);function Wi(){var oa=$c(Mr,li);H(oa>=0,"cannot cancel a frame twice");function qo(){var El=$c(Mr,qo);Mr[El]=Mr[Mr.length-1],Mr.length-=1,Mr.length<=0&&fa()}Mr[oa]=qo}return ji(),{cancel:Wi}}function ks(){var li=on.viewport,Wi=on.scissor_box;li[0]=li[1]=Wi[0]=Wi[1]=0,jr.viewportWidth=jr.framebufferWidth=jr.drawingBufferWidth=li[2]=Wi[2]=ze.drawingBufferWidth,jr.viewportHeight=jr.framebufferHeight=jr.drawingBufferHeight=li[3]=Wi[3]=ze.drawingBufferHeight}function _s(){jr.tick+=1,jr.time=Ni(),ks(),Xn.procs.poll()}function Fo(){sn.refresh(),ks(),Xn.procs.refresh(),Jr&&Jr.update()}function Ni(){return(Qt()-Gr)/1e3}Fo();function Fs(li,Wi){H.type(Wi,"function","listener callback must be a function");var oa;switch(li){case"frame":return Es(Wi);case"lost":oa=si;break;case"restore":oa=ui;break;case"destroy":oa=kn;break;default:H.raise("invalid event, must be one of frame,lost,restore,destroy")}return oa.push(Wi),{cancel:function(){for(var qo=0;qo<oa.length;++qo)if(oa[qo]===Wi){oa[qo]=oa[oa.length-1],oa.pop();return}}}}var Sa=x(vo,{clear:ys,prop:lt.define.bind(null,Kf),context:lt.define.bind(null,mp),this:lt.define.bind(null,zh),draw:vo({}),buffer:function(li){return Vr.create(li,vp,!1,!1)},elements:function(li){return Sn.create(li,!1)},texture:sn.create2D,cube:sn.createCube,renderbuffer:Rr.create,framebuffer:nn.create,framebufferCube:nn.createCube,vao:mn.createVAO,attributes:qt,frame:Es,on:Fs,limits:lr,hasExtension:function(li){return lr.extensions.indexOf(li.toLowerCase())>=0},read:Kn,destroy:$i,_gl:ze,_refresh:Fo,poll:function(){_s(),Jr&&Jr.update()},now:Ni,stats:Ur});return Te.onDone(null,Sa),Sa}return Zh})},69848:function(sr){(function(L,x){sr.exports=x()})(this,function(){"use strict";function L(xt,Ke,_t,Fe,Pe,Ve){if(!(Pe-Fe<=_t)){var Et=Fe+Pe>>1;x(xt,Ke,Et,Fe,Pe,Ve%2),L(xt,Ke,_t,Fe,Et-1,Ve+1),L(xt,Ke,_t,Et+1,Pe,Ve+1)}}function x(xt,Ke,_t,Fe,Pe,Ve){for(;Pe>Fe;){if(Pe-Fe>600){var Et=Pe-Fe+1,gr=_t-Fe+1,ae=Math.log(Et),Ae=.5*Math.exp(2*ae/3),oe=.5*Math.sqrt(ae*Ae*(Et-Ae)/Et)*(gr-Et/2<0?-1:1),ge=Math.max(Fe,Math.floor(_t-gr*Ae/Et+oe)),Me=Math.min(Pe,Math.floor(_t+(Et-gr)*Ae/Et+oe));x(xt,Ke,_t,ge,Me,Ve)}var Qe=Ke[2*_t+Ve],gt=Fe,Jt=Pe;for(Q(xt,Ke,Fe,_t),Ke[2*Pe+Ve]>Qe&&Q(xt,Ke,Fe,Pe);gt<Jt;){for(Q(xt,Ke,gt,Jt),gt++,Jt--;Ke[2*gt+Ve]<Qe;)gt++;for(;Ke[2*Jt+Ve]>Qe;)Jt--}Ke[2*Fe+Ve]===Qe?Q(xt,Ke,Fe,Jt):(Jt++,Q(xt,Ke,Jt,Pe)),Jt<=_t&&(Fe=Jt+1),_t<=Jt&&(Pe=Jt-1)}}function Q(xt,Ke,_t,Fe){w(xt,_t,Fe),w(Ke,2*_t,2*Fe),w(Ke,2*_t+1,2*Fe+1)}function w(xt,Ke,_t){var Fe=xt[Ke];xt[Ke]=xt[_t],xt[_t]=Fe}function d(xt,Ke,_t,Fe,Pe,Ve,Et){for(var gr=[0,xt.length-1,0],ae=[],Ae,oe;gr.length;){var ge=gr.pop(),Me=gr.pop(),Qe=gr.pop();if(Me-Qe<=Et){for(var gt=Qe;gt<=Me;gt++)Ae=Ke[2*gt],oe=Ke[2*gt+1],Ae>=_t&&Ae<=Pe&&oe>=Fe&&oe<=Ve&&ae.push(xt[gt]);continue}var Jt=Math.floor((Qe+Me)/2);Ae=Ke[2*Jt],oe=Ke[2*Jt+1],Ae>=_t&&Ae<=Pe&&oe>=Fe&&oe<=Ve&&ae.push(xt[Jt]);var Dr=(ge+1)%2;(ge===0?_t<=Ae:Fe<=oe)&&(gr.push(Qe),gr.push(Jt-1),gr.push(Dr)),(ge===0?Pe>=Ae:Ve>=oe)&&(gr.push(Jt+1),gr.push(Me),gr.push(Dr))}return ae}function b(xt,Ke,_t,Fe,Pe,Ve){for(var Et=[0,xt.length-1,0],gr=[],ae=Pe*Pe;Et.length;){var Ae=Et.pop(),oe=Et.pop(),ge=Et.pop();if(oe-ge<=Ve){for(var Me=ge;Me<=oe;Me++)Y(Ke[2*Me],Ke[2*Me+1],_t,Fe)<=ae&&gr.push(xt[Me]);continue}var Qe=Math.floor((ge+oe)/2),gt=Ke[2*Qe],Jt=Ke[2*Qe+1];Y(gt,Jt,_t,Fe)<=ae&&gr.push(xt[Qe]);var Dr=(Ae+1)%2;(Ae===0?_t-Pe<=gt:Fe-Pe<=Jt)&&(Et.push(ge),Et.push(Qe-1),Et.push(Dr)),(Ae===0?_t+Pe>=gt:Fe+Pe>=Jt)&&(Et.push(Qe+1),Et.push(oe),Et.push(Dr))}return gr}function Y(xt,Ke,_t,Fe){var Pe=xt-_t,Ve=Ke-Fe;return Pe*Pe+Ve*Ve}var W=function(xt){return xt[0]},$=function(xt){return xt[1]},I=function(Ke,_t,Fe,Pe,Ve){_t===void 0&&(_t=W),Fe===void 0&&(Fe=$),Pe===void 0&&(Pe=64),Ve===void 0&&(Ve=Float64Array),this.nodeSize=Pe,this.points=Ke;for(var Et=Ke.length<65536?Uint16Array:Uint32Array,gr=this.ids=new Et(Ke.length),ae=this.coords=new Ve(Ke.length*2),Ae=0;Ae<Ke.length;Ae++)gr[Ae]=Ae,ae[2*Ae]=_t(Ke[Ae]),ae[2*Ae+1]=Fe(Ke[Ae]);L(gr,ae,Pe,0,gr.length-1,0)};I.prototype.range=function(Ke,_t,Fe,Pe){return d(this.ids,this.coords,Ke,_t,Fe,Pe,this.nodeSize)},I.prototype.within=function(Ke,_t,Fe){return b(this.ids,this.coords,Ke,_t,Fe,this.nodeSize)};var k={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(xt){return xt}},we=Math.fround||function(xt){return function(Ke){return xt[0]=+Ke,xt[0]}}(new Float32Array(1)),Be=function(Ke){this.options=Ir(Object.create(k),Ke),this.trees=new Array(this.options.maxZoom+1)};Be.prototype.load=function(Ke){var _t=this.options,Fe=_t.log,Pe=_t.minZoom,Ve=_t.maxZoom,Et=_t.nodeSize;Fe&&console.time("total time");var gr="prepare "+Ke.length+" points";Fe&&console.time(gr),this.points=Ke;for(var ae=[],Ae=0;Ae<Ke.length;Ae++)!Ke[Ae].geometry||ae.push($e(Ke[Ae],Ae));this.trees[Ve+1]=new I(ae,er,nr,Et,Float32Array),Fe&&console.timeEnd(gr);for(var oe=Ve;oe>=Pe;oe--){var ge=+Date.now();ae=this._cluster(ae,oe),this.trees[oe]=new I(ae,er,nr,Et,Float32Array),Fe&&console.log("z%d: %d clusters in %dms",oe,ae.length,+Date.now()-ge)}return Fe&&console.timeEnd("total time"),this},Be.prototype.getClusters=function(Ke,_t){var Fe=((Ke[0]+180)%360+360)%360-180,Pe=Math.max(-90,Math.min(90,Ke[1])),Ve=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,Et=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)Fe=-180,Ve=180;else if(Fe>Ve){var gr=this.getClusters([Fe,Pe,180,Et],_t),ae=this.getClusters([-180,Pe,Ve,Et],_t);return gr.concat(ae)}for(var Ae=this.trees[this._limitZoom(_t)],oe=Ae.range(kt(Fe),Lt(Et),kt(Ve),Lt(Pe)),ge=[],Me=0,Qe=oe;Me<Qe.length;Me+=1){var gt=Qe[Me],Jt=Ae.points[gt];ge.push(Jt.numPoints?Ut(Jt):this.points[Jt.index])}return ge},Be.prototype.getChildren=function(Ke){var _t=this._getOriginId(Ke),Fe=this._getOriginZoom(Ke),Pe="No cluster with the specified id.",Ve=this.trees[Fe];if(!Ve)throw new Error(Pe);var Et=Ve.points[_t];if(!Et)throw new Error(Pe);for(var gr=this.options.radius/(this.options.extent*Math.pow(2,Fe-1)),ae=Ve.within(Et.x,Et.y,gr),Ae=[],oe=0,ge=ae;oe<ge.length;oe+=1){var Me=ge[oe],Qe=Ve.points[Me];Qe.parentId===Ke&&Ae.push(Qe.numPoints?Ut(Qe):this.points[Qe.index])}if(Ae.length===0)throw new Error(Pe);return Ae},Be.prototype.getLeaves=function(Ke,_t,Fe){_t=_t||10,Fe=Fe||0;var Pe=[];return this._appendLeaves(Pe,Ke,_t,Fe,0),Pe},Be.prototype.getTile=function(Ke,_t,Fe){var Pe=this.trees[this._limitZoom(Ke)],Ve=Math.pow(2,Ke),Et=this.options,gr=Et.extent,ae=Et.radius,Ae=ae/gr,oe=(Fe-Ae)/Ve,ge=(Fe+1+Ae)/Ve,Me={features:[]};return this._addTileFeatures(Pe.range((_t-Ae)/Ve,oe,(_t+1+Ae)/Ve,ge),Pe.points,_t,Fe,Ve,Me),_t===0&&this._addTileFeatures(Pe.range(1-Ae/Ve,oe,1,ge),Pe.points,Ve,Fe,Ve,Me),_t===Ve-1&&this._addTileFeatures(Pe.range(0,oe,Ae/Ve,ge),Pe.points,-1,Fe,Ve,Me),Me.features.length?Me:null},Be.prototype.getClusterExpansionZoom=function(Ke){for(var _t=this._getOriginZoom(Ke)-1;_t<=this.options.maxZoom;){var Fe=this.getChildren(Ke);if(_t++,Fe.length!==1)break;Ke=Fe[0].properties.cluster_id}return _t},Be.prototype._appendLeaves=function(Ke,_t,Fe,Pe,Ve){for(var Et=this.getChildren(_t),gr=0,ae=Et;gr<ae.length;gr+=1){var Ae=ae[gr],oe=Ae.properties;if(oe&&oe.cluster?Ve+oe.point_count<=Pe?Ve+=oe.point_count:Ve=this._appendLeaves(Ke,oe.cluster_id,Fe,Pe,Ve):Ve<Pe?Ve++:Ke.push(Ae),Ke.length===Fe)break}return Ve},Be.prototype._addTileFeatures=function(Ke,_t,Fe,Pe,Ve,Et){for(var gr=0,ae=Ke;gr<ae.length;gr+=1){var Ae=ae[gr],oe=_t[Ae],ge=oe.numPoints,Me=void 0,Qe=void 0,gt=void 0;if(ge)Me=Yt(oe),Qe=oe.x,gt=oe.y;else{var Jt=this.points[oe.index];Me=Jt.properties,Qe=kt(Jt.geometry.coordinates[0]),gt=Lt(Jt.geometry.coordinates[1])}var Dr={type:1,geometry:[[Math.round(this.options.extent*(Qe*Ve-Fe)),Math.round(this.options.extent*(gt*Ve-Pe))]],tags:Me},Br=void 0;ge?Br=oe.id:this.options.generateId?Br=oe.index:this.points[oe.index].id&&(Br=this.points[oe.index].id),Br!==void 0&&(Dr.id=Br),Et.features.push(Dr)}},Be.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(+Ke,this.options.maxZoom+1))},Be.prototype._cluster=function(Ke,_t){for(var Fe=[],Pe=this.options,Ve=Pe.radius,Et=Pe.extent,gr=Pe.reduce,ae=Pe.minPoints,Ae=Ve/(Et*Math.pow(2,_t)),oe=0;oe<Ke.length;oe++){var ge=Ke[oe];if(!(ge.zoom<=_t)){ge.zoom=_t;for(var Me=this.trees[_t+1],Qe=Me.within(ge.x,ge.y,Ae),gt=ge.numPoints||1,Jt=gt,Dr=0,Br=Qe;Dr<Br.length;Dr+=1){var un=Br[Dr],tr=Me.points[un];tr.zoom>_t&&(Jt+=tr.numPoints||1)}if(Jt>=ae){for(var se=ge.x*gt,be=ge.y*gt,ke=gr&&gt>1?this._map(ge,!0):null,Ce=(oe<<5)+(_t+1)+this.points.length,Pt=0,Dt=Qe;Pt<Dt.length;Pt+=1){var E=Dt[Pt],N=Me.points[E];if(!(N.zoom<=_t)){N.zoom=_t;var he=N.numPoints||1;se+=N.x*he,be+=N.y*he,N.parentId=Ce,gr&&(ke||(ke=this._map(ge,!0)),gr(ke,this._map(N)))}}ge.parentId=Ce,Fe.push(We(se/Jt,be/Jt,Ce,Jt,ke))}else if(Fe.push(ge),Jt>1)for(var Ze=0,qe=Qe;Ze<qe.length;Ze+=1){var mt=qe[Ze],Ct=Me.points[mt];Ct.zoom<=_t||(Ct.zoom=_t,Fe.push(Ct))}}}return Fe},Be.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},Be.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},Be.prototype._map=function(Ke,_t){if(Ke.numPoints)return _t?Ir({},Ke.properties):Ke.properties;var Fe=this.points[Ke.index].properties,Pe=this.options.map(Fe);return _t&&Pe===Fe?Ir({},Pe):Pe};function We(xt,Ke,_t,Fe,Pe){return{x:we(xt),y:we(Ke),zoom:Infinity,id:_t,parentId:-1,numPoints:Fe,properties:Pe}}function $e(xt,Ke){var _t=xt.geometry.coordinates,Fe=_t[0],Pe=_t[1];return{x:we(kt(Fe)),y:we(Lt(Pe)),zoom:Infinity,index:Ke,parentId:-1}}function Ut(xt){return{type:"Feature",id:xt.id,properties:Yt(xt),geometry:{type:"Point",coordinates:[bt(xt.x),pt(xt.y)]}}}function Yt(xt){var Ke=xt.numPoints,_t=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return Ir(Ir({},xt.properties),{cluster:!0,cluster_id:xt.id,point_count:Ke,point_count_abbreviated:_t})}function kt(xt){return xt/360+.5}function Lt(xt){var Ke=Math.sin(xt*Math.PI/180),_t=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return _t<0?0:_t>1?1:_t}function bt(xt){return(xt-.5)*360}function pt(xt){var Ke=(180-xt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function Ir(xt,Ke){for(var _t in Ke)xt[_t]=Ke[_t];return xt}function er(xt){return xt.x}function nr(xt){return xt.y}return Be})},75752:function(sr){sr.exports.RADIUS=6378137,sr.exports.FLATTENING=1/298.257223563,sr.exports.POLAR_RADIUS=63567523142e-4}}]);
